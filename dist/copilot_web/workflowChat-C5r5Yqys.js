function getImportPath(filename) {
            return `./${filename}`;
        }
            const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["copilot_web/WorkflowOption-CftQ5G2f.js","copilot_web/vendor-markdown-CBmlBP6m.js","copilot_web/vendor-react-Dixhfmvb.js","copilot_web/message-components-D6lPlYs-.js","copilot_web/DebugGuide-BXNjYS8H.js","copilot_web/DebugResult-BHewBqvk.js"].map(path => {
                        const apiBase = window.comfyAPI?.api?.api?.api_base;
                        if (apiBase) {
                            // 有 API base 时，使用完整路径
                            return `${apiBase.substring(1)}/${path}`;
                        } else {        
                            // 没有 API base 时，使用相对路径
                            return `./${path}`;
                        }
                    }))))=>i.map(i=>d[i]);
import{j as i,r as Fg,b as zg}from"./vendor-markdown-CBmlBP6m.js";import{r as k,R as pr,c as gr,a as Ug}from"./vendor-react-Dixhfmvb.js";import{f as Gg,v as Hg,W as Tt,g as Xe,a as Re,B as Kg,U as qg,A as hs,b as Jg,c as yr,u as Gn,d as Yg,M as Vg}from"./message-components-D6lPlYs-.js";import{_ as jn}from"./input.js";/* empty css     *//**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zg=a=>a.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Sl=(...a)=>a.filter((u,r,f)=>!!u&&u.trim()!==""&&f.indexOf(u)===r).join(" ").trim();/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Xg={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qg=k.forwardRef(({color:a="currentColor",size:u=24,strokeWidth:r=2,absoluteStrokeWidth:f,className:d="",children:h,iconNode:g,...x},b)=>k.createElement("svg",{ref:b,...Xg,width:u,height:u,stroke:a,strokeWidth:f?Number(r)*24/Number(u):r,className:Sl("lucide",d),...x},[...g.map(([j,N])=>k.createElement(j,N)),...Array.isArray(h)?h:[h]]));/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const un=(a,u)=>{const r=k.forwardRef(({className:f,...d},h)=>k.createElement(Qg,{ref:h,iconNode:u,className:Sl(`lucide-${Zg(a)}`,f),...d}));return r.displayName=`${a}`,r};/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ep=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["rect",{x:"9",y:"9",width:"6",height:"6",rx:"1",key:"1ssd4o"}]],tp=un("CircleStop",ep);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const np=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],rp=un("History",np);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sp=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],ip=un("Image",sp);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const op=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],ap=un("Plus",op);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lp=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],cp=un("Send",lp);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const up=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],dp=un("Settings",up);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fp=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]],hp=un("Trash",fp);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gp=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],gs=un("X",gp);function pp({isOpen:a,onClose:u,onSave:r,initialApiKey:f=""}){const[d,h]=k.useState(f),[g,x]=k.useState(!1),[b,j]=k.useState(""),[N,_]=k.useState("https://api.openai.com/v1"),[E,O]=k.useState(!1),[P,B]=k.useState(!1),[G,R]=k.useState(null),[X,K]=k.useState(null);k.useEffect(()=>{h(f);const D=localStorage.getItem("openaiApiKey"),V=localStorage.getItem("openaiBaseUrl");D&&j(D),V&&_(V),(async()=>{try{const z=localStorage.getItem("rsaPublicKey");if(z)K(z);else{const ce=await Gg();K(ce),localStorage.setItem("rsaPublicKey",ce)}}catch(z){console.error("Failed to fetch RSA public key:",z)}})()},[f]);const w=async()=>{if(!b.trim()){R({success:!1,message:"Please enter an OpenAI API key"});return}if(!X){R({success:!1,message:"RSA public key not available. Please try again later."});return}B(!0),R(null);try{const D=await Hg(b,N);R({success:D,message:D?"API key is valid!":"Invalid API key. Please check and try again."})}catch(D){R({success:!1,message:D instanceof Error?D.message:"Failed to verify API key"})}finally{B(!1)}},M=()=>{r(d),b.trim()?(localStorage.setItem("openaiApiKey",b),localStorage.setItem("openaiBaseUrl",N)):(localStorage.removeItem("openaiApiKey"),localStorage.removeItem("openaiBaseUrl")),u()};return a?i.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50",children:i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-8 w-[480px] shadow-2xl",children:[i.jsx("h2",{className:"text-xl text-gray-900 dark:text-white font-semibold mb-6",children:"Set API Key"}),i.jsxs("div",{className:"mb-6",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ComfyUI Copilot API Key"}),i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:g?"text":"password",value:d,onChange:D=>h(D.target.value),placeholder:"Enter your API key",className:`w-full px-4 py-3 border border-gray-200 dark:border-gray-600 rounded-lg mb-4 pr-12
                            bg-gray-50 dark:bg-gray-700 
                            text-gray-900 dark:text-white
                            placeholder-gray-500 dark:placeholder-gray-400
                            focus:border-blue-500 dark:focus:border-blue-400 
                            focus:ring-2 focus:ring-blue-500/20 dark:focus:ring-blue-400/20
                            focus:outline-none`}),i.jsx("button",{type:"button",className:`absolute inset-y-0 right-0 pr-4 flex items-center text-gray-500 dark:text-gray-400 
                            hover:text-gray-700 dark:hover:text-gray-200 transition-colors bg-transparent border-none`,onClick:()=>x(!g),children:g?i.jsxs("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}):i.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})})})]}),i.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:[i.jsx("span",{children:"Don't have an API key? "}),i.jsx("a",{href:"https://form.typeform.com/to/tkg91K8D",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 font-medium",children:"Click here to request one"})]})]}),i.jsxs("div",{className:"mb-6 border-t border-gray-200 dark:border-gray-700 pt-6",children:[i.jsx("h3",{className:"text-sm text-gray-900 dark:text-white font-medium mb-4",children:"OpenAI API Configuration (Optional)"}),i.jsxs("div",{className:"mb-4",children:[i.jsx("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-2",children:"OpenAI API Key"}),i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:E?"text":"password",value:b,onChange:D=>j(D.target.value),placeholder:"Enter your OpenAI API key",className:`w-full px-4 py-3 border border-gray-200 dark:border-gray-600 rounded-lg pr-12 text-xs
                                bg-gray-50 dark:bg-gray-700 
                                text-gray-900 dark:text-white
                                placeholder-gray-500 dark:placeholder-gray-400
                                focus:border-blue-500 dark:focus:border-blue-400 
                                focus:ring-2 focus:ring-blue-500/20 dark:focus:ring-blue-400/20
                                focus:outline-none`}),i.jsx("button",{type:"button",className:`absolute inset-y-0 right-0 pr-4 flex items-center text-gray-500 dark:text-gray-400 
                                hover:text-gray-700 dark:hover:text-gray-200 transition-colors bg-transparent border-none`,onClick:()=>O(!E),children:E?i.jsxs("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}):i.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})})})]})]}),i.jsxs("div",{className:"mb-4",children:[i.jsx("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-2",children:"OpenAI Base URL"}),i.jsx("input",{type:"text",value:N,onChange:D=>_(D.target.value),placeholder:"https://api.openai.com/v1",className:`w-full px-4 py-3 border border-gray-200 dark:border-gray-600 rounded-lg text-xs
                            bg-gray-50 dark:bg-gray-700 
                            text-gray-900 dark:text-white
                            placeholder-gray-500 dark:placeholder-gray-400
                            focus:border-blue-500 dark:focus:border-blue-400 
                            focus:ring-2 focus:ring-blue-500/20 dark:focus:ring-blue-400/20
                            focus:outline-none`})]}),i.jsx("div",{className:"flex items-center mb-2",children:i.jsx("button",{onClick:w,disabled:P||!b.trim(),className:`px-4 py-2 rounded-lg font-medium text-xs transition-colors ${P||!b.trim()?"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white"}`,children:P?i.jsxs("span",{className:"flex items-center",children:[i.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[i.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),i.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Verifying..."]}):"Verify"})}),G&&i.jsx("div",{className:`text-xs p-2 rounded-md ${G.success?"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-400":"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400"}`,children:G.message})]}),i.jsxs("div",{className:"flex justify-end gap-3",children:[i.jsx("button",{onClick:u,className:`px-5 py-2.5 text-gray-700 bg-white dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 
                        rounded-lg font-medium transition-colors`,children:"Cancel"}),i.jsx("button",{onClick:M,className:`px-5 py-2.5 bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 
                        text-white rounded-lg font-medium transition-colors`,children:"Save"})]})]})}):null}class mp{dbName="ComfyUICopilotDB";version=1;storeName="chatSessions";db=null;async init(){return new Promise((u,r)=>{const f=indexedDB.open(this.dbName,this.version);f.onerror=()=>{r(new Error("Failed to open IndexedDB"))},f.onsuccess=()=>{this.db=f.result,u()},f.onupgradeneeded=d=>{const h=d.target.result;h.objectStoreNames.contains(this.storeName)||h.createObjectStore(this.storeName,{keyPath:"id"}).createIndex("lastUpdated","lastUpdated",{unique:!1})}})}async saveSession(u,r){if(this.db||await this.init(),!this.db)throw new Error("Database not initialized");const f=r.find(h=>h.role==="user")?.content||"",d={id:u,firstMessage:f.length>50?f.substring(0,50)+"...":f,lastUpdated:Date.now(),messages:r};return new Promise((h,g)=>{const j=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).put(d);j.onsuccess=()=>h(),j.onerror=()=>g(new Error("Failed to save session"))})}async getSession(u){if(this.db||await this.init(),!this.db)throw new Error("Database not initialized");return new Promise((r,f)=>{const g=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName).get(u);g.onsuccess=()=>{r(g.result||null)},g.onerror=()=>f(new Error("Failed to get session"))})}async getAllSessions(){if(this.db||await this.init(),!this.db)throw new Error("Database not initialized");return new Promise((u,r)=>{const g=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName).index("lastUpdated").openCursor(null,"prev"),x=[];g.onsuccess=()=>{const b=g.result;b?(x.push(b.value),b.continue()):u(x)},g.onerror=()=>r(new Error("Failed to get all sessions"))})}async deleteSession(u){if(this.db||await this.init(),!this.db)throw new Error("Database not initialized");return new Promise((r,f)=>{const g=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).delete(u);g.onsuccess=()=>r(),g.onerror=()=>f(new Error("Failed to delete session"))})}}const mr=new mp;function xp({isOpen:a,onClose:u,onSelectSession:r,currentSessionId:f}){const[d,h]=k.useState([]),[g,x]=k.useState(!1);k.useEffect(()=>{a&&b()},[a]);const b=async()=>{x(!0);try{const E=await mr.getAllSessions();h(E)}catch(E){console.error("Failed to load sessions:",E)}finally{x(!1)}},j=E=>{const O=new Date(E),B=new Date().getTime()-O.getTime(),G=Math.floor(B/(1e3*60*60*24));return G===0?O.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):G===1?"昨天":G<7?`${G}天前`:O.toLocaleDateString("zh-CN",{month:"short",day:"numeric"})},N=E=>{r(E.id,E.messages),u()},_=async(E,O)=>{if(E.stopPropagation(),confirm("确定要删除这个会话吗？"))try{await mr.deleteSession(O),b()}catch(P){console.error("Failed to delete session:",P)}};return a?i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-96 max-h-[80vh] flex flex-col",children:[i.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[i.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100",children:"Session History"}),i.jsx("button",{onClick:u,className:"text-gray-400 hover:text-gray-600 dark:hover:text-white transition-colors",children:i.jsx(gs,{className:"h-5 w-5"})})]}),i.jsx("div",{className:"flex-1 overflow-y-auto",children:g?i.jsx("div",{className:"flex items-center justify-center py-8",children:i.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"Loading..."})}):d.length===0?i.jsx("div",{className:"flex items-center justify-center py-8",children:i.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"No session history"})}):i.jsx("div",{className:"space-y-1 p-2",children:d.map(E=>i.jsxs("div",{onClick:()=>N(E),className:`flex items-center justify-between p-3 rounded-lg cursor-pointer group ${E.id===f?"dark:bg-gray-700 border border-blue-200 dark:border-gray-600":"hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:[i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsxs("div",{className:"flex items-center justify-between mb-1",children:[i.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:j(E.lastUpdated)}),E.id===f&&i.jsx("span",{className:"text-xs text-blue-600 dark:text-blue-400 font-medium",children:"Current"})]}),i.jsx("div",{className:"text-sm text-gray-900 dark:text-gray-100 truncate",children:E.firstMessage||"Empty session"})]}),i.jsx("button",{onClick:O=>_(O,E.id),className:"ml-2 p-1 text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-all",title:"Delete session",children:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]},E.id))})}),i.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 text-xs text-gray-500 dark:text-gray-400",children:["Click session to switch, total ",d.length," sessions"]})]})}):null}const vp="/copilot_web/assets/logo-BTZhX0BN.png";function yp({onClose:a,onClear:u,hasMessages:r,onHeightResize:f,title:d="ComfyUI-Copilot",onSelectSession:h,currentSessionId:g}){const[x,b]=k.useState(!1),[j,N]=k.useState(!1),[_,E]=k.useState(!1),O=()=>{b(!0)},P=()=>{N(!0)},B=R=>{localStorage.setItem("chatApiKey",R)},G=(R,X)=>{h?.(R,X)};return k.useEffect(()=>{const R=K=>{if(!_)return;const w=K.movementY;f?.(w)},X=()=>{E(!1)};return _&&(document.addEventListener("mousemove",R),document.addEventListener("mouseup",X)),()=>{document.removeEventListener("mousemove",R),document.removeEventListener("mouseup",X)}},[_,f]),i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:`flex items-center justify-between border-b px-3 py-2 
                        bg-white border-gray-200 sticky top-2 z-10`,children:[i.jsxs("div",{className:"flex items-center space-x-1",children:[i.jsx("img",{src:`.${vp}`,alt:"ComfyUI-Copilot Logo",className:"h-7 w-7 -ml-1"}),i.jsx("h3",{className:"text-[14px] font-medium text-gray-800",children:d}),i.jsx("button",{onClick:O,className:"p-1 bg-white border-none hover:bg-gray-100 rounded text-gray-500",children:i.jsx(dp,{className:"h-4 w-4"})})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx("button",{onClick:P,className:"p-1.5 bg-white border-none hover:bg-gray-100 rounded text-gray-500",title:"Session History",children:i.jsx(rp,{className:"h-4 w-4"})}),i.jsx("button",{className:`inline-flex bg-white border-none items-center justify-center rounded-md p-1.5 
                                 ${r?"text-gray-500 hover:bg-gray-100":"text-gray-300 cursor-not-allowed"}`,disabled:!r,onClick:u,children:i.jsx(hp,{className:"h-4 w-4"})})]})]}),i.jsx(pp,{isOpen:x,onClose:()=>b(!1),onSave:B,initialApiKey:localStorage.getItem("chatApiKey")||""}),i.jsx(xp,{isOpen:j,onClose:()=>N(!1),onSelectSession:G,currentSessionId:g||null})]})}const bp=({className:a})=>i.jsx("svg",{className:a,viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M20 8h-2.81c-.45-.78-1.07-1.45-1.82-1.96L17 4.41 15.59 3l-2.17 2.17C12.96 5.06 12.49 5 12 5s-.96.06-1.42.17L8.41 3 7 4.41l1.63 1.63C7.88 6.55 7.26 7.22 6.81 8H4v2h2.09c-.05.33-.09.66-.09 1v1H4v2h2v1c0 .34.04.67.09 1H4v2h2.81c1.04 1.79 2.97 3 5.19 3s4.15-1.21 5.19-3H20v-2h-2.09c.05-.33.09-.66.09-1v-1h2v-2h-2v-1c0-.34-.04-.67-.09-1H20V8zm-6 8h-4v-2h4v2zm0-4h-4v-2h4v2z"})}),wp=5*1024*1024,fl=["image/jpeg","image/png","image/gif","image/webp"];function _p({input:a,loading:u,onChange:r,onSend:f,onKeyPress:d,onUploadImages:h,uploadedImages:g,onRemoveImage:x,selectedModel:b,onModelChange:j,onStop:N,onAddDebugMessage:_}){const[E,O]=k.useState(!1),[P,B]=k.useState([]),G=pr.useRef(null),R=k.useRef(null);k.useEffect(()=>{R.current&&(R.current.style.height="auto",R.current.style.height=`${Math.min(R.current.scrollHeight,400)}px`)},[a]),k.useEffect(()=>{(async()=>{try{const M=await Tt.listModels();B(M.models)}catch(M){console.error("Failed to load models:",M),B([{label:"gemini-2.5-flash",name:"gemini-2.5-flash",image_enable:!0},{label:"gpt-4.1",name:"gpt-4.1-2025-04-14-GlobalStandard",image_enable:!0},{label:"qwen-plus",name:"qwen-plus",image_enable:!1}])}})()},[]);const X=w=>{if(w.target.files){const M=[],D=[];if(Array.from(w.target.files).forEach(V=>{fl.includes(V.type)?V.size>wp?M.push(`${V.name} (exceeds 5MB)`):D.push(V):M.push(`${V.name} (unsupported format)`)}),M.length>0&&alert(`The following files couldn't be uploaded:
${M.join(`
`)}`),D.length>0){const V=new DataTransfer;D.forEach(je=>V.items.add(je)),h(V.files)}}},K=()=>{if(_){const w={id:Xe(),role:"ai",content:JSON.stringify({text:"Would you like me to help you debug the current workflow on the canvas?",ext:[]}),format:"debug_guide",name:"Assistant"};_(w)}};return i.jsxs("div",{className:`relative ${g.length>0?"mt-12":""}`,children:[g.length>0&&i.jsx("div",{className:"absolute -top-10 left-0 flex gap-2",children:g.map(w=>i.jsxs("div",{className:"relative group",children:[i.jsx("img",{src:w.preview,alt:"uploaded",className:"w-8 h-8 rounded object-cover"}),i.jsx("button",{onClick:()=>x(w.id),className:`absolute -top-1 -right-1 bg-white border-none text-gray-500 rounded-full p-0.5
                                         opacity-0 group-hover:opacity-100 transition-opacity`,children:i.jsx(gs,{className:"w-3 h-3"})})]},w.id))}),i.jsx("textarea",{ref:R,onChange:r,onKeyDown:w=>{if(w.key==="Enter"&&!w.shiftKey){if(w.nativeEvent.isComposing)return;w.preventDefault(),a.trim()!==""&&f()}d(w)},value:a,placeholder:"Type your message...",className:`w-full min-h-[80px] max-h-[400px] resize-none rounded-md border 
                         border-gray-200 px-3 py-2 pr-12 pb-10 text-[14px] shadow-sm 
                         focus:outline-none focus:ring-2 focus:ring-blue-500 
                         focus:border-transparent bg-white transition-all 
                         duration-200 text-gray-700 overflow-y-auto`,style:{height:"80px"}}),i.jsxs("div",{className:`absolute bottom-2 left-3 right-12 flex items-center gap-2 
                          bg-white border-t border-gray-100 pt-1`,children:[i.jsx("select",{value:b,onChange:w=>j(w.target.value),className:`px-1.5 py-0.5 text-xs rounded-md 
                             border border-gray-200 bg-white text-gray-700
                             focus:outline-none focus:ring-2 focus:ring-blue-500
                             focus:border-transparent hover:bg-gray-50
                             transition-colors border-0`,children:P.map(w=>i.jsx("option",{value:w.name,children:w.label},w.name))}),i.jsx("button",{type:"button",onClick:()=>O(!0),disabled:!P.find(w=>w.name===b)?.image_enable,className:`p-1.5 text-gray-500 bg-white border-none
                             hover:bg-gray-100 hover:text-gray-600 
                             transition-all duration-200 outline-none
                             ${P.find(w=>w.name===b)?.image_enable?"":"opacity-50 cursor-not-allowed"}`,children:i.jsx(ip,{className:"h-4 w-4"})})]}),i.jsx("button",{type:"submit",onClick:u?N:f,disabled:u?!1:a.trim()==="",className:`absolute bottom-3 right-3 p-2 rounded-md text-gray-500 bg-white border-none 
                         hover:bg-gray-100 hover:text-gray-600 disabled:opacity-50 
                         transition-all duration-200 active:scale-95`,children:u?i.jsx(tp,{className:"h-5 w-5 text-red-500 hover:text-red-600"}):i.jsx(cp,{className:"h-5 w-5 group-hover:translate-x-1"})}),i.jsx("button",{type:"button",onClick:K,className:`absolute bottom-3 right-14 p-2 rounded-md text-gray-500 bg-white border-none 
                         hover:bg-gray-100 hover:text-gray-600 
                         transition-all duration-200 active:scale-95`,title:"Debug workflow",children:i.jsx(bp,{className:"h-5 w-5"})}),E&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:i.jsxs("div",{className:"bg-white rounded-lg p-6 w-96 relative",children:[i.jsx("button",{onClick:()=>O(!1),className:"absolute top-2 right-2 bg-white border-none text-gray-500 hover:text-gray-700",children:i.jsx(gs,{className:"w-5 h-5"})}),i.jsx("h3",{className:"text-lg text-gray-800 font-medium mb-4",children:"Upload Images"}),i.jsxs("div",{className:`border-2 border-dashed border-gray-300 rounded-lg p-8
                                      flex flex-col items-center justify-center gap-4
                                      hover:border-blue-500 transition-colors cursor-pointer`,onClick:()=>G.current?.click(),children:[i.jsx(ap,{className:"w-8 h-8 text-gray-400"}),i.jsxs("div",{className:"text-center",children:[i.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"Click to upload images or drag and drop"}),i.jsx("p",{className:"text-xs text-gray-400",children:"Supported formats: JPG, PNG, GIF, WebP"}),i.jsx("p",{className:"text-xs text-gray-400",children:"Max file size: 5MB"})]})]}),i.jsx("input",{ref:G,type:"file",multiple:!0,accept:fl.join(","),onChange:X,className:"hidden"}),g.length>0&&i.jsx("div",{className:"mt-4 grid grid-cols-3 gap-2",children:g.map(w=>i.jsxs("div",{className:"relative group",children:[i.jsx("img",{src:w.preview,alt:"preview",className:"w-full h-20 object-cover rounded"}),i.jsx("button",{onClick:()=>x(w.id),className:`absolute -top-1 -right-1 bg-white border-none text-gray-500 
                                                     rounded-full p-0.5 opacity-0 group-hover:opacity-100 
                                                     transition-opacity`,children:i.jsx(gs,{className:"w-3 h-3"})})]},w.id))}),i.jsx("div",{className:"mt-4 flex justify-end gap-2",children:i.jsx("button",{onClick:()=>O(!1),className:`px-4 py-2 text-sm font-medium text-gray-700 
                                         bg-white border border-gray-300 rounded-md 
                                         hover:bg-gray-50`,children:"Close"})})]})})]})}function Sp(a){const u=a[0],r=new Set;function f(d,h){if(!(!d||h>=1)&&d.inputs)for(const g of Object.values(d.inputs)){const x=g.link;if(x&&Re.graph.links[x]){const b=Re.graph.links[x].origin_id,j=Re.graph._nodes_by_id[b];j&&(r.add(j.type),f(j,h+1))}}}return u?(f(u,0),[{type:"upstream_node_types",data:Array.from(r)}]):null}function Np({nodeInfo:a,onSendWithIntent:u,loading:r,onSendWithContent:f}){return console.log("SelectedNodeInfo nodeInfo:",a[0]),i.jsx("div",{className:"mb-3 p-3 rounded-md bg-gray-50 border border-gray-200",children:i.jsxs("div",{className:"text-sm text-gray-700",children:[i.jsxs("p",{children:["Selected node: ",a[0].type]}),i.jsxs("div",{className:"flex gap-2 mt-2",children:[i.jsx("button",{className:`px-3 py-1 text-xs rounded-md bg-blue-50 
                                 text-blue-700 hover:bg-blue-100`,onClick:()=>f(`Reply in ${navigator.language} language: How does the ${a[0].type} node work? I need its official usage guide.`),disabled:r,children:"Usage"}),i.jsx("button",{className:`px-3 py-1 text-xs rounded-md bg-green-100 
                                 text-green-700 hover:bg-green-200`,onClick:()=>f(`Reply in ${navigator.language} language: Show me the technical specifications for the ${a[0].type} node's inputs and outputs.`),disabled:r,children:"Parameters"}),i.jsx("button",{className:`px-3 py-1 text-xs rounded-md bg-purple-100 
                                 text-purple-700 hover:bg-purple-200`,onClick:()=>u("downstream_subgraph_search",Sp(a)),disabled:r,children:"Downstream Nodes"})]})]})})}function jp(){return i.jsx(Kg,{name:"Assistant",children:i.jsxs("div",{className:"flex items-center space-x-2 p-4 bg-gray-50 rounded-lg",children:[i.jsxs("div",{className:"flex space-x-1",children:[i.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),i.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),i.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]}),i.jsx("span",{className:"text-sm text-gray-500",children:"AI is thinking..."})]})})}const kp=a=>`https://ui-avatars.com/api/?name=${a||"User"}&background=random`,Ep=k.lazy(()=>jn(()=>import(getImportPath("WorkflowOption-CftQ5G2f.js")),__vite__mapDeps([0,1,2,3])).then(a=>({default:a.WorkflowOption}))),Cp=k.lazy(()=>jn(()=>import(getImportPath("message-components-D6lPlYs-.js")).then(a=>a.N),__vite__mapDeps([3,2,1])).then(a=>({default:a.NodeSearch}))),Ap=k.lazy(()=>jn(()=>import(getImportPath("message-components-D6lPlYs-.js")).then(a=>a.D),__vite__mapDeps([3,2,1])).then(a=>({default:a.DownstreamSubgraphs}))),Ip=k.lazy(()=>jn(()=>import(getImportPath("message-components-D6lPlYs-.js")).then(a=>a.h),__vite__mapDeps([3,2,1])).then(a=>({default:a.NodeInstallGuide}))),Mp=k.lazy(()=>jn(()=>import(getImportPath("DebugGuide-BXNjYS8H.js")),__vite__mapDeps([4,1,2,3])).then(a=>({default:a.DebugGuide}))),Lp=k.lazy(()=>jn(()=>import(getImportPath("DebugResult-BHewBqvk.js")),__vite__mapDeps([5,1,2,3])).then(a=>({default:a.DebugResult}))),Op=3;function Pp({messages:a,latestInput:u,onOptionClick:r,installedNodes:f,onAddMessage:d,loading:h,isActive:g}){const[x,b]=k.useState(0),[j,N]=k.useState([]),_=k.useRef(null),E=k.useRef(0),O=k.useRef(0),P=k.useRef(!1),B=()=>{_?.current&&(_.current.scrollTop=_.current.scrollHeight)},G=w=>{if(w.role==="user")return i.jsx(qg,{content:w.content,trace_id:w.trace_id},w.id);if(w.role==="ai"||w.role==="tool"){const M=kp(w.role);try{const D=JSON.parse(w.content),V=D.ext?.find(U=>U.type==="workflow"),je=D.ext?.find(U=>U.type==="node"),z=D.ext?.find(U=>U.type==="downstream_subgraph_search"),ce=D.ext?.find(U=>U.type==="node_install_guide"),be=D.ext?.find(U=>U.type==="workflow_update"),q=D.ext?.find(U=>U.type==="debug_checkpoint"),we=D.text==="The workflow has been successfully loaded to the canvas";if(be&&be.data){const{changes:U}=be.data;if(typeof window<"u"&&window.app&&U){console.log("[MessageList] Applying parameter changes to canvas...");try{jn(async()=>{const{applyParameterChanges:Q}=await import(getImportPath("message-components-D6lPlYs-.js")).then(fe=>fe.e);return{applyParameterChanges:Q}},__vite__mapDeps([3,2,1])).then(({applyParameterChanges:Q})=>{const fe=Array.isArray(U)?U:[U];Q(fe)?(console.log(`[MessageList] Successfully applied ${fe.length} parameter changes`),fe.forEach(xe=>{console.log(`[MessageList] Updated parameter ${xe.parameter} in node ${xe.node_id} to:`,xe.new_value)})):console.warn("[MessageList] Failed to apply some parameter changes")}).catch(Q=>{console.error("[MessageList] Failed to import graphUtils:",Q)})}catch(Q){console.error("[MessageList] Failed to update canvas:",Q)}}}let ee=null;if(V)ee=i.jsx(k.Suspense,{fallback:i.jsx("div",{children:"Loading..."}),children:i.jsx(Ep,{content:w.content,name:w.name,avatar:M,latestInput:u,installedNodes:f,onAddMessage:d,onFinishLoad:B})});else if(je)ee=i.jsx(k.Suspense,{fallback:i.jsx("div",{children:"Loading..."}),children:i.jsx(Cp,{content:w.content,name:w.name,avatar:M,installedNodes:f,onFinishLoad:B})});else if(z){const U=i.jsx(k.Suspense,{fallback:i.jsx("div",{children:"Loading..."}),children:i.jsx(Ap,{content:w.content,name:w.name,avatar:M,onAddMessage:d,onFinishLoad:B})});if(w.metadata?.intent==="downstream_subgraph_search")return i.jsx(hs,{content:w.content,name:w.name,avatar:M,format:w.format,onOptionClick:r,extComponent:U,metadata:w.metadata},w.id);ee=U}else ce?ee=i.jsx(k.Suspense,{fallback:i.jsx("div",{children:"Loading..."}),children:i.jsx(Ip,{content:w.content,onLoadSubgraph:()=>{if(w.metadata?.pendingSubgraph){const U=Object.values(Re.canvas.selected_nodes)[0];if(U){const Q=w.metadata.pendingSubgraph,fe=Q.json.nodes,J=Q.json.links,xe=fe.find(ie=>ie.id===0),Z=xe?.id,te={};Z&&(te[Z]=U),Re.canvas.emitBeforeChange();try{for(const ie of fe)if(ie.id!==Z){const ve=xe?.pos||[0,0],ye=U._pos||[0,0],ke=[ie.pos[0]+ye[0]-ve[0],ie.pos[1]+ye[1]-ve[1]];te[ie.id]=Jg(ie.type,{pos:ke})}}finally{Re.canvas.emitAfterChange()}for(const ie of J){const ve=te[ie.origin_id],ye=te[ie.target_id];ve&&ye&&ve.connect(ie.origin_slot,ye,ie.target_slot)}}else alert("Please select a upstream node first before adding a subgraph.")}else if(w.metadata?.pendingWorkflow){const U=w.metadata.pendingWorkflow,Q=w.metadata.optimizedParams;if(U.nodes)Re.loadGraphData(U);else{Re.loadApiJson(U);const J=Object.keys(U),xe=Object.keys(Re.graph._nodes_by_id)[0],Z=Re.graph._nodes_by_id[xe],te=Z?Z.pos[0]:0,ie=Z?Z.pos[1]:0,ve=250,ye=60,ke=20,Ge=60,lt=50,rt=1e3;let Qe=te,Ct=ie,st=0;for(const At of J){const Ue=Re.graph._nodes_by_id[At];if(Ue){st>rt&&(Qe+=ve+Ge,st=0,Ct=ie);const Ye=Ue.inputs?Ue.inputs.length:0,ct=Ue.outputs?Ue.outputs.length:0,dn=Ue.widgets?Ue.widgets.length:0,F=Math.max(Ye,ct)+dn,oe=ke*F+ye;Ue.size[0]=ve,Ue.size[1]=oe,Ue.pos[0]=Qe,Ue.pos[1]=Ct,st+=oe+lt,Ct+=oe+lt}}}for(const[J,xe,Z,te,ie]of Q){const ve=Re.graph._nodes_by_id[J].widgets;for(const ye of ve)ye.name===te&&(ye.value=ie)}Re.graph.setDirtyCanvas(!1,!0);const fe={id:Xe(),role:"tool",content:JSON.stringify({text:"The workflow has been successfully loaded to the canvas",ext:[]}),format:"markdown",name:"Assistant"};d?.(fe)}},onFinishLoad:B})}):we||w.format==="debug_guide"?ee=i.jsx(k.Suspense,{fallback:i.jsx("div",{children:"Loading..."}),children:i.jsx(Mp,{content:w.content,name:w.name,avatar:M,onAddMessage:d})}):q&&(ee=i.jsx(k.Suspense,{fallback:i.jsx("div",{children:"Loading..."}),children:i.jsx(Lp,{content:w.content,name:w.name,avatar:M,format:w.format})}));return(we||w.format==="debug_guide")&&ee||q&&ee?ee:D.text||ee?i.jsx(hs,{content:w.content,name:w.name,avatar:M,format:w.format,onOptionClick:r,extComponent:ee,metadata:w.metadata},w.id):ee||i.jsx(hs,{content:w.content,name:w.name,avatar:M,format:w.format,onOptionClick:r,metadata:w.metadata},w.id)}catch(D){return console.error("[MessageList] Error parsing message content:",D),console.error("解析JSON失败",w.content),i.jsx(hs,{content:w.content,name:w.name,avatar:M,format:w.format,onOptionClick:r,metadata:w.metadata},w.id)}}return null},R=w=>{const M=w?.buttonStatus==="not_used";return i.jsx("div",{className:"flex justify-center items-center",children:M?i.jsx("button",{className:"w-full h-[24px] text-gray-700 text-xs bg-transparent hover:!bg-gray-100 px-2 py-1 rounded-md",onClick:K,children:"Load more"}):i.jsx("div",{className:"w-full h-[24px] bg-transparent"})},w.id)};function X(w){return w&&typeof w=="object"&&w.buttonType==="loadmore"}const K=()=>{P.current=!0,b(w=>w+1)};return k.useEffect(()=>{let w=[];if(E.current>0&&E.current<a.length)w=a.slice(E.current),a[E.current].role==="user"&&w.unshift({id:`${a[E.current].id}_loadmore`,buttonType:"loadmore",buttonStatus:"used"}),N(M=>[...M,...w]);else{let M=0,D=a?.length;for(let V=a?.length-1;V>=0;V--)if(a[V].role==="ai"||V===0)if(M>Op+x){w.unshift({id:`${a[V].id}_loadmore`,buttonType:"loadmore",buttonStatus:"not_used"});break}else M++,w?.length>0&&w.unshift({id:`${a[V].id}_loadmore`,buttonType:"loadmore",buttonStatus:"used"}),w=[...a?.slice(Math.min(D,V===0?V:V+1),D+1),...w],D=V;N(w)}E.current=a.length},[a,x]),k.useLayoutEffect(()=>{_?.current&&(P.current?(_.current.scrollTop=_.current.scrollHeight-O.current,P.current=!1):_.current.scrollTop=_.current.scrollHeight,O.current=_.current.scrollHeight)},[j]),i.jsxs("div",{className:"flex-1 flex-col overflow-y-auto p-4 h-0",ref:_,style:{display:g?"block":"none"},children:[j?.map(w=>!!w&&(X(w)?R(w):G(w))),h&&i.jsx(jp,{})]})}async function Tp(){try{return await(await yr.fetchApi("/object_info",{method:"GET"})).json()}catch(a){throw console.error("Error fetching object info:",a),a}}async function Rp(){const a=await Tp();return Object.keys(a)}async function Dp(a){return await(await yr.fetchApi("/prompt",{method:"POST",body:JSON.stringify(a)})).json()}async function Wp(a){try{const u=await yr.fetchApi("/queue",{method:"POST",body:JSON.stringify(a)});if(!u.ok)throw new Error(`Failed to manage queue: ${u.status} ${u.statusText}`);return u}catch(u){throw console.error("Error managing queue:",u),u}}async function $p(){try{const a=await yr.fetchApi("/interrupt",{method:"POST"});if(!a.ok)throw new Error(`Failed to interrupt processing: ${a.status} ${a.statusText}`);return a}catch(a){throw console.error("Error interrupting processing:",a),a}}async function Bp(a){try{const u=await yr.fetchApi(`/history/${a}`,{method:"GET"});if(!u.ok)throw new Error(`Failed to fetch history: ${u.status} ${u.statusText}`);return await u.json()}catch(u){throw console.error("Error fetching history:",u),u}}var ps={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */ps.exports;(function(a,u){(function(){var r,f="4.17.21",d=200,h="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",g="Expected a function",x="Invalid `variable` option passed into `_.template`",b="__lodash_hash_undefined__",j=500,N="__lodash_placeholder__",_=1,E=2,O=4,P=1,B=2,G=1,R=2,X=4,K=8,w=16,M=32,D=64,V=128,je=256,z=512,ce=30,be="...",q=800,we=16,ee=1,U=2,Q=3,fe=1/0,J=9007199254740991,xe=17976931348623157e292,Z=NaN,te=4294967295,ie=te-1,ve=te>>>1,ye=[["ary",V],["bind",G],["bindKey",R],["curry",K],["curryRight",w],["flip",z],["partial",M],["partialRight",D],["rearg",je]],ke="[object Arguments]",Ge="[object Array]",lt="[object AsyncFunction]",rt="[object Boolean]",Qe="[object Date]",Ct="[object DOMException]",st="[object Error]",At="[object Function]",Ue="[object GeneratorFunction]",Ye="[object Map]",ct="[object Number]",dn="[object Null]",F="[object Object]",oe="[object Promise]",Ae="[object Proxy]",Le="[object RegExp]",De="[object Set]",We="[object String]",Oe="[object Symbol]",He="[object Undefined]",Be="[object WeakMap]",$t="[object WeakSet]",It="[object ArrayBuffer]",Bt="[object DataView]",fn="[object Float32Array]",hn="[object Float64Array]",kn="[object Int8Array]",En="[object Int16Array]",Hn="[object Int32Array]",Vt="[object Uint8Array]",Kn="[object Uint8ClampedArray]",qn="[object Uint16Array]",Jn="[object Uint32Array]",ms=/\b__p \+= '';/g,xs=/\b(__p \+=) '' \+/g,vs=/(__e\(.*?\)|\b__t\)) \+\n'';/g,br=/&(?:amp|lt|gt|quot|#39);/g,Yn=/[&<>"']/g,ys=RegExp(br.source),bs=RegExp(Yn.source),ws=/<%-([\s\S]+?)%>/g,wr=/<%([\s\S]+?)%>/g,Cn=/<%=([\s\S]+?)%>/g,_s=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ss=/^\w*$/,Zt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Vn=/[\\^$.*+?()[\]{}|]/g,Ns=RegExp(Vn.source),Zn=/^\s+/,_r=/\s/,Xn=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,js=/\{\n\/\* \[wrapped with (.+)\] \*/,Sr=/,? & /,Nr=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,gn=/[()=,{}\[\]\/\s]/,ks=/\\(\\)?/g,Xt=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,pn=/\w*$/,T=/^[-+]0x[0-9a-f]+$/i,W=/^0b[01]+$/i,Ee=/^\[object .+?Constructor\]$/,et=/^0o[0-7]+$/i,Qt=/^(?:0|[1-9]\d*)$/,Ml=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,jr=/($^)/,Ll=/['\n\r\u2028\u2029\\]/g,kr="\\ud800-\\udfff",Ol="\\u0300-\\u036f",Pl="\\ufe20-\\ufe2f",Tl="\\u20d0-\\u20ff",Bi=Ol+Pl+Tl,Fi="\\u2700-\\u27bf",zi="a-z\\xdf-\\xf6\\xf8-\\xff",Rl="\\xac\\xb1\\xd7\\xf7",Dl="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Wl="\\u2000-\\u206f",$l=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ui="A-Z\\xc0-\\xd6\\xd8-\\xde",Gi="\\ufe0e\\ufe0f",Hi=Rl+Dl+Wl+$l,Es="['’]",Bl="["+kr+"]",Ki="["+Hi+"]",Er="["+Bi+"]",qi="\\d+",Fl="["+Fi+"]",Ji="["+zi+"]",Yi="[^"+kr+Hi+qi+Fi+zi+Ui+"]",Cs="\\ud83c[\\udffb-\\udfff]",zl="(?:"+Er+"|"+Cs+")",Vi="[^"+kr+"]",As="(?:\\ud83c[\\udde6-\\uddff]){2}",Is="[\\ud800-\\udbff][\\udc00-\\udfff]",An="["+Ui+"]",Zi="\\u200d",Xi="(?:"+Ji+"|"+Yi+")",Ul="(?:"+An+"|"+Yi+")",Qi="(?:"+Es+"(?:d|ll|m|re|s|t|ve))?",eo="(?:"+Es+"(?:D|LL|M|RE|S|T|VE))?",to=zl+"?",no="["+Gi+"]?",Gl="(?:"+Zi+"(?:"+[Vi,As,Is].join("|")+")"+no+to+")*",Hl="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Kl="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",ro=no+to+Gl,ql="(?:"+[Fl,As,Is].join("|")+")"+ro,Jl="(?:"+[Vi+Er+"?",Er,As,Is,Bl].join("|")+")",Yl=RegExp(Es,"g"),Vl=RegExp(Er,"g"),Ms=RegExp(Cs+"(?="+Cs+")|"+Jl+ro,"g"),Zl=RegExp([An+"?"+Ji+"+"+Qi+"(?="+[Ki,An,"$"].join("|")+")",Ul+"+"+eo+"(?="+[Ki,An+Xi,"$"].join("|")+")",An+"?"+Xi+"+"+Qi,An+"+"+eo,Kl,Hl,qi,ql].join("|"),"g"),Xl=RegExp("["+Zi+kr+Bi+Gi+"]"),Ql=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,ec=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],tc=-1,Me={};Me[fn]=Me[hn]=Me[kn]=Me[En]=Me[Hn]=Me[Vt]=Me[Kn]=Me[qn]=Me[Jn]=!0,Me[ke]=Me[Ge]=Me[It]=Me[rt]=Me[Bt]=Me[Qe]=Me[st]=Me[At]=Me[Ye]=Me[ct]=Me[F]=Me[Le]=Me[De]=Me[We]=Me[Be]=!1;var Ie={};Ie[ke]=Ie[Ge]=Ie[It]=Ie[Bt]=Ie[rt]=Ie[Qe]=Ie[fn]=Ie[hn]=Ie[kn]=Ie[En]=Ie[Hn]=Ie[Ye]=Ie[ct]=Ie[F]=Ie[Le]=Ie[De]=Ie[We]=Ie[Oe]=Ie[Vt]=Ie[Kn]=Ie[qn]=Ie[Jn]=!0,Ie[st]=Ie[At]=Ie[Be]=!1;var nc={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},rc={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},sc={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},ic={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},oc=parseFloat,ac=parseInt,so=typeof gr=="object"&&gr&&gr.Object===Object&&gr,lc=typeof self=="object"&&self&&self.Object===Object&&self,Ve=so||lc||Function("return this")(),Ls=u&&!u.nodeType&&u,mn=Ls&&!0&&a&&!a.nodeType&&a,io=mn&&mn.exports===Ls,Os=io&&so.process,bt=function(){try{var v=mn&&mn.require&&mn.require("util").types;return v||Os&&Os.binding&&Os.binding("util")}catch{}}(),oo=bt&&bt.isArrayBuffer,ao=bt&&bt.isDate,lo=bt&&bt.isMap,co=bt&&bt.isRegExp,uo=bt&&bt.isSet,fo=bt&&bt.isTypedArray;function gt(v,C,S){switch(S.length){case 0:return v.call(C);case 1:return v.call(C,S[0]);case 2:return v.call(C,S[0],S[1]);case 3:return v.call(C,S[0],S[1],S[2])}return v.apply(C,S)}function cc(v,C,S,H){for(var ae=-1,_e=v==null?0:v.length;++ae<_e;){var Ke=v[ae];C(H,Ke,S(Ke),v)}return H}function wt(v,C){for(var S=-1,H=v==null?0:v.length;++S<H&&C(v[S],S,v)!==!1;);return v}function uc(v,C){for(var S=v==null?0:v.length;S--&&C(v[S],S,v)!==!1;);return v}function ho(v,C){for(var S=-1,H=v==null?0:v.length;++S<H;)if(!C(v[S],S,v))return!1;return!0}function en(v,C){for(var S=-1,H=v==null?0:v.length,ae=0,_e=[];++S<H;){var Ke=v[S];C(Ke,S,v)&&(_e[ae++]=Ke)}return _e}function Cr(v,C){var S=v==null?0:v.length;return!!S&&In(v,C,0)>-1}function Ps(v,C,S){for(var H=-1,ae=v==null?0:v.length;++H<ae;)if(S(C,v[H]))return!0;return!1}function Pe(v,C){for(var S=-1,H=v==null?0:v.length,ae=Array(H);++S<H;)ae[S]=C(v[S],S,v);return ae}function tn(v,C){for(var S=-1,H=C.length,ae=v.length;++S<H;)v[ae+S]=C[S];return v}function Ts(v,C,S,H){var ae=-1,_e=v==null?0:v.length;for(H&&_e&&(S=v[++ae]);++ae<_e;)S=C(S,v[ae],ae,v);return S}function dc(v,C,S,H){var ae=v==null?0:v.length;for(H&&ae&&(S=v[--ae]);ae--;)S=C(S,v[ae],ae,v);return S}function Rs(v,C){for(var S=-1,H=v==null?0:v.length;++S<H;)if(C(v[S],S,v))return!0;return!1}var fc=Ds("length");function hc(v){return v.split("")}function gc(v){return v.match(Nr)||[]}function go(v,C,S){var H;return S(v,function(ae,_e,Ke){if(C(ae,_e,Ke))return H=_e,!1}),H}function Ar(v,C,S,H){for(var ae=v.length,_e=S+(H?1:-1);H?_e--:++_e<ae;)if(C(v[_e],_e,v))return _e;return-1}function In(v,C,S){return C===C?kc(v,C,S):Ar(v,po,S)}function pc(v,C,S,H){for(var ae=S-1,_e=v.length;++ae<_e;)if(H(v[ae],C))return ae;return-1}function po(v){return v!==v}function mo(v,C){var S=v==null?0:v.length;return S?$s(v,C)/S:Z}function Ds(v){return function(C){return C==null?r:C[v]}}function Ws(v){return function(C){return v==null?r:v[C]}}function xo(v,C,S,H,ae){return ae(v,function(_e,Ke,Ce){S=H?(H=!1,_e):C(S,_e,Ke,Ce)}),S}function mc(v,C){var S=v.length;for(v.sort(C);S--;)v[S]=v[S].value;return v}function $s(v,C){for(var S,H=-1,ae=v.length;++H<ae;){var _e=C(v[H]);_e!==r&&(S=S===r?_e:S+_e)}return S}function Bs(v,C){for(var S=-1,H=Array(v);++S<v;)H[S]=C(S);return H}function xc(v,C){return Pe(C,function(S){return[S,v[S]]})}function vo(v){return v&&v.slice(0,_o(v)+1).replace(Zn,"")}function pt(v){return function(C){return v(C)}}function Fs(v,C){return Pe(C,function(S){return v[S]})}function Qn(v,C){return v.has(C)}function yo(v,C){for(var S=-1,H=v.length;++S<H&&In(C,v[S],0)>-1;);return S}function bo(v,C){for(var S=v.length;S--&&In(C,v[S],0)>-1;);return S}function vc(v,C){for(var S=v.length,H=0;S--;)v[S]===C&&++H;return H}var yc=Ws(nc),bc=Ws(rc);function wc(v){return"\\"+ic[v]}function _c(v,C){return v==null?r:v[C]}function Mn(v){return Xl.test(v)}function Sc(v){return Ql.test(v)}function Nc(v){for(var C,S=[];!(C=v.next()).done;)S.push(C.value);return S}function zs(v){var C=-1,S=Array(v.size);return v.forEach(function(H,ae){S[++C]=[ae,H]}),S}function wo(v,C){return function(S){return v(C(S))}}function nn(v,C){for(var S=-1,H=v.length,ae=0,_e=[];++S<H;){var Ke=v[S];(Ke===C||Ke===N)&&(v[S]=N,_e[ae++]=S)}return _e}function Ir(v){var C=-1,S=Array(v.size);return v.forEach(function(H){S[++C]=H}),S}function jc(v){var C=-1,S=Array(v.size);return v.forEach(function(H){S[++C]=[H,H]}),S}function kc(v,C,S){for(var H=S-1,ae=v.length;++H<ae;)if(v[H]===C)return H;return-1}function Ec(v,C,S){for(var H=S+1;H--;)if(v[H]===C)return H;return H}function Ln(v){return Mn(v)?Ac(v):fc(v)}function Mt(v){return Mn(v)?Ic(v):hc(v)}function _o(v){for(var C=v.length;C--&&_r.test(v.charAt(C)););return C}var Cc=Ws(sc);function Ac(v){for(var C=Ms.lastIndex=0;Ms.test(v);)++C;return C}function Ic(v){return v.match(Ms)||[]}function Mc(v){return v.match(Zl)||[]}var Lc=function v(C){C=C==null?Ve:On.defaults(Ve.Object(),C,On.pick(Ve,ec));var S=C.Array,H=C.Date,ae=C.Error,_e=C.Function,Ke=C.Math,Ce=C.Object,Us=C.RegExp,Oc=C.String,_t=C.TypeError,Mr=S.prototype,Pc=_e.prototype,Pn=Ce.prototype,Lr=C["__core-js_shared__"],Or=Pc.toString,Ne=Pn.hasOwnProperty,Tc=0,So=function(){var e=/[^.]+$/.exec(Lr&&Lr.keys&&Lr.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Pr=Pn.toString,Rc=Or.call(Ce),Dc=Ve._,Wc=Us("^"+Or.call(Ne).replace(Vn,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Tr=io?C.Buffer:r,rn=C.Symbol,Rr=C.Uint8Array,No=Tr?Tr.allocUnsafe:r,Dr=wo(Ce.getPrototypeOf,Ce),jo=Ce.create,ko=Pn.propertyIsEnumerable,Wr=Mr.splice,Eo=rn?rn.isConcatSpreadable:r,er=rn?rn.iterator:r,xn=rn?rn.toStringTag:r,$r=function(){try{var e=_n(Ce,"defineProperty");return e({},"",{}),e}catch{}}(),$c=C.clearTimeout!==Ve.clearTimeout&&C.clearTimeout,Bc=H&&H.now!==Ve.Date.now&&H.now,Fc=C.setTimeout!==Ve.setTimeout&&C.setTimeout,Br=Ke.ceil,Fr=Ke.floor,Gs=Ce.getOwnPropertySymbols,zc=Tr?Tr.isBuffer:r,Co=C.isFinite,Uc=Mr.join,Gc=wo(Ce.keys,Ce),qe=Ke.max,tt=Ke.min,Hc=H.now,Kc=C.parseInt,Ao=Ke.random,qc=Mr.reverse,Hs=_n(C,"DataView"),tr=_n(C,"Map"),Ks=_n(C,"Promise"),Tn=_n(C,"Set"),nr=_n(C,"WeakMap"),rr=_n(Ce,"create"),zr=nr&&new nr,Rn={},Jc=Sn(Hs),Yc=Sn(tr),Vc=Sn(Ks),Zc=Sn(Tn),Xc=Sn(nr),Ur=rn?rn.prototype:r,sr=Ur?Ur.valueOf:r,Io=Ur?Ur.toString:r;function l(e){if($e(e)&&!le(e)&&!(e instanceof pe)){if(e instanceof St)return e;if(Ne.call(e,"__wrapped__"))return Ma(e)}return new St(e)}var Dn=function(){function e(){}return function(t){if(!Te(t))return{};if(jo)return jo(t);e.prototype=t;var n=new e;return e.prototype=r,n}}();function Gr(){}function St(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=r}l.templateSettings={escape:ws,evaluate:wr,interpolate:Cn,variable:"",imports:{_:l}},l.prototype=Gr.prototype,l.prototype.constructor=l,St.prototype=Dn(Gr.prototype),St.prototype.constructor=St;function pe(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=te,this.__views__=[]}function Qc(){var e=new pe(this.__wrapped__);return e.__actions__=ut(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=ut(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=ut(this.__views__),e}function eu(){if(this.__filtered__){var e=new pe(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function tu(){var e=this.__wrapped__.value(),t=this.__dir__,n=le(e),s=t<0,o=n?e.length:0,c=hd(0,o,this.__views__),p=c.start,m=c.end,y=m-p,A=s?m:p-1,I=this.__iteratees__,L=I.length,$=0,Y=tt(y,this.__takeCount__);if(!n||!s&&o==y&&Y==y)return ea(e,this.__actions__);var re=[];e:for(;y--&&$<Y;){A+=t;for(var de=-1,se=e[A];++de<L;){var ge=I[de],me=ge.iteratee,vt=ge.type,at=me(se);if(vt==U)se=at;else if(!at){if(vt==ee)continue e;break e}}re[$++]=se}return re}pe.prototype=Dn(Gr.prototype),pe.prototype.constructor=pe;function vn(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var s=e[t];this.set(s[0],s[1])}}function nu(){this.__data__=rr?rr(null):{},this.size=0}function ru(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function su(e){var t=this.__data__;if(rr){var n=t[e];return n===b?r:n}return Ne.call(t,e)?t[e]:r}function iu(e){var t=this.__data__;return rr?t[e]!==r:Ne.call(t,e)}function ou(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=rr&&t===r?b:t,this}vn.prototype.clear=nu,vn.prototype.delete=ru,vn.prototype.get=su,vn.prototype.has=iu,vn.prototype.set=ou;function Ft(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var s=e[t];this.set(s[0],s[1])}}function au(){this.__data__=[],this.size=0}function lu(e){var t=this.__data__,n=Hr(t,e);if(n<0)return!1;var s=t.length-1;return n==s?t.pop():Wr.call(t,n,1),--this.size,!0}function cu(e){var t=this.__data__,n=Hr(t,e);return n<0?r:t[n][1]}function uu(e){return Hr(this.__data__,e)>-1}function du(e,t){var n=this.__data__,s=Hr(n,e);return s<0?(++this.size,n.push([e,t])):n[s][1]=t,this}Ft.prototype.clear=au,Ft.prototype.delete=lu,Ft.prototype.get=cu,Ft.prototype.has=uu,Ft.prototype.set=du;function zt(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var s=e[t];this.set(s[0],s[1])}}function fu(){this.size=0,this.__data__={hash:new vn,map:new(tr||Ft),string:new vn}}function hu(e){var t=rs(this,e).delete(e);return this.size-=t?1:0,t}function gu(e){return rs(this,e).get(e)}function pu(e){return rs(this,e).has(e)}function mu(e,t){var n=rs(this,e),s=n.size;return n.set(e,t),this.size+=n.size==s?0:1,this}zt.prototype.clear=fu,zt.prototype.delete=hu,zt.prototype.get=gu,zt.prototype.has=pu,zt.prototype.set=mu;function yn(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new zt;++t<n;)this.add(e[t])}function xu(e){return this.__data__.set(e,b),this}function vu(e){return this.__data__.has(e)}yn.prototype.add=yn.prototype.push=xu,yn.prototype.has=vu;function Lt(e){var t=this.__data__=new Ft(e);this.size=t.size}function yu(){this.__data__=new Ft,this.size=0}function bu(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function wu(e){return this.__data__.get(e)}function _u(e){return this.__data__.has(e)}function Su(e,t){var n=this.__data__;if(n instanceof Ft){var s=n.__data__;if(!tr||s.length<d-1)return s.push([e,t]),this.size=++n.size,this;n=this.__data__=new zt(s)}return n.set(e,t),this.size=n.size,this}Lt.prototype.clear=yu,Lt.prototype.delete=bu,Lt.prototype.get=wu,Lt.prototype.has=_u,Lt.prototype.set=Su;function Mo(e,t){var n=le(e),s=!n&&Nn(e),o=!n&&!s&&cn(e),c=!n&&!s&&!o&&Fn(e),p=n||s||o||c,m=p?Bs(e.length,Oc):[],y=m.length;for(var A in e)(t||Ne.call(e,A))&&!(p&&(A=="length"||o&&(A=="offset"||A=="parent")||c&&(A=="buffer"||A=="byteLength"||A=="byteOffset")||Kt(A,y)))&&m.push(A);return m}function Lo(e){var t=e.length;return t?e[ri(0,t-1)]:r}function Nu(e,t){return ss(ut(e),bn(t,0,e.length))}function ju(e){return ss(ut(e))}function qs(e,t,n){(n!==r&&!Ot(e[t],n)||n===r&&!(t in e))&&Ut(e,t,n)}function ir(e,t,n){var s=e[t];(!(Ne.call(e,t)&&Ot(s,n))||n===r&&!(t in e))&&Ut(e,t,n)}function Hr(e,t){for(var n=e.length;n--;)if(Ot(e[n][0],t))return n;return-1}function ku(e,t,n,s){return sn(e,function(o,c,p){t(s,o,n(o),p)}),s}function Oo(e,t){return e&&Dt(t,Je(t),e)}function Eu(e,t){return e&&Dt(t,ft(t),e)}function Ut(e,t,n){t=="__proto__"&&$r?$r(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function Js(e,t){for(var n=-1,s=t.length,o=S(s),c=e==null;++n<s;)o[n]=c?r:Ci(e,t[n]);return o}function bn(e,t,n){return e===e&&(n!==r&&(e=e<=n?e:n),t!==r&&(e=e>=t?e:t)),e}function Nt(e,t,n,s,o,c){var p,m=t&_,y=t&E,A=t&O;if(n&&(p=o?n(e,s,o,c):n(e)),p!==r)return p;if(!Te(e))return e;var I=le(e);if(I){if(p=pd(e),!m)return ut(e,p)}else{var L=nt(e),$=L==At||L==Ue;if(cn(e))return ra(e,m);if(L==F||L==ke||$&&!o){if(p=y||$?{}:_a(e),!m)return y?sd(e,Eu(p,e)):rd(e,Oo(p,e))}else{if(!Ie[L])return o?e:{};p=md(e,L,m)}}c||(c=new Lt);var Y=c.get(e);if(Y)return Y;c.set(e,p),Za(e)?e.forEach(function(se){p.add(Nt(se,t,n,se,e,c))}):Ya(e)&&e.forEach(function(se,ge){p.set(ge,Nt(se,t,n,ge,e,c))});var re=A?y?gi:hi:y?ft:Je,de=I?r:re(e);return wt(de||e,function(se,ge){de&&(ge=se,se=e[ge]),ir(p,ge,Nt(se,t,n,ge,e,c))}),p}function Cu(e){var t=Je(e);return function(n){return Po(n,e,t)}}function Po(e,t,n){var s=n.length;if(e==null)return!s;for(e=Ce(e);s--;){var o=n[s],c=t[o],p=e[o];if(p===r&&!(o in e)||!c(p))return!1}return!0}function To(e,t,n){if(typeof e!="function")throw new _t(g);return fr(function(){e.apply(r,n)},t)}function or(e,t,n,s){var o=-1,c=Cr,p=!0,m=e.length,y=[],A=t.length;if(!m)return y;n&&(t=Pe(t,pt(n))),s?(c=Ps,p=!1):t.length>=d&&(c=Qn,p=!1,t=new yn(t));e:for(;++o<m;){var I=e[o],L=n==null?I:n(I);if(I=s||I!==0?I:0,p&&L===L){for(var $=A;$--;)if(t[$]===L)continue e;y.push(I)}else c(t,L,s)||y.push(I)}return y}var sn=la(Rt),Ro=la(Vs,!0);function Au(e,t){var n=!0;return sn(e,function(s,o,c){return n=!!t(s,o,c),n}),n}function Kr(e,t,n){for(var s=-1,o=e.length;++s<o;){var c=e[s],p=t(c);if(p!=null&&(m===r?p===p&&!xt(p):n(p,m)))var m=p,y=c}return y}function Iu(e,t,n,s){var o=e.length;for(n=ue(n),n<0&&(n=-n>o?0:o+n),s=s===r||s>o?o:ue(s),s<0&&(s+=o),s=n>s?0:Qa(s);n<s;)e[n++]=t;return e}function Do(e,t){var n=[];return sn(e,function(s,o,c){t(s,o,c)&&n.push(s)}),n}function Ze(e,t,n,s,o){var c=-1,p=e.length;for(n||(n=vd),o||(o=[]);++c<p;){var m=e[c];t>0&&n(m)?t>1?Ze(m,t-1,n,s,o):tn(o,m):s||(o[o.length]=m)}return o}var Ys=ca(),Wo=ca(!0);function Rt(e,t){return e&&Ys(e,t,Je)}function Vs(e,t){return e&&Wo(e,t,Je)}function qr(e,t){return en(t,function(n){return qt(e[n])})}function wn(e,t){t=an(t,e);for(var n=0,s=t.length;e!=null&&n<s;)e=e[Wt(t[n++])];return n&&n==s?e:r}function $o(e,t,n){var s=t(e);return le(e)?s:tn(s,n(e))}function it(e){return e==null?e===r?He:dn:xn&&xn in Ce(e)?fd(e):jd(e)}function Zs(e,t){return e>t}function Mu(e,t){return e!=null&&Ne.call(e,t)}function Lu(e,t){return e!=null&&t in Ce(e)}function Ou(e,t,n){return e>=tt(t,n)&&e<qe(t,n)}function Xs(e,t,n){for(var s=n?Ps:Cr,o=e[0].length,c=e.length,p=c,m=S(c),y=1/0,A=[];p--;){var I=e[p];p&&t&&(I=Pe(I,pt(t))),y=tt(I.length,y),m[p]=!n&&(t||o>=120&&I.length>=120)?new yn(p&&I):r}I=e[0];var L=-1,$=m[0];e:for(;++L<o&&A.length<y;){var Y=I[L],re=t?t(Y):Y;if(Y=n||Y!==0?Y:0,!($?Qn($,re):s(A,re,n))){for(p=c;--p;){var de=m[p];if(!(de?Qn(de,re):s(e[p],re,n)))continue e}$&&$.push(re),A.push(Y)}}return A}function Pu(e,t,n,s){return Rt(e,function(o,c,p){t(s,n(o),c,p)}),s}function ar(e,t,n){t=an(t,e),e=ka(e,t);var s=e==null?e:e[Wt(kt(t))];return s==null?r:gt(s,e,n)}function Bo(e){return $e(e)&&it(e)==ke}function Tu(e){return $e(e)&&it(e)==It}function Ru(e){return $e(e)&&it(e)==Qe}function lr(e,t,n,s,o){return e===t?!0:e==null||t==null||!$e(e)&&!$e(t)?e!==e&&t!==t:Du(e,t,n,s,lr,o)}function Du(e,t,n,s,o,c){var p=le(e),m=le(t),y=p?Ge:nt(e),A=m?Ge:nt(t);y=y==ke?F:y,A=A==ke?F:A;var I=y==F,L=A==F,$=y==A;if($&&cn(e)){if(!cn(t))return!1;p=!0,I=!1}if($&&!I)return c||(c=new Lt),p||Fn(e)?ya(e,t,n,s,o,c):ud(e,t,y,n,s,o,c);if(!(n&P)){var Y=I&&Ne.call(e,"__wrapped__"),re=L&&Ne.call(t,"__wrapped__");if(Y||re){var de=Y?e.value():e,se=re?t.value():t;return c||(c=new Lt),o(de,se,n,s,c)}}return $?(c||(c=new Lt),dd(e,t,n,s,o,c)):!1}function Wu(e){return $e(e)&&nt(e)==Ye}function Qs(e,t,n,s){var o=n.length,c=o,p=!s;if(e==null)return!c;for(e=Ce(e);o--;){var m=n[o];if(p&&m[2]?m[1]!==e[m[0]]:!(m[0]in e))return!1}for(;++o<c;){m=n[o];var y=m[0],A=e[y],I=m[1];if(p&&m[2]){if(A===r&&!(y in e))return!1}else{var L=new Lt;if(s)var $=s(A,I,y,e,t,L);if(!($===r?lr(I,A,P|B,s,L):$))return!1}}return!0}function Fo(e){if(!Te(e)||bd(e))return!1;var t=qt(e)?Wc:Ee;return t.test(Sn(e))}function $u(e){return $e(e)&&it(e)==Le}function Bu(e){return $e(e)&&nt(e)==De}function Fu(e){return $e(e)&&us(e.length)&&!!Me[it(e)]}function zo(e){return typeof e=="function"?e:e==null?ht:typeof e=="object"?le(e)?Ho(e[0],e[1]):Go(e):ul(e)}function ei(e){if(!dr(e))return Gc(e);var t=[];for(var n in Ce(e))Ne.call(e,n)&&n!="constructor"&&t.push(n);return t}function zu(e){if(!Te(e))return Nd(e);var t=dr(e),n=[];for(var s in e)s=="constructor"&&(t||!Ne.call(e,s))||n.push(s);return n}function ti(e,t){return e<t}function Uo(e,t){var n=-1,s=dt(e)?S(e.length):[];return sn(e,function(o,c,p){s[++n]=t(o,c,p)}),s}function Go(e){var t=mi(e);return t.length==1&&t[0][2]?Na(t[0][0],t[0][1]):function(n){return n===e||Qs(n,e,t)}}function Ho(e,t){return vi(e)&&Sa(t)?Na(Wt(e),t):function(n){var s=Ci(n,e);return s===r&&s===t?Ai(n,e):lr(t,s,P|B)}}function Jr(e,t,n,s,o){e!==t&&Ys(t,function(c,p){if(o||(o=new Lt),Te(c))Uu(e,t,p,n,Jr,s,o);else{var m=s?s(bi(e,p),c,p+"",e,t,o):r;m===r&&(m=c),qs(e,p,m)}},ft)}function Uu(e,t,n,s,o,c,p){var m=bi(e,n),y=bi(t,n),A=p.get(y);if(A){qs(e,n,A);return}var I=c?c(m,y,n+"",e,t,p):r,L=I===r;if(L){var $=le(y),Y=!$&&cn(y),re=!$&&!Y&&Fn(y);I=y,$||Y||re?le(m)?I=m:Fe(m)?I=ut(m):Y?(L=!1,I=ra(y,!0)):re?(L=!1,I=sa(y,!0)):I=[]:hr(y)||Nn(y)?(I=m,Nn(m)?I=el(m):(!Te(m)||qt(m))&&(I=_a(y))):L=!1}L&&(p.set(y,I),o(I,y,s,c,p),p.delete(y)),qs(e,n,I)}function Ko(e,t){var n=e.length;if(n)return t+=t<0?n:0,Kt(t,n)?e[t]:r}function qo(e,t,n){t.length?t=Pe(t,function(c){return le(c)?function(p){return wn(p,c.length===1?c[0]:c)}:c}):t=[ht];var s=-1;t=Pe(t,pt(ne()));var o=Uo(e,function(c,p,m){var y=Pe(t,function(A){return A(c)});return{criteria:y,index:++s,value:c}});return mc(o,function(c,p){return nd(c,p,n)})}function Gu(e,t){return Jo(e,t,function(n,s){return Ai(e,s)})}function Jo(e,t,n){for(var s=-1,o=t.length,c={};++s<o;){var p=t[s],m=wn(e,p);n(m,p)&&cr(c,an(p,e),m)}return c}function Hu(e){return function(t){return wn(t,e)}}function ni(e,t,n,s){var o=s?pc:In,c=-1,p=t.length,m=e;for(e===t&&(t=ut(t)),n&&(m=Pe(e,pt(n)));++c<p;)for(var y=0,A=t[c],I=n?n(A):A;(y=o(m,I,y,s))>-1;)m!==e&&Wr.call(m,y,1),Wr.call(e,y,1);return e}function Yo(e,t){for(var n=e?t.length:0,s=n-1;n--;){var o=t[n];if(n==s||o!==c){var c=o;Kt(o)?Wr.call(e,o,1):oi(e,o)}}return e}function ri(e,t){return e+Fr(Ao()*(t-e+1))}function Ku(e,t,n,s){for(var o=-1,c=qe(Br((t-e)/(n||1)),0),p=S(c);c--;)p[s?c:++o]=e,e+=n;return p}function si(e,t){var n="";if(!e||t<1||t>J)return n;do t%2&&(n+=e),t=Fr(t/2),t&&(e+=e);while(t);return n}function he(e,t){return wi(ja(e,t,ht),e+"")}function qu(e){return Lo(zn(e))}function Ju(e,t){var n=zn(e);return ss(n,bn(t,0,n.length))}function cr(e,t,n,s){if(!Te(e))return e;t=an(t,e);for(var o=-1,c=t.length,p=c-1,m=e;m!=null&&++o<c;){var y=Wt(t[o]),A=n;if(y==="__proto__"||y==="constructor"||y==="prototype")return e;if(o!=p){var I=m[y];A=s?s(I,y,m):r,A===r&&(A=Te(I)?I:Kt(t[o+1])?[]:{})}ir(m,y,A),m=m[y]}return e}var Vo=zr?function(e,t){return zr.set(e,t),e}:ht,Yu=$r?function(e,t){return $r(e,"toString",{configurable:!0,enumerable:!1,value:Mi(t),writable:!0})}:ht;function Vu(e){return ss(zn(e))}function jt(e,t,n){var s=-1,o=e.length;t<0&&(t=-t>o?0:o+t),n=n>o?o:n,n<0&&(n+=o),o=t>n?0:n-t>>>0,t>>>=0;for(var c=S(o);++s<o;)c[s]=e[s+t];return c}function Zu(e,t){var n;return sn(e,function(s,o,c){return n=t(s,o,c),!n}),!!n}function Yr(e,t,n){var s=0,o=e==null?s:e.length;if(typeof t=="number"&&t===t&&o<=ve){for(;s<o;){var c=s+o>>>1,p=e[c];p!==null&&!xt(p)&&(n?p<=t:p<t)?s=c+1:o=c}return o}return ii(e,t,ht,n)}function ii(e,t,n,s){var o=0,c=e==null?0:e.length;if(c===0)return 0;t=n(t);for(var p=t!==t,m=t===null,y=xt(t),A=t===r;o<c;){var I=Fr((o+c)/2),L=n(e[I]),$=L!==r,Y=L===null,re=L===L,de=xt(L);if(p)var se=s||re;else A?se=re&&(s||$):m?se=re&&$&&(s||!Y):y?se=re&&$&&!Y&&(s||!de):Y||de?se=!1:se=s?L<=t:L<t;se?o=I+1:c=I}return tt(c,ie)}function Zo(e,t){for(var n=-1,s=e.length,o=0,c=[];++n<s;){var p=e[n],m=t?t(p):p;if(!n||!Ot(m,y)){var y=m;c[o++]=p===0?0:p}}return c}function Xo(e){return typeof e=="number"?e:xt(e)?Z:+e}function mt(e){if(typeof e=="string")return e;if(le(e))return Pe(e,mt)+"";if(xt(e))return Io?Io.call(e):"";var t=e+"";return t=="0"&&1/e==-fe?"-0":t}function on(e,t,n){var s=-1,o=Cr,c=e.length,p=!0,m=[],y=m;if(n)p=!1,o=Ps;else if(c>=d){var A=t?null:ld(e);if(A)return Ir(A);p=!1,o=Qn,y=new yn}else y=t?[]:m;e:for(;++s<c;){var I=e[s],L=t?t(I):I;if(I=n||I!==0?I:0,p&&L===L){for(var $=y.length;$--;)if(y[$]===L)continue e;t&&y.push(L),m.push(I)}else o(y,L,n)||(y!==m&&y.push(L),m.push(I))}return m}function oi(e,t){return t=an(t,e),e=ka(e,t),e==null||delete e[Wt(kt(t))]}function Qo(e,t,n,s){return cr(e,t,n(wn(e,t)),s)}function Vr(e,t,n,s){for(var o=e.length,c=s?o:-1;(s?c--:++c<o)&&t(e[c],c,e););return n?jt(e,s?0:c,s?c+1:o):jt(e,s?c+1:0,s?o:c)}function ea(e,t){var n=e;return n instanceof pe&&(n=n.value()),Ts(t,function(s,o){return o.func.apply(o.thisArg,tn([s],o.args))},n)}function ai(e,t,n){var s=e.length;if(s<2)return s?on(e[0]):[];for(var o=-1,c=S(s);++o<s;)for(var p=e[o],m=-1;++m<s;)m!=o&&(c[o]=or(c[o]||p,e[m],t,n));return on(Ze(c,1),t,n)}function ta(e,t,n){for(var s=-1,o=e.length,c=t.length,p={};++s<o;){var m=s<c?t[s]:r;n(p,e[s],m)}return p}function li(e){return Fe(e)?e:[]}function ci(e){return typeof e=="function"?e:ht}function an(e,t){return le(e)?e:vi(e,t)?[e]:Ia(Se(e))}var Xu=he;function ln(e,t,n){var s=e.length;return n=n===r?s:n,!t&&n>=s?e:jt(e,t,n)}var na=$c||function(e){return Ve.clearTimeout(e)};function ra(e,t){if(t)return e.slice();var n=e.length,s=No?No(n):new e.constructor(n);return e.copy(s),s}function ui(e){var t=new e.constructor(e.byteLength);return new Rr(t).set(new Rr(e)),t}function Qu(e,t){var n=t?ui(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}function ed(e){var t=new e.constructor(e.source,pn.exec(e));return t.lastIndex=e.lastIndex,t}function td(e){return sr?Ce(sr.call(e)):{}}function sa(e,t){var n=t?ui(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function ia(e,t){if(e!==t){var n=e!==r,s=e===null,o=e===e,c=xt(e),p=t!==r,m=t===null,y=t===t,A=xt(t);if(!m&&!A&&!c&&e>t||c&&p&&y&&!m&&!A||s&&p&&y||!n&&y||!o)return 1;if(!s&&!c&&!A&&e<t||A&&n&&o&&!s&&!c||m&&n&&o||!p&&o||!y)return-1}return 0}function nd(e,t,n){for(var s=-1,o=e.criteria,c=t.criteria,p=o.length,m=n.length;++s<p;){var y=ia(o[s],c[s]);if(y){if(s>=m)return y;var A=n[s];return y*(A=="desc"?-1:1)}}return e.index-t.index}function oa(e,t,n,s){for(var o=-1,c=e.length,p=n.length,m=-1,y=t.length,A=qe(c-p,0),I=S(y+A),L=!s;++m<y;)I[m]=t[m];for(;++o<p;)(L||o<c)&&(I[n[o]]=e[o]);for(;A--;)I[m++]=e[o++];return I}function aa(e,t,n,s){for(var o=-1,c=e.length,p=-1,m=n.length,y=-1,A=t.length,I=qe(c-m,0),L=S(I+A),$=!s;++o<I;)L[o]=e[o];for(var Y=o;++y<A;)L[Y+y]=t[y];for(;++p<m;)($||o<c)&&(L[Y+n[p]]=e[o++]);return L}function ut(e,t){var n=-1,s=e.length;for(t||(t=S(s));++n<s;)t[n]=e[n];return t}function Dt(e,t,n,s){var o=!n;n||(n={});for(var c=-1,p=t.length;++c<p;){var m=t[c],y=s?s(n[m],e[m],m,n,e):r;y===r&&(y=e[m]),o?Ut(n,m,y):ir(n,m,y)}return n}function rd(e,t){return Dt(e,xi(e),t)}function sd(e,t){return Dt(e,ba(e),t)}function Zr(e,t){return function(n,s){var o=le(n)?cc:ku,c=t?t():{};return o(n,e,ne(s,2),c)}}function Wn(e){return he(function(t,n){var s=-1,o=n.length,c=o>1?n[o-1]:r,p=o>2?n[2]:r;for(c=e.length>3&&typeof c=="function"?(o--,c):r,p&&ot(n[0],n[1],p)&&(c=o<3?r:c,o=1),t=Ce(t);++s<o;){var m=n[s];m&&e(t,m,s,c)}return t})}function la(e,t){return function(n,s){if(n==null)return n;if(!dt(n))return e(n,s);for(var o=n.length,c=t?o:-1,p=Ce(n);(t?c--:++c<o)&&s(p[c],c,p)!==!1;);return n}}function ca(e){return function(t,n,s){for(var o=-1,c=Ce(t),p=s(t),m=p.length;m--;){var y=p[e?m:++o];if(n(c[y],y,c)===!1)break}return t}}function id(e,t,n){var s=t&G,o=ur(e);function c(){var p=this&&this!==Ve&&this instanceof c?o:e;return p.apply(s?n:this,arguments)}return c}function ua(e){return function(t){t=Se(t);var n=Mn(t)?Mt(t):r,s=n?n[0]:t.charAt(0),o=n?ln(n,1).join(""):t.slice(1);return s[e]()+o}}function $n(e){return function(t){return Ts(ll(al(t).replace(Yl,"")),e,"")}}function ur(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=Dn(e.prototype),s=e.apply(n,t);return Te(s)?s:n}}function od(e,t,n){var s=ur(e);function o(){for(var c=arguments.length,p=S(c),m=c,y=Bn(o);m--;)p[m]=arguments[m];var A=c<3&&p[0]!==y&&p[c-1]!==y?[]:nn(p,y);if(c-=A.length,c<n)return pa(e,t,Xr,o.placeholder,r,p,A,r,r,n-c);var I=this&&this!==Ve&&this instanceof o?s:e;return gt(I,this,p)}return o}function da(e){return function(t,n,s){var o=Ce(t);if(!dt(t)){var c=ne(n,3);t=Je(t),n=function(m){return c(o[m],m,o)}}var p=e(t,n,s);return p>-1?o[c?t[p]:p]:r}}function fa(e){return Ht(function(t){var n=t.length,s=n,o=St.prototype.thru;for(e&&t.reverse();s--;){var c=t[s];if(typeof c!="function")throw new _t(g);if(o&&!p&&ns(c)=="wrapper")var p=new St([],!0)}for(s=p?s:n;++s<n;){c=t[s];var m=ns(c),y=m=="wrapper"?pi(c):r;y&&yi(y[0])&&y[1]==(V|K|M|je)&&!y[4].length&&y[9]==1?p=p[ns(y[0])].apply(p,y[3]):p=c.length==1&&yi(c)?p[m]():p.thru(c)}return function(){var A=arguments,I=A[0];if(p&&A.length==1&&le(I))return p.plant(I).value();for(var L=0,$=n?t[L].apply(this,A):I;++L<n;)$=t[L].call(this,$);return $}})}function Xr(e,t,n,s,o,c,p,m,y,A){var I=t&V,L=t&G,$=t&R,Y=t&(K|w),re=t&z,de=$?r:ur(e);function se(){for(var ge=arguments.length,me=S(ge),vt=ge;vt--;)me[vt]=arguments[vt];if(Y)var at=Bn(se),yt=vc(me,at);if(s&&(me=oa(me,s,o,Y)),c&&(me=aa(me,c,p,Y)),ge-=yt,Y&&ge<A){var ze=nn(me,at);return pa(e,t,Xr,se.placeholder,n,me,ze,m,y,A-ge)}var Pt=L?n:this,Yt=$?Pt[e]:e;return ge=me.length,m?me=kd(me,m):re&&ge>1&&me.reverse(),I&&y<ge&&(me.length=y),this&&this!==Ve&&this instanceof se&&(Yt=de||ur(Yt)),Yt.apply(Pt,me)}return se}function ha(e,t){return function(n,s){return Pu(n,e,t(s),{})}}function Qr(e,t){return function(n,s){var o;if(n===r&&s===r)return t;if(n!==r&&(o=n),s!==r){if(o===r)return s;typeof n=="string"||typeof s=="string"?(n=mt(n),s=mt(s)):(n=Xo(n),s=Xo(s)),o=e(n,s)}return o}}function di(e){return Ht(function(t){return t=Pe(t,pt(ne())),he(function(n){var s=this;return e(t,function(o){return gt(o,s,n)})})})}function es(e,t){t=t===r?" ":mt(t);var n=t.length;if(n<2)return n?si(t,e):t;var s=si(t,Br(e/Ln(t)));return Mn(t)?ln(Mt(s),0,e).join(""):s.slice(0,e)}function ad(e,t,n,s){var o=t&G,c=ur(e);function p(){for(var m=-1,y=arguments.length,A=-1,I=s.length,L=S(I+y),$=this&&this!==Ve&&this instanceof p?c:e;++A<I;)L[A]=s[A];for(;y--;)L[A++]=arguments[++m];return gt($,o?n:this,L)}return p}function ga(e){return function(t,n,s){return s&&typeof s!="number"&&ot(t,n,s)&&(n=s=r),t=Jt(t),n===r?(n=t,t=0):n=Jt(n),s=s===r?t<n?1:-1:Jt(s),Ku(t,n,s,e)}}function ts(e){return function(t,n){return typeof t=="string"&&typeof n=="string"||(t=Et(t),n=Et(n)),e(t,n)}}function pa(e,t,n,s,o,c,p,m,y,A){var I=t&K,L=I?p:r,$=I?r:p,Y=I?c:r,re=I?r:c;t|=I?M:D,t&=~(I?D:M),t&X||(t&=-4);var de=[e,t,o,Y,L,re,$,m,y,A],se=n.apply(r,de);return yi(e)&&Ea(se,de),se.placeholder=s,Ca(se,e,t)}function fi(e){var t=Ke[e];return function(n,s){if(n=Et(n),s=s==null?0:tt(ue(s),292),s&&Co(n)){var o=(Se(n)+"e").split("e"),c=t(o[0]+"e"+(+o[1]+s));return o=(Se(c)+"e").split("e"),+(o[0]+"e"+(+o[1]-s))}return t(n)}}var ld=Tn&&1/Ir(new Tn([,-0]))[1]==fe?function(e){return new Tn(e)}:Pi;function ma(e){return function(t){var n=nt(t);return n==Ye?zs(t):n==De?jc(t):xc(t,e(t))}}function Gt(e,t,n,s,o,c,p,m){var y=t&R;if(!y&&typeof e!="function")throw new _t(g);var A=s?s.length:0;if(A||(t&=-97,s=o=r),p=p===r?p:qe(ue(p),0),m=m===r?m:ue(m),A-=o?o.length:0,t&D){var I=s,L=o;s=o=r}var $=y?r:pi(e),Y=[e,t,n,s,o,I,L,c,p,m];if($&&Sd(Y,$),e=Y[0],t=Y[1],n=Y[2],s=Y[3],o=Y[4],m=Y[9]=Y[9]===r?y?0:e.length:qe(Y[9]-A,0),!m&&t&(K|w)&&(t&=-25),!t||t==G)var re=id(e,t,n);else t==K||t==w?re=od(e,t,m):(t==M||t==(G|M))&&!o.length?re=ad(e,t,n,s):re=Xr.apply(r,Y);var de=$?Vo:Ea;return Ca(de(re,Y),e,t)}function xa(e,t,n,s){return e===r||Ot(e,Pn[n])&&!Ne.call(s,n)?t:e}function va(e,t,n,s,o,c){return Te(e)&&Te(t)&&(c.set(t,e),Jr(e,t,r,va,c),c.delete(t)),e}function cd(e){return hr(e)?r:e}function ya(e,t,n,s,o,c){var p=n&P,m=e.length,y=t.length;if(m!=y&&!(p&&y>m))return!1;var A=c.get(e),I=c.get(t);if(A&&I)return A==t&&I==e;var L=-1,$=!0,Y=n&B?new yn:r;for(c.set(e,t),c.set(t,e);++L<m;){var re=e[L],de=t[L];if(s)var se=p?s(de,re,L,t,e,c):s(re,de,L,e,t,c);if(se!==r){if(se)continue;$=!1;break}if(Y){if(!Rs(t,function(ge,me){if(!Qn(Y,me)&&(re===ge||o(re,ge,n,s,c)))return Y.push(me)})){$=!1;break}}else if(!(re===de||o(re,de,n,s,c))){$=!1;break}}return c.delete(e),c.delete(t),$}function ud(e,t,n,s,o,c,p){switch(n){case Bt:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case It:return!(e.byteLength!=t.byteLength||!c(new Rr(e),new Rr(t)));case rt:case Qe:case ct:return Ot(+e,+t);case st:return e.name==t.name&&e.message==t.message;case Le:case We:return e==t+"";case Ye:var m=zs;case De:var y=s&P;if(m||(m=Ir),e.size!=t.size&&!y)return!1;var A=p.get(e);if(A)return A==t;s|=B,p.set(e,t);var I=ya(m(e),m(t),s,o,c,p);return p.delete(e),I;case Oe:if(sr)return sr.call(e)==sr.call(t)}return!1}function dd(e,t,n,s,o,c){var p=n&P,m=hi(e),y=m.length,A=hi(t),I=A.length;if(y!=I&&!p)return!1;for(var L=y;L--;){var $=m[L];if(!(p?$ in t:Ne.call(t,$)))return!1}var Y=c.get(e),re=c.get(t);if(Y&&re)return Y==t&&re==e;var de=!0;c.set(e,t),c.set(t,e);for(var se=p;++L<y;){$=m[L];var ge=e[$],me=t[$];if(s)var vt=p?s(me,ge,$,t,e,c):s(ge,me,$,e,t,c);if(!(vt===r?ge===me||o(ge,me,n,s,c):vt)){de=!1;break}se||(se=$=="constructor")}if(de&&!se){var at=e.constructor,yt=t.constructor;at!=yt&&"constructor"in e&&"constructor"in t&&!(typeof at=="function"&&at instanceof at&&typeof yt=="function"&&yt instanceof yt)&&(de=!1)}return c.delete(e),c.delete(t),de}function Ht(e){return wi(ja(e,r,Pa),e+"")}function hi(e){return $o(e,Je,xi)}function gi(e){return $o(e,ft,ba)}var pi=zr?function(e){return zr.get(e)}:Pi;function ns(e){for(var t=e.name+"",n=Rn[t],s=Ne.call(Rn,t)?n.length:0;s--;){var o=n[s],c=o.func;if(c==null||c==e)return o.name}return t}function Bn(e){var t=Ne.call(l,"placeholder")?l:e;return t.placeholder}function ne(){var e=l.iteratee||Li;return e=e===Li?zo:e,arguments.length?e(arguments[0],arguments[1]):e}function rs(e,t){var n=e.__data__;return yd(t)?n[typeof t=="string"?"string":"hash"]:n.map}function mi(e){for(var t=Je(e),n=t.length;n--;){var s=t[n],o=e[s];t[n]=[s,o,Sa(o)]}return t}function _n(e,t){var n=_c(e,t);return Fo(n)?n:r}function fd(e){var t=Ne.call(e,xn),n=e[xn];try{e[xn]=r;var s=!0}catch{}var o=Pr.call(e);return s&&(t?e[xn]=n:delete e[xn]),o}var xi=Gs?function(e){return e==null?[]:(e=Ce(e),en(Gs(e),function(t){return ko.call(e,t)}))}:Ti,ba=Gs?function(e){for(var t=[];e;)tn(t,xi(e)),e=Dr(e);return t}:Ti,nt=it;(Hs&&nt(new Hs(new ArrayBuffer(1)))!=Bt||tr&&nt(new tr)!=Ye||Ks&&nt(Ks.resolve())!=oe||Tn&&nt(new Tn)!=De||nr&&nt(new nr)!=Be)&&(nt=function(e){var t=it(e),n=t==F?e.constructor:r,s=n?Sn(n):"";if(s)switch(s){case Jc:return Bt;case Yc:return Ye;case Vc:return oe;case Zc:return De;case Xc:return Be}return t});function hd(e,t,n){for(var s=-1,o=n.length;++s<o;){var c=n[s],p=c.size;switch(c.type){case"drop":e+=p;break;case"dropRight":t-=p;break;case"take":t=tt(t,e+p);break;case"takeRight":e=qe(e,t-p);break}}return{start:e,end:t}}function gd(e){var t=e.match(js);return t?t[1].split(Sr):[]}function wa(e,t,n){t=an(t,e);for(var s=-1,o=t.length,c=!1;++s<o;){var p=Wt(t[s]);if(!(c=e!=null&&n(e,p)))break;e=e[p]}return c||++s!=o?c:(o=e==null?0:e.length,!!o&&us(o)&&Kt(p,o)&&(le(e)||Nn(e)))}function pd(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&Ne.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function _a(e){return typeof e.constructor=="function"&&!dr(e)?Dn(Dr(e)):{}}function md(e,t,n){var s=e.constructor;switch(t){case It:return ui(e);case rt:case Qe:return new s(+e);case Bt:return Qu(e,n);case fn:case hn:case kn:case En:case Hn:case Vt:case Kn:case qn:case Jn:return sa(e,n);case Ye:return new s;case ct:case We:return new s(e);case Le:return ed(e);case De:return new s;case Oe:return td(e)}}function xd(e,t){var n=t.length;if(!n)return e;var s=n-1;return t[s]=(n>1?"& ":"")+t[s],t=t.join(n>2?", ":" "),e.replace(Xn,`{
/* [wrapped with `+t+`] */
`)}function vd(e){return le(e)||Nn(e)||!!(Eo&&e&&e[Eo])}function Kt(e,t){var n=typeof e;return t=t??J,!!t&&(n=="number"||n!="symbol"&&Qt.test(e))&&e>-1&&e%1==0&&e<t}function ot(e,t,n){if(!Te(n))return!1;var s=typeof t;return(s=="number"?dt(n)&&Kt(t,n.length):s=="string"&&t in n)?Ot(n[t],e):!1}function vi(e,t){if(le(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||xt(e)?!0:Ss.test(e)||!_s.test(e)||t!=null&&e in Ce(t)}function yd(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function yi(e){var t=ns(e),n=l[t];if(typeof n!="function"||!(t in pe.prototype))return!1;if(e===n)return!0;var s=pi(n);return!!s&&e===s[0]}function bd(e){return!!So&&So in e}var wd=Lr?qt:Ri;function dr(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||Pn;return e===n}function Sa(e){return e===e&&!Te(e)}function Na(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==r||e in Ce(n))}}function _d(e){var t=ls(e,function(s){return n.size===j&&n.clear(),s}),n=t.cache;return t}function Sd(e,t){var n=e[1],s=t[1],o=n|s,c=o<(G|R|V),p=s==V&&n==K||s==V&&n==je&&e[7].length<=t[8]||s==(V|je)&&t[7].length<=t[8]&&n==K;if(!(c||p))return e;s&G&&(e[2]=t[2],o|=n&G?0:X);var m=t[3];if(m){var y=e[3];e[3]=y?oa(y,m,t[4]):m,e[4]=y?nn(e[3],N):t[4]}return m=t[5],m&&(y=e[5],e[5]=y?aa(y,m,t[6]):m,e[6]=y?nn(e[5],N):t[6]),m=t[7],m&&(e[7]=m),s&V&&(e[8]=e[8]==null?t[8]:tt(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=o,e}function Nd(e){var t=[];if(e!=null)for(var n in Ce(e))t.push(n);return t}function jd(e){return Pr.call(e)}function ja(e,t,n){return t=qe(t===r?e.length-1:t,0),function(){for(var s=arguments,o=-1,c=qe(s.length-t,0),p=S(c);++o<c;)p[o]=s[t+o];o=-1;for(var m=S(t+1);++o<t;)m[o]=s[o];return m[t]=n(p),gt(e,this,m)}}function ka(e,t){return t.length<2?e:wn(e,jt(t,0,-1))}function kd(e,t){for(var n=e.length,s=tt(t.length,n),o=ut(e);s--;){var c=t[s];e[s]=Kt(c,n)?o[c]:r}return e}function bi(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var Ea=Aa(Vo),fr=Fc||function(e,t){return Ve.setTimeout(e,t)},wi=Aa(Yu);function Ca(e,t,n){var s=t+"";return wi(e,xd(s,Ed(gd(s),n)))}function Aa(e){var t=0,n=0;return function(){var s=Hc(),o=we-(s-n);if(n=s,o>0){if(++t>=q)return arguments[0]}else t=0;return e.apply(r,arguments)}}function ss(e,t){var n=-1,s=e.length,o=s-1;for(t=t===r?s:t;++n<t;){var c=ri(n,o),p=e[c];e[c]=e[n],e[n]=p}return e.length=t,e}var Ia=_d(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Zt,function(n,s,o,c){t.push(o?c.replace(ks,"$1"):s||n)}),t});function Wt(e){if(typeof e=="string"||xt(e))return e;var t=e+"";return t=="0"&&1/e==-fe?"-0":t}function Sn(e){if(e!=null){try{return Or.call(e)}catch{}try{return e+""}catch{}}return""}function Ed(e,t){return wt(ye,function(n){var s="_."+n[0];t&n[1]&&!Cr(e,s)&&e.push(s)}),e.sort()}function Ma(e){if(e instanceof pe)return e.clone();var t=new St(e.__wrapped__,e.__chain__);return t.__actions__=ut(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function Cd(e,t,n){(n?ot(e,t,n):t===r)?t=1:t=qe(ue(t),0);var s=e==null?0:e.length;if(!s||t<1)return[];for(var o=0,c=0,p=S(Br(s/t));o<s;)p[c++]=jt(e,o,o+=t);return p}function Ad(e){for(var t=-1,n=e==null?0:e.length,s=0,o=[];++t<n;){var c=e[t];c&&(o[s++]=c)}return o}function Id(){var e=arguments.length;if(!e)return[];for(var t=S(e-1),n=arguments[0],s=e;s--;)t[s-1]=arguments[s];return tn(le(n)?ut(n):[n],Ze(t,1))}var Md=he(function(e,t){return Fe(e)?or(e,Ze(t,1,Fe,!0)):[]}),Ld=he(function(e,t){var n=kt(t);return Fe(n)&&(n=r),Fe(e)?or(e,Ze(t,1,Fe,!0),ne(n,2)):[]}),Od=he(function(e,t){var n=kt(t);return Fe(n)&&(n=r),Fe(e)?or(e,Ze(t,1,Fe,!0),r,n):[]});function Pd(e,t,n){var s=e==null?0:e.length;return s?(t=n||t===r?1:ue(t),jt(e,t<0?0:t,s)):[]}function Td(e,t,n){var s=e==null?0:e.length;return s?(t=n||t===r?1:ue(t),t=s-t,jt(e,0,t<0?0:t)):[]}function Rd(e,t){return e&&e.length?Vr(e,ne(t,3),!0,!0):[]}function Dd(e,t){return e&&e.length?Vr(e,ne(t,3),!0):[]}function Wd(e,t,n,s){var o=e==null?0:e.length;return o?(n&&typeof n!="number"&&ot(e,t,n)&&(n=0,s=o),Iu(e,t,n,s)):[]}function La(e,t,n){var s=e==null?0:e.length;if(!s)return-1;var o=n==null?0:ue(n);return o<0&&(o=qe(s+o,0)),Ar(e,ne(t,3),o)}function Oa(e,t,n){var s=e==null?0:e.length;if(!s)return-1;var o=s-1;return n!==r&&(o=ue(n),o=n<0?qe(s+o,0):tt(o,s-1)),Ar(e,ne(t,3),o,!0)}function Pa(e){var t=e==null?0:e.length;return t?Ze(e,1):[]}function $d(e){var t=e==null?0:e.length;return t?Ze(e,fe):[]}function Bd(e,t){var n=e==null?0:e.length;return n?(t=t===r?1:ue(t),Ze(e,t)):[]}function Fd(e){for(var t=-1,n=e==null?0:e.length,s={};++t<n;){var o=e[t];s[o[0]]=o[1]}return s}function Ta(e){return e&&e.length?e[0]:r}function zd(e,t,n){var s=e==null?0:e.length;if(!s)return-1;var o=n==null?0:ue(n);return o<0&&(o=qe(s+o,0)),In(e,t,o)}function Ud(e){var t=e==null?0:e.length;return t?jt(e,0,-1):[]}var Gd=he(function(e){var t=Pe(e,li);return t.length&&t[0]===e[0]?Xs(t):[]}),Hd=he(function(e){var t=kt(e),n=Pe(e,li);return t===kt(n)?t=r:n.pop(),n.length&&n[0]===e[0]?Xs(n,ne(t,2)):[]}),Kd=he(function(e){var t=kt(e),n=Pe(e,li);return t=typeof t=="function"?t:r,t&&n.pop(),n.length&&n[0]===e[0]?Xs(n,r,t):[]});function qd(e,t){return e==null?"":Uc.call(e,t)}function kt(e){var t=e==null?0:e.length;return t?e[t-1]:r}function Jd(e,t,n){var s=e==null?0:e.length;if(!s)return-1;var o=s;return n!==r&&(o=ue(n),o=o<0?qe(s+o,0):tt(o,s-1)),t===t?Ec(e,t,o):Ar(e,po,o,!0)}function Yd(e,t){return e&&e.length?Ko(e,ue(t)):r}var Vd=he(Ra);function Ra(e,t){return e&&e.length&&t&&t.length?ni(e,t):e}function Zd(e,t,n){return e&&e.length&&t&&t.length?ni(e,t,ne(n,2)):e}function Xd(e,t,n){return e&&e.length&&t&&t.length?ni(e,t,r,n):e}var Qd=Ht(function(e,t){var n=e==null?0:e.length,s=Js(e,t);return Yo(e,Pe(t,function(o){return Kt(o,n)?+o:o}).sort(ia)),s});function ef(e,t){var n=[];if(!(e&&e.length))return n;var s=-1,o=[],c=e.length;for(t=ne(t,3);++s<c;){var p=e[s];t(p,s,e)&&(n.push(p),o.push(s))}return Yo(e,o),n}function _i(e){return e==null?e:qc.call(e)}function tf(e,t,n){var s=e==null?0:e.length;return s?(n&&typeof n!="number"&&ot(e,t,n)?(t=0,n=s):(t=t==null?0:ue(t),n=n===r?s:ue(n)),jt(e,t,n)):[]}function nf(e,t){return Yr(e,t)}function rf(e,t,n){return ii(e,t,ne(n,2))}function sf(e,t){var n=e==null?0:e.length;if(n){var s=Yr(e,t);if(s<n&&Ot(e[s],t))return s}return-1}function of(e,t){return Yr(e,t,!0)}function af(e,t,n){return ii(e,t,ne(n,2),!0)}function lf(e,t){var n=e==null?0:e.length;if(n){var s=Yr(e,t,!0)-1;if(Ot(e[s],t))return s}return-1}function cf(e){return e&&e.length?Zo(e):[]}function uf(e,t){return e&&e.length?Zo(e,ne(t,2)):[]}function df(e){var t=e==null?0:e.length;return t?jt(e,1,t):[]}function ff(e,t,n){return e&&e.length?(t=n||t===r?1:ue(t),jt(e,0,t<0?0:t)):[]}function hf(e,t,n){var s=e==null?0:e.length;return s?(t=n||t===r?1:ue(t),t=s-t,jt(e,t<0?0:t,s)):[]}function gf(e,t){return e&&e.length?Vr(e,ne(t,3),!1,!0):[]}function pf(e,t){return e&&e.length?Vr(e,ne(t,3)):[]}var mf=he(function(e){return on(Ze(e,1,Fe,!0))}),xf=he(function(e){var t=kt(e);return Fe(t)&&(t=r),on(Ze(e,1,Fe,!0),ne(t,2))}),vf=he(function(e){var t=kt(e);return t=typeof t=="function"?t:r,on(Ze(e,1,Fe,!0),r,t)});function yf(e){return e&&e.length?on(e):[]}function bf(e,t){return e&&e.length?on(e,ne(t,2)):[]}function wf(e,t){return t=typeof t=="function"?t:r,e&&e.length?on(e,r,t):[]}function Si(e){if(!(e&&e.length))return[];var t=0;return e=en(e,function(n){if(Fe(n))return t=qe(n.length,t),!0}),Bs(t,function(n){return Pe(e,Ds(n))})}function Da(e,t){if(!(e&&e.length))return[];var n=Si(e);return t==null?n:Pe(n,function(s){return gt(t,r,s)})}var _f=he(function(e,t){return Fe(e)?or(e,t):[]}),Sf=he(function(e){return ai(en(e,Fe))}),Nf=he(function(e){var t=kt(e);return Fe(t)&&(t=r),ai(en(e,Fe),ne(t,2))}),jf=he(function(e){var t=kt(e);return t=typeof t=="function"?t:r,ai(en(e,Fe),r,t)}),kf=he(Si);function Ef(e,t){return ta(e||[],t||[],ir)}function Cf(e,t){return ta(e||[],t||[],cr)}var Af=he(function(e){var t=e.length,n=t>1?e[t-1]:r;return n=typeof n=="function"?(e.pop(),n):r,Da(e,n)});function Wa(e){var t=l(e);return t.__chain__=!0,t}function If(e,t){return t(e),e}function is(e,t){return t(e)}var Mf=Ht(function(e){var t=e.length,n=t?e[0]:0,s=this.__wrapped__,o=function(c){return Js(c,e)};return t>1||this.__actions__.length||!(s instanceof pe)||!Kt(n)?this.thru(o):(s=s.slice(n,+n+(t?1:0)),s.__actions__.push({func:is,args:[o],thisArg:r}),new St(s,this.__chain__).thru(function(c){return t&&!c.length&&c.push(r),c}))});function Lf(){return Wa(this)}function Of(){return new St(this.value(),this.__chain__)}function Pf(){this.__values__===r&&(this.__values__=Xa(this.value()));var e=this.__index__>=this.__values__.length,t=e?r:this.__values__[this.__index__++];return{done:e,value:t}}function Tf(){return this}function Rf(e){for(var t,n=this;n instanceof Gr;){var s=Ma(n);s.__index__=0,s.__values__=r,t?o.__wrapped__=s:t=s;var o=s;n=n.__wrapped__}return o.__wrapped__=e,t}function Df(){var e=this.__wrapped__;if(e instanceof pe){var t=e;return this.__actions__.length&&(t=new pe(this)),t=t.reverse(),t.__actions__.push({func:is,args:[_i],thisArg:r}),new St(t,this.__chain__)}return this.thru(_i)}function Wf(){return ea(this.__wrapped__,this.__actions__)}var $f=Zr(function(e,t,n){Ne.call(e,n)?++e[n]:Ut(e,n,1)});function Bf(e,t,n){var s=le(e)?ho:Au;return n&&ot(e,t,n)&&(t=r),s(e,ne(t,3))}function Ff(e,t){var n=le(e)?en:Do;return n(e,ne(t,3))}var zf=da(La),Uf=da(Oa);function Gf(e,t){return Ze(os(e,t),1)}function Hf(e,t){return Ze(os(e,t),fe)}function Kf(e,t,n){return n=n===r?1:ue(n),Ze(os(e,t),n)}function $a(e,t){var n=le(e)?wt:sn;return n(e,ne(t,3))}function Ba(e,t){var n=le(e)?uc:Ro;return n(e,ne(t,3))}var qf=Zr(function(e,t,n){Ne.call(e,n)?e[n].push(t):Ut(e,n,[t])});function Jf(e,t,n,s){e=dt(e)?e:zn(e),n=n&&!s?ue(n):0;var o=e.length;return n<0&&(n=qe(o+n,0)),ds(e)?n<=o&&e.indexOf(t,n)>-1:!!o&&In(e,t,n)>-1}var Yf=he(function(e,t,n){var s=-1,o=typeof t=="function",c=dt(e)?S(e.length):[];return sn(e,function(p){c[++s]=o?gt(t,p,n):ar(p,t,n)}),c}),Vf=Zr(function(e,t,n){Ut(e,n,t)});function os(e,t){var n=le(e)?Pe:Uo;return n(e,ne(t,3))}function Zf(e,t,n,s){return e==null?[]:(le(t)||(t=t==null?[]:[t]),n=s?r:n,le(n)||(n=n==null?[]:[n]),qo(e,t,n))}var Xf=Zr(function(e,t,n){e[n?0:1].push(t)},function(){return[[],[]]});function Qf(e,t,n){var s=le(e)?Ts:xo,o=arguments.length<3;return s(e,ne(t,4),n,o,sn)}function eh(e,t,n){var s=le(e)?dc:xo,o=arguments.length<3;return s(e,ne(t,4),n,o,Ro)}function th(e,t){var n=le(e)?en:Do;return n(e,cs(ne(t,3)))}function nh(e){var t=le(e)?Lo:qu;return t(e)}function rh(e,t,n){(n?ot(e,t,n):t===r)?t=1:t=ue(t);var s=le(e)?Nu:Ju;return s(e,t)}function sh(e){var t=le(e)?ju:Vu;return t(e)}function ih(e){if(e==null)return 0;if(dt(e))return ds(e)?Ln(e):e.length;var t=nt(e);return t==Ye||t==De?e.size:ei(e).length}function oh(e,t,n){var s=le(e)?Rs:Zu;return n&&ot(e,t,n)&&(t=r),s(e,ne(t,3))}var ah=he(function(e,t){if(e==null)return[];var n=t.length;return n>1&&ot(e,t[0],t[1])?t=[]:n>2&&ot(t[0],t[1],t[2])&&(t=[t[0]]),qo(e,Ze(t,1),[])}),as=Bc||function(){return Ve.Date.now()};function lh(e,t){if(typeof t!="function")throw new _t(g);return e=ue(e),function(){if(--e<1)return t.apply(this,arguments)}}function Fa(e,t,n){return t=n?r:t,t=e&&t==null?e.length:t,Gt(e,V,r,r,r,r,t)}function za(e,t){var n;if(typeof t!="function")throw new _t(g);return e=ue(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=r),n}}var Ni=he(function(e,t,n){var s=G;if(n.length){var o=nn(n,Bn(Ni));s|=M}return Gt(e,s,t,n,o)}),Ua=he(function(e,t,n){var s=G|R;if(n.length){var o=nn(n,Bn(Ua));s|=M}return Gt(t,s,e,n,o)});function Ga(e,t,n){t=n?r:t;var s=Gt(e,K,r,r,r,r,r,t);return s.placeholder=Ga.placeholder,s}function Ha(e,t,n){t=n?r:t;var s=Gt(e,w,r,r,r,r,r,t);return s.placeholder=Ha.placeholder,s}function Ka(e,t,n){var s,o,c,p,m,y,A=0,I=!1,L=!1,$=!0;if(typeof e!="function")throw new _t(g);t=Et(t)||0,Te(n)&&(I=!!n.leading,L="maxWait"in n,c=L?qe(Et(n.maxWait)||0,t):c,$="trailing"in n?!!n.trailing:$);function Y(ze){var Pt=s,Yt=o;return s=o=r,A=ze,p=e.apply(Yt,Pt),p}function re(ze){return A=ze,m=fr(ge,t),I?Y(ze):p}function de(ze){var Pt=ze-y,Yt=ze-A,dl=t-Pt;return L?tt(dl,c-Yt):dl}function se(ze){var Pt=ze-y,Yt=ze-A;return y===r||Pt>=t||Pt<0||L&&Yt>=c}function ge(){var ze=as();if(se(ze))return me(ze);m=fr(ge,de(ze))}function me(ze){return m=r,$&&s?Y(ze):(s=o=r,p)}function vt(){m!==r&&na(m),A=0,s=y=o=m=r}function at(){return m===r?p:me(as())}function yt(){var ze=as(),Pt=se(ze);if(s=arguments,o=this,y=ze,Pt){if(m===r)return re(y);if(L)return na(m),m=fr(ge,t),Y(y)}return m===r&&(m=fr(ge,t)),p}return yt.cancel=vt,yt.flush=at,yt}var ch=he(function(e,t){return To(e,1,t)}),uh=he(function(e,t,n){return To(e,Et(t)||0,n)});function dh(e){return Gt(e,z)}function ls(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new _t(g);var n=function(){var s=arguments,o=t?t.apply(this,s):s[0],c=n.cache;if(c.has(o))return c.get(o);var p=e.apply(this,s);return n.cache=c.set(o,p)||c,p};return n.cache=new(ls.Cache||zt),n}ls.Cache=zt;function cs(e){if(typeof e!="function")throw new _t(g);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function fh(e){return za(2,e)}var hh=Xu(function(e,t){t=t.length==1&&le(t[0])?Pe(t[0],pt(ne())):Pe(Ze(t,1),pt(ne()));var n=t.length;return he(function(s){for(var o=-1,c=tt(s.length,n);++o<c;)s[o]=t[o].call(this,s[o]);return gt(e,this,s)})}),ji=he(function(e,t){var n=nn(t,Bn(ji));return Gt(e,M,r,t,n)}),qa=he(function(e,t){var n=nn(t,Bn(qa));return Gt(e,D,r,t,n)}),gh=Ht(function(e,t){return Gt(e,je,r,r,r,t)});function ph(e,t){if(typeof e!="function")throw new _t(g);return t=t===r?t:ue(t),he(e,t)}function mh(e,t){if(typeof e!="function")throw new _t(g);return t=t==null?0:qe(ue(t),0),he(function(n){var s=n[t],o=ln(n,0,t);return s&&tn(o,s),gt(e,this,o)})}function xh(e,t,n){var s=!0,o=!0;if(typeof e!="function")throw new _t(g);return Te(n)&&(s="leading"in n?!!n.leading:s,o="trailing"in n?!!n.trailing:o),Ka(e,t,{leading:s,maxWait:t,trailing:o})}function vh(e){return Fa(e,1)}function yh(e,t){return ji(ci(t),e)}function bh(){if(!arguments.length)return[];var e=arguments[0];return le(e)?e:[e]}function wh(e){return Nt(e,O)}function _h(e,t){return t=typeof t=="function"?t:r,Nt(e,O,t)}function Sh(e){return Nt(e,_|O)}function Nh(e,t){return t=typeof t=="function"?t:r,Nt(e,_|O,t)}function jh(e,t){return t==null||Po(e,t,Je(t))}function Ot(e,t){return e===t||e!==e&&t!==t}var kh=ts(Zs),Eh=ts(function(e,t){return e>=t}),Nn=Bo(function(){return arguments}())?Bo:function(e){return $e(e)&&Ne.call(e,"callee")&&!ko.call(e,"callee")},le=S.isArray,Ch=oo?pt(oo):Tu;function dt(e){return e!=null&&us(e.length)&&!qt(e)}function Fe(e){return $e(e)&&dt(e)}function Ah(e){return e===!0||e===!1||$e(e)&&it(e)==rt}var cn=zc||Ri,Ih=ao?pt(ao):Ru;function Mh(e){return $e(e)&&e.nodeType===1&&!hr(e)}function Lh(e){if(e==null)return!0;if(dt(e)&&(le(e)||typeof e=="string"||typeof e.splice=="function"||cn(e)||Fn(e)||Nn(e)))return!e.length;var t=nt(e);if(t==Ye||t==De)return!e.size;if(dr(e))return!ei(e).length;for(var n in e)if(Ne.call(e,n))return!1;return!0}function Oh(e,t){return lr(e,t)}function Ph(e,t,n){n=typeof n=="function"?n:r;var s=n?n(e,t):r;return s===r?lr(e,t,r,n):!!s}function ki(e){if(!$e(e))return!1;var t=it(e);return t==st||t==Ct||typeof e.message=="string"&&typeof e.name=="string"&&!hr(e)}function Th(e){return typeof e=="number"&&Co(e)}function qt(e){if(!Te(e))return!1;var t=it(e);return t==At||t==Ue||t==lt||t==Ae}function Ja(e){return typeof e=="number"&&e==ue(e)}function us(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=J}function Te(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function $e(e){return e!=null&&typeof e=="object"}var Ya=lo?pt(lo):Wu;function Rh(e,t){return e===t||Qs(e,t,mi(t))}function Dh(e,t,n){return n=typeof n=="function"?n:r,Qs(e,t,mi(t),n)}function Wh(e){return Va(e)&&e!=+e}function $h(e){if(wd(e))throw new ae(h);return Fo(e)}function Bh(e){return e===null}function Fh(e){return e==null}function Va(e){return typeof e=="number"||$e(e)&&it(e)==ct}function hr(e){if(!$e(e)||it(e)!=F)return!1;var t=Dr(e);if(t===null)return!0;var n=Ne.call(t,"constructor")&&t.constructor;return typeof n=="function"&&n instanceof n&&Or.call(n)==Rc}var Ei=co?pt(co):$u;function zh(e){return Ja(e)&&e>=-J&&e<=J}var Za=uo?pt(uo):Bu;function ds(e){return typeof e=="string"||!le(e)&&$e(e)&&it(e)==We}function xt(e){return typeof e=="symbol"||$e(e)&&it(e)==Oe}var Fn=fo?pt(fo):Fu;function Uh(e){return e===r}function Gh(e){return $e(e)&&nt(e)==Be}function Hh(e){return $e(e)&&it(e)==$t}var Kh=ts(ti),qh=ts(function(e,t){return e<=t});function Xa(e){if(!e)return[];if(dt(e))return ds(e)?Mt(e):ut(e);if(er&&e[er])return Nc(e[er]());var t=nt(e),n=t==Ye?zs:t==De?Ir:zn;return n(e)}function Jt(e){if(!e)return e===0?e:0;if(e=Et(e),e===fe||e===-fe){var t=e<0?-1:1;return t*xe}return e===e?e:0}function ue(e){var t=Jt(e),n=t%1;return t===t?n?t-n:t:0}function Qa(e){return e?bn(ue(e),0,te):0}function Et(e){if(typeof e=="number")return e;if(xt(e))return Z;if(Te(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Te(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=vo(e);var n=W.test(e);return n||et.test(e)?ac(e.slice(2),n?2:8):T.test(e)?Z:+e}function el(e){return Dt(e,ft(e))}function Jh(e){return e?bn(ue(e),-J,J):e===0?e:0}function Se(e){return e==null?"":mt(e)}var Yh=Wn(function(e,t){if(dr(t)||dt(t)){Dt(t,Je(t),e);return}for(var n in t)Ne.call(t,n)&&ir(e,n,t[n])}),tl=Wn(function(e,t){Dt(t,ft(t),e)}),fs=Wn(function(e,t,n,s){Dt(t,ft(t),e,s)}),Vh=Wn(function(e,t,n,s){Dt(t,Je(t),e,s)}),Zh=Ht(Js);function Xh(e,t){var n=Dn(e);return t==null?n:Oo(n,t)}var Qh=he(function(e,t){e=Ce(e);var n=-1,s=t.length,o=s>2?t[2]:r;for(o&&ot(t[0],t[1],o)&&(s=1);++n<s;)for(var c=t[n],p=ft(c),m=-1,y=p.length;++m<y;){var A=p[m],I=e[A];(I===r||Ot(I,Pn[A])&&!Ne.call(e,A))&&(e[A]=c[A])}return e}),e0=he(function(e){return e.push(r,va),gt(nl,r,e)});function t0(e,t){return go(e,ne(t,3),Rt)}function n0(e,t){return go(e,ne(t,3),Vs)}function r0(e,t){return e==null?e:Ys(e,ne(t,3),ft)}function s0(e,t){return e==null?e:Wo(e,ne(t,3),ft)}function i0(e,t){return e&&Rt(e,ne(t,3))}function o0(e,t){return e&&Vs(e,ne(t,3))}function a0(e){return e==null?[]:qr(e,Je(e))}function l0(e){return e==null?[]:qr(e,ft(e))}function Ci(e,t,n){var s=e==null?r:wn(e,t);return s===r?n:s}function c0(e,t){return e!=null&&wa(e,t,Mu)}function Ai(e,t){return e!=null&&wa(e,t,Lu)}var u0=ha(function(e,t,n){t!=null&&typeof t.toString!="function"&&(t=Pr.call(t)),e[t]=n},Mi(ht)),d0=ha(function(e,t,n){t!=null&&typeof t.toString!="function"&&(t=Pr.call(t)),Ne.call(e,t)?e[t].push(n):e[t]=[n]},ne),f0=he(ar);function Je(e){return dt(e)?Mo(e):ei(e)}function ft(e){return dt(e)?Mo(e,!0):zu(e)}function h0(e,t){var n={};return t=ne(t,3),Rt(e,function(s,o,c){Ut(n,t(s,o,c),s)}),n}function g0(e,t){var n={};return t=ne(t,3),Rt(e,function(s,o,c){Ut(n,o,t(s,o,c))}),n}var p0=Wn(function(e,t,n){Jr(e,t,n)}),nl=Wn(function(e,t,n,s){Jr(e,t,n,s)}),m0=Ht(function(e,t){var n={};if(e==null)return n;var s=!1;t=Pe(t,function(c){return c=an(c,e),s||(s=c.length>1),c}),Dt(e,gi(e),n),s&&(n=Nt(n,_|E|O,cd));for(var o=t.length;o--;)oi(n,t[o]);return n});function x0(e,t){return rl(e,cs(ne(t)))}var v0=Ht(function(e,t){return e==null?{}:Gu(e,t)});function rl(e,t){if(e==null)return{};var n=Pe(gi(e),function(s){return[s]});return t=ne(t),Jo(e,n,function(s,o){return t(s,o[0])})}function y0(e,t,n){t=an(t,e);var s=-1,o=t.length;for(o||(o=1,e=r);++s<o;){var c=e==null?r:e[Wt(t[s])];c===r&&(s=o,c=n),e=qt(c)?c.call(e):c}return e}function b0(e,t,n){return e==null?e:cr(e,t,n)}function w0(e,t,n,s){return s=typeof s=="function"?s:r,e==null?e:cr(e,t,n,s)}var sl=ma(Je),il=ma(ft);function _0(e,t,n){var s=le(e),o=s||cn(e)||Fn(e);if(t=ne(t,4),n==null){var c=e&&e.constructor;o?n=s?new c:[]:Te(e)?n=qt(c)?Dn(Dr(e)):{}:n={}}return(o?wt:Rt)(e,function(p,m,y){return t(n,p,m,y)}),n}function S0(e,t){return e==null?!0:oi(e,t)}function N0(e,t,n){return e==null?e:Qo(e,t,ci(n))}function j0(e,t,n,s){return s=typeof s=="function"?s:r,e==null?e:Qo(e,t,ci(n),s)}function zn(e){return e==null?[]:Fs(e,Je(e))}function k0(e){return e==null?[]:Fs(e,ft(e))}function E0(e,t,n){return n===r&&(n=t,t=r),n!==r&&(n=Et(n),n=n===n?n:0),t!==r&&(t=Et(t),t=t===t?t:0),bn(Et(e),t,n)}function C0(e,t,n){return t=Jt(t),n===r?(n=t,t=0):n=Jt(n),e=Et(e),Ou(e,t,n)}function A0(e,t,n){if(n&&typeof n!="boolean"&&ot(e,t,n)&&(t=n=r),n===r&&(typeof t=="boolean"?(n=t,t=r):typeof e=="boolean"&&(n=e,e=r)),e===r&&t===r?(e=0,t=1):(e=Jt(e),t===r?(t=e,e=0):t=Jt(t)),e>t){var s=e;e=t,t=s}if(n||e%1||t%1){var o=Ao();return tt(e+o*(t-e+oc("1e-"+((o+"").length-1))),t)}return ri(e,t)}var I0=$n(function(e,t,n){return t=t.toLowerCase(),e+(n?ol(t):t)});function ol(e){return Ii(Se(e).toLowerCase())}function al(e){return e=Se(e),e&&e.replace(Ml,yc).replace(Vl,"")}function M0(e,t,n){e=Se(e),t=mt(t);var s=e.length;n=n===r?s:bn(ue(n),0,s);var o=n;return n-=t.length,n>=0&&e.slice(n,o)==t}function L0(e){return e=Se(e),e&&bs.test(e)?e.replace(Yn,bc):e}function O0(e){return e=Se(e),e&&Ns.test(e)?e.replace(Vn,"\\$&"):e}var P0=$n(function(e,t,n){return e+(n?"-":"")+t.toLowerCase()}),T0=$n(function(e,t,n){return e+(n?" ":"")+t.toLowerCase()}),R0=ua("toLowerCase");function D0(e,t,n){e=Se(e),t=ue(t);var s=t?Ln(e):0;if(!t||s>=t)return e;var o=(t-s)/2;return es(Fr(o),n)+e+es(Br(o),n)}function W0(e,t,n){e=Se(e),t=ue(t);var s=t?Ln(e):0;return t&&s<t?e+es(t-s,n):e}function $0(e,t,n){e=Se(e),t=ue(t);var s=t?Ln(e):0;return t&&s<t?es(t-s,n)+e:e}function B0(e,t,n){return n||t==null?t=0:t&&(t=+t),Kc(Se(e).replace(Zn,""),t||0)}function F0(e,t,n){return(n?ot(e,t,n):t===r)?t=1:t=ue(t),si(Se(e),t)}function z0(){var e=arguments,t=Se(e[0]);return e.length<3?t:t.replace(e[1],e[2])}var U0=$n(function(e,t,n){return e+(n?"_":"")+t.toLowerCase()});function G0(e,t,n){return n&&typeof n!="number"&&ot(e,t,n)&&(t=n=r),n=n===r?te:n>>>0,n?(e=Se(e),e&&(typeof t=="string"||t!=null&&!Ei(t))&&(t=mt(t),!t&&Mn(e))?ln(Mt(e),0,n):e.split(t,n)):[]}var H0=$n(function(e,t,n){return e+(n?" ":"")+Ii(t)});function K0(e,t,n){return e=Se(e),n=n==null?0:bn(ue(n),0,e.length),t=mt(t),e.slice(n,n+t.length)==t}function q0(e,t,n){var s=l.templateSettings;n&&ot(e,t,n)&&(t=r),e=Se(e),t=fs({},t,s,xa);var o=fs({},t.imports,s.imports,xa),c=Je(o),p=Fs(o,c),m,y,A=0,I=t.interpolate||jr,L="__p += '",$=Us((t.escape||jr).source+"|"+I.source+"|"+(I===Cn?Xt:jr).source+"|"+(t.evaluate||jr).source+"|$","g"),Y="//# sourceURL="+(Ne.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++tc+"]")+`
`;e.replace($,function(se,ge,me,vt,at,yt){return me||(me=vt),L+=e.slice(A,yt).replace(Ll,wc),ge&&(m=!0,L+=`' +
__e(`+ge+`) +
'`),at&&(y=!0,L+=`';
`+at+`;
__p += '`),me&&(L+=`' +
((__t = (`+me+`)) == null ? '' : __t) +
'`),A=yt+se.length,se}),L+=`';
`;var re=Ne.call(t,"variable")&&t.variable;if(!re)L=`with (obj) {
`+L+`
}
`;else if(gn.test(re))throw new ae(x);L=(y?L.replace(ms,""):L).replace(xs,"$1").replace(vs,"$1;"),L="function("+(re||"obj")+`) {
`+(re?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(m?", __e = _.escape":"")+(y?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+L+`return __p
}`;var de=cl(function(){return _e(c,Y+"return "+L).apply(r,p)});if(de.source=L,ki(de))throw de;return de}function J0(e){return Se(e).toLowerCase()}function Y0(e){return Se(e).toUpperCase()}function V0(e,t,n){if(e=Se(e),e&&(n||t===r))return vo(e);if(!e||!(t=mt(t)))return e;var s=Mt(e),o=Mt(t),c=yo(s,o),p=bo(s,o)+1;return ln(s,c,p).join("")}function Z0(e,t,n){if(e=Se(e),e&&(n||t===r))return e.slice(0,_o(e)+1);if(!e||!(t=mt(t)))return e;var s=Mt(e),o=bo(s,Mt(t))+1;return ln(s,0,o).join("")}function X0(e,t,n){if(e=Se(e),e&&(n||t===r))return e.replace(Zn,"");if(!e||!(t=mt(t)))return e;var s=Mt(e),o=yo(s,Mt(t));return ln(s,o).join("")}function Q0(e,t){var n=ce,s=be;if(Te(t)){var o="separator"in t?t.separator:o;n="length"in t?ue(t.length):n,s="omission"in t?mt(t.omission):s}e=Se(e);var c=e.length;if(Mn(e)){var p=Mt(e);c=p.length}if(n>=c)return e;var m=n-Ln(s);if(m<1)return s;var y=p?ln(p,0,m).join(""):e.slice(0,m);if(o===r)return y+s;if(p&&(m+=y.length-m),Ei(o)){if(e.slice(m).search(o)){var A,I=y;for(o.global||(o=Us(o.source,Se(pn.exec(o))+"g")),o.lastIndex=0;A=o.exec(I);)var L=A.index;y=y.slice(0,L===r?m:L)}}else if(e.indexOf(mt(o),m)!=m){var $=y.lastIndexOf(o);$>-1&&(y=y.slice(0,$))}return y+s}function eg(e){return e=Se(e),e&&ys.test(e)?e.replace(br,Cc):e}var tg=$n(function(e,t,n){return e+(n?" ":"")+t.toUpperCase()}),Ii=ua("toUpperCase");function ll(e,t,n){return e=Se(e),t=n?r:t,t===r?Sc(e)?Mc(e):gc(e):e.match(t)||[]}var cl=he(function(e,t){try{return gt(e,r,t)}catch(n){return ki(n)?n:new ae(n)}}),ng=Ht(function(e,t){return wt(t,function(n){n=Wt(n),Ut(e,n,Ni(e[n],e))}),e});function rg(e){var t=e==null?0:e.length,n=ne();return e=t?Pe(e,function(s){if(typeof s[1]!="function")throw new _t(g);return[n(s[0]),s[1]]}):[],he(function(s){for(var o=-1;++o<t;){var c=e[o];if(gt(c[0],this,s))return gt(c[1],this,s)}})}function sg(e){return Cu(Nt(e,_))}function Mi(e){return function(){return e}}function ig(e,t){return e==null||e!==e?t:e}var og=fa(),ag=fa(!0);function ht(e){return e}function Li(e){return zo(typeof e=="function"?e:Nt(e,_))}function lg(e){return Go(Nt(e,_))}function cg(e,t){return Ho(e,Nt(t,_))}var ug=he(function(e,t){return function(n){return ar(n,e,t)}}),dg=he(function(e,t){return function(n){return ar(e,n,t)}});function Oi(e,t,n){var s=Je(t),o=qr(t,s);n==null&&!(Te(t)&&(o.length||!s.length))&&(n=t,t=e,e=this,o=qr(t,Je(t)));var c=!(Te(n)&&"chain"in n)||!!n.chain,p=qt(e);return wt(o,function(m){var y=t[m];e[m]=y,p&&(e.prototype[m]=function(){var A=this.__chain__;if(c||A){var I=e(this.__wrapped__),L=I.__actions__=ut(this.__actions__);return L.push({func:y,args:arguments,thisArg:e}),I.__chain__=A,I}return y.apply(e,tn([this.value()],arguments))})}),e}function fg(){return Ve._===this&&(Ve._=Dc),this}function Pi(){}function hg(e){return e=ue(e),he(function(t){return Ko(t,e)})}var gg=di(Pe),pg=di(ho),mg=di(Rs);function ul(e){return vi(e)?Ds(Wt(e)):Hu(e)}function xg(e){return function(t){return e==null?r:wn(e,t)}}var vg=ga(),yg=ga(!0);function Ti(){return[]}function Ri(){return!1}function bg(){return{}}function wg(){return""}function _g(){return!0}function Sg(e,t){if(e=ue(e),e<1||e>J)return[];var n=te,s=tt(e,te);t=ne(t),e-=te;for(var o=Bs(s,t);++n<e;)t(n);return o}function Ng(e){return le(e)?Pe(e,Wt):xt(e)?[e]:ut(Ia(Se(e)))}function jg(e){var t=++Tc;return Se(e)+t}var kg=Qr(function(e,t){return e+t},0),Eg=fi("ceil"),Cg=Qr(function(e,t){return e/t},1),Ag=fi("floor");function Ig(e){return e&&e.length?Kr(e,ht,Zs):r}function Mg(e,t){return e&&e.length?Kr(e,ne(t,2),Zs):r}function Lg(e){return mo(e,ht)}function Og(e,t){return mo(e,ne(t,2))}function Pg(e){return e&&e.length?Kr(e,ht,ti):r}function Tg(e,t){return e&&e.length?Kr(e,ne(t,2),ti):r}var Rg=Qr(function(e,t){return e*t},1),Dg=fi("round"),Wg=Qr(function(e,t){return e-t},0);function $g(e){return e&&e.length?$s(e,ht):0}function Bg(e,t){return e&&e.length?$s(e,ne(t,2)):0}return l.after=lh,l.ary=Fa,l.assign=Yh,l.assignIn=tl,l.assignInWith=fs,l.assignWith=Vh,l.at=Zh,l.before=za,l.bind=Ni,l.bindAll=ng,l.bindKey=Ua,l.castArray=bh,l.chain=Wa,l.chunk=Cd,l.compact=Ad,l.concat=Id,l.cond=rg,l.conforms=sg,l.constant=Mi,l.countBy=$f,l.create=Xh,l.curry=Ga,l.curryRight=Ha,l.debounce=Ka,l.defaults=Qh,l.defaultsDeep=e0,l.defer=ch,l.delay=uh,l.difference=Md,l.differenceBy=Ld,l.differenceWith=Od,l.drop=Pd,l.dropRight=Td,l.dropRightWhile=Rd,l.dropWhile=Dd,l.fill=Wd,l.filter=Ff,l.flatMap=Gf,l.flatMapDeep=Hf,l.flatMapDepth=Kf,l.flatten=Pa,l.flattenDeep=$d,l.flattenDepth=Bd,l.flip=dh,l.flow=og,l.flowRight=ag,l.fromPairs=Fd,l.functions=a0,l.functionsIn=l0,l.groupBy=qf,l.initial=Ud,l.intersection=Gd,l.intersectionBy=Hd,l.intersectionWith=Kd,l.invert=u0,l.invertBy=d0,l.invokeMap=Yf,l.iteratee=Li,l.keyBy=Vf,l.keys=Je,l.keysIn=ft,l.map=os,l.mapKeys=h0,l.mapValues=g0,l.matches=lg,l.matchesProperty=cg,l.memoize=ls,l.merge=p0,l.mergeWith=nl,l.method=ug,l.methodOf=dg,l.mixin=Oi,l.negate=cs,l.nthArg=hg,l.omit=m0,l.omitBy=x0,l.once=fh,l.orderBy=Zf,l.over=gg,l.overArgs=hh,l.overEvery=pg,l.overSome=mg,l.partial=ji,l.partialRight=qa,l.partition=Xf,l.pick=v0,l.pickBy=rl,l.property=ul,l.propertyOf=xg,l.pull=Vd,l.pullAll=Ra,l.pullAllBy=Zd,l.pullAllWith=Xd,l.pullAt=Qd,l.range=vg,l.rangeRight=yg,l.rearg=gh,l.reject=th,l.remove=ef,l.rest=ph,l.reverse=_i,l.sampleSize=rh,l.set=b0,l.setWith=w0,l.shuffle=sh,l.slice=tf,l.sortBy=ah,l.sortedUniq=cf,l.sortedUniqBy=uf,l.split=G0,l.spread=mh,l.tail=df,l.take=ff,l.takeRight=hf,l.takeRightWhile=gf,l.takeWhile=pf,l.tap=If,l.throttle=xh,l.thru=is,l.toArray=Xa,l.toPairs=sl,l.toPairsIn=il,l.toPath=Ng,l.toPlainObject=el,l.transform=_0,l.unary=vh,l.union=mf,l.unionBy=xf,l.unionWith=vf,l.uniq=yf,l.uniqBy=bf,l.uniqWith=wf,l.unset=S0,l.unzip=Si,l.unzipWith=Da,l.update=N0,l.updateWith=j0,l.values=zn,l.valuesIn=k0,l.without=_f,l.words=ll,l.wrap=yh,l.xor=Sf,l.xorBy=Nf,l.xorWith=jf,l.zip=kf,l.zipObject=Ef,l.zipObjectDeep=Cf,l.zipWith=Af,l.entries=sl,l.entriesIn=il,l.extend=tl,l.extendWith=fs,Oi(l,l),l.add=kg,l.attempt=cl,l.camelCase=I0,l.capitalize=ol,l.ceil=Eg,l.clamp=E0,l.clone=wh,l.cloneDeep=Sh,l.cloneDeepWith=Nh,l.cloneWith=_h,l.conformsTo=jh,l.deburr=al,l.defaultTo=ig,l.divide=Cg,l.endsWith=M0,l.eq=Ot,l.escape=L0,l.escapeRegExp=O0,l.every=Bf,l.find=zf,l.findIndex=La,l.findKey=t0,l.findLast=Uf,l.findLastIndex=Oa,l.findLastKey=n0,l.floor=Ag,l.forEach=$a,l.forEachRight=Ba,l.forIn=r0,l.forInRight=s0,l.forOwn=i0,l.forOwnRight=o0,l.get=Ci,l.gt=kh,l.gte=Eh,l.has=c0,l.hasIn=Ai,l.head=Ta,l.identity=ht,l.includes=Jf,l.indexOf=zd,l.inRange=C0,l.invoke=f0,l.isArguments=Nn,l.isArray=le,l.isArrayBuffer=Ch,l.isArrayLike=dt,l.isArrayLikeObject=Fe,l.isBoolean=Ah,l.isBuffer=cn,l.isDate=Ih,l.isElement=Mh,l.isEmpty=Lh,l.isEqual=Oh,l.isEqualWith=Ph,l.isError=ki,l.isFinite=Th,l.isFunction=qt,l.isInteger=Ja,l.isLength=us,l.isMap=Ya,l.isMatch=Rh,l.isMatchWith=Dh,l.isNaN=Wh,l.isNative=$h,l.isNil=Fh,l.isNull=Bh,l.isNumber=Va,l.isObject=Te,l.isObjectLike=$e,l.isPlainObject=hr,l.isRegExp=Ei,l.isSafeInteger=zh,l.isSet=Za,l.isString=ds,l.isSymbol=xt,l.isTypedArray=Fn,l.isUndefined=Uh,l.isWeakMap=Gh,l.isWeakSet=Hh,l.join=qd,l.kebabCase=P0,l.last=kt,l.lastIndexOf=Jd,l.lowerCase=T0,l.lowerFirst=R0,l.lt=Kh,l.lte=qh,l.max=Ig,l.maxBy=Mg,l.mean=Lg,l.meanBy=Og,l.min=Pg,l.minBy=Tg,l.stubArray=Ti,l.stubFalse=Ri,l.stubObject=bg,l.stubString=wg,l.stubTrue=_g,l.multiply=Rg,l.nth=Yd,l.noConflict=fg,l.noop=Pi,l.now=as,l.pad=D0,l.padEnd=W0,l.padStart=$0,l.parseInt=B0,l.random=A0,l.reduce=Qf,l.reduceRight=eh,l.repeat=F0,l.replace=z0,l.result=y0,l.round=Dg,l.runInContext=v,l.sample=nh,l.size=ih,l.snakeCase=U0,l.some=oh,l.sortedIndex=nf,l.sortedIndexBy=rf,l.sortedIndexOf=sf,l.sortedLastIndex=of,l.sortedLastIndexBy=af,l.sortedLastIndexOf=lf,l.startCase=H0,l.startsWith=K0,l.subtract=Wg,l.sum=$g,l.sumBy=Bg,l.template=q0,l.times=Sg,l.toFinite=Jt,l.toInteger=ue,l.toLength=Qa,l.toLower=J0,l.toNumber=Et,l.toSafeInteger=Jh,l.toString=Se,l.toUpper=Y0,l.trim=V0,l.trimEnd=Z0,l.trimStart=X0,l.truncate=Q0,l.unescape=eg,l.uniqueId=jg,l.upperCase=tg,l.upperFirst=Ii,l.each=$a,l.eachRight=Ba,l.first=Ta,Oi(l,function(){var e={};return Rt(l,function(t,n){Ne.call(l.prototype,n)||(e[n]=t)}),e}(),{chain:!1}),l.VERSION=f,wt(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){l[e].placeholder=l}),wt(["drop","take"],function(e,t){pe.prototype[e]=function(n){n=n===r?1:qe(ue(n),0);var s=this.__filtered__&&!t?new pe(this):this.clone();return s.__filtered__?s.__takeCount__=tt(n,s.__takeCount__):s.__views__.push({size:tt(n,te),type:e+(s.__dir__<0?"Right":"")}),s},pe.prototype[e+"Right"]=function(n){return this.reverse()[e](n).reverse()}}),wt(["filter","map","takeWhile"],function(e,t){var n=t+1,s=n==ee||n==Q;pe.prototype[e]=function(o){var c=this.clone();return c.__iteratees__.push({iteratee:ne(o,3),type:n}),c.__filtered__=c.__filtered__||s,c}}),wt(["head","last"],function(e,t){var n="take"+(t?"Right":"");pe.prototype[e]=function(){return this[n](1).value()[0]}}),wt(["initial","tail"],function(e,t){var n="drop"+(t?"":"Right");pe.prototype[e]=function(){return this.__filtered__?new pe(this):this[n](1)}}),pe.prototype.compact=function(){return this.filter(ht)},pe.prototype.find=function(e){return this.filter(e).head()},pe.prototype.findLast=function(e){return this.reverse().find(e)},pe.prototype.invokeMap=he(function(e,t){return typeof e=="function"?new pe(this):this.map(function(n){return ar(n,e,t)})}),pe.prototype.reject=function(e){return this.filter(cs(ne(e)))},pe.prototype.slice=function(e,t){e=ue(e);var n=this;return n.__filtered__&&(e>0||t<0)?new pe(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),t!==r&&(t=ue(t),n=t<0?n.dropRight(-t):n.take(t-e)),n)},pe.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},pe.prototype.toArray=function(){return this.take(te)},Rt(pe.prototype,function(e,t){var n=/^(?:filter|find|map|reject)|While$/.test(t),s=/^(?:head|last)$/.test(t),o=l[s?"take"+(t=="last"?"Right":""):t],c=s||/^find/.test(t);o&&(l.prototype[t]=function(){var p=this.__wrapped__,m=s?[1]:arguments,y=p instanceof pe,A=m[0],I=y||le(p),L=function(ge){var me=o.apply(l,tn([ge],m));return s&&$?me[0]:me};I&&n&&typeof A=="function"&&A.length!=1&&(y=I=!1);var $=this.__chain__,Y=!!this.__actions__.length,re=c&&!$,de=y&&!Y;if(!c&&I){p=de?p:new pe(this);var se=e.apply(p,m);return se.__actions__.push({func:is,args:[L],thisArg:r}),new St(se,$)}return re&&de?e.apply(this,m):(se=this.thru(L),re?s?se.value()[0]:se.value():se)})}),wt(["pop","push","shift","sort","splice","unshift"],function(e){var t=Mr[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",s=/^(?:pop|shift)$/.test(e);l.prototype[e]=function(){var o=arguments;if(s&&!this.__chain__){var c=this.value();return t.apply(le(c)?c:[],o)}return this[n](function(p){return t.apply(le(p)?p:[],o)})}}),Rt(pe.prototype,function(e,t){var n=l[t];if(n){var s=n.name+"";Ne.call(Rn,s)||(Rn[s]=[]),Rn[s].push({name:t,func:n})}}),Rn[Xr(r,R).name]=[{name:"wrapper",func:r}],pe.prototype.clone=Qc,pe.prototype.reverse=eu,pe.prototype.value=tu,l.prototype.at=Mf,l.prototype.chain=Lf,l.prototype.commit=Of,l.prototype.next=Pf,l.prototype.plant=Rf,l.prototype.reverse=Df,l.prototype.toJSON=l.prototype.valueOf=l.prototype.value=Wf,l.prototype.first=l.prototype.head,er&&(l.prototype[er]=Tf),l},On=Lc();mn?((mn.exports=On)._=On,Ls._=On):Ve._=On}).call(gr)})(ps,ps.exports);var Wi=ps.exports;function Fp(a=!0){k.useEffect(()=>{if(!a)return;const u=Wi.debounce(r=>{document.documentElement.style.setProperty("--mouse-x",`${r.clientX}px`),document.documentElement.style.setProperty("--mouse-y",`${r.clientY}px`)},16);return document.addEventListener("mousemove",u),()=>{u.cancel(),document.removeEventListener("mousemove",u)}},[a])}function zp(a=!0){const{state:u,dispatch:r}=Gn(),{activeTab:f,screenState:d}=u;k.useEffect(()=>{if(!a)return;const h=g=>{const x=f==="parameter-debug",b=f==="chat",j=!d||d.currentScreen===0;if(b||j&&x){const N=Re.canvas.selected_nodes;Object.keys(N??{}).length?r({type:"SET_SELECTED_NODE",payload:Object.values(N)}):r({type:"SET_SELECTED_NODE",payload:null})}};return document.addEventListener("click",h),()=>{document.removeEventListener("click",h)}},[r,a,f,d])}const Up=({selectedNodes:a,handleParamSelect:u,selectedParams:r,handleNext:f,handleClose:d})=>{const g=a.flatMap(x=>(x.widgets||[]).map(b=>b.name)).some(x=>r[x]===!0);return i.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[i.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Select parameters"}),i.jsx("p",{className:"text-xs text-gray-500",children:"multiple selections supported"})]}),i.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:d,children:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),a.map((x,b)=>{const j=x.title||"Unknown Node",N=x.widgets||[];return i.jsxs("div",{className:"border rounded-md mb-4 overflow-hidden",children:[i.jsx("div",{className:"bg-gray-50 px-3 py-2 text-sm font-medium text-gray-700 border-b",children:j}),i.jsx("div",{className:"p-4 space-y-3",children:i.jsx("div",{className:"flex items-center gap-3 flex-wrap",children:N.map((_,E)=>{const O=_.name;return i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:`w-5 h-5 rounded-full border flex items-center justify-center ${r[O]?"border-red-500 bg-red-100":"border-gray-300"}`,onClick:P=>u(O,P),children:r[O]&&i.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"})}),i.jsx("span",{className:"ml-2 text-gray-700 text-xs",children:O})]},`widget-${E}`)})})})]},`node-${b}`)}),i.jsx("div",{className:"mt-6 flex justify-center",children:i.jsx("button",{onClick:x=>f(x),disabled:!g,className:`px-3 py-1.5 text-xs ${g?"bg-pink-200 text-pink-700 hover:bg-pink-300":"bg-gray-200 text-gray-500 cursor-not-allowed"} rounded-md transition-colors`,children:"Next"})})]})},Gp=({selectedNodes:a,paramTestValues:u,selectedParams:r,updateParamTestValues:f,toggleDropdown:d,openDropdowns:h,handleTestValueSelect:g,searchTerms:x,handleSearch:b,handleSelectAll:j,handleNext:N,handlePrevious:_,handleClose:E,inputValues:O,setInputValues:P,textInputs:B,handleTextInputChange:G,handleAddTextInput:R,handleRemoveTextInput:X,openAiWritingModal:K})=>{const w=(M,D,V,je=0)=>{if(M=isNaN(M)?0:M,D=isNaN(D)?100:D,V=isNaN(V)||V<=0?1:V,D<M&&(D=M),Math.floor((D-M)/V)+1<=1)return[M];const ce=[];let be=M;for(;be<=D;){const q=Math.pow(10,je),we=Math.round(be*q)/q;ce.push(we),be+=V}return ce};return k.useEffect(()=>{!a||a.length===0||a.forEach(M=>{const D=M.id.toString(),V=M.widgets||{};Object.values(V).forEach(z=>{const ce=z.name;if(!r[ce])return;if(!(u[D]?.[ce]?.length>0)&&z.type==="number"){const q=z.options?.min||0,we=z.options?.max||100;let ee=(z.options?.step||10)/10;ee<.1&&(ee=.1);const U=z.options?.precision||0,Q=w(q,we,ee,U);if(Q.length>0){f(D,ce,Q);const fe=`${D}_${ce}`;P(J=>({...J,[fe]:{min:q.toString(),max:we.toString(),step:ee.toString()}}))}}if(z.type==="customtext"||z.type.toLowerCase().includes("text")){const q=`${D}_${ce}`,we=B[q]||[""];JSON.stringify(we)!==JSON.stringify(u[D]?.[ce]||[""])&&f(D,ce,we)}})})},[a,r,u,B,f,P,w]),i.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[i.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Set test values"}),i.jsx("p",{className:"text-xs text-gray-500",children:"Configure the test values for each parameter"})]}),i.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:E,children:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),a.length>0?a.map((M,D)=>{const V=M.widgets||{},je=Object.values(V),z=M.id;return i.jsxs("div",{className:"border rounded-md mb-4 overflow-hidden",children:[i.jsxs("div",{className:"bg-gray-50 px-3 py-2 text-xs font-medium text-gray-700 border-b flex justify-between items-center",children:[i.jsxs("span",{children:[M.type," (ID: ",z,")"]}),i.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:ce=>E(ce,D),children:i.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),i.jsx("div",{className:"p-4 space-y-4",children:je.map((ce,be)=>{const q=ce.name;if(!r[q])return null;const we=`${z}_${q}`;if(ce.type==="customtext"||ce.type.toLowerCase().includes("text")){const ee=B[we]||[""];return i.jsxs("div",{className:"border-b pb-3",children:[i.jsxs("div",{className:"flex justify-between items-center mb-2",children:[i.jsxs("label",{className:"text-xs font-medium text-gray-700",children:[q,":"]}),i.jsxs("button",{className:"px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs flex items-center hover:bg-blue-200 transition-colors",onClick:()=>K(z,q),children:[i.jsx("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),"AI Writing"]})]}),i.jsx("div",{className:"space-y-2",children:ee.map((U,Q)=>i.jsxs("div",{className:"flex items-start",children:[i.jsx("textarea",{className:`flex-1 border ${U?"border-gray-300":"border-red-500"} rounded p-2 text-xs resize-y`,rows:2,placeholder:"Enter text...",value:U,onChange:fe=>G(z,q,Q,fe.target.value),required:!0}),i.jsx("button",{className:"ml-2 text-red-500 hover:text-red-700",onClick:()=>X(z,q,Q),title:"Remove",children:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},Q))}),i.jsxs("button",{className:"mt-2 px-2 py-1 border border-dashed border-gray-300 rounded text-xs text-gray-600 hover:bg-gray-50 flex items-center",onClick:()=>R(z,q),children:[i.jsx("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Add Text"]})]},be)}if(ce.type==="number"){const ee=ce.options?.min||0,U=ce.options?.max||100,Q=(ce.options?.step||10)/10,fe=ce.options?.precision||0,J=w(ee,U,Q,fe),xe=O[we]||{min:ee.toString(),max:U.toString(),step:Q.toString()};return i.jsxs("div",{className:"border-b pb-3",children:[i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsxs("label",{className:"text-xs font-medium text-gray-700",children:[q,":"]}),i.jsx("div",{className:"w-4"})]}),i.jsxs("div",{className:"flex space-x-2 items-center",children:[i.jsx("label",{className:"text-xs text-gray-600",children:"Min"}),i.jsx("input",{type:"text",className:"w-12 h-6 border border-gray-300 rounded text-xs px-2",value:xe.min,required:!0,onClick:Z=>{Z.preventDefault(),Z.stopPropagation()},onChange:Z=>{Z.preventDefault(),Z.stopPropagation();const te=Z.target.value;if(P(ie=>({...ie,[we]:{...ie[we],min:te}})),te===""||!isNaN(parseFloat(te))){const ie=te===""?0:parseFloat(te),ve=parseFloat(xe.max||U.toString()),ye=parseFloat(xe.step||Q.toString()),ke=w(ie,ve,ye,fe);f(z,q,ke)}}}),i.jsx("label",{className:"text-xs text-gray-600",children:"Max"}),i.jsx("input",{type:"text",className:"w-12 h-6 border border-gray-300 rounded text-xs px-2",value:xe.max,onClick:Z=>{Z.preventDefault(),Z.stopPropagation()},required:!0,onChange:Z=>{Z.preventDefault(),Z.stopPropagation();const te=Z.target.value;if(P(ie=>({...ie,[we]:{...ie[we],max:te}})),te===""||!isNaN(parseFloat(te))){const ie=parseFloat(xe.min||ee.toString()),ve=te===""?ie:parseFloat(te),ye=parseFloat(xe.step||Q.toString()),ke=w(ie,ve,ye,fe);f(z,q,ke)}}}),i.jsx("label",{className:"text-xs text-gray-600",children:"Step"}),i.jsx("input",{type:"text",className:"w-12 h-6 border border-gray-300 rounded text-xs px-2",value:xe.step,required:!0,onClick:Z=>{Z.preventDefault(),Z.stopPropagation()},onChange:Z=>{Z.preventDefault(),Z.stopPropagation();const te=Z.target.value;if(P(ie=>({...ie,[we]:{...ie[we],step:te}})),te===""||!isNaN(parseFloat(te))&&parseFloat(te)>0){const ie=parseFloat(xe.min||ee.toString()),ve=parseFloat(xe.max||U.toString());let ye=te===""?1:parseFloat(te);ye<.1&&(ye=.1);const ke=w(ie,ve,ye,fe);f(z,q,ke)}}})]}),i.jsxs("div",{className:"mt-1",children:[i.jsx("label",{className:"text-xs text-gray-600",children:"Test values"}),i.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:(()=>{const Z=u[z]?.[q]||J;if(Z.length<=10)return Z.map((te,ie)=>i.jsxs("div",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-md flex items-center text-xs cursor-pointer hover:bg-blue-200",onClick:ve=>{ve.stopPropagation(),g(z,q,te,ve)},children:[i.jsx("span",{children:te}),i.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},ie));{const te=Z.slice(0,5),ie=Z.slice(Z.length-5);return i.jsxs(i.Fragment,{children:[te.map((ve,ye)=>i.jsxs("div",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-md flex items-center text-xs cursor-pointer hover:bg-blue-200",onClick:ke=>{ke.stopPropagation(),g(z,q,ve,ke)},children:[i.jsx("span",{children:ve}),i.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},`first-${ye}`)),i.jsx("div",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 rounded-md flex items-center text-xs",children:"..."}),ie.map((ve,ye)=>i.jsxs("div",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-md flex items-center text-xs cursor-pointer hover:bg-blue-200",onClick:ke=>{ke.stopPropagation(),g(z,q,ve,ke)},children:[i.jsx("span",{children:ve}),i.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},`last-${ye}`))]})}})()})]}),i.jsx("div",{className:"mt-1",children:i.jsx("p",{className:"text-xs text-gray-500",children:"Values are distributed evenly between Min and Max"})})]},be)}else if(ce.type==="combo"){const ee=ce.options?.values||[],U=`${z}_${q}`,Q=J=>typeof J=="string"?J:J&&typeof J=="object"&&"name"in J?J.name:String(J),fe=J=>typeof J=="object"&&J!==null&&"name"in J?J.name:J;return i.jsxs("div",{className:"border-b pb-3",children:[i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx("label",{className:"text-xs font-medium text-gray-700",children:q}),i.jsxs("div",{className:"relative dropdown-container",children:[i.jsxs("button",{className:`appearance-none border ${(u[z]?.[q]||[]).length===0?"border-red-500":"border-gray-300"} rounded px-2 py-0.5 pr-6 text-xs flex items-center bg-white text-gray-700`,onClick:J=>{J.preventDefault(),J.stopPropagation(),d(z,q,J)},"data-dropdown":U,children:[i.jsx("span",{children:(u[z]?.[q]||[]).length>0?`${q}: ${(u[z]?.[q]||[]).length} selected`:`Select ${q}`}),i.jsx("div",{className:"ml-2",children:i.jsx("svg",{className:"fill-current h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:i.jsx("path",{d:"M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"})})})]}),h[U]&&i.jsxs("div",{className:"absolute z-[9999] mt-1 w-64 bg-white border border-gray-300 rounded-md shadow-lg dropdown-menu",style:{position:"fixed",top:typeof h[U]=="object"?`${h[U].y}px`:"0px",left:typeof h[U]=="object"?`${h[U].x}px`:"0px",maxHeight:"300px",overflowY:"auto"},children:[i.jsx("div",{className:"p-2 border-b sticky top-0 bg-white",children:i.jsx("input",{type:"text",className:"w-full px-2 py-0.5 text-xs border border-gray-300 rounded",placeholder:"Search...",value:x[U]||"",onChange:J=>{J.preventDefault(),J.stopPropagation(),b(z,q,J.target.value)},onClick:J=>{J.preventDefault(),J.stopPropagation()},autoFocus:!0})}),i.jsxs("div",{className:"px-3 py-1.5 bg-gray-50 border-b cursor-pointer text-xs flex items-center text-gray-700 hover:bg-gray-100",onClick:J=>{J.preventDefault(),J.stopPropagation();const Z=ee.filter(te=>!x[U]||Q(te).toLowerCase().includes((x[U]||"").toLowerCase())).map(fe);j(z,q,Z)},children:[i.jsx("div",{className:`w-4 h-4 mr-2 border rounded-sm flex items-center justify-center ${ee.length>0&&(u[z]?.[q]||[]).length===ee.length?"bg-blue-500 border-blue-500":(u[z]?.[q]||[]).length>0?"bg-blue-500 border-blue-500 opacity-50":"border-gray-300"}`,children:(u[z]?.[q]||[]).length>0&&i.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),i.jsx("span",{className:"font-medium",children:ee.length>0&&(u[z]?.[q]||[]).length===ee.length?"Deselect All":"Select All"})]}),i.jsxs("div",{className:"max-h-60 overflow-y-auto",children:[ee.filter(J=>!x[U]||Q(J).toLowerCase().includes((x[U]||"").toLowerCase())).map((J,xe)=>i.jsxs("div",{className:"px-3 py-1.5 hover:bg-gray-100 cursor-pointer text-xs flex items-center text-gray-700",onClick:Z=>{Z.preventDefault(),Z.stopPropagation(),g(z,q,fe(J),Z)},children:[i.jsx("div",{className:`w-4 h-4 mr-2 border rounded-sm flex items-center justify-center ${(u[z]?.[q]||[]).includes(fe(J))?"bg-blue-500 border-blue-500":"border-gray-300"}`,children:(u[z]?.[q]||[]).includes(fe(J))&&i.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),i.jsx("span",{className:"whitespace-normal overflow-hidden text-ellipsis",children:Q(J)})]},xe)),ee.filter(J=>!x[U]||Q(J).toLowerCase().includes((x[U]||"").toLowerCase())).length===0&&i.jsx("div",{className:"px-3 py-4 text-sm text-gray-500 text-center",children:"No matching options"})]})]})]})]}),i.jsxs("div",{className:"mt-2",children:[i.jsx("label",{className:"text-xs text-gray-600",children:"Test values"}),(u[z]?.[q]||[]).length===0&&i.jsx("div",{className:"text-xs text-red-500 mt-1",children:"Please select at least one value"}),i.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:(u[z]?.[q]||[]).map((J,xe)=>i.jsxs("div",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-md flex items-center text-xs",children:[i.jsx("span",{children:J}),i.jsx("svg",{className:"w-4 h-4 ml-1 cursor-pointer hover:text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",onClick:Z=>{Z.preventDefault(),Z.stopPropagation(),g(z,q,J,Z)},children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},xe))})]})]},be)}else return i.jsxs("div",{className:"border-b pb-3",children:[i.jsx("div",{className:"flex justify-between items-center",children:i.jsx("label",{className:"text-xs font-medium text-gray-700",children:q})}),i.jsxs("div",{className:"mt-2",children:[i.jsx("label",{className:"text-xs text-gray-600",children:"Test values"}),i.jsxs("div",{className:"mt-1 flex flex-wrap gap-1",children:[(u[z]?.[q]||[]).map((ee,U)=>i.jsxs("div",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-md flex items-center text-xs",children:[i.jsx("span",{children:ee}),i.jsx("svg",{className:"w-4 h-4 ml-1 cursor-pointer hover:text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",onClick:Q=>{Q.preventDefault(),Q.stopPropagation(),g(z,q,ee,Q)},children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},U)),i.jsxs("button",{className:"px-2 py-0.5 border border-dashed border-blue-300 text-blue-600 rounded-md text-xs flex items-center hover:bg-blue-50",onClick:ee=>{ee.preventDefault(),ee.stopPropagation();const U=`${q}${(u[z]?.[q]||[]).length+1}`;f(z,q,[...u[z]?.[q]||[],U])},children:[i.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),i.jsx("span",{children:"Add"})]})]})]})]},be)})})]},D)}):i.jsx("div",{className:"border rounded-md mb-4 p-4 text-center text-gray-500",children:"No nodes selected. Please select a node in the workflow to configure parameters."}),i.jsxs("div",{className:"mt-6 flex justify-between",children:[i.jsx("button",{onClick:M=>_(M),className:"px-3 py-1.5 text-xs bg-gray-100 text-gray-800 rounded-md hover:bg-gray-200 transition-colors",children:"Previous"}),i.jsx("button",{onClick:M=>N(M),className:"px-3 py-1.5 text-xs bg-pink-200 text-pink-700 rounded-md hover:bg-pink-300 transition-colors",children:"Next"})]})]})},Hp=({selectedNodes:a,paramTestValues:u,selectedParams:r,totalCount:f,errorMessage:d,handlePrevious:h,handleStartGeneration:g,handleClose:x})=>{const[b,j]=k.useState([]),[N,_]=k.useState(null),[E,O]=k.useState(!1),{dispatch:P}=Gn(),B=()=>{const R=Object.values(Re.graph._nodes_by_id),X=[],K=[];for(const M of R)M.type==="SaveImage"?X.push(M.id):M.type==="PreviewImage"&&K.push(M.id);const w=[...X,...K];j(w),w.length===1?_(w[0]):w.length>1&&(O(!0),_(null))};k.useEffect(()=>{B()},[]),k.useEffect(()=>{const R=()=>{if(!Re.canvas.selected_nodes)return;const X=Object.values(Re.canvas.selected_nodes);if(X.length===0)return;const K=X[0];K&&(K.type==="SaveImage"||K.type==="PreviewImage")&&(console.log("Selected image node:",K.id),_(K.id))};return document.addEventListener("click",R),()=>{document.removeEventListener("click",R)}},[]);const G=R=>{if(R&&(R.preventDefault(),R.stopPropagation()),b.length>1&&!N){O(!0);return}g(R,N||void 0)};return i.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[i.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Conform combinations"}),i.jsxs("p",{className:"text-xs text-gray-500",children:["In the selected parameter combinations, there are ",f," total runs. Each run will generate a separate image."]})]}),i.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:x,children:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),E&&b.length>1&&i.jsx("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-md text-amber-600 text-xs",children:i.jsxs("div",{className:"flex items-start",children:[i.jsx("div",{className:"flex-shrink-0 mt-0.5",children:i.jsx("svg",{className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),i.jsx("div",{className:"ml-2",children:N===null?`Multiple SaveImage and PreviewImage nodes detected with IDs ${b.join(",")}. Please click the node on canvas.`:`Current node ID is ${N}, please click Start Generation again`})]})}),d&&i.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md text-red-600 text-xs",children:i.jsxs("div",{className:"flex items-start",children:[i.jsx("div",{className:"flex-shrink-0 mt-0.5",children:i.jsx("svg",{className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),i.jsx("div",{className:"ml-2",children:d})]})}),a.length>0?a.map((R,X)=>{const K=R.type||"Unknown Node",w=R.widgets||[],M=R.id;return i.jsxs("div",{className:"border rounded-md mb-4 overflow-hidden",children:[i.jsxs("div",{className:"bg-gray-50 px-3 py-2 text-xs font-medium text-gray-700 border-b",children:[K," (ID: ",M,")"]}),i.jsx("div",{className:"p-4 space-y-3",children:w.map((D,V)=>{const je=D.name;if(!r[je])return null;const z=u[M]?.[je]||[],ce=Array.isArray(z)?`[${z.join(", ")}]`:JSON.stringify(z);return i.jsxs("div",{className:V<w.length-1?"flex justify-between items-center border-b pb-2":"flex justify-between items-center",children:[i.jsx("label",{className:"font-medium text-gray-700 text-xs",children:je}),i.jsx("div",{className:"flex space-x-2 items-center",children:i.jsx("input",{type:"text",className:"w-64 h-7 border border-gray-300 rounded text-xs px-2 bg-gray-50 cursor-not-allowed text-gray-500",readOnly:!0,disabled:!0,value:ce,onClick:be=>be.preventDefault()})})]},V)})})]},X)}):i.jsx("div",{className:"border rounded-md mb-4 p-4 text-center text-gray-500 text-xs",children:"No nodes selected. Please select a node in the workflow to configure parameters."}),i.jsxs("div",{className:"mt-6 flex justify-between",children:[i.jsx("button",{onClick:R=>h(R),className:"px-3 py-1.5 text-xs bg-gray-100 text-gray-800 rounded-md hover:bg-gray-200 transition-colors",children:"Previous"}),i.jsx("button",{onClick:R=>G(R),className:`px-3 py-1.5 text-xs rounded-md transition-colors ${b.length>1&&!N?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-pink-200 text-pink-700 hover:bg-pink-300"}`,disabled:b.length>1&&!N,children:"Generate & Compare"})]})]})},Kp=({selectedNodes:a,paramTestValues:u,selectedParams:r,totalCount:f,completedCount:d,errorMessage:h,handleClose:g,setIsProcessing:x,setCurrentScreen:b,cleanupPolling:j})=>{const N=_=>{_.preventDefault(),_.stopPropagation(),Wp({clear:!0}),$p(),j&&j(),x(!1),b(2)};return i.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 relative",children:[i.jsx("div",{className:"absolute inset-0 bg-gray-500 bg-opacity-30 flex flex-col items-center justify-center z-10",children:i.jsxs("div",{className:"text-center text-gray-800 bg-white p-4 rounded-lg shadow-lg",children:[i.jsx("div",{className:"mb-2 text-sm font-medium",children:"Processing..."}),i.jsxs("div",{className:"text-xs mb-3",children:["Completed ",d," of ",f," runs"]}),i.jsx("div",{className:"w-48 h-2 bg-gray-200 rounded-full overflow-hidden",children:i.jsx("div",{className:"h-full bg-pink-500 transition-all duration-200",style:{width:`${d/f*100}%`}})}),i.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:["Already generated ",d," images"]}),i.jsx("button",{onClick:N,className:"mt-4 px-3 py-1.5 text-xs bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"})]})}),i.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Confirm Test Configuration"}),i.jsxs("p",{className:"text-xs text-gray-500",children:["In the selected parameter combinations, there are ",f," total runs. Each run will generate a separate image."]})]}),i.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:g,children:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),h&&i.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md text-red-600 text-xs",children:i.jsxs("div",{className:"flex items-start",children:[i.jsx("div",{className:"flex-shrink-0 mt-0.5",children:i.jsx("svg",{className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),i.jsx("div",{className:"ml-2",children:h})]})}),a.length>0?a.map((_,E)=>{const O=_.type||"Unknown Node",P=_.widgets||[],B=_.id;return i.jsxs("div",{className:"border rounded-md mb-4 overflow-hidden",children:[i.jsxs("div",{className:"bg-gray-50 px-3 py-2 text-xs font-medium text-gray-700 border-b",children:[O," (ID: ",B,")"]}),i.jsx("div",{className:"p-4 space-y-3",children:P.map((G,R)=>{const X=G.name;if(!r[X])return null;const K=u[B]?.[X]||[],w=Array.isArray(K)?`[${K.join(", ")}]`:JSON.stringify(K);return i.jsxs("div",{className:R<P.length-1?"flex justify-between items-center border-b pb-2":"flex justify-between items-center",children:[i.jsx("label",{className:"font-medium text-gray-700",children:X}),i.jsx("div",{className:"flex space-x-2 items-center",children:i.jsx("input",{type:"text",className:"w-64 h-7 border border-gray-300 rounded text-sm px-2 bg-gray-50 cursor-not-allowed text-gray-500",readOnly:!0,disabled:!0,value:w,onClick:M=>M.preventDefault()})})]},R)})})]},E)}):i.jsx("div",{className:"border rounded-md mb-4 p-4 text-center text-gray-500",children:"No nodes selected. Please select a node in the workflow to configure parameters."})]})},xr=({visible:a,imageUrl:u,params:r,onClose:f})=>{if(!a)return null;const d=()=>{if(!r||!r.nodeParams)return null;const h=Object.entries(r.nodeParams).map(([g,x])=>{const b=r.nodeNames?.[g]||r.selectedNodeInfoMap&&r.selectedNodeInfoMap[g]||(g.includes("text")?"Text Node":`Node ${g}`),j=Object.entries(x).filter(([N,_])=>typeof _!="object"||_===null).map(([N,_])=>i.jsxs("div",{className:"pl-4 text-sm py-1 flex",children:[i.jsx("span",{className:"text-gray-600 dark:text-gray-400 mr-2",children:"-"}),i.jsxs("span",{className:"font-medium mr-1",children:[N,":"]}),i.jsx("span",{className:"text-gray-700 dark:text-gray-300 break-all",children:String(_)})]},N));return i.jsxs("div",{className:"mb-4",children:[i.jsx("div",{className:"font-semibold text-pink-600 dark:text-pink-400 text-base py-1 border-b border-gray-200 dark:border-gray-700 mb-2",children:b}),j.length>0?j:i.jsx("div",{className:"pl-4 text-sm text-gray-500 italic",children:"nodeParams is null"})]},g)});return i.jsx("div",{className:"overflow-y-auto max-h-full",children:h.length>0?h:i.jsx("div",{className:"text-sm text-gray-500 italic",children:"nodeParams is null"})})};return i.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50",onClick:f,children:i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl flex flex-row w-[90%] max-w-6xl max-h-[90vh] relative m-4 overflow-hidden",onClick:h=>h.stopPropagation(),style:{display:"flex",flexDirection:"row"},children:[i.jsx("button",{className:"absolute top-2 right-2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 p-1 z-10",onClick:f,children:i.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),i.jsx("div",{className:"w-[65%] border-r border-gray-200 dark:border-gray-700",children:i.jsx("div",{className:"p-4 h-full flex items-center justify-center",children:i.jsx("img",{src:u,alt:"Enlarged image",className:"max-w-full max-h-[calc(90vh-2rem)] object-contain"})})}),i.jsx("div",{className:"w-[35%] h-full overflow-hidden flex flex-col",children:i.jsxs("div",{className:"p-4 flex-1 overflow-y-auto",children:[i.jsx("h3",{className:"text-lg font-medium text-gray-800 dark:text-gray-200 mb-4",children:"Parameters"}),r&&!r.nodeParams&&Object.entries(r).filter(([h,g])=>h!=="nodeParams"&&typeof g!="object").map(([h,g])=>i.jsxs("div",{className:"py-1 text-sm text-gray-600 dark:text-gray-300",children:[i.jsxs("span",{className:"font-medium",children:[h,":"]})," ",String(g)]},h)),i.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:d()})]})})]})})};function Un(a,u,r){let f=r.initialDeps??[],d;function h(){var g,x,b,j;let N;r.key&&((g=r.debug)!=null&&g.call(r))&&(N=Date.now());const _=a();if(!(_.length!==f.length||_.some((P,B)=>f[B]!==P)))return d;f=_;let O;if(r.key&&((x=r.debug)!=null&&x.call(r))&&(O=Date.now()),d=u(..._),r.key&&((b=r.debug)!=null&&b.call(r))){const P=Math.round((Date.now()-N)*100)/100,B=Math.round((Date.now()-O)*100)/100,G=B/16,R=(X,K)=>{for(X=String(X);X.length<K;)X=" "+X;return X};console.info(`%c⏱ ${R(B,5)} /${R(P,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*G,120))}deg 100% 31%);`,r?.key)}return(j=r?.onChange)==null||j.call(r,d),d}return h.updateDeps=g=>{f=g},h}function hl(a,u){if(a===void 0)throw new Error("Unexpected undefined");return a}const qp=(a,u)=>Math.abs(a-u)<1.01,Jp=(a,u,r)=>{let f;return function(...d){a.clearTimeout(f),f=a.setTimeout(()=>u.apply(this,d),r)}},gl=a=>{const{offsetWidth:u,offsetHeight:r}=a;return{width:u,height:r}},Yp=a=>a,Vp=a=>{const u=Math.max(a.startIndex-a.overscan,0),r=Math.min(a.endIndex+a.overscan,a.count-1),f=[];for(let d=u;d<=r;d++)f.push(d);return f},Zp=(a,u)=>{const r=a.scrollElement;if(!r)return;const f=a.targetWindow;if(!f)return;const d=g=>{const{width:x,height:b}=g;u({width:Math.round(x),height:Math.round(b)})};if(d(gl(r)),!f.ResizeObserver)return()=>{};const h=new f.ResizeObserver(g=>{const x=()=>{const b=g[0];if(b?.borderBoxSize){const j=b.borderBoxSize[0];if(j){d({width:j.inlineSize,height:j.blockSize});return}}d(gl(r))};a.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(x):x()});return h.observe(r,{box:"border-box"}),()=>{h.unobserve(r)}},pl={passive:!0},ml=typeof window>"u"?!0:"onscrollend"in window,Xp=(a,u)=>{const r=a.scrollElement;if(!r)return;const f=a.targetWindow;if(!f)return;let d=0;const h=a.options.useScrollendEvent&&ml?()=>{}:Jp(f,()=>{u(d,!1)},a.options.isScrollingResetDelay),g=N=>()=>{const{horizontal:_,isRtl:E}=a.options;d=_?r.scrollLeft*(E&&-1||1):r.scrollTop,h(),u(d,N)},x=g(!0),b=g(!1);b(),r.addEventListener("scroll",x,pl);const j=a.options.useScrollendEvent&&ml;return j&&r.addEventListener("scrollend",b,pl),()=>{r.removeEventListener("scroll",x),j&&r.removeEventListener("scrollend",b)}},Qp=(a,u,r)=>{if(u?.borderBoxSize){const f=u.borderBoxSize[0];if(f)return Math.round(f[r.options.horizontal?"inlineSize":"blockSize"])}return a[r.options.horizontal?"offsetWidth":"offsetHeight"]},em=(a,{adjustments:u=0,behavior:r},f)=>{var d,h;const g=a+u;(h=(d=f.scrollElement)==null?void 0:d.scrollTo)==null||h.call(d,{[f.options.horizontal?"left":"top"]:g,behavior:r})};class tm{constructor(u){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let r=null;const f=()=>r||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:r=new this.targetWindow.ResizeObserver(d=>{d.forEach(h=>{const g=()=>{this._measureElement(h.target,h)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(g):g()})}));return{disconnect:()=>{var d;(d=f())==null||d.disconnect(),r=null},observe:d=>{var h;return(h=f())==null?void 0:h.observe(d,{box:"border-box"})},unobserve:d=>{var h;return(h=f())==null?void 0:h.unobserve(d)}}})(),this.range=null,this.setOptions=r=>{Object.entries(r).forEach(([f,d])=>{typeof d>"u"&&delete r[f]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:Yp,rangeExtractor:Vp,onChange:()=>{},measureElement:Qp,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...r}},this.notify=r=>{var f,d;(d=(f=this.options).onChange)==null||d.call(f,this,r)},this.maybeNotify=Un(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),r=>{this.notify(r)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(r=>r()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var r;const f=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==f){if(this.cleanup(),!f){this.maybeNotify();return}this.scrollElement=f,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((r=this.scrollElement)==null?void 0:r.window)??null,this.elementsCache.forEach(d=>{this.observer.observe(d)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,d=>{this.scrollRect=d,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(d,h)=>{this.scrollAdjustments=0,this.scrollDirection=h?this.getScrollOffset()<d?"forward":"backward":null,this.scrollOffset=d,this.isScrolling=h,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(r,f)=>{const d=new Map,h=new Map;for(let g=f-1;g>=0;g--){const x=r[g];if(d.has(x.lane))continue;const b=h.get(x.lane);if(b==null||x.end>b.end?h.set(x.lane,x):x.end<b.end&&d.set(x.lane,!0),d.size===this.options.lanes)break}return h.size===this.options.lanes?Array.from(h.values()).sort((g,x)=>g.end===x.end?g.index-x.index:g.end-x.end)[0]:void 0},this.getMeasurementOptions=Un(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled],(r,f,d,h,g)=>(this.pendingMeasuredCacheIndexes=[],{count:r,paddingStart:f,scrollMargin:d,getItemKey:h,enabled:g}),{key:!1}),this.getMeasurements=Un(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:r,paddingStart:f,scrollMargin:d,getItemKey:h,enabled:g},x)=>{if(!g)return this.measurementsCache=[],this.itemSizeCache.clear(),[];this.measurementsCache.length===0&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(N=>{this.itemSizeCache.set(N.key,N.size)}));const b=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const j=this.measurementsCache.slice(0,b);for(let N=b;N<r;N++){const _=h(N),E=this.options.lanes===1?j[N-1]:this.getFurthestMeasurement(j,N),O=E?E.end+this.options.gap:f+d,P=x.get(_),B=typeof P=="number"?P:this.options.estimateSize(N),G=O+B,R=E?E.lane:N%this.options.lanes;j[N]={index:N,start:O,size:B,end:G,key:_,lane:R}}return this.measurementsCache=j,j},{key:!1,debug:()=>this.options.debug}),this.calculateRange=Un(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(r,f,d,h)=>this.range=r.length>0&&f>0?nm({measurements:r,outerSize:f,scrollOffset:d,lanes:h}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=Un(()=>{let r=null,f=null;const d=this.calculateRange();return d&&(r=d.startIndex,f=d.endIndex),this.maybeNotify.updateDeps([this.isScrolling,r,f]),[this.options.rangeExtractor,this.options.overscan,this.options.count,r,f]},(r,f,d,h,g)=>h===null||g===null?[]:r({startIndex:h,endIndex:g,overscan:f,count:d}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=r=>{const f=this.options.indexAttribute,d=r.getAttribute(f);return d?parseInt(d,10):(console.warn(`Missing attribute name '${f}={index}' on measured element.`),-1)},this._measureElement=(r,f)=>{const d=this.indexFromElement(r),h=this.measurementsCache[d];if(!h)return;const g=h.key,x=this.elementsCache.get(g);x!==r&&(x&&this.observer.unobserve(x),this.observer.observe(r),this.elementsCache.set(g,r)),r.isConnected&&this.resizeItem(d,this.options.measureElement(r,f,this))},this.resizeItem=(r,f)=>{const d=this.measurementsCache[r];if(!d)return;const h=this.itemSizeCache.get(d.key)??d.size,g=f-h;g!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(d,g,this):d.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=g,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(d.index),this.itemSizeCache=new Map(this.itemSizeCache.set(d.key,f)),this.notify(!1))},this.measureElement=r=>{if(!r){this.elementsCache.forEach((f,d)=>{f.isConnected||(this.observer.unobserve(f),this.elementsCache.delete(d))});return}this._measureElement(r,void 0)},this.getVirtualItems=Un(()=>[this.getVirtualIndexes(),this.getMeasurements()],(r,f)=>{const d=[];for(let h=0,g=r.length;h<g;h++){const x=r[h],b=f[x];d.push(b)}return d},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=r=>{const f=this.getMeasurements();if(f.length!==0)return hl(f[Nl(0,f.length-1,d=>hl(f[d]).start,r)])},this.getOffsetForAlignment=(r,f,d=0)=>{const h=this.getSize(),g=this.getScrollOffset();f==="auto"&&(f=r>=g+h?"end":"start"),f==="center"?r+=(d-h)/2:f==="end"&&(r-=h);const x=this.getTotalSize()+this.options.scrollMargin-h;return Math.max(Math.min(x,r),0)},this.getOffsetForIndex=(r,f="auto")=>{r=Math.max(0,Math.min(r,this.options.count-1));const d=this.measurementsCache[r];if(!d)return;const h=this.getSize(),g=this.getScrollOffset();if(f==="auto")if(d.end>=g+h-this.options.scrollPaddingEnd)f="end";else if(d.start<=g+this.options.scrollPaddingStart)f="start";else return[g,f];const x=f==="end"?d.end+this.options.scrollPaddingEnd:d.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(x,f,d.size),f]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(r,{align:f="start",behavior:d}={})=>{d==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(r,f),{adjustments:void 0,behavior:d})},this.scrollToIndex=(r,{align:f="auto",behavior:d}={})=>{d==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),r=Math.max(0,Math.min(r,this.options.count-1));let h=0;const g=10,x=j=>{if(!this.targetWindow)return;const N=this.getOffsetForIndex(r,j);if(!N){console.warn("Failed to get offset for index:",r);return}const[_,E]=N;this._scrollToOffset(_,{adjustments:void 0,behavior:d}),this.targetWindow.requestAnimationFrame(()=>{const O=this.getScrollOffset(),P=this.getOffsetForIndex(r,E);if(!P){console.warn("Failed to get offset for index:",r);return}qp(P[0],O)||b(E)})},b=j=>{this.targetWindow&&(h++,h<g?this.targetWindow.requestAnimationFrame(()=>x(j)):console.warn(`Failed to scroll to index ${r} after ${g} attempts.`))};x(f)},this.scrollBy=(r,{behavior:f}={})=>{f==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+r,{adjustments:void 0,behavior:f})},this.getTotalSize=()=>{var r;const f=this.getMeasurements();let d;if(f.length===0)d=this.options.paddingStart;else if(this.options.lanes===1)d=((r=f[f.length-1])==null?void 0:r.end)??0;else{const h=Array(this.options.lanes).fill(null);let g=f.length-1;for(;g>=0&&h.some(x=>x===null);){const x=f[g];h[x.lane]===null&&(h[x.lane]=x.end),g--}d=Math.max(...h.filter(x=>x!==null))}return Math.max(d-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(r,{adjustments:f,behavior:d})=>{this.options.scrollToFn(r,{behavior:d,adjustments:f},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(u)}}const Nl=(a,u,r,f)=>{for(;a<=u;){const d=(a+u)/2|0,h=r(d);if(h<f)a=d+1;else if(h>f)u=d-1;else return d}return a>0?a-1:0};function nm({measurements:a,outerSize:u,scrollOffset:r,lanes:f}){const d=a.length-1,h=b=>a[b].start;if(a.length<=f)return{startIndex:0,endIndex:d};let g=Nl(0,d,h,r),x=g;if(f===1)for(;x<d&&a[x].end<r+u;)x++;else if(f>1){const b=Array(f).fill(0);for(;x<d&&b.some(N=>N<r+u);){const N=a[x];b[N.lane]=N.end,x++}const j=Array(f).fill(r+u);for(;g>=0&&j.some(N=>N>=r);){const N=a[g];j[N.lane]=N.start,g--}g=Math.max(0,g-g%f),x=Math.min(d,x+(f-1-x%f))}return{startIndex:g,endIndex:x}}const xl=typeof document<"u"?k.useLayoutEffect:k.useEffect;function rm(a){const u=k.useReducer(()=>({}),{})[1],r={...a,onChange:(d,h)=>{var g;h?Ug.flushSync(u):u(),(g=a.onChange)==null||g.call(a,d,h)}},[f]=k.useState(()=>new tm(r));return f.setOptions(r),xl(()=>f._didMount(),[]),xl(()=>f._willUpdate()),f}function sm(a){return rm({observeElementRect:Zp,observeElementOffset:Xp,scrollToFn:em,...a})}const jl=a=>{const{items:u,renderItem:r,minWidth:f=200,gap:d=16}=a,h=k.useRef(null),[g,x]=k.useState(1),[b,j]=k.useState(0);k.useLayoutEffect(()=>{if(!h.current)return;const _=()=>{if(h.current){const O=h.current.offsetWidth,P=Math.max(1,Math.floor(O/(f+d/2)));x(P),j(Math.ceil(u.length/P))}};_();const E=new window.ResizeObserver(Wi.debounce(_,50));return E.observe(h.current),()=>E.disconnect()},[]);const N=sm({count:b,getScrollElement:()=>h.current,estimateSize:()=>f+40,overscan:3,gap:d});return i.jsx("div",{ref:h,className:"h-full relative overflow-auto hide-scrollbar",children:i.jsx("div",{style:{height:N.getTotalSize(),position:"relative"},children:N.getVirtualItems().map(_=>{const E=_.index,O=E*g,P=Math.min(O+g,u.length);return i.jsx("div",{"data-index":E,ref:N.measureElement,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${_.start}px)`,display:"grid",gridTemplateColumns:`repeat(${g}, minmax(${f}px, 1fr))`,gap:`${d}px`},children:u.slice(O,P).map((B,G)=>r(B,O+G))},E)})})})},im=({generatedImages:a,selectedImageIndex:u,handleSelectImage:r,handleApplySelected:f,handleClose:d,notificationVisible:h,modalVisible:g,modalImageUrl:x,modalImageParams:b,openImageModal:j,closeImageModal:N})=>{const _=(E,O)=>i.jsxs("div",{className:`relative flex flex-col rounded-lg overflow-hidden border ${u===E.index?"border-pink-500 ring-2 ring-pink-300":"border-gray-200"}`,onClick:P=>r(O,P),children:[i.jsx("button",{className:"absolute top-2 right-2 bg-white bg-opacity-75 rounded-full p-0.5 text-gray-600 hover:text-gray-900 shadow-sm z-10",onClick:P=>j(E.url,E.params,P),children:i.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5v-4m0 4h-4m4 0l-5-5"})})}),i.jsx("div",{className:"aspect-square",children:i.jsx("img",{src:E.url,alt:`Generated image ${O+1}`,className:"w-full h-full object-cover"})}),i.jsx("div",{className:"p-2 text-xs text-gray-600 bg-white max-h-16 overflow-y-auto",children:Object.entries(E.params).filter(([P,B])=>P!=="nodeParams"&&typeof B!="object").map(([P,B])=>i.jsxs("div",{children:[P,": ",String(B)]},P))})]},O.toString());return i.jsxs("div",{className:"h-full flex flex-col relative bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[i.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Generation Complete"}),i.jsxs("p",{className:"text-xs text-gray-500",children:["All ",a.length," images have been generated."]})]}),i.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:d,children:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),h&&i.jsx("div",{className:"fixed top-4 right-4 bg-green-100 border-l-4 border-green-500 text-green-700 p-3 shadow-md rounded animate-fade-in-out z-50",children:i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:"py-1",children:i.jsx("svg",{className:"h-4 w-4 text-green-500 mr-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),i.jsx("p",{className:"text-xs",children:"Parameters has been applied."})]})}),i.jsx("div",{className:"flex-1 min-h-0",children:i.jsx(jl,{items:a,renderItem:_})}),i.jsx("div",{className:"mt-6 flex justify-end",children:i.jsx("button",{onClick:E=>f(E),className:"px-3 py-1.5 text-xs bg-pink-200 text-pink-700 rounded-md hover:bg-pink-300 transition-colors",disabled:u===null,children:"Apply Selected"})}),i.jsx(xr,{visible:g,imageUrl:x,params:b||{},onClose:N})]})},om=({visible:a,aiWritingModalText:u,setAiWritingModalText:r,aiGeneratedTexts:f,aiSelectedTexts:d,aiWritingLoading:h,aiWritingError:g,handleAiWriting:x,toggleTextSelection:b,addSelectedTexts:j,onClose:N})=>a?i.jsx("div",{className:"fixed inset-0 bg-black flex items-center justify-center z-50",children:i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col",children:[i.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"AI Writing Assistant"}),i.jsx("button",{className:"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200",onClick:N,children:i.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),i.jsxs("div",{className:"p-4 overflow-y-auto flex-1",children:[i.jsxs("div",{className:"mb-4",children:[i.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 mb-2",children:"Enter text and AI will generate variations"}),i.jsx("textarea",{className:`w-full px-4 py-3 border border-gray-200 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white
                bg-gray-50 dark:bg-gray-700 
                placeholder-gray-500 dark:placeholder-gray-400
                focus:border-blue-500 dark:focus:border-blue-400 
                focus:ring-2 focus:ring-blue-500/20 dark:focus:ring-blue-400/20
                focus:outline-none`,rows:3,placeholder:"Enter some text here...",value:u,onChange:_=>r(_.target.value)}),i.jsx("button",{className:`mt-2 px-4 py-2 rounded-lg text-sm flex items-center transition-colors ${h?"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white"}`,onClick:x,disabled:h,children:h?i.jsxs(i.Fragment,{children:[i.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-gray-500 dark:text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[i.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),i.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Generating..."]}):i.jsx(i.Fragment,{children:"Generate"})})]}),g&&i.jsx("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800/20 rounded-md text-red-700 dark:text-red-400 text-sm",children:g}),f.length>0&&i.jsxs("div",{className:"mb-4",children:[i.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Generated variations (select items to add):"}),i.jsx("div",{className:"space-y-2 max-h-[40vh] overflow-y-auto p-2",children:f.map((_,E)=>i.jsxs("div",{className:"flex items-start border border-gray-200 dark:border-gray-600 rounded-md p-2",children:[i.jsx("div",{className:"mr-2 mt-1",children:i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:"checkbox",id:`text${E+1}`,checked:!!d[`text${E+1}`],onChange:()=>b(`text${E+1}`),className:"sr-only"}),i.jsx("div",{className:`h-4 w-4 rounded border ${d[`text${E+1}`]?"bg-blue-600 dark:bg-blue-500 border-blue-600 dark:border-blue-500":"border-gray-300 dark:border-gray-600"} flex items-center justify-center cursor-pointer`,onClick:()=>b(`text${E+1}`),children:d[`text${E+1}`]&&i.jsx("svg",{className:"h-3 w-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]})}),i.jsx("label",{htmlFor:`text${E+1}`,className:"text-sm text-gray-700 dark:text-gray-300 cursor-pointer flex-1",children:_})]},E))})]})]}),i.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex justify-end flex-shrink-0",children:[i.jsx("button",{className:`px-5 py-2.5 text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 
            rounded-lg font-medium transition-colors mr-3`,onClick:N,children:"Cancel"}),i.jsx("button",{className:`px-5 py-2.5 rounded-lg font-medium transition-colors ${Object.values(d).every(_=>!_)?"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white"}`,onClick:j,disabled:Object.values(d).every(_=>!_),children:"Add Selected"})]})]})}):null,Di=a=>{const u=[],r={};if(Object.keys(a).forEach(h=>{const g=parseInt(h),x=a[h]||{},b=Object.keys(x).filter(N=>x[N]&&x[N].length>0);if(b.length===0)return;const j=[[]];b.forEach(N=>{const _=x[N],E=[];j.forEach(O=>{_.forEach(P=>{const B=[...O,{nodeId:g,paramName:N,paramValue:String(P)}];E.push(B)})}),j.length=0,j.push(...E)}),r[h]=j}),Object.keys(r).length===0)return u;if(Object.keys(r).length===1){const h=Object.keys(r)[0];return r[h]}const f=Object.keys(r);let d=r[f[0]];for(let h=1;h<f.length;h++){const g=r[f[h]],x=[];d.forEach(b=>{g.forEach(j=>{x.push([...b,...j])})}),d=x}return d},am=(a,u)=>{const r={};r.nodeParams={};const f=Di(a);return u<f.length&&f[u].forEach(h=>{const g=h.nodeId.toString(),x=h.paramName,b=h.paramValue;r.nodeParams[g]||(r.nodeParams[g]={}),r.nodeParams[g][x]=b,r[x]=b}),r},kl="parameter_debug_history",vl=30,yl=async(a,u,r,f,d)=>{try{const h=El(),g={id:Xe(),timestamp:Date.now(),title:$i(a,u),nodeName:a,params:{...u,nodeNames:{...u.nodeNames||{},[a.split("<")[0]]:a.split("<")[0]}},generatedImages:r,totalCount:f,workflow:d};return h.unshift(g),h.length>vl&&h.splice(vl),localStorage.setItem(kl,JSON.stringify(h)),g}catch(h){return console.error("Error saving parameter debug history:",h),null}},El=()=>{try{const a=localStorage.getItem(kl);if(a)return JSON.parse(a)}catch(a){console.error("Error loading parameter debug history:",a)}return[]},Cl=a=>{const u=new Date(a);return`${u.getFullYear()}-${String(u.getMonth()+1).padStart(2,"0")}-${String(u.getDate()).padStart(2,"0")} ${String(u.getHours()).padStart(2,"0")}:${String(u.getMinutes()).padStart(2,"0")}`},$i=(a,u)=>{if(u.nodeParams)return Object.entries(u.nodeParams).map(([h,g])=>{let x=a;u.selectedNodeInfoMap&&u.selectedNodeInfoMap[h]&&(x=u.selectedNodeInfoMap[h]);const b=Object.keys(g).slice(0,3);return`${x}<${b.join(",")}>`}).join(";");const r=Object.keys(u).filter(f=>f!=="nodeParams"&&f!=="selectedNodeInfoMap").slice(0,3);return`${a}<${r.join(",")}>`},lm=({historyItems:a,onViewHistoryItem:u,onClose:r})=>i.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 flex flex-col h-full",children:[i.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Experiments History"}),i.jsxs("p",{className:"text-xs text-gray-500",children:["Last ",a.length," experiments"]})]}),i.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:r,children:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),a.length===0?i.jsx("div",{className:"flex-1 flex items-center justify-center text-gray-500 text-sm",children:"No history items found"}):i.jsx("div",{className:"flex-1 overflow-y-auto",children:a.map(f=>i.jsxs("div",{className:"border border-gray-200 rounded-lg mb-3 overflow-hidden",children:[i.jsxs("div",{className:"bg-gray-50 py-2 px-3 flex items-center justify-between border-b",children:[i.jsx("div",{className:"text-[14px] text-gray-600",children:Cl(f.timestamp)}),i.jsx("button",{onClick:()=>u(f),className:"px-3 py-1 text-xs bg-pink-200 text-pink-700 rounded-md hover:bg-pink-300 transition-colors",children:"view"})]}),i.jsx("div",{className:"p-3",children:i.jsx("div",{className:"text-[10px] font-medium text-gray-700",children:$i(f.nodeName,f.params)})})]},f.id))})]}),cm=({historyItem:a,selectedImageIndex:u,handleSelectImage:r,handleClose:f,modalVisible:d,modalImageUrl:h,modalImageParams:g,openImageModal:x,closeImageModal:b})=>{const{timestamp:j,nodeName:N,generatedImages:_,params:E}=a,O=(P,B)=>i.jsxs("div",{className:`relative flex flex-col rounded-lg overflow-hidden border ${u===B?"border-pink-500 ring-2 ring-pink-300":"border-gray-200"}`,onClick:G=>r(B,G),children:[i.jsx("button",{className:"absolute top-2 right-2 bg-white bg-opacity-75 rounded-full p-0.5 text-gray-600 hover:text-gray-900 shadow-sm z-10",onClick:G=>x(P.url,P.params,G),children:i.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5v-4m0 4h-4m4 0l-5-5"})})}),i.jsx("div",{className:"aspect-square",children:i.jsx("img",{src:P.url,alt:`Generated image ${B+1}`,className:"w-full h-full object-cover"})}),i.jsx("div",{className:"p-2 text-xs text-gray-600 bg-white max-h-16 overflow-y-auto",children:Object.entries(P.params).filter(([G,R])=>G!=="nodeParams"&&typeof R!="object").map(([G,R])=>i.jsxs("div",{children:[G,": ",String(R)]},G))})]},B.toString());return i.jsxs("div",{className:"h-full flex flex-col relative bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[i.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-start",children:[i.jsxs("div",{className:"min-w-0",children:[i.jsx("h3",{className:"text-base font-medium text-gray-800 truncate hover:!break-words hover:!whitespace-normal hover:!overflow-visible",children:$i(N,E)}),i.jsxs("p",{className:"text-xs text-gray-500",children:[Cl(j)," • ",_.length," images"]})]}),i.jsx("button",{className:"text-gray-400 hover:text-gray-600 mt-0",onClick:f,children:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),i.jsx("div",{className:"flex-1 min-h-0",children:i.jsx(jl,{items:_,renderItem:O})}),i.jsx(xr,{visible:d,imageUrl:h,params:g?{...g,nodeNames:{[a.nodeName.split("<")[0]]:a.nodeName.split("<")[0]}}:void 0,onClose:b})]})},um=`
  @keyframes highlight-pulse {
    0% { 
      box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.5);
    }
    70% { 
      box-shadow: 0 0 0 15px rgba(59, 130, 246, 0);
    }
    100% { 
      box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
    }
  }
  
  .highlight-pulse {
    animation: highlight-pulse 1.5s infinite;
    border: 2px solid #3b82f6;
  }

  @keyframes fade-in-out {
    0% { opacity: 0; transform: translateY(-20px); }
    10% { opacity: 1; transform: translateY(0); }
    90% { opacity: 1; transform: translateY(0); }
    100% { opacity: 0; transform: translateY(-20px); }
  }
  
  .animate-fade-in-out {
    animation: fade-in-out 3s forwards;
  }
`,vr="parameter_debug_state",bl=a=>{try{localStorage.setItem(vr,JSON.stringify(a))}catch(u){console.error("Error saving parameter debug state:",u)}},dm=()=>{try{const a=localStorage.getItem(vr);if(a)return JSON.parse(a)}catch(a){console.error("Error loading parameter debug state:",a)}return null},fm=()=>{try{localStorage.removeItem(vr)}catch(a){console.error("Error clearing parameter debug state:",a)}},hm=(a,u,r,f,d,h)=>{const g=`${a}_${u}`;h(b=>{const j=[...b[g]||[]];return j[r]=f,{...b,[g]:j}});const x=[...d[g]||[]];return x[r]=f,x},gm=(a,u,r,f)=>{const d=`${a}_${u}`;return f(h=>{const g=[...h[d]||[]];return g.push(""),{...h,[d]:g}}),[...r[d]||[],""]},pm=(a,u,r,f,d)=>{const h=`${a}_${u}`;d(x=>{const b=[...x[h]||[]];return b.splice(r,1),{...x,[h]:b}});const g=[...f[h]||[]];return g.splice(r,1),g},mm=(a,u,r,f,d)=>{r.preventDefault(),r.stopPropagation();const h=`${a}_${u}`;d(g=>{if(g[h]&&typeof g[h]=="object"?g[h].isOpen:!!g[h])return{...g,[h]:!1};{let b=0,j=0;if(r.currentTarget){const E=r.currentTarget.getBoundingClientRect();b=E.left,j=E.bottom}else b=r.clientX,j=r.clientY+20;const N=window.innerWidth,_=250;return b+_>N&&(b=N-_-10),b<0&&(b=10),{...g,[h]:{isOpen:!0,x:b,y:j}}}})},xm=(a,u,r,f,d)=>{d(h=>{const g={...h};return g[a]||(g[a]={}),g[a][u]=r,g})},vm=(a,u,r,f,d,h)=>{h&&(h.preventDefault(),h.stopPropagation()),d(g=>{const x={...g};x[a]||(x[a]={}),x[a][u]||(x[a][u]=[]);const b=x[a][u];return b.includes(r)?x[a][u]=b.filter(j=>j!==r):x[a][u]=[...b,r],x})},ym=(a,u,r,f,d)=>{const h=`${a}_${u}`;d(g=>({...g,[h]:r}))},bm=(a,u,r,f,d)=>{if(!f[a]){d(a,u,r);return}const h=f[a][u]||[];r.length===h.length?d(a,u,[]):d(a,u,[...r])},wm=(a,u,r,f,d,h)=>{h&&(h.preventDefault(),h.stopPropagation());const g=u[a];if(r(x=>({...x,[a]:!g})),g){const x={...f};Object.keys(x).forEach(b=>{x[b][a]&&delete x[b][a]}),d(x)}},_m=(a,u,r,f,d,h,g)=>{g.preventDefault(),g.stopPropagation();const x={...u};if(u.nodeParams){const b={};Object.keys(u.nodeParams).forEach(j=>{const N=r.find(_=>_.id.toString()===j);b[j]=N?N.title||`Node ${j}`:`Node ${j}`}),x.nodeNames=b}else if(Object.keys(u).length>0){const b={};Object.entries(u).forEach(([j,N])=>{(typeof N!="object"||N===null)&&(b[j]=N)}),Object.keys(b).length>0&&(x.nodeParams={default:b},x.nodeNames={default:u.node_name||u.nodeName||"参数"})}f(a),d(x),h(!0)},Sm=(a,u)=>{u&&(u.preventDefault(),u.stopPropagation()),a(!1)},Nm=(a,u,r,f,d,h,g,x,b,j,N)=>{if(N&&(N.preventDefault(),N.stopPropagation()),a===0){const _={...f};Object.keys(_).forEach(E=>{const O=_[E];Object.keys(O).forEach(P=>{r[P]||delete O[P]})}),d(_)}if(a===1){const _={...f};g.forEach(O=>{const P=O.id.toString(),B=O.widgets||{};Object.values(B).forEach(G=>{const R=G.name;if(r[R]&&(G.type==="customtext"||G.type.toLowerCase().includes("text"))){const X=`${P}_${R}`,K=h[X]||[""];_[P]=_[P]||{},_[P][R]=K}})}),d(_);const E=j(_);x(E.length)}b(null),u(_=>Math.min(_+1,2))},jm=(a,u,r,f,d,h,g,x,b,j)=>{if(j&&(j.preventDefault(),j.stopPropagation()),b(null),g&&x(!1),a===1){const N=r.map(O=>O.id.toString()),_=Object.keys(f),E={...f};_.forEach(O=>{N.includes(O)||delete E[O]}),d(E)}if(a===2||g){const N={...f};Object.entries(h).forEach(([_,E])=>{if(!E||E.length===0)return;const[O,P]=_.split("_");r.some(B=>B.id.toString()===O)&&(N[O]=N[O]||{},JSON.stringify(N[O][P])!==JSON.stringify(E)&&(N[O][P]=E))}),d(N)}u(N=>Math.max(N-1,0))},km=(a,u,r,f,d)=>{d&&(d.preventDefault(),d.stopPropagation()),f(Math.max(1,Math.min(a,Math.ceil(r.length/u))))};function Em(a,u){try{if(!a)return console.error("Invalid prompt_output: ",a),a;for(const r of u){if(!a[r.nodeId]){console.error(`Node with ID ${r.nodeId} not found`);continue}if(!a[r.nodeId].inputs){console.error(`Inputs not found for node with ID ${r.nodeId}`);continue}a[r.nodeId].inputs[r.paramName]=r.paramValue}return a}catch(r){return console.error("Error updating prompt:",r),a}}async function Cm(a){const u=await Re.graphToPrompt(),r=Em(u.output,a);console.log("queuePrompt updated_prompt:",r);const f={prompt:r,client_id:Re.api.clientId,extra_data:{extra_pageinfo:{workflow:u.workflow}}};console.debug("queuePrompt request_body.prompt:",r);const d=await Dp(f);return console.debug("queuePrompt response:",d),d}function wl(a){const u=document.createElement("canvas"),r=u.getContext("2d");if(u.width=512,u.height=512,r){r.fillStyle="#f8d7da",r.fillRect(0,0,u.width,u.height),r.strokeStyle="#dc3545",r.lineWidth=4,r.strokeRect(10,10,u.width-20,u.height-20),r.fillStyle="#dc3545",r.beginPath(),r.arc(u.width/2,150,50,0,2*Math.PI),r.fill(),r.fillStyle="white",r.font="bold 80px Arial",r.textAlign="center",r.textBaseline="middle",r.fillText("!",u.width/2,150),r.fillStyle="#721c24",r.font="20px Arial",r.textAlign="center",r.textBaseline="middle";const f=u.width-60,d=30,h=a.split(" ");let g="",x=250;for(let b=0;b<h.length;b++){const j=g+h[b]+" ";r.measureText(j).width>f&&b>0?(r.fillText(g,u.width/2,x),g=h[b]+" ",x+=d):g=j}r.fillText(g,u.width/2,x)}return u.toDataURL("image/png")}async function Am(a){try{if(!a||a==="")return console.log("No prompt ID provided"),{1:[wl("Fail to generate prompt ID")]};const u=await Bp(a);if(!u||!u[a])return console.log("Not finished for prompt ID:",a),{};const r=u[a];if(r.status&&r.status.status_str==="error"){console.error("Error for prompt ID:",a);const d=r.status.messages;if(d&&d.length>0){const h=d[d.length-1];if(h&&h.length>0){const g=h[0];return{1:[wl(g)]}}}}const f={};if(r.outputs)for(const d in r.outputs){const h=r.outputs[d];if(h&&h.images){f[d]=[];for(const g of h.images)if(g&&g.filename&&g.type){const x=Re.graph._nodes_by_id[d].imgs[0].currentSrc.split("?")[0];f[d].push(x+"?filename="+encodeURIComponent(g.filename)+"&type="+encodeURIComponent(g.type)+(g.subfolder?"&subfolder="+encodeURIComponent(g.subfolder):""))}console.log("outputImages for nodeId:",d,f[d])}}return f}catch(u){throw console.error("Error getting output images from prompt:",u),u}}function Im(){const a=Object.values(Re.graph._nodes_by_id),u=[],r=[];for(const f of a)f.type==="SaveImage"?u.push(f.id):f.type==="PreviewImage"&&r.push(f.id);if(console.log("saveNodeIds:",u),console.log("previewNodeIds:",r),u.length===0&&r.length===0)throw new Error("No SaveImage or PreviewImage node found, please add one to the graph");return u.length===1?u[0]:u.length==0&&r.length===1?r[0]:null}async function Mm(a,u){const r=await Am(a);return Object.keys(r).length===0?null:r[u.toString()]&&r[u.toString()].length>0?r[u.toString()][0]:null}const Lm=async(a,u,r,f,d,h,g,x,b,j,N,_,E,O)=>{E&&(E.preventDefault(),E.stopPropagation()),Il(j,b);const P=N(a),B=P.length;if(B>100){d(`Cannot generate more than 100 images at once (currently: ${B} images)`);return}d(null),r(!0),f(0),console.log("Generated parameter combinations:",P);let G=null;try{G=(await _.graphToPrompt()).output}catch(w){console.error("Error capturing workflow data:",w)}if(Tt.trackEvent({event_type:"start_generation",message_type:"parameter_debug",message_id:u,data:{workflow:G,all_params:a,count:B}}),P.length===0){d("No valid parameter combinations found. Please check your parameter selections."),r(!1);return}let R=O||null;if(R===null){const w=Im();w!==null&&(R=w)}if(R===null){d("Please select a SaveImage or PreviewImage node first."),r(!1);return}const X={};Object.keys(a).forEach(w=>{const M=_.graph._nodes_by_id[w];M&&(X[w]=M.type||M.comfyClass||"Unknown Node")});const K=[];try{const w=Date.now().toString();b.current=w;for(const ce of P){const be=await Cm(ce);be.prompt_id?K.push(be.prompt_id):(console.error("Failed to get prompt_id from response:",be),K.push(""))}const M=Array(P.length).fill(null).map((ce,be)=>({url:`https://source.unsplash.com/random/300x300?sig=${Math.random()}`,params:am(a,be)}));h(M);const D=Date.now(),V=5*60*1e3,je=Object.keys(a)[0],z=X[je]||"Unknown Node";Al(K,R,M,w,D,V,b,j,h,f,r,g,x,z,a,B,G,X)}catch(w){console.error("Error generating images:",w),r(!1)}},Al=async(a,u,r,f,d,h,g,x,b,j,N,_,E,O,P,B,G,R)=>{if(g.current!==f){console.log("Another polling session has started, stopping this one");return}if(Date.now()-d>h){if(console.log("Timeout reached while waiting for images"),g.current===f&&(N(!1),_(!0),E(1),r.length>0&&O&&P)){const K=r[0].params;R&&(K.selectedNodeInfoMap=R),yl(O,K,r,B||r.length,G)}return}let X=0;for(let K=0;K<a.length;K++){const w=a[K];if(w)try{const M=await Mm(w,Number(u));M&&(r[K]={...r[K],url:M},X++)}catch(M){console.error(`Error fetching image for prompt ID ${w}:`,M)}}if(b([...r]),j(X),X===a.length){if(console.log("All images have been generated!"),g.current===f&&(N(!1),_(!0),E(1),r.length>0&&O&&P)){const K=r[0].params;R&&(K.selectedNodeInfoMap=R),yl(O,K,r,B||r.length,G)}return}g.current===f&&(x.current=setTimeout(()=>{Al(a,u,r,f,d,h,g,x,b,j,N,_,E,O,P,B,G,R)},2e3))},Il=(a,u)=>{a.current&&(clearTimeout(a.current),a.current=null),u.current=null},Om=async(a,u,r,f,d,h)=>{if(!a.trim()){f("Please enter some text to generate variations");return}r(!0),f(null),d([]),h({});try{const g=await Tt.generateSDPrompts(a);d(g),Tt.trackEvent({event_type:"prompt_generate",message_type:"parameter_debug",message_id:u,data:{input_text:a,generated_texts:g}});const x={};g.forEach((b,j)=>{x[`text${j+1}`]=!1}),h(x)}catch(g){console.error("Error generating text:",g),f("Failed to generate text variations. Please try again.")}finally{r(!1)}},Pm=(a,u)=>{u(r=>({...r,[a]:!r[a]}))},Tm=(a,u,r,f,d,h,g,x,b,j)=>{const N=`${a}_${u}`,_=Object.entries(r).filter(([O,P])=>P).map(([O])=>{const P=parseInt(O.replace("text",""))-1;return f[P]});if(_.length===0)return;x(O=>{const P=[...O[N]||[]];return{...O,[N]:[...P,..._]}}),Tt.trackEvent({event_type:"prompt_apply",message_type:"parameter_debug",message_id:h,data:{input_text:d,generated_texts:f,selected_texts:_}});const E=[...g[N]||[],..._];b(a,u,E),j(!1)},Rm=(a,u,r,f,d,h,g,x,b,j)=>{r(!0),f(a),d(u),h(""),g([]),x({}),b(!1),j(null)},Dm=(a,u,r,f,d,h,g,x,b,j,N,_,E,O,P,B,G,R,X,K,w,M,D,V,je,z,ce,be,q,we=!1)=>{a(0),u({Steps:!0,CFG:!0,sampler_name:!0,threshold:!1,prompt:!1}),r(Xe()),f(),d(!1),h(!1),g(0),x(12),b(null),j(Array(12).fill(null).map((ee,U)=>({url:`https://source.unsplash.com/random/300x300?sig=${Math.random()}`,params:{step:U%3===0?5:U%3===1?10:15,sampler_name:"euler",cfg:1}}))),N({}),_({}),E({}),O({}),P(1),B(null),G(!1),R(!1),X(""),K(null),w({}),M(!1),D(""),V([]),je(!1),z(""),ce(""),be(null),q({}),we&&fm()},Wm=(a,u,r)=>{r&&(r.preventDefault(),r.stopPropagation()),u(a)},$m=async(a,u,r,f,d,h,g)=>{if(g&&(g.preventDefault(),g.stopPropagation()),a!==null){console.log(`Applied image ${a+1} with parameters:`,u[a].params);let x=1;if(d){for(const j in d)if(d[j])for(const N in d[j]){const _=d[j][N];if(_){let E=1;Array.isArray(_)?E=_.length>0?_.length:1:typeof _=="object"&&_!==null&&(E=Object.keys(_).length>0?Object.keys(_).length:1),x=x*E}}}Tt.trackEvent({event_type:"parameter_debug_apply",message_type:"parameter_debug",message_id:f,data:{workflow:(await r.graphToPrompt()).output,selected_params:u[a].params,all_params:d,count:x}});const b=u[a].params;b.nodeParams&&(Yg(b.nodeParams)?(console.log("[stateManagementUtils] Successfully applied selected parameters to canvas"),h(!0),setTimeout(()=>{h(!1)},3e3)):console.warn("[stateManagementUtils] Failed to apply selected parameters to canvas"))}},Bm=(a,u,r,f,d,h,g)=>{if(g&&(g.preventDefault(),g.stopPropagation()),a===1&&r!==void 0){const x=[...u];x[r],x.splice(r,1),x.length===0?d&&(f({type:"SET_SCREEN_STATE",payload:null}),h(!0),d()):f({type:"SET_SELECTED_NODE",payload:x});return}d&&(f({type:"SET_SCREEN_STATE",payload:null}),h(!0),d())},Fm=({selectedNodes:a,visible:u,onClose:r})=>{const[f,d]=k.useState(0),[h,g]=k.useState({Steps:!0,CFG:!0,sampler_name:!0,threshold:!1,prompt:!1}),[x,b]=k.useState(Xe()),[j,N]=k.useState(!1),[_,E]=k.useState(!1),[O,P]=k.useState(0),[B,G]=k.useState(12),[R,X]=k.useState(null),[K,w]=k.useState(()=>Array(12).fill(null).map((T,W)=>({url:`https://source.unsplash.com/random/300x300?sig=${Math.random()}`,params:{step:W%3===0?5:W%3===1?10:15,sampler_name:"euler",cfg:1}}))),[M,D]=k.useState({}),[V,je]=k.useState({}),[z,ce]=k.useState({}),[be,q]=k.useState({}),[we,ee]=k.useState(1),U=6,[Q,fe]=k.useState(null),[J,xe]=k.useState(!1),[Z,te]=k.useState(!1),[ie,ve]=k.useState(""),[ye,ke]=k.useState(null),[Ge,lt]=k.useState({}),[rt,Qe]=k.useState(!1),[Ct,st]=k.useState(""),[At,Ue]=k.useState([]),[Ye,ct]=k.useState(!1),[dn,F]=k.useState(""),[oe,Ae]=k.useState(""),[Le,De]=k.useState(null),[We,Oe]=k.useState({}),[He,Be]=k.useState(!1),[$t,It]=k.useState([]),[Bt,fn]=k.useState(null),{dispatch:hn}=Gn(),kn=k.useRef(null),En=k.useRef(null),[Hn,Vt]=k.useState(()=>u);k.useEffect(()=>{if(He){const T=El();It(T)}},[He]);const Kn=async()=>{Om(Ct,x,ct,De,Ue,Oe)},qn=(T,W,Ee,et)=>{const Qt=hm(T,W,Ee,et,Ge,lt);Zt(T,W,Qt)},Jn=(T,W)=>{const Ee=gm(T,W,Ge,lt);Zt(T,W,Ee)},ms=(T,W,Ee)=>{const et=pm(T,W,Ee,Ge,lt);Zt(T,W,et)},xs=T=>{Pm(T,Oe)},vs=()=>{Tm(dn,oe,We,At,Ct,x,Ge,lt,Zt,Qe)},br=(T,W)=>{Rm(T,W,Qe,F,Ae,st,Ue,Oe,ct,De)},Yn=T=>{T&&(T.preventDefault(),T.stopPropagation()),Be(W=>!W)},ys=T=>{fn(T),Be(!1),w(T.generatedImages||[]),X(null),ee(1)},bs=T=>{T&&(T.preventDefault(),T.stopPropagation()),fn(null)};k.useEffect(()=>{if(!a||a.length===0)return;const T={...M},W=a.map(et=>et.id.toString());Object.keys(T).forEach(et=>{W.includes(et)||delete T[et]}),a.forEach(et=>{const Qt=et.id.toString();T[Qt]||(T[Qt]={})}),JSON.stringify(T)!==JSON.stringify(M)&&D(T)},[a,M]),k.useEffect(()=>{hn({type:"SET_SCREEN_STATE",payload:{currentScreen:f,isProcessing:j,isCompleted:_}})},[f,j,_,hn]),k.useEffect(()=>{const T=document.createElement("style");return T.textContent=um,document.head.appendChild(T),()=>{document.head.removeChild(T)}},[]),k.useEffect(()=>{const T=W=>{if(Object.values(V).some(Ee=>Ee)){const Ee=W.target,et=!!Ee.closest(".dropdown-menu"),Qt=!!Ee.closest("[data-dropdown]");!et&&!Qt&&je({})}};return document.addEventListener("mousedown",T),()=>{document.removeEventListener("mousedown",T)}},[V]),k.useEffect(()=>{u&&(JSON.parse(localStorage.getItem(vr)||"{}").task_id||b(Xe()))},[u]),k.useEffect(()=>{if(u){Vt(!0);try{const T=localStorage.getItem(vr);if(T){const W=JSON.parse(T);if(!a||a.length===0){console.log("Not restoring parameter debug state: no nodes selected"),Vt(!1);return}W.currentScreen!==void 0&&d(W.currentScreen),W.selectedParams&&g(W.selectedParams),W.task_id&&b(W.task_id);const Ee=W.generatedImages&&W.generatedImages.length>0;W.isProcessing!==void 0&&!W.isProcessing&&N(!1),W.isCompleted!==void 0&&Ee&&E(W.isCompleted),W.completedCount!==void 0&&P(W.completedCount),W.totalCount!==void 0&&G(W.totalCount),W.selectedImageIndex!==void 0&&X(W.selectedImageIndex),W.generatedImages&&w(W.generatedImages),W.paramTestValues&&D(W.paramTestValues),W.searchTerms&&ce(W.searchTerms),W.inputValues&&q(W.inputValues),W.currentPage!==void 0&&ee(W.currentPage),W.textInputs&&lt(W.textInputs)}}catch(T){console.error("Error loading parameter debug state:",T)}finally{setTimeout(()=>{Vt(!1)},50)}}else Vt(!0);return()=>{if(!u)return;bl({currentScreen:f,selectedParams:h,task_id:x,isProcessing:j,isCompleted:_,completedCount:O,totalCount:B,selectedImageIndex:R,generatedImages:K,paramTestValues:M,searchTerms:z,inputValues:be,currentPage:we,textInputs:Ge})}},[u]);const ws=(T=!1)=>{Dm(d,g,b,Xn,N,E,P,G,X,w,D,je,ce,q,ee,fe,xe,te,ve,ke,lt,Qe,st,Ue,ct,F,Ae,De,Oe,T),Be(!1),fn(null)};k.useEffect(()=>{if(!u)return;const T=setTimeout(()=>{bl({currentScreen:f,selectedParams:h,task_id:x,isProcessing:j,isCompleted:_,completedCount:O,totalCount:B,selectedImageIndex:R,generatedImages:K,paramTestValues:M,searchTerms:z,inputValues:be,currentPage:we,textInputs:Ge})},500);return()=>clearTimeout(T)},[u,f,h,x,j,_,O,B,R,K,M,z,be,we,Ge]);const wr=T=>{Nm(f,d,h,M,D,Ge,a,G,fe,Di,T)},Cn=T=>{jm(f,d,a,M,D,Ge,_,E,fe,T)},_s=(T,W)=>{wm(T,h,g,M,D,W)},Ss=(T,W,Ee)=>{mm(T,W,Ee,V,je)},Zt=(T,W,Ee)=>{xm(T,W,Ee,M,D)},Vn=(T,W,Ee,et)=>{vm(T,W,Ee,M,D,et)},Ns=(T,W,Ee)=>{ym(T,W,Ee,z,ce)},Zn=(T,W,Ee)=>{bm(T,W,Ee,M,Zt)},_r=(T,W)=>{km(T,U,K,ee,W)},Xn=()=>{Il(kn,En)};k.useEffect(()=>()=>{Xn()},[]);const js=async(T,W)=>{Lm(M,x,N,P,fe,w,E,ee,En,kn,Di,Re,T,W)},Sr=(T,W)=>{Wm(T,X,W)},Nr=(T,W,Ee)=>{_m(T,W,a,ve,ke,te,Ee)},gn=T=>{Sm(te,T)},ks=async T=>{$m(R,K,Re,x,M,xe,T)},Xt=(T,W)=>{Bm(f,a,W,hn,r,ws,T)},pn=()=>i.jsx(i.Fragment,{children:i.jsx(xr,{visible:Z,imageUrl:ie,params:ye||{},onClose:gn})});return Bt?i.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4",onClick:T=>T.stopPropagation(),children:i.jsx(cm,{historyItem:Bt,selectedImageIndex:R,handleSelectImage:Sr,handleClose:bs,currentPage:we,handlePageChange:_r,imagesPerPage:U,modalVisible:Z,modalImageUrl:ie,modalImageParams:ye,openImageModal:Nr,closeImageModal:gn})}):He?i.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4 flex flex-col h-full max-h-[80vh]",onClick:T=>T.stopPropagation(),children:i.jsx(lm,{historyItems:$t,onViewHistoryItem:ys,onClose:Yn})}):Hn&&u&&a.length>0?i.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 bg-gray-50 overflow-y-auto",onClick:T=>T.stopPropagation(),children:[i.jsxs("div",{className:"p-8 rounded-lg shadow-sm relative flex flex-col items-center",children:[i.jsx("div",{className:"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),i.jsx("div",{className:"mt-4 text-gray-600 text-sm",children:"Loading interface..."})]}),i.jsx(xr,{visible:Z,imageUrl:ie,params:ye||{},onClose:gn})]}):!u||a.length===0?i.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 bg-gray-50 overflow-y-auto",onClick:T=>T.stopPropagation(),children:[i.jsxs("div",{className:"max-w-lg p-8 rounded-lg shadow-sm border border-blue-100 relative",children:[i.jsxs("div",{className:"absolute top-3 right-3 flex",children:[i.jsx("button",{className:"text-blue-500 hover:text-blue-700 mr-2",onClick:Yn,title:"Show History",children:i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:i.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z",clipRule:"evenodd"})})}),i.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:Xt,children:i.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),i.jsxs("div",{className:"mb-6 text-center",children:[i.jsx("h3",{className:"text-base font-bold text-blue-600 mb-2",children:"GenLab"}),i.jsx("div",{className:"h-1 w-16 bg-blue-500 mx-auto rounded-full mb-4"})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"text-left mb-4",children:[i.jsx("h3",{className:"text-sm font-medium text-gray-800 mb-3",children:"Batch-test parameters & find the best combo in one click."}),i.jsx("div",{className:"h-px w-full bg-gray-200 my-4"})]}),i.jsxs("div",{className:"text-left",children:[i.jsx("h4",{className:"text-base font-medium text-gray-800 mb-4",children:"How to use"}),i.jsxs("div",{className:"space-y-2 mb-4",children:[i.jsxs("p",{className:"text-sm text-gray-700",children:[i.jsx("span",{className:"font-bold",children:"1 - "}),"Click any node(hold Shift to select multiple nodes)"]}),i.jsxs("p",{className:"text-sm text-gray-700",children:[i.jsx("span",{className:"font-bold",children:"2 - "}),"Set parameter ranges and start batch generation."]})]}),i.jsx("div",{className:"h-px w-full bg-gray-200 my-4"}),i.jsx("p",{className:"text-sm text-blue-600 mt-6",children:"Let's select a node to begin!"})]})]})]}),i.jsx(xr,{visible:Z,imageUrl:ie,params:ye||{},onClose:gn})]}):_?i.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4",onClick:T=>T.stopPropagation(),children:i.jsx(im,{generatedImages:K,selectedImageIndex:R,handleSelectImage:Sr,handleApplySelected:ks,handlePrevious:Cn,handleClose:Xt,currentPage:we,handlePageChange:_r,imagesPerPage:U,notificationVisible:J,modalVisible:Z,modalImageUrl:ie,modalImageParams:ye,openImageModal:Nr,closeImageModal:gn})}):j?i.jsxs("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4",onClick:T=>T.stopPropagation(),children:[i.jsx(Kp,{selectedNodes:a,paramTestValues:M,selectedParams:h,totalCount:B,completedCount:O,errorMessage:Q,handleClose:Xt,setIsProcessing:N,setCurrentScreen:d,cleanupPolling:Xn}),i.jsx(pn,{})]}):f===0?i.jsxs("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4 flex flex-col h-full max-h-[80vh]",onClick:T=>T.stopPropagation(),children:[i.jsx(Up,{selectedNodes:a,handleParamSelect:_s,selectedParams:h,handleNext:wr,handleClose:Xt}),i.jsx(pn,{})]}):f===1?i.jsxs("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4 flex flex-col h-full max-h-[80vh]",onClick:T=>T.stopPropagation(),children:[i.jsx(Gp,{selectedNodes:a,paramTestValues:M,selectedParams:h,updateParamTestValues:Zt,toggleDropdown:Ss,openDropdowns:V,handleTestValueSelect:Vn,searchTerms:z,handleSearch:Ns,handleSelectAll:Zn,handleNext:wr,handlePrevious:Cn,handleClose:Xt,inputValues:be,setInputValues:q,textInputs:Ge,handleTextInputChange:qn,handleAddTextInput:Jn,handleRemoveTextInput:ms,openAiWritingModal:br}),i.jsx(om,{visible:rt,aiWritingModalText:Ct,setAiWritingModalText:st,aiGeneratedTexts:At,aiSelectedTexts:We,aiWritingLoading:Ye,aiWritingError:Le,handleAiWriting:Kn,toggleTextSelection:xs,addSelectedTexts:vs,onClose:()=>Qe(!1)}),i.jsx(pn,{})]}):i.jsxs("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4 flex flex-col h-full max-h-[80vh]",onClick:T=>T.stopPropagation(),children:[i.jsx(Hp,{selectedNodes:a,paramTestValues:M,selectedParams:h,totalCount:B,errorMessage:Q,handlePrevious:Cn,handleStartGeneration:js,handleClose:Xt}),i.jsx(pn,{})]})},zm=a=>{const{dispatch:u}=Gn(),[r,f]=k.useState(!1);return k.useEffect(()=>{if(a.visible&&!r){const d=dm();d&&d.screenState&&u({type:"SET_SCREEN_STATE",payload:{currentScreen:d.currentScreen,isProcessing:d.isProcessing,isCompleted:d.isCompleted}}),f(!0)}},[a.visible,r,u]),k.useEffect(()=>()=>{a.visible||u({type:"SET_SCREEN_STATE",payload:null})},[a.visible,u]),i.jsx(Fm,{...a})},Um=({message:a,onClose:u})=>a?i.jsxs("div",{className:`bg-gradient-to-r from-gray-50 to-gray-100 
            border border-gray-300 px-2 py-1 mt-2 ml-2 mr-2 relative shadow-sm rounded-sm`,children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:"flex-shrink-0 mr-1",children:i.jsx("svg",{className:"w-3.5 h-3.5 text-gray-700",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:i.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),i.jsx("div",{className:"text-gray-700 font-medium leading-relaxed pr-6 markdown-content",style:{fontSize:"11px"},children:i.jsx(Vg,{rehypePlugins:[[zg,{target:"_blank",rel:["noopener","noreferrer"]}]],remarkPlugins:[Fg],className:"prose !text-[11px] prose-a:text-gray-700 prose-a:underline prose-a:font-medium hover:prose-a:text-gray-800",components:{a:({node:r,...f})=>i.jsx("a",{...f,className:"text-gray-700 underline hover:text-gray-800 transition-colors",style:{fontSize:"11px"}}),p:({children:r})=>i.jsx("span",{className:"inline",style:{fontSize:"11px"},children:r}),span:({children:r})=>i.jsx("span",{style:{fontSize:"11px"},children:r}),li:({children:r})=>i.jsx("li",{style:{fontSize:"11px"},children:r}),ul:({children:r})=>i.jsx("ul",{style:{fontSize:"11px"},children:r}),ol:({children:r})=>i.jsx("ol",{style:{fontSize:"11px"},children:r})},children:a})})]}),i.jsx("button",{onClick:u,className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-700 hover:text-gray-800 transition-colors p-1 rounded-full hover:bg-gray-800","aria-label":"Close announcement",children:i.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}):null,Gm=()=>{const{state:a,dispatch:u}=Gn(),{selectedNode:r,screenState:f}=a,d=r||[],h=()=>{u({type:"SET_SELECTED_NODE",payload:null}),u({type:"SET_SCREEN_STATE",payload:null}),localStorage.removeItem("screenState")};return i.jsx("div",{className:"flex-1 flex flex-col overflow-y-auto",children:i.jsx(zm,{selectedNodes:d,visible:!0,onClose:h})})},_l=({active:a,onClick:u,children:r})=>i.jsx("button",{onClick:u,className:`px-4 py-2 font-medium text-xs transition-colors duration-200 ${a?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-blue-500 hover:border-b-2 hover:border-blue-300"}`,children:r});function Vm({onClose:a,visible:u=!0,triggerUsage:r=!1,onUsageTriggered:f}){const{state:d,dispatch:h}=Gn(),{messages:g,installedNodes:x,loading:b,sessionId:j,selectedNode:N,activeTab:_}=d;k.useRef(null);const[E,O]=k.useState(""),[P,B]=k.useState(""),[G,R]=k.useState(window.innerWidth/3),[X,K]=k.useState(!1),[w,M]=k.useState([]),[D,V]=k.useState("gemini-2.5-flash"),[je,z]=k.useState(window.innerHeight),[ce,be]=k.useState(0),[q,we]=k.useState(""),[ee,U]=k.useState(!1),Q=k.useRef(null);Fp(u&&_==="chat"),zp(u),k.useEffect(()=>{mr.init().catch(console.error)},[]),k.useEffect(()=>{g.length>0&&j&&rt(g)},[g,j]),k.useEffect(()=>{if(_!=="chat")return;(async()=>{const oe=await Rp();console.log("[WorkflowChat] Received installed nodes:",oe.length),h({type:"SET_INSTALLED_NODES",payload:oe})})()},[_]);const fe=async F=>{try{const oe=await mr.getSession(F);if(oe&&oe.messages.length>0){h({type:"SET_MESSAGES",payload:oe.messages});return}const Ae=await Tt.fetchMessages(F);h({type:"SET_MESSAGES",payload:Ae})}catch(oe){console.error("Error fetching messages:",oe)}};k.useEffect(()=>{if(_!=="chat")return;let F=localStorage.getItem("sessionId");F?(h({type:"SET_SESSION_ID",payload:F}),fe(F)):(F=Xe(),h({type:"SET_SESSION_ID",payload:F}),localStorage.setItem("sessionId",F))},[_]),k.useEffect(()=>{const F=localStorage.getItem("activeTab");F&&h({type:"SET_ACTIVE_TAB",payload:F});const oe=localStorage.getItem("screenState");oe&&h({type:"SET_SCREEN_STATE",payload:JSON.parse(oe)})},[]),k.useEffect(()=>{localStorage.setItem("activeTab",_)},[_]),k.useEffect(()=>{d.screenState&&localStorage.setItem("screenState",JSON.stringify(d.screenState))},[d.screenState]);const J=pr.useCallback(F=>{if(!X)return;const oe=window.innerWidth-F.clientX,Ae=Math.min(Math.max(300,oe),window.innerWidth*.8);R(Ae)},[X]),xe=pr.useMemo(()=>Wi.debounce(J,16),[J]);k.useEffect(()=>(X&&(document.addEventListener("mousemove",xe),document.addEventListener("mouseup",st)),()=>{document.removeEventListener("mousemove",xe),document.removeEventListener("mouseup",st),xe.cancel()}),[X,xe]);const Z=F=>{O(F.target.value)},te=()=>{Q.current&&(Q.current.abort(),Q.current=null,h({type:"SET_LOADING",payload:!1}))},ie=async()=>{if(h({type:"SET_LOADING",payload:!0}),E.trim()===""&&!N||!j)return;B(E);const F=Xe(),oe={id:Xe(),role:"user",content:E,trace_id:F};h({type:"ADD_MESSAGE",payload:oe}),O(""),Q.current=new AbortController;try{const Ae={type:"model_select",data:[D]};let Le=Xe(),De=!0;for await(const We of Tt.streamInvokeServer(j,E,w.map(Oe=>Oe.file),null,Ae,F,Q.current.signal,d.messages)){const Oe={id:Le,role:"ai",content:JSON.stringify(We),format:We.format,finished:We.finished,name:"Assistant"};if(De)h({type:"ADD_MESSAGE",payload:Oe}),De=!1;else{h({type:"UPDATE_MESSAGE",payload:Oe});const He=d.messages.map(Be=>Be.id===Oe.id&&!Be.finished?Oe:Be);rt(He)}We.finished&&(h({type:"SET_LOADING",payload:!1}),Q.current=null)}}catch(Ae){Ae instanceof Error&&Ae.name==="AbortError"?console.log("User aborted the request"):console.error("Error sending message:",Ae),h({type:"SET_LOADING",payload:!1}),Q.current=null}finally{M([])}},ve=async F=>{if(!j)return;h({type:"SET_LOADING",payload:!0}),B(F);const oe=Xe(),Ae={id:Xe(),role:"user",content:F,trace_id:oe};h({type:"ADD_MESSAGE",payload:Ae}),Q.current=new AbortController;try{const Le={type:"model_select",data:[D]};let De=Xe(),We=!0;for await(const Oe of Tt.streamInvokeServer(j,F,w.map(He=>He.file),null,Le,oe,Q.current.signal,d.messages)){const He={id:De,role:"ai",content:JSON.stringify(Oe),format:Oe.format,finished:Oe.finished,name:"Assistant"};if(We)h({type:"ADD_MESSAGE",payload:He}),We=!1;else{h({type:"UPDATE_MESSAGE",payload:He});const Be=d.messages.map($t=>$t.id===He.id&&!$t.finished?He:$t);rt(Be)}Oe.finished&&(h({type:"SET_LOADING",payload:!1}),Q.current=null)}}catch(Le){Le instanceof Error&&Le.name==="AbortError"?console.log("User aborted the request"):console.error("Error sending message:",Le),h({type:"SET_LOADING",payload:!1}),Q.current=null}finally{M([])}},ye=F=>{F.metaKey&&F.key==="Enter"&&ie()},ke=()=>{h({type:"CLEAR_MESSAGES"});const F=d.sessionId;F&&localStorage.removeItem(`messages_${F}`),localStorage.removeItem("sessionId");const oe=Xe();h({type:"SET_SESSION_ID",payload:oe}),localStorage.setItem("sessionId",oe)},Ge=F=>{O(F)},lt=async(F,oe)=>{if(!j||!N)return;h({type:"SET_LOADING",payload:!0});const Ae=N[0].comfyClass||N[0].type,Le=Xe(),De={id:Xe(),role:"user",content:Ae,trace_id:Le};h({type:"ADD_MESSAGE",payload:De}),Q.current=new AbortController;try{let We=Xe(),Oe=!0;for await(const He of Tt.streamInvokeServer(j,Ae,[],F,oe,Le,Q.current.signal,d.messages)){const Be={id:We,role:"ai",content:JSON.stringify(He),format:He.format,finished:He.finished,name:"Assistant"};if(F&&F!==""&&(Be.metadata={intent:F}),Oe)h({type:"ADD_MESSAGE",payload:Be}),Oe=!1;else{h({type:"UPDATE_MESSAGE",payload:Be});const $t=d.messages.map(It=>It.id===Be.id&&!It.finished?Be:It);rt($t)}He.finished&&(h({type:"SET_LOADING",payload:!1}),Q.current=null)}}catch(We){We instanceof Error&&We.name==="AbortError"?console.log("User aborted the request"):console.error("Error sending message:",We),h({type:"SET_LOADING",payload:!1}),Q.current=null}},rt=async F=>{if(d.sessionId){localStorage.setItem(`messages_${d.sessionId}`,JSON.stringify(F));try{await mr.saveSession(d.sessionId,F)}catch(oe){console.error("Failed to save session to IndexedDB:",oe)}}},Qe=F=>{console.log("[WorkflowChat] Adding new message:",F);const oe=[...d.messages,F];h({type:"ADD_MESSAGE",payload:F}),rt(oe)},Ct=(F,oe)=>{h({type:"SET_SESSION_ID",payload:F}),h({type:"SET_MESSAGES",payload:oe}),localStorage.setItem("sessionId",F),localStorage.setItem(`messages_${F}`,JSON.stringify(oe))},st=()=>{K(!1)},At=F=>{const oe=Array.from(F).map(Ae=>({id:Math.random().toString(36).substr(2,9),file:Ae,preview:URL.createObjectURL(Ae)}));M(Ae=>[...Ae,...oe])},Ue=F=>{M(oe=>oe.filter(Le=>Le.id!==F))};pr.useEffect(()=>()=>{w.forEach(F=>URL.revokeObjectURL(F.preview))},[w]),k.useEffect(()=>{r&&f&&_==="chat"&&(lt("node_explain"),f())},[r,_]),k.useEffect(()=>{if(!u||_!=="chat")return;(async()=>{try{const oe=new Date().toDateString();if(localStorage.getItem("announcementLastShownDate")!==oe){const Le=await Tt.fetchAnnouncement();Le&&Le.trim()!==""&&(we(Le),U(!0),localStorage.setItem("announcementLastShownDate",oe))}}catch(oe){console.error("Error fetching announcement:",oe)}})()},[u,_]);const Ye=()=>{U(!1)},ct=F=>{h({type:"SET_ACTIVE_TAB",payload:F})},dn=pr.useMemo(()=>i.jsx(Gm,{}),[]);return u?i.jsxs("div",{className:"flex flex-col h-full w-full bg-white relative",style:{display:u?"flex":"none"},children:[i.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1 cursor-ew-resize hover:bg-gray-300"}),i.jsxs("div",{className:"flex h-full flex-col",children:[i.jsx(yp,{onClose:a,onClear:ke,hasMessages:g.length>0,title:"ComfyUI-Copilot",onSelectSession:Ct,currentSessionId:j}),i.jsxs("div",{className:"flex border-b border-gray-200 mt-2",children:[i.jsx(_l,{active:_==="chat",onClick:()=>ct("chat"),children:"Chat"}),i.jsx(_l,{active:_==="parameter-debug",onClick:()=>ct("parameter-debug"),children:"GenLab"})]}),ee&&q&&_==="chat"&&i.jsx(Um,{message:q,onClose:Ye}),i.jsx(Pp,{messages:g,latestInput:P,onOptionClick:Ge,installedNodes:x,onAddMessage:Qe,loading:b,isActive:_==="chat"}),i.jsxs("div",{className:"border-t px-4 py-3 border-gray-200 bg-white sticky bottom-0",style:{display:_==="chat"?"block":"none"},children:[N&&i.jsx(Np,{nodeInfo:N,onSendWithIntent:lt,loading:b,onSendWithContent:ve}),i.jsx(_p,{input:E,loading:b,onChange:Z,onSend:ie,onKeyPress:ye,onUploadImages:At,uploadedImages:w,onRemoveImage:Ue,selectedModel:D,onModelChange:V,onStop:te,onAddDebugMessage:Qe})]}),i.jsx("div",{className:"flex-1 flex flex-col h-0",style:{display:_==="parameter-debug"?"flex":"none"},children:dn})]})]}):null}export{Vm as default};
