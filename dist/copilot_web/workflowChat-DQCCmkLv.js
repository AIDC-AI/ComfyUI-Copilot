function getImportPath(filename) {
            return `./${filename}`;
        }
            const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["copilot_web/WorkflowOption-CBi6bt51.js","copilot_web/vendor-markdown-CBmlBP6m.js","copilot_web/vendor-react-Dixhfmvb.js","copilot_web/message-components-C62Ox0cV.js"].map(path => {
                        const apiBase = window.comfyAPI?.api?.api?.api_base;
                        if (apiBase) {
                            // 有 API base 时，使用完整路径
                            return `${apiBase.substring(1)}/${path}`;
                        } else {        
                            // 没有 API base 时，使用相对路径
                            return `./${path}`;
                        }
                    }))))=>i.map(i=>d[i]);
import{j as i,r as Bg,b as Fg}from"./vendor-markdown-CBmlBP6m.js";import{r as k,R as gr,c as hr,a as zg}from"./vendor-react-Dixhfmvb.js";import{f as Ug,v as Gg,W as Tt,a as De,B as Hg,U as Kg,A as ds,b as qg,g as tt,c as xr,u as Un,M as Jg}from"./message-components-C62Ox0cV.js";import{_ as hs}from"./input.js";/* empty css     *//**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yg=a=>a.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),wl=(...a)=>a.filter((u,r,f)=>!!u&&u.trim()!==""&&f.indexOf(u)===r).join(" ").trim();/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Zg={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vg=k.forwardRef(({color:a="currentColor",size:u=24,strokeWidth:r=2,absoluteStrokeWidth:f,className:d="",children:h,iconNode:p,...x},_)=>k.createElement("svg",{ref:_,...Zg,width:u,height:u,stroke:a,strokeWidth:f?Number(r)*24/Number(u):r,className:wl("lucide",d),...x},[...p.map(([N,S])=>k.createElement(N,S)),...Array.isArray(h)?h:[h]]));/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nn=(a,u)=>{const r=k.forwardRef(({className:f,...d},h)=>k.createElement(Vg,{ref:h,iconNode:u,className:wl(`lucide-${Yg(a)}`,f),...d}));return r.displayName=`${a}`,r};/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xg=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["rect",{x:"9",y:"9",width:"6",height:"6",rx:"1",key:"1ssd4o"}]],Qg=Nn("CircleStop",Xg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ep=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],tp=Nn("Image",ep);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const np=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],rp=Nn("Plus",np);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sp=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],ip=Nn("Send",sp);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const op=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],ap=Nn("Settings",op);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lp=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]],cp=Nn("Trash",lp);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const up=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Pi=Nn("X",up);function dp({isOpen:a,onClose:u,onSave:r,initialApiKey:f=""}){const[d,h]=k.useState(f),[p,x]=k.useState(!1),[_,N]=k.useState(""),[S,b]=k.useState("https://api.openai.com/v1"),[I,P]=k.useState(!1),[T,G]=k.useState(!1),[q,B]=k.useState(null),[D,F]=k.useState(null);k.useEffect(()=>{h(f);const z=localStorage.getItem("openaiApiKey"),Q=localStorage.getItem("openaiBaseUrl");z&&N(z),Q&&b(Q),(async()=>{try{const U=localStorage.getItem("rsaPublicKey");if(U)F(U);else{const ae=await Ug();F(ae),localStorage.setItem("rsaPublicKey",ae)}}catch(U){console.error("Failed to fetch RSA public key:",U)}})()},[f]);const j=async()=>{if(!_.trim()){B({success:!1,message:"Please enter an OpenAI API key"});return}if(!D){B({success:!1,message:"RSA public key not available. Please try again later."});return}G(!0),B(null);try{const z=await Gg(_,S,D);B({success:z,message:z?"API key is valid!":"Invalid API key. Please check and try again."})}catch(z){B({success:!1,message:z instanceof Error?z.message:"Failed to verify API key"})}finally{G(!1)}},L=()=>{r(d),_.trim()?(localStorage.setItem("openaiApiKey",_),localStorage.setItem("openaiBaseUrl",S)):(localStorage.removeItem("openaiApiKey"),localStorage.removeItem("openaiBaseUrl")),u()};return a?i.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50",children:i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-8 w-[480px] shadow-2xl",children:[i.jsx("h2",{className:"text-xl text-gray-900 dark:text-white font-semibold mb-6",children:"Set API Key"}),i.jsxs("div",{className:"mb-6",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ComfyUI Copilot API Key"}),i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:p?"text":"password",value:d,onChange:z=>h(z.target.value),placeholder:"Enter your API key",className:`w-full px-4 py-3 border border-gray-200 dark:border-gray-600 rounded-lg mb-4 pr-12
                            bg-gray-50 dark:bg-gray-700 
                            text-gray-900 dark:text-white
                            placeholder-gray-500 dark:placeholder-gray-400
                            focus:border-blue-500 dark:focus:border-blue-400 
                            focus:ring-2 focus:ring-blue-500/20 dark:focus:ring-blue-400/20
                            focus:outline-none`}),i.jsx("button",{type:"button",className:`absolute inset-y-0 right-0 pr-4 flex items-center text-gray-500 dark:text-gray-400 
                            hover:text-gray-700 dark:hover:text-gray-200 transition-colors bg-transparent border-none`,onClick:()=>x(!p),children:p?i.jsxs("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}):i.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})})})]}),i.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:[i.jsx("span",{children:"Don't have an API key? "}),i.jsx("a",{href:"https://form.typeform.com/to/tkg91K8D",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 font-medium",children:"Click here to request one"})]})]}),i.jsxs("div",{className:"mb-6 border-t border-gray-200 dark:border-gray-700 pt-6",children:[i.jsx("h3",{className:"text-sm text-gray-900 dark:text-white font-medium mb-4",children:"OpenAI API Configuration (Optional)"}),i.jsxs("div",{className:"mb-4",children:[i.jsx("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-2",children:"OpenAI API Key"}),i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:I?"text":"password",value:_,onChange:z=>N(z.target.value),placeholder:"Enter your OpenAI API key",className:`w-full px-4 py-3 border border-gray-200 dark:border-gray-600 rounded-lg pr-12 text-xs
                                bg-gray-50 dark:bg-gray-700 
                                text-gray-900 dark:text-white
                                placeholder-gray-500 dark:placeholder-gray-400
                                focus:border-blue-500 dark:focus:border-blue-400 
                                focus:ring-2 focus:ring-blue-500/20 dark:focus:ring-blue-400/20
                                focus:outline-none`}),i.jsx("button",{type:"button",className:`absolute inset-y-0 right-0 pr-4 flex items-center text-gray-500 dark:text-gray-400 
                                hover:text-gray-700 dark:hover:text-gray-200 transition-colors bg-transparent border-none`,onClick:()=>P(!I),children:I?i.jsxs("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}):i.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})})})]})]}),i.jsxs("div",{className:"mb-4",children:[i.jsx("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-2",children:"OpenAI Base URL"}),i.jsx("input",{type:"text",value:S,onChange:z=>b(z.target.value),placeholder:"https://api.openai.com/v1",className:`w-full px-4 py-3 border border-gray-200 dark:border-gray-600 rounded-lg text-xs
                            bg-gray-50 dark:bg-gray-700 
                            text-gray-900 dark:text-white
                            placeholder-gray-500 dark:placeholder-gray-400
                            focus:border-blue-500 dark:focus:border-blue-400 
                            focus:ring-2 focus:ring-blue-500/20 dark:focus:ring-blue-400/20
                            focus:outline-none`})]}),i.jsx("div",{className:"flex items-center mb-2",children:i.jsx("button",{onClick:j,disabled:T||!_.trim(),className:`px-4 py-2 rounded-lg font-medium text-xs transition-colors ${T||!_.trim()?"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white"}`,children:T?i.jsxs("span",{className:"flex items-center",children:[i.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[i.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),i.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Verifying..."]}):"Verify"})}),q&&i.jsx("div",{className:`text-xs p-2 rounded-md ${q.success?"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-400":"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400"}`,children:q.message})]}),i.jsxs("div",{className:"flex justify-end gap-3",children:[i.jsx("button",{onClick:u,className:`px-5 py-2.5 text-gray-700 bg-white dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 
                        rounded-lg font-medium transition-colors`,children:"Cancel"}),i.jsx("button",{onClick:L,className:`px-5 py-2.5 bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 
                        text-white rounded-lg font-medium transition-colors`,children:"Save"})]})]})}):null}const fp="/copilot_web/assets/logo-BTZhX0BN.png";function hp({onClose:a,onClear:u,hasMessages:r,onHeightResize:f,title:d="ComfyUI-Copilot"}){const[h,p]=k.useState(!1),[x,_]=k.useState(!1),N=()=>{p(!0)},S=b=>{localStorage.setItem("chatApiKey",b)};return k.useEffect(()=>{const b=P=>{if(!x)return;const T=P.movementY;f?.(T)},I=()=>{_(!1)};return x&&(document.addEventListener("mousemove",b),document.addEventListener("mouseup",I)),()=>{document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",I)}},[x,f]),i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:`flex items-center justify-between border-b px-3 py-2 
                        bg-white border-gray-200 sticky top-2 z-10`,children:[i.jsxs("div",{className:"flex items-center space-x-1",children:[i.jsx("img",{src:`.${fp}`,alt:"ComfyUI-Copilot Logo",className:"h-7 w-7 -ml-1"}),i.jsx("h3",{className:"text-[14px] font-medium text-gray-800",children:d}),i.jsx("button",{onClick:N,className:"p-1 bg-white border-none hover:bg-gray-100 rounded text-gray-500",children:i.jsx(ap,{className:"h-4 w-4"})})]}),i.jsx("div",{className:"flex items-center gap-1",children:i.jsx("button",{className:`inline-flex bg-white border-none items-center justify-center rounded-md p-1.5 
                                 ${r?"text-gray-500 hover:bg-gray-100":"text-gray-300 cursor-not-allowed"}`,disabled:!r,onClick:u,children:i.jsx(cp,{className:"h-4 w-4"})})})]}),i.jsx(dp,{isOpen:h,onClose:()=>p(!1),onSave:S,initialApiKey:localStorage.getItem("chatApiKey")||""})]})}const gp=5*1024*1024,dl=["image/jpeg","image/png","image/gif","image/webp"];function pp({input:a,loading:u,onChange:r,onSend:f,onKeyPress:d,onUploadImages:h,uploadedImages:p,onRemoveImage:x,selectedModel:_,onModelChange:N,onStop:S}){const[b,I]=k.useState(!1),[P,T]=k.useState([]),G=gr.useRef(null),q=k.useRef(null);k.useEffect(()=>{q.current&&(q.current.style.height="auto",q.current.style.height=`${Math.min(q.current.scrollHeight,400)}px`)},[a]),k.useEffect(()=>{(async()=>{try{const F=await Tt.listModels();T(F.models)}catch(F){console.error("Failed to load models:",F),T([{name:"gpt-4o",image_enable:!0},{name:"gpt-4o-mini",image_enable:!0},{name:"qwen-plus",image_enable:!1},{name:"DeepSeek-V3",image_enable:!1}])}})()},[]);const B=D=>{if(D.target.files){const F=[],j=[];if(Array.from(D.target.files).forEach(L=>{dl.includes(L.type)?L.size>gp?F.push(`${L.name} (exceeds 5MB)`):j.push(L):F.push(`${L.name} (unsupported format)`)}),F.length>0&&alert(`The following files couldn't be uploaded:
${F.join(`
`)}`),j.length>0){const L=new DataTransfer;j.forEach(z=>L.items.add(z)),h(L.files)}}};return i.jsxs("div",{className:`relative ${p.length>0?"mt-12":""}`,children:[p.length>0&&i.jsx("div",{className:"absolute -top-10 left-0 flex gap-2",children:p.map(D=>i.jsxs("div",{className:"relative group",children:[i.jsx("img",{src:D.preview,alt:"uploaded",className:"w-8 h-8 rounded object-cover"}),i.jsx("button",{onClick:()=>x(D.id),className:`absolute -top-1 -right-1 bg-white border-none text-gray-500 rounded-full p-0.5
                                         opacity-0 group-hover:opacity-100 transition-opacity`,children:i.jsx(Pi,{className:"w-3 h-3"})})]},D.id))}),i.jsx("textarea",{ref:q,onChange:r,onKeyDown:D=>{if(D.key==="Enter"&&!D.shiftKey){if(D.nativeEvent.isComposing)return;D.preventDefault(),a.trim()!==""&&f()}d(D)},value:a,placeholder:"Type your message...",className:`w-full min-h-[80px] max-h-[400px] resize-none rounded-md border 
                         border-gray-200 px-3 py-2 pr-12 pb-10 text-[14px] shadow-sm 
                         focus:outline-none focus:ring-2 focus:ring-blue-500 
                         focus:border-transparent bg-white transition-all 
                         duration-200 text-gray-700 overflow-y-auto`,style:{height:"80px"}}),i.jsxs("div",{className:`absolute bottom-2 left-3 right-12 flex items-center gap-2 
                          bg-white border-t border-gray-100 pt-1`,children:[i.jsx("select",{value:_,onChange:D=>N(D.target.value),className:`px-1.5 py-0.5 text-xs rounded-md 
                             border border-gray-200 bg-white text-gray-700
                             focus:outline-none focus:ring-2 focus:ring-blue-500
                             focus:border-transparent hover:bg-gray-50
                             transition-colors border-0`,children:P.map(D=>i.jsx("option",{value:D.name,children:D.name},D.name))}),i.jsx("button",{type:"button",onClick:()=>I(!0),disabled:!P.find(D=>D.name===_)?.image_enable,className:`p-1.5 text-gray-500 bg-white border-none
                             hover:bg-gray-100 hover:text-gray-600 
                             transition-all duration-200 outline-none
                             ${P.find(D=>D.name===_)?.image_enable?"":"opacity-50 cursor-not-allowed"}`,children:i.jsx(tp,{className:"h-4 w-4"})})]}),i.jsx("button",{type:"submit",onClick:u?S:f,disabled:u?!1:a.trim()==="",className:`absolute bottom-3 right-3 p-2 rounded-md text-gray-500 bg-white border-none 
                         hover:bg-gray-100 hover:text-gray-600 disabled:opacity-50 
                         transition-all duration-200 active:scale-95`,children:u?i.jsx(Qg,{className:"h-5 w-5 text-red-500 hover:text-red-600"}):i.jsx(ip,{className:"h-5 w-5 group-hover:translate-x-1"})}),b&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:i.jsxs("div",{className:"bg-white rounded-lg p-6 w-96 relative",children:[i.jsx("button",{onClick:()=>I(!1),className:"absolute top-2 right-2 bg-white border-none text-gray-500 hover:text-gray-700",children:i.jsx(Pi,{className:"w-5 h-5"})}),i.jsx("h3",{className:"text-lg text-gray-800 font-medium mb-4",children:"Upload Images"}),i.jsxs("div",{className:`border-2 border-dashed border-gray-300 rounded-lg p-8
                                      flex flex-col items-center justify-center gap-4
                                      hover:border-blue-500 transition-colors cursor-pointer`,onClick:()=>G.current?.click(),children:[i.jsx(rp,{className:"w-8 h-8 text-gray-400"}),i.jsxs("div",{className:"text-center",children:[i.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"Click to upload images or drag and drop"}),i.jsx("p",{className:"text-xs text-gray-400",children:"Supported formats: JPG, PNG, GIF, WebP"}),i.jsx("p",{className:"text-xs text-gray-400",children:"Max file size: 5MB"})]})]}),i.jsx("input",{ref:G,type:"file",multiple:!0,accept:dl.join(","),onChange:B,className:"hidden"}),p.length>0&&i.jsx("div",{className:"mt-4 grid grid-cols-3 gap-2",children:p.map(D=>i.jsxs("div",{className:"relative group",children:[i.jsx("img",{src:D.preview,alt:"preview",className:"w-full h-20 object-cover rounded"}),i.jsx("button",{onClick:()=>x(D.id),className:`absolute -top-1 -right-1 bg-white border-none text-gray-500 
                                                     rounded-full p-0.5 opacity-0 group-hover:opacity-100 
                                                     transition-opacity`,children:i.jsx(Pi,{className:"w-3 h-3"})})]},D.id))}),i.jsx("div",{className:"mt-4 flex justify-end gap-2",children:i.jsx("button",{onClick:()=>I(!1),className:`px-4 py-2 text-sm font-medium text-gray-700 
                                         bg-white border border-gray-300 rounded-md 
                                         hover:bg-gray-50`,children:"Close"})})]})})]})}function mp(a){const u=a[0],r=new Set;function f(d,h){if(!(!d||h>=1)&&d.inputs)for(const p of Object.values(d.inputs)){const x=p.link;if(x&&De.graph.links[x]){const _=De.graph.links[x].origin_id,N=De.graph._nodes_by_id[_];N&&(r.add(N.type),f(N,h+1))}}}return u?(f(u,0),[{type:"upstream_node_types",data:Array.from(r)}]):null}function xp({nodeInfo:a,onSendWithIntent:u,loading:r,onSendWithContent:f}){return console.log("SelectedNodeInfo nodeInfo:",a[0]),i.jsx("div",{className:"mb-3 p-3 rounded-md bg-gray-50 border border-gray-200",children:i.jsxs("div",{className:"text-sm text-gray-700",children:[i.jsxs("p",{children:["Selected node: ",a[0].type]}),i.jsxs("div",{className:"flex gap-2 mt-2",children:[i.jsx("button",{className:`px-3 py-1 text-xs rounded-md bg-blue-50 
                                 text-blue-700 hover:bg-blue-100`,onClick:()=>f(`Reply in ${navigator.language} language: How does the ${a[0].type} node work? I need its official usage guide.`),disabled:r,children:"Usage"}),i.jsx("button",{className:`px-3 py-1 text-xs rounded-md bg-green-100 
                                 text-green-700 hover:bg-green-200`,onClick:()=>f(`Reply in ${navigator.language} language: Show me the technical specifications for the ${a[0].type} node's inputs and outputs.`),disabled:r,children:"Parameters"}),i.jsx("button",{className:`px-3 py-1 text-xs rounded-md bg-purple-100 
                                 text-purple-700 hover:bg-purple-200`,onClick:()=>u("downstream_subgraph_search",mp(a)),disabled:r,children:"Downstream Nodes"})]})]})})}function vp(){return i.jsx(Hg,{name:"Assistant",children:i.jsxs("div",{className:"flex items-center space-x-2 p-4 bg-gray-50 rounded-lg",children:[i.jsxs("div",{className:"flex space-x-1",children:[i.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),i.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),i.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]}),i.jsx("span",{className:"text-sm text-gray-500",children:"AI is thinking..."})]})})}const yp=a=>`https://ui-avatars.com/api/?name=${a||"User"}&background=random`,bp=k.lazy(()=>hs(()=>import(getImportPath("WorkflowOption-CBi6bt51.js")),__vite__mapDeps([0,1,2,3])).then(a=>({default:a.WorkflowOption}))),_p=k.lazy(()=>hs(()=>import(getImportPath("message-components-C62Ox0cV.js")).then(a=>a.N),__vite__mapDeps([3,2,1])).then(a=>({default:a.NodeSearch}))),wp=k.lazy(()=>hs(()=>import(getImportPath("message-components-C62Ox0cV.js")).then(a=>a.D),__vite__mapDeps([3,2,1])).then(a=>({default:a.DownstreamSubgraphs}))),Sp=k.lazy(()=>hs(()=>import(getImportPath("message-components-C62Ox0cV.js")).then(a=>a.d),__vite__mapDeps([3,2,1])).then(a=>({default:a.NodeInstallGuide}))),Np=3;function jp({messages:a,latestInput:u,onOptionClick:r,installedNodes:f,onAddMessage:d,loading:h,isActive:p}){const[x,_]=k.useState(0),[N,S]=k.useState([]),b=k.useRef(null),I=k.useRef(0),P=k.useRef(0),T=k.useRef(!1),G=()=>{b?.current&&(b.current.scrollTop=b.current.scrollHeight)},q=j=>{if(j.role==="user")return i.jsx(Kg,{content:j.content,trace_id:j.trace_id},j.id);if(j.role==="ai"||j.role==="tool"){const L=yp(j.role);try{const z=JSON.parse(j.content),Q=z.ext?.find(R=>R.type==="workflow"),Ce=z.ext?.find(R=>R.type==="node"),U=z.ext?.find(R=>R.type==="downstream_subgraph_search"),ae=z.ext?.find(R=>R.type==="node_install_guide");let pe=null;if(Q)pe=i.jsx(k.Suspense,{fallback:i.jsx("div",{children:"Loading..."}),children:i.jsx(bp,{content:j.content,name:j.name,avatar:L,latestInput:u,installedNodes:f,onAddMessage:d,onFinishLoad:G})});else if(Ce)pe=i.jsx(k.Suspense,{fallback:i.jsx("div",{children:"Loading..."}),children:i.jsx(_p,{content:j.content,name:j.name,avatar:L,installedNodes:f,onFinishLoad:G})});else if(U){const R=i.jsx(k.Suspense,{fallback:i.jsx("div",{children:"Loading..."}),children:i.jsx(wp,{content:j.content,name:j.name,avatar:L,onAddMessage:d,onFinishLoad:G})});if(j.metadata?.intent==="downstream_subgraph_search")return i.jsx(ds,{content:j.content,name:j.name,avatar:L,format:j.format,onOptionClick:r,extComponent:R,metadata:j.metadata},j.id);pe=R}else ae&&(pe=i.jsx(k.Suspense,{fallback:i.jsx("div",{children:"Loading..."}),children:i.jsx(Sp,{content:j.content,onLoadSubgraph:()=>{if(j.metadata?.pendingSubgraph){const R=Object.values(De.canvas.selected_nodes)[0];if(R){const ye=j.metadata.pendingSubgraph,le=ye.json.nodes,re=ye.json.links,ne=le.find(ce=>ce.id===0),he=ne?.id,K={};he&&(K[he]=R),De.canvas.emitBeforeChange();try{for(const ce of le)if(ce.id!==he){const J=ne?.pos||[0,0],V=R._pos||[0,0],ve=[ce.pos[0]+V[0]-J[0],ce.pos[1]+V[1]-J[1]];K[ce.id]=qg(ce.type,{pos:ve})}}finally{De.canvas.emitAfterChange()}for(const ce of re){const J=K[ce.origin_id],V=K[ce.target_id];J&&V&&J.connect(ce.origin_slot,V,ce.target_slot)}}else alert("Please select a upstream node first before adding a subgraph.")}else if(j.metadata?.pendingWorkflow){const R=j.metadata.pendingWorkflow,ye=j.metadata.optimizedParams;if(R.nodes)De.loadGraphData(R);else{De.loadApiJson(R);const re=Object.keys(R),ne=Object.keys(De.graph._nodes_by_id)[0],he=De.graph._nodes_by_id[ne],K=he?he.pos[0]:0,ce=he?he.pos[1]:0,J=250,V=60,ve=20,Oe=60,Ie=50,Ee=1e3;let ze=K,nt=ce,Ve=0;for(const lt of re){const Ue=De.graph._nodes_by_id[lt];if(Ue){Ve>Ee&&(ze+=J+Oe,Ve=0,nt=ce);const bt=Ue.inputs?Ue.inputs.length:0,At=Ue.outputs?Ue.outputs.length:0,Pt=Ue.widgets?Ue.widgets.length:0,Ke=Math.max(bt,At)+Pt,rt=ve*Ke+V;Ue.size[0]=J,Ue.size[1]=rt,Ue.pos[0]=ze,Ue.pos[1]=nt,Ve+=rt+Ie,nt+=rt+Ie}}}for(const[re,ne,he,K,ce]of ye){const J=De.graph._nodes_by_id[re].widgets;for(const V of J)V.name===K&&(V.value=ce)}De.graph.setDirtyCanvas(!1,!0);const le={id:tt(),role:"tool",content:JSON.stringify({text:"The workflow has been successfully loaded to the canvas",ext:[]}),format:"markdown",name:"Assistant"};d?.(le)}},onFinishLoad:G})}));return z.text||pe?i.jsx(ds,{content:j.content,name:j.name,avatar:L,format:j.format,onOptionClick:r,extComponent:pe,metadata:j.metadata},j.id):pe||i.jsx(ds,{content:j.content,name:j.name,avatar:L,format:j.format,onOptionClick:r,metadata:j.metadata},j.id)}catch(z){return console.error("[MessageList] Error parsing message content:",z),console.error("解析JSON失败",j.content),i.jsx(ds,{content:j.content,name:j.name,avatar:L,format:j.format,onOptionClick:r,metadata:j.metadata},j.id)}}return null},B=j=>{const L=j?.buttonStatus==="not_used";return i.jsx("div",{className:"flex justify-center items-center",children:L?i.jsx("button",{className:"w-full h-[24px] text-gray-700 text-xs bg-transparent hover:!bg-gray-100 px-2 py-1 rounded-md",onClick:F,children:"Load more"}):i.jsx("div",{className:"w-full h-[24px] bg-transparent"})},j.id)};function D(j){return j&&typeof j=="object"&&j.buttonType==="loadmore"}const F=()=>{T.current=!0,_(j=>j+1)};return k.useEffect(()=>{let j=[];if(I.current>0&&I.current<a.length)j=a.slice(I.current),a[I.current].role==="user"&&j.unshift({id:`${a[I.current].id}_loadmore`,buttonType:"loadmore",buttonStatus:"used"}),S(L=>[...L,...j]);else{let L=0,z=a?.length;for(let Q=a?.length-1;Q>=0;Q--)if(a[Q].role==="ai"||Q===0)if(L>Np+x){j.unshift({id:`${a[Q].id}_loadmore`,buttonType:"loadmore",buttonStatus:"not_used"});break}else L++,j?.length>0&&j.unshift({id:`${a[Q].id}_loadmore`,buttonType:"loadmore",buttonStatus:"used"}),j=[...a?.slice(Math.min(z,Q===0?Q:Q+1),z+1),...j],z=Q;S(j)}I.current=a.length},[a,x]),k.useLayoutEffect(()=>{b?.current&&(T.current?(b.current.scrollTop=b.current.scrollHeight-P.current,T.current=!1):b.current.scrollTop=b.current.scrollHeight,P.current=b.current.scrollHeight)},[N]),i.jsxs("div",{className:"flex-1 flex-col overflow-y-auto p-4 h-0",ref:b,style:{display:p?"block":"none"},children:[N?.map(j=>!!j&&(D(j)?B(j):q(j))),h&&i.jsx(vp,{})]})}async function Cp(){try{return await(await xr.fetchApi("/object_info",{method:"GET"})).json()}catch(a){throw console.error("Error fetching object info:",a),a}}async function kp(){const a=await Cp();return Object.keys(a)}async function Ep(a){return await(await xr.fetchApi("/prompt",{method:"POST",body:JSON.stringify(a)})).json()}async function Ap(a){try{const u=await xr.fetchApi("/queue",{method:"POST",body:JSON.stringify(a)});if(!u.ok)throw new Error(`Failed to manage queue: ${u.status} ${u.statusText}`);return u}catch(u){throw console.error("Error managing queue:",u),u}}async function Ip(){try{const a=await xr.fetchApi("/interrupt",{method:"POST"});if(!a.ok)throw new Error(`Failed to interrupt processing: ${a.status} ${a.statusText}`);return a}catch(a){throw console.error("Error interrupting processing:",a),a}}async function Mp(a){try{const u=await xr.fetchApi(`/history/${a}`,{method:"GET"});if(!u.ok)throw new Error(`Failed to fetch history: ${u.status} ${u.statusText}`);return await u.json()}catch(u){throw console.error("Error fetching history:",u),u}}var fs={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */fs.exports;(function(a,u){(function(){var r,f="4.17.21",d=200,h="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",p="Expected a function",x="Invalid `variable` option passed into `_.template`",_="__lodash_hash_undefined__",N=500,S="__lodash_placeholder__",b=1,I=2,P=4,T=1,G=2,q=1,B=2,D=4,F=8,j=16,L=32,z=64,Q=128,Ce=256,U=512,ae=30,pe="...",R=800,ye=16,le=1,re=2,ne=3,he=1/0,K=9007199254740991,ce=17976931348623157e292,J=NaN,V=4294967295,ve=V-1,Oe=V>>>1,Ie=[["ary",Q],["bind",q],["bindKey",B],["curry",F],["curryRight",j],["flip",U],["partial",L],["partialRight",z],["rearg",Ce]],Ee="[object Arguments]",ze="[object Array]",nt="[object AsyncFunction]",Ve="[object Boolean]",lt="[object Date]",Ue="[object DOMException]",bt="[object Error]",At="[object Function]",Pt="[object GeneratorFunction]",Ke="[object Map]",rt="[object Number]",Z="[object Null]",se="[object Object]",Me="[object Promise]",$e="[object Proxy]",ct="[object RegExp]",we="[object Set]",Te="[object String]",Pe="[object Symbol]",Je="[object Undefined]",st="[object WeakMap]",cn="[object WeakSet]",un="[object ArrayBuffer]",$t="[object DataView]",dn="[object Float32Array]",fn="[object Float64Array]",jn="[object Int8Array]",Cn="[object Int16Array]",Gn="[object Int32Array]",Yt="[object Uint8Array]",Hn="[object Uint8ClampedArray]",Kn="[object Uint16Array]",qn="[object Uint32Array]",gs=/\b__p \+= '';/g,ps=/\b(__p \+=) '' \+/g,ms=/(__e\(.*?\)|\b__t\)) \+\n'';/g,vr=/&(?:amp|lt|gt|quot|#39);/g,Jn=/[&<>"']/g,xs=RegExp(vr.source),vs=RegExp(Jn.source),ys=/<%-([\s\S]+?)%>/g,yr=/<%([\s\S]+?)%>/g,kn=/<%=([\s\S]+?)%>/g,bs=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,_s=/^\w*$/,Zt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Yn=/[\\^$.*+?()[\]{}|]/g,ws=RegExp(Yn.source),Zn=/^\s+/,br=/\s/,Vn=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Ss=/\{\n\/\* \[wrapped with (.+)\] \*/,_r=/,? & /,wr=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,hn=/[()=,{}\[\]\/\s]/,Ns=/\\(\\)?/g,Vt=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,gn=/\w*$/,O=/^[-+]0x[0-9a-f]+$/i,W=/^0b[01]+$/i,Ne=/^\[object .+?Constructor\]$/,Xe=/^0o[0-7]+$/i,Xt=/^(?:0|[1-9]\d*)$/,Il=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Sr=/($^)/,Ml=/['\n\r\u2028\u2029\\]/g,Nr="\\ud800-\\udfff",Ll="\\u0300-\\u036f",Ol="\\ufe20-\\ufe2f",Tl="\\u20d0-\\u20ff",$i=Ll+Ol+Tl,Bi="\\u2700-\\u27bf",Fi="a-z\\xdf-\\xf6\\xf8-\\xff",Pl="\\xac\\xb1\\xd7\\xf7",Rl="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Dl="\\u2000-\\u206f",Wl=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",zi="A-Z\\xc0-\\xd6\\xd8-\\xde",Ui="\\ufe0e\\ufe0f",Gi=Pl+Rl+Dl+Wl,js="['’]",$l="["+Nr+"]",Hi="["+Gi+"]",jr="["+$i+"]",Ki="\\d+",Bl="["+Bi+"]",qi="["+Fi+"]",Ji="[^"+Nr+Gi+Ki+Bi+Fi+zi+"]",Cs="\\ud83c[\\udffb-\\udfff]",Fl="(?:"+jr+"|"+Cs+")",Yi="[^"+Nr+"]",ks="(?:\\ud83c[\\udde6-\\uddff]){2}",Es="[\\ud800-\\udbff][\\udc00-\\udfff]",En="["+zi+"]",Zi="\\u200d",Vi="(?:"+qi+"|"+Ji+")",zl="(?:"+En+"|"+Ji+")",Xi="(?:"+js+"(?:d|ll|m|re|s|t|ve))?",Qi="(?:"+js+"(?:D|LL|M|RE|S|T|VE))?",eo=Fl+"?",to="["+Ui+"]?",Ul="(?:"+Zi+"(?:"+[Yi,ks,Es].join("|")+")"+to+eo+")*",Gl="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Hl="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",no=to+eo+Ul,Kl="(?:"+[Bl,ks,Es].join("|")+")"+no,ql="(?:"+[Yi+jr+"?",jr,ks,Es,$l].join("|")+")",Jl=RegExp(js,"g"),Yl=RegExp(jr,"g"),As=RegExp(Cs+"(?="+Cs+")|"+ql+no,"g"),Zl=RegExp([En+"?"+qi+"+"+Xi+"(?="+[Hi,En,"$"].join("|")+")",zl+"+"+Qi+"(?="+[Hi,En+Vi,"$"].join("|")+")",En+"?"+Vi+"+"+Xi,En+"+"+Qi,Hl,Gl,Ki,Kl].join("|"),"g"),Vl=RegExp("["+Zi+Nr+$i+Ui+"]"),Xl=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Ql=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],ec=-1,Ae={};Ae[dn]=Ae[fn]=Ae[jn]=Ae[Cn]=Ae[Gn]=Ae[Yt]=Ae[Hn]=Ae[Kn]=Ae[qn]=!0,Ae[Ee]=Ae[ze]=Ae[un]=Ae[Ve]=Ae[$t]=Ae[lt]=Ae[bt]=Ae[At]=Ae[Ke]=Ae[rt]=Ae[se]=Ae[ct]=Ae[we]=Ae[Te]=Ae[st]=!1;var ke={};ke[Ee]=ke[ze]=ke[un]=ke[$t]=ke[Ve]=ke[lt]=ke[dn]=ke[fn]=ke[jn]=ke[Cn]=ke[Gn]=ke[Ke]=ke[rt]=ke[se]=ke[ct]=ke[we]=ke[Te]=ke[Pe]=ke[Yt]=ke[Hn]=ke[Kn]=ke[qn]=!0,ke[bt]=ke[At]=ke[st]=!1;var tc={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},nc={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},rc={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},sc={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ic=parseFloat,oc=parseInt,ro=typeof hr=="object"&&hr&&hr.Object===Object&&hr,ac=typeof self=="object"&&self&&self.Object===Object&&self,Ye=ro||ac||Function("return this")(),Is=u&&!u.nodeType&&u,pn=Is&&!0&&a&&!a.nodeType&&a,so=pn&&pn.exports===Is,Ms=so&&ro.process,_t=function(){try{var v=pn&&pn.require&&pn.require("util").types;return v||Ms&&Ms.binding&&Ms.binding("util")}catch{}}(),io=_t&&_t.isArrayBuffer,oo=_t&&_t.isDate,ao=_t&&_t.isMap,lo=_t&&_t.isRegExp,co=_t&&_t.isSet,uo=_t&&_t.isTypedArray;function gt(v,C,w){switch(w.length){case 0:return v.call(C);case 1:return v.call(C,w[0]);case 2:return v.call(C,w[0],w[1]);case 3:return v.call(C,w[0],w[1],w[2])}return v.apply(C,w)}function lc(v,C,w,H){for(var ie=-1,be=v==null?0:v.length;++ie<be;){var Ge=v[ie];C(H,Ge,w(Ge),v)}return H}function wt(v,C){for(var w=-1,H=v==null?0:v.length;++w<H&&C(v[w],w,v)!==!1;);return v}function cc(v,C){for(var w=v==null?0:v.length;w--&&C(v[w],w,v)!==!1;);return v}function fo(v,C){for(var w=-1,H=v==null?0:v.length;++w<H;)if(!C(v[w],w,v))return!1;return!0}function Qt(v,C){for(var w=-1,H=v==null?0:v.length,ie=0,be=[];++w<H;){var Ge=v[w];C(Ge,w,v)&&(be[ie++]=Ge)}return be}function Cr(v,C){var w=v==null?0:v.length;return!!w&&An(v,C,0)>-1}function Ls(v,C,w){for(var H=-1,ie=v==null?0:v.length;++H<ie;)if(w(C,v[H]))return!0;return!1}function Le(v,C){for(var w=-1,H=v==null?0:v.length,ie=Array(H);++w<H;)ie[w]=C(v[w],w,v);return ie}function en(v,C){for(var w=-1,H=C.length,ie=v.length;++w<H;)v[ie+w]=C[w];return v}function Os(v,C,w,H){var ie=-1,be=v==null?0:v.length;for(H&&be&&(w=v[++ie]);++ie<be;)w=C(w,v[ie],ie,v);return w}function uc(v,C,w,H){var ie=v==null?0:v.length;for(H&&ie&&(w=v[--ie]);ie--;)w=C(w,v[ie],ie,v);return w}function Ts(v,C){for(var w=-1,H=v==null?0:v.length;++w<H;)if(C(v[w],w,v))return!0;return!1}var dc=Ps("length");function fc(v){return v.split("")}function hc(v){return v.match(wr)||[]}function ho(v,C,w){var H;return w(v,function(ie,be,Ge){if(C(ie,be,Ge))return H=be,!1}),H}function kr(v,C,w,H){for(var ie=v.length,be=w+(H?1:-1);H?be--:++be<ie;)if(C(v[be],be,v))return be;return-1}function An(v,C,w){return C===C?jc(v,C,w):kr(v,go,w)}function gc(v,C,w,H){for(var ie=w-1,be=v.length;++ie<be;)if(H(v[ie],C))return ie;return-1}function go(v){return v!==v}function po(v,C){var w=v==null?0:v.length;return w?Ds(v,C)/w:J}function Ps(v){return function(C){return C==null?r:C[v]}}function Rs(v){return function(C){return v==null?r:v[C]}}function mo(v,C,w,H,ie){return ie(v,function(be,Ge,je){w=H?(H=!1,be):C(w,be,Ge,je)}),w}function pc(v,C){var w=v.length;for(v.sort(C);w--;)v[w]=v[w].value;return v}function Ds(v,C){for(var w,H=-1,ie=v.length;++H<ie;){var be=C(v[H]);be!==r&&(w=w===r?be:w+be)}return w}function Ws(v,C){for(var w=-1,H=Array(v);++w<v;)H[w]=C(w);return H}function mc(v,C){return Le(C,function(w){return[w,v[w]]})}function xo(v){return v&&v.slice(0,_o(v)+1).replace(Zn,"")}function pt(v){return function(C){return v(C)}}function $s(v,C){return Le(C,function(w){return v[w]})}function Xn(v,C){return v.has(C)}function vo(v,C){for(var w=-1,H=v.length;++w<H&&An(C,v[w],0)>-1;);return w}function yo(v,C){for(var w=v.length;w--&&An(C,v[w],0)>-1;);return w}function xc(v,C){for(var w=v.length,H=0;w--;)v[w]===C&&++H;return H}var vc=Rs(tc),yc=Rs(nc);function bc(v){return"\\"+sc[v]}function _c(v,C){return v==null?r:v[C]}function In(v){return Vl.test(v)}function wc(v){return Xl.test(v)}function Sc(v){for(var C,w=[];!(C=v.next()).done;)w.push(C.value);return w}function Bs(v){var C=-1,w=Array(v.size);return v.forEach(function(H,ie){w[++C]=[ie,H]}),w}function bo(v,C){return function(w){return v(C(w))}}function tn(v,C){for(var w=-1,H=v.length,ie=0,be=[];++w<H;){var Ge=v[w];(Ge===C||Ge===S)&&(v[w]=S,be[ie++]=w)}return be}function Er(v){var C=-1,w=Array(v.size);return v.forEach(function(H){w[++C]=H}),w}function Nc(v){var C=-1,w=Array(v.size);return v.forEach(function(H){w[++C]=[H,H]}),w}function jc(v,C,w){for(var H=w-1,ie=v.length;++H<ie;)if(v[H]===C)return H;return-1}function Cc(v,C,w){for(var H=w+1;H--;)if(v[H]===C)return H;return H}function Mn(v){return In(v)?Ec(v):dc(v)}function It(v){return In(v)?Ac(v):fc(v)}function _o(v){for(var C=v.length;C--&&br.test(v.charAt(C)););return C}var kc=Rs(rc);function Ec(v){for(var C=As.lastIndex=0;As.test(v);)++C;return C}function Ac(v){return v.match(As)||[]}function Ic(v){return v.match(Zl)||[]}var Mc=function v(C){C=C==null?Ye:Ln.defaults(Ye.Object(),C,Ln.pick(Ye,Ql));var w=C.Array,H=C.Date,ie=C.Error,be=C.Function,Ge=C.Math,je=C.Object,Fs=C.RegExp,Lc=C.String,St=C.TypeError,Ar=w.prototype,Oc=be.prototype,On=je.prototype,Ir=C["__core-js_shared__"],Mr=Oc.toString,Se=On.hasOwnProperty,Tc=0,wo=function(){var e=/[^.]+$/.exec(Ir&&Ir.keys&&Ir.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Lr=On.toString,Pc=Mr.call(je),Rc=Ye._,Dc=Fs("^"+Mr.call(Se).replace(Yn,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Or=so?C.Buffer:r,nn=C.Symbol,Tr=C.Uint8Array,So=Or?Or.allocUnsafe:r,Pr=bo(je.getPrototypeOf,je),No=je.create,jo=On.propertyIsEnumerable,Rr=Ar.splice,Co=nn?nn.isConcatSpreadable:r,Qn=nn?nn.iterator:r,mn=nn?nn.toStringTag:r,Dr=function(){try{var e=_n(je,"defineProperty");return e({},"",{}),e}catch{}}(),Wc=C.clearTimeout!==Ye.clearTimeout&&C.clearTimeout,$c=H&&H.now!==Ye.Date.now&&H.now,Bc=C.setTimeout!==Ye.setTimeout&&C.setTimeout,Wr=Ge.ceil,$r=Ge.floor,zs=je.getOwnPropertySymbols,Fc=Or?Or.isBuffer:r,ko=C.isFinite,zc=Ar.join,Uc=bo(je.keys,je),He=Ge.max,Qe=Ge.min,Gc=H.now,Hc=C.parseInt,Eo=Ge.random,Kc=Ar.reverse,Us=_n(C,"DataView"),er=_n(C,"Map"),Gs=_n(C,"Promise"),Tn=_n(C,"Set"),tr=_n(C,"WeakMap"),nr=_n(je,"create"),Br=tr&&new tr,Pn={},qc=wn(Us),Jc=wn(er),Yc=wn(Gs),Zc=wn(Tn),Vc=wn(tr),Fr=nn?nn.prototype:r,rr=Fr?Fr.valueOf:r,Ao=Fr?Fr.toString:r;function l(e){if(We(e)&&!oe(e)&&!(e instanceof me)){if(e instanceof Nt)return e;if(Se.call(e,"__wrapped__"))return Ia(e)}return new Nt(e)}var Rn=function(){function e(){}return function(t){if(!Re(t))return{};if(No)return No(t);e.prototype=t;var n=new e;return e.prototype=r,n}}();function zr(){}function Nt(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=r}l.templateSettings={escape:ys,evaluate:yr,interpolate:kn,variable:"",imports:{_:l}},l.prototype=zr.prototype,l.prototype.constructor=l,Nt.prototype=Rn(zr.prototype),Nt.prototype.constructor=Nt;function me(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=V,this.__views__=[]}function Xc(){var e=new me(this.__wrapped__);return e.__actions__=ut(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=ut(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=ut(this.__views__),e}function Qc(){if(this.__filtered__){var e=new me(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function eu(){var e=this.__wrapped__.value(),t=this.__dir__,n=oe(e),s=t<0,o=n?e.length:0,c=fd(0,o,this.__views__),g=c.start,m=c.end,y=m-g,E=s?m:g-1,A=this.__iteratees__,M=A.length,$=0,Y=Qe(y,this.__takeCount__);if(!n||!s&&o==y&&Y==y)return Qo(e,this.__actions__);var ee=[];e:for(;y--&&$<Y;){E+=t;for(var de=-1,te=e[E];++de<M;){var ge=A[de],xe=ge.iteratee,vt=ge.type,at=xe(te);if(vt==re)te=at;else if(!at){if(vt==le)continue e;break e}}ee[$++]=te}return ee}me.prototype=Rn(zr.prototype),me.prototype.constructor=me;function xn(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var s=e[t];this.set(s[0],s[1])}}function tu(){this.__data__=nr?nr(null):{},this.size=0}function nu(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function ru(e){var t=this.__data__;if(nr){var n=t[e];return n===_?r:n}return Se.call(t,e)?t[e]:r}function su(e){var t=this.__data__;return nr?t[e]!==r:Se.call(t,e)}function iu(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=nr&&t===r?_:t,this}xn.prototype.clear=tu,xn.prototype.delete=nu,xn.prototype.get=ru,xn.prototype.has=su,xn.prototype.set=iu;function Bt(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var s=e[t];this.set(s[0],s[1])}}function ou(){this.__data__=[],this.size=0}function au(e){var t=this.__data__,n=Ur(t,e);if(n<0)return!1;var s=t.length-1;return n==s?t.pop():Rr.call(t,n,1),--this.size,!0}function lu(e){var t=this.__data__,n=Ur(t,e);return n<0?r:t[n][1]}function cu(e){return Ur(this.__data__,e)>-1}function uu(e,t){var n=this.__data__,s=Ur(n,e);return s<0?(++this.size,n.push([e,t])):n[s][1]=t,this}Bt.prototype.clear=ou,Bt.prototype.delete=au,Bt.prototype.get=lu,Bt.prototype.has=cu,Bt.prototype.set=uu;function Ft(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var s=e[t];this.set(s[0],s[1])}}function du(){this.size=0,this.__data__={hash:new xn,map:new(er||Bt),string:new xn}}function fu(e){var t=ts(this,e).delete(e);return this.size-=t?1:0,t}function hu(e){return ts(this,e).get(e)}function gu(e){return ts(this,e).has(e)}function pu(e,t){var n=ts(this,e),s=n.size;return n.set(e,t),this.size+=n.size==s?0:1,this}Ft.prototype.clear=du,Ft.prototype.delete=fu,Ft.prototype.get=hu,Ft.prototype.has=gu,Ft.prototype.set=pu;function vn(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new Ft;++t<n;)this.add(e[t])}function mu(e){return this.__data__.set(e,_),this}function xu(e){return this.__data__.has(e)}vn.prototype.add=vn.prototype.push=mu,vn.prototype.has=xu;function Mt(e){var t=this.__data__=new Bt(e);this.size=t.size}function vu(){this.__data__=new Bt,this.size=0}function yu(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function bu(e){return this.__data__.get(e)}function _u(e){return this.__data__.has(e)}function wu(e,t){var n=this.__data__;if(n instanceof Bt){var s=n.__data__;if(!er||s.length<d-1)return s.push([e,t]),this.size=++n.size,this;n=this.__data__=new Ft(s)}return n.set(e,t),this.size=n.size,this}Mt.prototype.clear=vu,Mt.prototype.delete=yu,Mt.prototype.get=bu,Mt.prototype.has=_u,Mt.prototype.set=wu;function Io(e,t){var n=oe(e),s=!n&&Sn(e),o=!n&&!s&&ln(e),c=!n&&!s&&!o&&Bn(e),g=n||s||o||c,m=g?Ws(e.length,Lc):[],y=m.length;for(var E in e)(t||Se.call(e,E))&&!(g&&(E=="length"||o&&(E=="offset"||E=="parent")||c&&(E=="buffer"||E=="byteLength"||E=="byteOffset")||Ht(E,y)))&&m.push(E);return m}function Mo(e){var t=e.length;return t?e[ti(0,t-1)]:r}function Su(e,t){return ns(ut(e),yn(t,0,e.length))}function Nu(e){return ns(ut(e))}function Hs(e,t,n){(n!==r&&!Lt(e[t],n)||n===r&&!(t in e))&&zt(e,t,n)}function sr(e,t,n){var s=e[t];(!(Se.call(e,t)&&Lt(s,n))||n===r&&!(t in e))&&zt(e,t,n)}function Ur(e,t){for(var n=e.length;n--;)if(Lt(e[n][0],t))return n;return-1}function ju(e,t,n,s){return rn(e,function(o,c,g){t(s,o,n(o),g)}),s}function Lo(e,t){return e&&Dt(t,qe(t),e)}function Cu(e,t){return e&&Dt(t,ft(t),e)}function zt(e,t,n){t=="__proto__"&&Dr?Dr(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function Ks(e,t){for(var n=-1,s=t.length,o=w(s),c=e==null;++n<s;)o[n]=c?r:Ci(e,t[n]);return o}function yn(e,t,n){return e===e&&(n!==r&&(e=e<=n?e:n),t!==r&&(e=e>=t?e:t)),e}function jt(e,t,n,s,o,c){var g,m=t&b,y=t&I,E=t&P;if(n&&(g=o?n(e,s,o,c):n(e)),g!==r)return g;if(!Re(e))return e;var A=oe(e);if(A){if(g=gd(e),!m)return ut(e,g)}else{var M=et(e),$=M==At||M==Pt;if(ln(e))return na(e,m);if(M==se||M==Ee||$&&!o){if(g=y||$?{}:_a(e),!m)return y?rd(e,Cu(g,e)):nd(e,Lo(g,e))}else{if(!ke[M])return o?e:{};g=pd(e,M,m)}}c||(c=new Mt);var Y=c.get(e);if(Y)return Y;c.set(e,g),Za(e)?e.forEach(function(te){g.add(jt(te,t,n,te,e,c))}):Ja(e)&&e.forEach(function(te,ge){g.set(ge,jt(te,t,n,ge,e,c))});var ee=E?y?fi:di:y?ft:qe,de=A?r:ee(e);return wt(de||e,function(te,ge){de&&(ge=te,te=e[ge]),sr(g,ge,jt(te,t,n,ge,e,c))}),g}function ku(e){var t=qe(e);return function(n){return Oo(n,e,t)}}function Oo(e,t,n){var s=n.length;if(e==null)return!s;for(e=je(e);s--;){var o=n[s],c=t[o],g=e[o];if(g===r&&!(o in e)||!c(g))return!1}return!0}function To(e,t,n){if(typeof e!="function")throw new St(p);return dr(function(){e.apply(r,n)},t)}function ir(e,t,n,s){var o=-1,c=Cr,g=!0,m=e.length,y=[],E=t.length;if(!m)return y;n&&(t=Le(t,pt(n))),s?(c=Ls,g=!1):t.length>=d&&(c=Xn,g=!1,t=new vn(t));e:for(;++o<m;){var A=e[o],M=n==null?A:n(A);if(A=s||A!==0?A:0,g&&M===M){for(var $=E;$--;)if(t[$]===M)continue e;y.push(A)}else c(t,M,s)||y.push(A)}return y}var rn=aa(Rt),Po=aa(Js,!0);function Eu(e,t){var n=!0;return rn(e,function(s,o,c){return n=!!t(s,o,c),n}),n}function Gr(e,t,n){for(var s=-1,o=e.length;++s<o;){var c=e[s],g=t(c);if(g!=null&&(m===r?g===g&&!xt(g):n(g,m)))var m=g,y=c}return y}function Au(e,t,n,s){var o=e.length;for(n=ue(n),n<0&&(n=-n>o?0:o+n),s=s===r||s>o?o:ue(s),s<0&&(s+=o),s=n>s?0:Xa(s);n<s;)e[n++]=t;return e}function Ro(e,t){var n=[];return rn(e,function(s,o,c){t(s,o,c)&&n.push(s)}),n}function Ze(e,t,n,s,o){var c=-1,g=e.length;for(n||(n=xd),o||(o=[]);++c<g;){var m=e[c];t>0&&n(m)?t>1?Ze(m,t-1,n,s,o):en(o,m):s||(o[o.length]=m)}return o}var qs=la(),Do=la(!0);function Rt(e,t){return e&&qs(e,t,qe)}function Js(e,t){return e&&Do(e,t,qe)}function Hr(e,t){return Qt(t,function(n){return Kt(e[n])})}function bn(e,t){t=on(t,e);for(var n=0,s=t.length;e!=null&&n<s;)e=e[Wt(t[n++])];return n&&n==s?e:r}function Wo(e,t,n){var s=t(e);return oe(e)?s:en(s,n(e))}function it(e){return e==null?e===r?Je:Z:mn&&mn in je(e)?dd(e):Nd(e)}function Ys(e,t){return e>t}function Iu(e,t){return e!=null&&Se.call(e,t)}function Mu(e,t){return e!=null&&t in je(e)}function Lu(e,t,n){return e>=Qe(t,n)&&e<He(t,n)}function Zs(e,t,n){for(var s=n?Ls:Cr,o=e[0].length,c=e.length,g=c,m=w(c),y=1/0,E=[];g--;){var A=e[g];g&&t&&(A=Le(A,pt(t))),y=Qe(A.length,y),m[g]=!n&&(t||o>=120&&A.length>=120)?new vn(g&&A):r}A=e[0];var M=-1,$=m[0];e:for(;++M<o&&E.length<y;){var Y=A[M],ee=t?t(Y):Y;if(Y=n||Y!==0?Y:0,!($?Xn($,ee):s(E,ee,n))){for(g=c;--g;){var de=m[g];if(!(de?Xn(de,ee):s(e[g],ee,n)))continue e}$&&$.push(ee),E.push(Y)}}return E}function Ou(e,t,n,s){return Rt(e,function(o,c,g){t(s,n(o),c,g)}),s}function or(e,t,n){t=on(t,e),e=ja(e,t);var s=e==null?e:e[Wt(kt(t))];return s==null?r:gt(s,e,n)}function $o(e){return We(e)&&it(e)==Ee}function Tu(e){return We(e)&&it(e)==un}function Pu(e){return We(e)&&it(e)==lt}function ar(e,t,n,s,o){return e===t?!0:e==null||t==null||!We(e)&&!We(t)?e!==e&&t!==t:Ru(e,t,n,s,ar,o)}function Ru(e,t,n,s,o,c){var g=oe(e),m=oe(t),y=g?ze:et(e),E=m?ze:et(t);y=y==Ee?se:y,E=E==Ee?se:E;var A=y==se,M=E==se,$=y==E;if($&&ln(e)){if(!ln(t))return!1;g=!0,A=!1}if($&&!A)return c||(c=new Mt),g||Bn(e)?va(e,t,n,s,o,c):cd(e,t,y,n,s,o,c);if(!(n&T)){var Y=A&&Se.call(e,"__wrapped__"),ee=M&&Se.call(t,"__wrapped__");if(Y||ee){var de=Y?e.value():e,te=ee?t.value():t;return c||(c=new Mt),o(de,te,n,s,c)}}return $?(c||(c=new Mt),ud(e,t,n,s,o,c)):!1}function Du(e){return We(e)&&et(e)==Ke}function Vs(e,t,n,s){var o=n.length,c=o,g=!s;if(e==null)return!c;for(e=je(e);o--;){var m=n[o];if(g&&m[2]?m[1]!==e[m[0]]:!(m[0]in e))return!1}for(;++o<c;){m=n[o];var y=m[0],E=e[y],A=m[1];if(g&&m[2]){if(E===r&&!(y in e))return!1}else{var M=new Mt;if(s)var $=s(E,A,y,e,t,M);if(!($===r?ar(A,E,T|G,s,M):$))return!1}}return!0}function Bo(e){if(!Re(e)||yd(e))return!1;var t=Kt(e)?Dc:Ne;return t.test(wn(e))}function Wu(e){return We(e)&&it(e)==ct}function $u(e){return We(e)&&et(e)==we}function Bu(e){return We(e)&&ls(e.length)&&!!Ae[it(e)]}function Fo(e){return typeof e=="function"?e:e==null?ht:typeof e=="object"?oe(e)?Go(e[0],e[1]):Uo(e):cl(e)}function Xs(e){if(!ur(e))return Uc(e);var t=[];for(var n in je(e))Se.call(e,n)&&n!="constructor"&&t.push(n);return t}function Fu(e){if(!Re(e))return Sd(e);var t=ur(e),n=[];for(var s in e)s=="constructor"&&(t||!Se.call(e,s))||n.push(s);return n}function Qs(e,t){return e<t}function zo(e,t){var n=-1,s=dt(e)?w(e.length):[];return rn(e,function(o,c,g){s[++n]=t(o,c,g)}),s}function Uo(e){var t=gi(e);return t.length==1&&t[0][2]?Sa(t[0][0],t[0][1]):function(n){return n===e||Vs(n,e,t)}}function Go(e,t){return mi(e)&&wa(t)?Sa(Wt(e),t):function(n){var s=Ci(n,e);return s===r&&s===t?ki(n,e):ar(t,s,T|G)}}function Kr(e,t,n,s,o){e!==t&&qs(t,function(c,g){if(o||(o=new Mt),Re(c))zu(e,t,g,n,Kr,s,o);else{var m=s?s(vi(e,g),c,g+"",e,t,o):r;m===r&&(m=c),Hs(e,g,m)}},ft)}function zu(e,t,n,s,o,c,g){var m=vi(e,n),y=vi(t,n),E=g.get(y);if(E){Hs(e,n,E);return}var A=c?c(m,y,n+"",e,t,g):r,M=A===r;if(M){var $=oe(y),Y=!$&&ln(y),ee=!$&&!Y&&Bn(y);A=y,$||Y||ee?oe(m)?A=m:Be(m)?A=ut(m):Y?(M=!1,A=na(y,!0)):ee?(M=!1,A=ra(y,!0)):A=[]:fr(y)||Sn(y)?(A=m,Sn(m)?A=Qa(m):(!Re(m)||Kt(m))&&(A=_a(y))):M=!1}M&&(g.set(y,A),o(A,y,s,c,g),g.delete(y)),Hs(e,n,A)}function Ho(e,t){var n=e.length;if(n)return t+=t<0?n:0,Ht(t,n)?e[t]:r}function Ko(e,t,n){t.length?t=Le(t,function(c){return oe(c)?function(g){return bn(g,c.length===1?c[0]:c)}:c}):t=[ht];var s=-1;t=Le(t,pt(X()));var o=zo(e,function(c,g,m){var y=Le(t,function(E){return E(c)});return{criteria:y,index:++s,value:c}});return pc(o,function(c,g){return td(c,g,n)})}function Uu(e,t){return qo(e,t,function(n,s){return ki(e,s)})}function qo(e,t,n){for(var s=-1,o=t.length,c={};++s<o;){var g=t[s],m=bn(e,g);n(m,g)&&lr(c,on(g,e),m)}return c}function Gu(e){return function(t){return bn(t,e)}}function ei(e,t,n,s){var o=s?gc:An,c=-1,g=t.length,m=e;for(e===t&&(t=ut(t)),n&&(m=Le(e,pt(n)));++c<g;)for(var y=0,E=t[c],A=n?n(E):E;(y=o(m,A,y,s))>-1;)m!==e&&Rr.call(m,y,1),Rr.call(e,y,1);return e}function Jo(e,t){for(var n=e?t.length:0,s=n-1;n--;){var o=t[n];if(n==s||o!==c){var c=o;Ht(o)?Rr.call(e,o,1):si(e,o)}}return e}function ti(e,t){return e+$r(Eo()*(t-e+1))}function Hu(e,t,n,s){for(var o=-1,c=He(Wr((t-e)/(n||1)),0),g=w(c);c--;)g[s?c:++o]=e,e+=n;return g}function ni(e,t){var n="";if(!e||t<1||t>K)return n;do t%2&&(n+=e),t=$r(t/2),t&&(e+=e);while(t);return n}function fe(e,t){return yi(Na(e,t,ht),e+"")}function Ku(e){return Mo(Fn(e))}function qu(e,t){var n=Fn(e);return ns(n,yn(t,0,n.length))}function lr(e,t,n,s){if(!Re(e))return e;t=on(t,e);for(var o=-1,c=t.length,g=c-1,m=e;m!=null&&++o<c;){var y=Wt(t[o]),E=n;if(y==="__proto__"||y==="constructor"||y==="prototype")return e;if(o!=g){var A=m[y];E=s?s(A,y,m):r,E===r&&(E=Re(A)?A:Ht(t[o+1])?[]:{})}sr(m,y,E),m=m[y]}return e}var Yo=Br?function(e,t){return Br.set(e,t),e}:ht,Ju=Dr?function(e,t){return Dr(e,"toString",{configurable:!0,enumerable:!1,value:Ai(t),writable:!0})}:ht;function Yu(e){return ns(Fn(e))}function Ct(e,t,n){var s=-1,o=e.length;t<0&&(t=-t>o?0:o+t),n=n>o?o:n,n<0&&(n+=o),o=t>n?0:n-t>>>0,t>>>=0;for(var c=w(o);++s<o;)c[s]=e[s+t];return c}function Zu(e,t){var n;return rn(e,function(s,o,c){return n=t(s,o,c),!n}),!!n}function qr(e,t,n){var s=0,o=e==null?s:e.length;if(typeof t=="number"&&t===t&&o<=Oe){for(;s<o;){var c=s+o>>>1,g=e[c];g!==null&&!xt(g)&&(n?g<=t:g<t)?s=c+1:o=c}return o}return ri(e,t,ht,n)}function ri(e,t,n,s){var o=0,c=e==null?0:e.length;if(c===0)return 0;t=n(t);for(var g=t!==t,m=t===null,y=xt(t),E=t===r;o<c;){var A=$r((o+c)/2),M=n(e[A]),$=M!==r,Y=M===null,ee=M===M,de=xt(M);if(g)var te=s||ee;else E?te=ee&&(s||$):m?te=ee&&$&&(s||!Y):y?te=ee&&$&&!Y&&(s||!de):Y||de?te=!1:te=s?M<=t:M<t;te?o=A+1:c=A}return Qe(c,ve)}function Zo(e,t){for(var n=-1,s=e.length,o=0,c=[];++n<s;){var g=e[n],m=t?t(g):g;if(!n||!Lt(m,y)){var y=m;c[o++]=g===0?0:g}}return c}function Vo(e){return typeof e=="number"?e:xt(e)?J:+e}function mt(e){if(typeof e=="string")return e;if(oe(e))return Le(e,mt)+"";if(xt(e))return Ao?Ao.call(e):"";var t=e+"";return t=="0"&&1/e==-he?"-0":t}function sn(e,t,n){var s=-1,o=Cr,c=e.length,g=!0,m=[],y=m;if(n)g=!1,o=Ls;else if(c>=d){var E=t?null:ad(e);if(E)return Er(E);g=!1,o=Xn,y=new vn}else y=t?[]:m;e:for(;++s<c;){var A=e[s],M=t?t(A):A;if(A=n||A!==0?A:0,g&&M===M){for(var $=y.length;$--;)if(y[$]===M)continue e;t&&y.push(M),m.push(A)}else o(y,M,n)||(y!==m&&y.push(M),m.push(A))}return m}function si(e,t){return t=on(t,e),e=ja(e,t),e==null||delete e[Wt(kt(t))]}function Xo(e,t,n,s){return lr(e,t,n(bn(e,t)),s)}function Jr(e,t,n,s){for(var o=e.length,c=s?o:-1;(s?c--:++c<o)&&t(e[c],c,e););return n?Ct(e,s?0:c,s?c+1:o):Ct(e,s?c+1:0,s?o:c)}function Qo(e,t){var n=e;return n instanceof me&&(n=n.value()),Os(t,function(s,o){return o.func.apply(o.thisArg,en([s],o.args))},n)}function ii(e,t,n){var s=e.length;if(s<2)return s?sn(e[0]):[];for(var o=-1,c=w(s);++o<s;)for(var g=e[o],m=-1;++m<s;)m!=o&&(c[o]=ir(c[o]||g,e[m],t,n));return sn(Ze(c,1),t,n)}function ea(e,t,n){for(var s=-1,o=e.length,c=t.length,g={};++s<o;){var m=s<c?t[s]:r;n(g,e[s],m)}return g}function oi(e){return Be(e)?e:[]}function ai(e){return typeof e=="function"?e:ht}function on(e,t){return oe(e)?e:mi(e,t)?[e]:Aa(_e(e))}var Vu=fe;function an(e,t,n){var s=e.length;return n=n===r?s:n,!t&&n>=s?e:Ct(e,t,n)}var ta=Wc||function(e){return Ye.clearTimeout(e)};function na(e,t){if(t)return e.slice();var n=e.length,s=So?So(n):new e.constructor(n);return e.copy(s),s}function li(e){var t=new e.constructor(e.byteLength);return new Tr(t).set(new Tr(e)),t}function Xu(e,t){var n=t?li(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}function Qu(e){var t=new e.constructor(e.source,gn.exec(e));return t.lastIndex=e.lastIndex,t}function ed(e){return rr?je(rr.call(e)):{}}function ra(e,t){var n=t?li(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function sa(e,t){if(e!==t){var n=e!==r,s=e===null,o=e===e,c=xt(e),g=t!==r,m=t===null,y=t===t,E=xt(t);if(!m&&!E&&!c&&e>t||c&&g&&y&&!m&&!E||s&&g&&y||!n&&y||!o)return 1;if(!s&&!c&&!E&&e<t||E&&n&&o&&!s&&!c||m&&n&&o||!g&&o||!y)return-1}return 0}function td(e,t,n){for(var s=-1,o=e.criteria,c=t.criteria,g=o.length,m=n.length;++s<g;){var y=sa(o[s],c[s]);if(y){if(s>=m)return y;var E=n[s];return y*(E=="desc"?-1:1)}}return e.index-t.index}function ia(e,t,n,s){for(var o=-1,c=e.length,g=n.length,m=-1,y=t.length,E=He(c-g,0),A=w(y+E),M=!s;++m<y;)A[m]=t[m];for(;++o<g;)(M||o<c)&&(A[n[o]]=e[o]);for(;E--;)A[m++]=e[o++];return A}function oa(e,t,n,s){for(var o=-1,c=e.length,g=-1,m=n.length,y=-1,E=t.length,A=He(c-m,0),M=w(A+E),$=!s;++o<A;)M[o]=e[o];for(var Y=o;++y<E;)M[Y+y]=t[y];for(;++g<m;)($||o<c)&&(M[Y+n[g]]=e[o++]);return M}function ut(e,t){var n=-1,s=e.length;for(t||(t=w(s));++n<s;)t[n]=e[n];return t}function Dt(e,t,n,s){var o=!n;n||(n={});for(var c=-1,g=t.length;++c<g;){var m=t[c],y=s?s(n[m],e[m],m,n,e):r;y===r&&(y=e[m]),o?zt(n,m,y):sr(n,m,y)}return n}function nd(e,t){return Dt(e,pi(e),t)}function rd(e,t){return Dt(e,ya(e),t)}function Yr(e,t){return function(n,s){var o=oe(n)?lc:ju,c=t?t():{};return o(n,e,X(s,2),c)}}function Dn(e){return fe(function(t,n){var s=-1,o=n.length,c=o>1?n[o-1]:r,g=o>2?n[2]:r;for(c=e.length>3&&typeof c=="function"?(o--,c):r,g&&ot(n[0],n[1],g)&&(c=o<3?r:c,o=1),t=je(t);++s<o;){var m=n[s];m&&e(t,m,s,c)}return t})}function aa(e,t){return function(n,s){if(n==null)return n;if(!dt(n))return e(n,s);for(var o=n.length,c=t?o:-1,g=je(n);(t?c--:++c<o)&&s(g[c],c,g)!==!1;);return n}}function la(e){return function(t,n,s){for(var o=-1,c=je(t),g=s(t),m=g.length;m--;){var y=g[e?m:++o];if(n(c[y],y,c)===!1)break}return t}}function sd(e,t,n){var s=t&q,o=cr(e);function c(){var g=this&&this!==Ye&&this instanceof c?o:e;return g.apply(s?n:this,arguments)}return c}function ca(e){return function(t){t=_e(t);var n=In(t)?It(t):r,s=n?n[0]:t.charAt(0),o=n?an(n,1).join(""):t.slice(1);return s[e]()+o}}function Wn(e){return function(t){return Os(al(ol(t).replace(Jl,"")),e,"")}}function cr(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=Rn(e.prototype),s=e.apply(n,t);return Re(s)?s:n}}function id(e,t,n){var s=cr(e);function o(){for(var c=arguments.length,g=w(c),m=c,y=$n(o);m--;)g[m]=arguments[m];var E=c<3&&g[0]!==y&&g[c-1]!==y?[]:tn(g,y);if(c-=E.length,c<n)return ga(e,t,Zr,o.placeholder,r,g,E,r,r,n-c);var A=this&&this!==Ye&&this instanceof o?s:e;return gt(A,this,g)}return o}function ua(e){return function(t,n,s){var o=je(t);if(!dt(t)){var c=X(n,3);t=qe(t),n=function(m){return c(o[m],m,o)}}var g=e(t,n,s);return g>-1?o[c?t[g]:g]:r}}function da(e){return Gt(function(t){var n=t.length,s=n,o=Nt.prototype.thru;for(e&&t.reverse();s--;){var c=t[s];if(typeof c!="function")throw new St(p);if(o&&!g&&es(c)=="wrapper")var g=new Nt([],!0)}for(s=g?s:n;++s<n;){c=t[s];var m=es(c),y=m=="wrapper"?hi(c):r;y&&xi(y[0])&&y[1]==(Q|F|L|Ce)&&!y[4].length&&y[9]==1?g=g[es(y[0])].apply(g,y[3]):g=c.length==1&&xi(c)?g[m]():g.thru(c)}return function(){var E=arguments,A=E[0];if(g&&E.length==1&&oe(A))return g.plant(A).value();for(var M=0,$=n?t[M].apply(this,E):A;++M<n;)$=t[M].call(this,$);return $}})}function Zr(e,t,n,s,o,c,g,m,y,E){var A=t&Q,M=t&q,$=t&B,Y=t&(F|j),ee=t&U,de=$?r:cr(e);function te(){for(var ge=arguments.length,xe=w(ge),vt=ge;vt--;)xe[vt]=arguments[vt];if(Y)var at=$n(te),yt=xc(xe,at);if(s&&(xe=ia(xe,s,o,Y)),c&&(xe=oa(xe,c,g,Y)),ge-=yt,Y&&ge<E){var Fe=tn(xe,at);return ga(e,t,Zr,te.placeholder,n,xe,Fe,m,y,E-ge)}var Ot=M?n:this,Jt=$?Ot[e]:e;return ge=xe.length,m?xe=jd(xe,m):ee&&ge>1&&xe.reverse(),A&&y<ge&&(xe.length=y),this&&this!==Ye&&this instanceof te&&(Jt=de||cr(Jt)),Jt.apply(Ot,xe)}return te}function fa(e,t){return function(n,s){return Ou(n,e,t(s),{})}}function Vr(e,t){return function(n,s){var o;if(n===r&&s===r)return t;if(n!==r&&(o=n),s!==r){if(o===r)return s;typeof n=="string"||typeof s=="string"?(n=mt(n),s=mt(s)):(n=Vo(n),s=Vo(s)),o=e(n,s)}return o}}function ci(e){return Gt(function(t){return t=Le(t,pt(X())),fe(function(n){var s=this;return e(t,function(o){return gt(o,s,n)})})})}function Xr(e,t){t=t===r?" ":mt(t);var n=t.length;if(n<2)return n?ni(t,e):t;var s=ni(t,Wr(e/Mn(t)));return In(t)?an(It(s),0,e).join(""):s.slice(0,e)}function od(e,t,n,s){var o=t&q,c=cr(e);function g(){for(var m=-1,y=arguments.length,E=-1,A=s.length,M=w(A+y),$=this&&this!==Ye&&this instanceof g?c:e;++E<A;)M[E]=s[E];for(;y--;)M[E++]=arguments[++m];return gt($,o?n:this,M)}return g}function ha(e){return function(t,n,s){return s&&typeof s!="number"&&ot(t,n,s)&&(n=s=r),t=qt(t),n===r?(n=t,t=0):n=qt(n),s=s===r?t<n?1:-1:qt(s),Hu(t,n,s,e)}}function Qr(e){return function(t,n){return typeof t=="string"&&typeof n=="string"||(t=Et(t),n=Et(n)),e(t,n)}}function ga(e,t,n,s,o,c,g,m,y,E){var A=t&F,M=A?g:r,$=A?r:g,Y=A?c:r,ee=A?r:c;t|=A?L:z,t&=~(A?z:L),t&D||(t&=-4);var de=[e,t,o,Y,M,ee,$,m,y,E],te=n.apply(r,de);return xi(e)&&Ca(te,de),te.placeholder=s,ka(te,e,t)}function ui(e){var t=Ge[e];return function(n,s){if(n=Et(n),s=s==null?0:Qe(ue(s),292),s&&ko(n)){var o=(_e(n)+"e").split("e"),c=t(o[0]+"e"+(+o[1]+s));return o=(_e(c)+"e").split("e"),+(o[0]+"e"+(+o[1]-s))}return t(n)}}var ad=Tn&&1/Er(new Tn([,-0]))[1]==he?function(e){return new Tn(e)}:Li;function pa(e){return function(t){var n=et(t);return n==Ke?Bs(t):n==we?Nc(t):mc(t,e(t))}}function Ut(e,t,n,s,o,c,g,m){var y=t&B;if(!y&&typeof e!="function")throw new St(p);var E=s?s.length:0;if(E||(t&=-97,s=o=r),g=g===r?g:He(ue(g),0),m=m===r?m:ue(m),E-=o?o.length:0,t&z){var A=s,M=o;s=o=r}var $=y?r:hi(e),Y=[e,t,n,s,o,A,M,c,g,m];if($&&wd(Y,$),e=Y[0],t=Y[1],n=Y[2],s=Y[3],o=Y[4],m=Y[9]=Y[9]===r?y?0:e.length:He(Y[9]-E,0),!m&&t&(F|j)&&(t&=-25),!t||t==q)var ee=sd(e,t,n);else t==F||t==j?ee=id(e,t,m):(t==L||t==(q|L))&&!o.length?ee=od(e,t,n,s):ee=Zr.apply(r,Y);var de=$?Yo:Ca;return ka(de(ee,Y),e,t)}function ma(e,t,n,s){return e===r||Lt(e,On[n])&&!Se.call(s,n)?t:e}function xa(e,t,n,s,o,c){return Re(e)&&Re(t)&&(c.set(t,e),Kr(e,t,r,xa,c),c.delete(t)),e}function ld(e){return fr(e)?r:e}function va(e,t,n,s,o,c){var g=n&T,m=e.length,y=t.length;if(m!=y&&!(g&&y>m))return!1;var E=c.get(e),A=c.get(t);if(E&&A)return E==t&&A==e;var M=-1,$=!0,Y=n&G?new vn:r;for(c.set(e,t),c.set(t,e);++M<m;){var ee=e[M],de=t[M];if(s)var te=g?s(de,ee,M,t,e,c):s(ee,de,M,e,t,c);if(te!==r){if(te)continue;$=!1;break}if(Y){if(!Ts(t,function(ge,xe){if(!Xn(Y,xe)&&(ee===ge||o(ee,ge,n,s,c)))return Y.push(xe)})){$=!1;break}}else if(!(ee===de||o(ee,de,n,s,c))){$=!1;break}}return c.delete(e),c.delete(t),$}function cd(e,t,n,s,o,c,g){switch(n){case $t:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case un:return!(e.byteLength!=t.byteLength||!c(new Tr(e),new Tr(t)));case Ve:case lt:case rt:return Lt(+e,+t);case bt:return e.name==t.name&&e.message==t.message;case ct:case Te:return e==t+"";case Ke:var m=Bs;case we:var y=s&T;if(m||(m=Er),e.size!=t.size&&!y)return!1;var E=g.get(e);if(E)return E==t;s|=G,g.set(e,t);var A=va(m(e),m(t),s,o,c,g);return g.delete(e),A;case Pe:if(rr)return rr.call(e)==rr.call(t)}return!1}function ud(e,t,n,s,o,c){var g=n&T,m=di(e),y=m.length,E=di(t),A=E.length;if(y!=A&&!g)return!1;for(var M=y;M--;){var $=m[M];if(!(g?$ in t:Se.call(t,$)))return!1}var Y=c.get(e),ee=c.get(t);if(Y&&ee)return Y==t&&ee==e;var de=!0;c.set(e,t),c.set(t,e);for(var te=g;++M<y;){$=m[M];var ge=e[$],xe=t[$];if(s)var vt=g?s(xe,ge,$,t,e,c):s(ge,xe,$,e,t,c);if(!(vt===r?ge===xe||o(ge,xe,n,s,c):vt)){de=!1;break}te||(te=$=="constructor")}if(de&&!te){var at=e.constructor,yt=t.constructor;at!=yt&&"constructor"in e&&"constructor"in t&&!(typeof at=="function"&&at instanceof at&&typeof yt=="function"&&yt instanceof yt)&&(de=!1)}return c.delete(e),c.delete(t),de}function Gt(e){return yi(Na(e,r,Oa),e+"")}function di(e){return Wo(e,qe,pi)}function fi(e){return Wo(e,ft,ya)}var hi=Br?function(e){return Br.get(e)}:Li;function es(e){for(var t=e.name+"",n=Pn[t],s=Se.call(Pn,t)?n.length:0;s--;){var o=n[s],c=o.func;if(c==null||c==e)return o.name}return t}function $n(e){var t=Se.call(l,"placeholder")?l:e;return t.placeholder}function X(){var e=l.iteratee||Ii;return e=e===Ii?Fo:e,arguments.length?e(arguments[0],arguments[1]):e}function ts(e,t){var n=e.__data__;return vd(t)?n[typeof t=="string"?"string":"hash"]:n.map}function gi(e){for(var t=qe(e),n=t.length;n--;){var s=t[n],o=e[s];t[n]=[s,o,wa(o)]}return t}function _n(e,t){var n=_c(e,t);return Bo(n)?n:r}function dd(e){var t=Se.call(e,mn),n=e[mn];try{e[mn]=r;var s=!0}catch{}var o=Lr.call(e);return s&&(t?e[mn]=n:delete e[mn]),o}var pi=zs?function(e){return e==null?[]:(e=je(e),Qt(zs(e),function(t){return jo.call(e,t)}))}:Oi,ya=zs?function(e){for(var t=[];e;)en(t,pi(e)),e=Pr(e);return t}:Oi,et=it;(Us&&et(new Us(new ArrayBuffer(1)))!=$t||er&&et(new er)!=Ke||Gs&&et(Gs.resolve())!=Me||Tn&&et(new Tn)!=we||tr&&et(new tr)!=st)&&(et=function(e){var t=it(e),n=t==se?e.constructor:r,s=n?wn(n):"";if(s)switch(s){case qc:return $t;case Jc:return Ke;case Yc:return Me;case Zc:return we;case Vc:return st}return t});function fd(e,t,n){for(var s=-1,o=n.length;++s<o;){var c=n[s],g=c.size;switch(c.type){case"drop":e+=g;break;case"dropRight":t-=g;break;case"take":t=Qe(t,e+g);break;case"takeRight":e=He(e,t-g);break}}return{start:e,end:t}}function hd(e){var t=e.match(Ss);return t?t[1].split(_r):[]}function ba(e,t,n){t=on(t,e);for(var s=-1,o=t.length,c=!1;++s<o;){var g=Wt(t[s]);if(!(c=e!=null&&n(e,g)))break;e=e[g]}return c||++s!=o?c:(o=e==null?0:e.length,!!o&&ls(o)&&Ht(g,o)&&(oe(e)||Sn(e)))}function gd(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&Se.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function _a(e){return typeof e.constructor=="function"&&!ur(e)?Rn(Pr(e)):{}}function pd(e,t,n){var s=e.constructor;switch(t){case un:return li(e);case Ve:case lt:return new s(+e);case $t:return Xu(e,n);case dn:case fn:case jn:case Cn:case Gn:case Yt:case Hn:case Kn:case qn:return ra(e,n);case Ke:return new s;case rt:case Te:return new s(e);case ct:return Qu(e);case we:return new s;case Pe:return ed(e)}}function md(e,t){var n=t.length;if(!n)return e;var s=n-1;return t[s]=(n>1?"& ":"")+t[s],t=t.join(n>2?", ":" "),e.replace(Vn,`{
/* [wrapped with `+t+`] */
`)}function xd(e){return oe(e)||Sn(e)||!!(Co&&e&&e[Co])}function Ht(e,t){var n=typeof e;return t=t??K,!!t&&(n=="number"||n!="symbol"&&Xt.test(e))&&e>-1&&e%1==0&&e<t}function ot(e,t,n){if(!Re(n))return!1;var s=typeof t;return(s=="number"?dt(n)&&Ht(t,n.length):s=="string"&&t in n)?Lt(n[t],e):!1}function mi(e,t){if(oe(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||xt(e)?!0:_s.test(e)||!bs.test(e)||t!=null&&e in je(t)}function vd(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function xi(e){var t=es(e),n=l[t];if(typeof n!="function"||!(t in me.prototype))return!1;if(e===n)return!0;var s=hi(n);return!!s&&e===s[0]}function yd(e){return!!wo&&wo in e}var bd=Ir?Kt:Ti;function ur(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||On;return e===n}function wa(e){return e===e&&!Re(e)}function Sa(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==r||e in je(n))}}function _d(e){var t=os(e,function(s){return n.size===N&&n.clear(),s}),n=t.cache;return t}function wd(e,t){var n=e[1],s=t[1],o=n|s,c=o<(q|B|Q),g=s==Q&&n==F||s==Q&&n==Ce&&e[7].length<=t[8]||s==(Q|Ce)&&t[7].length<=t[8]&&n==F;if(!(c||g))return e;s&q&&(e[2]=t[2],o|=n&q?0:D);var m=t[3];if(m){var y=e[3];e[3]=y?ia(y,m,t[4]):m,e[4]=y?tn(e[3],S):t[4]}return m=t[5],m&&(y=e[5],e[5]=y?oa(y,m,t[6]):m,e[6]=y?tn(e[5],S):t[6]),m=t[7],m&&(e[7]=m),s&Q&&(e[8]=e[8]==null?t[8]:Qe(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=o,e}function Sd(e){var t=[];if(e!=null)for(var n in je(e))t.push(n);return t}function Nd(e){return Lr.call(e)}function Na(e,t,n){return t=He(t===r?e.length-1:t,0),function(){for(var s=arguments,o=-1,c=He(s.length-t,0),g=w(c);++o<c;)g[o]=s[t+o];o=-1;for(var m=w(t+1);++o<t;)m[o]=s[o];return m[t]=n(g),gt(e,this,m)}}function ja(e,t){return t.length<2?e:bn(e,Ct(t,0,-1))}function jd(e,t){for(var n=e.length,s=Qe(t.length,n),o=ut(e);s--;){var c=t[s];e[s]=Ht(c,n)?o[c]:r}return e}function vi(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var Ca=Ea(Yo),dr=Bc||function(e,t){return Ye.setTimeout(e,t)},yi=Ea(Ju);function ka(e,t,n){var s=t+"";return yi(e,md(s,Cd(hd(s),n)))}function Ea(e){var t=0,n=0;return function(){var s=Gc(),o=ye-(s-n);if(n=s,o>0){if(++t>=R)return arguments[0]}else t=0;return e.apply(r,arguments)}}function ns(e,t){var n=-1,s=e.length,o=s-1;for(t=t===r?s:t;++n<t;){var c=ti(n,o),g=e[c];e[c]=e[n],e[n]=g}return e.length=t,e}var Aa=_d(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Zt,function(n,s,o,c){t.push(o?c.replace(Ns,"$1"):s||n)}),t});function Wt(e){if(typeof e=="string"||xt(e))return e;var t=e+"";return t=="0"&&1/e==-he?"-0":t}function wn(e){if(e!=null){try{return Mr.call(e)}catch{}try{return e+""}catch{}}return""}function Cd(e,t){return wt(Ie,function(n){var s="_."+n[0];t&n[1]&&!Cr(e,s)&&e.push(s)}),e.sort()}function Ia(e){if(e instanceof me)return e.clone();var t=new Nt(e.__wrapped__,e.__chain__);return t.__actions__=ut(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function kd(e,t,n){(n?ot(e,t,n):t===r)?t=1:t=He(ue(t),0);var s=e==null?0:e.length;if(!s||t<1)return[];for(var o=0,c=0,g=w(Wr(s/t));o<s;)g[c++]=Ct(e,o,o+=t);return g}function Ed(e){for(var t=-1,n=e==null?0:e.length,s=0,o=[];++t<n;){var c=e[t];c&&(o[s++]=c)}return o}function Ad(){var e=arguments.length;if(!e)return[];for(var t=w(e-1),n=arguments[0],s=e;s--;)t[s-1]=arguments[s];return en(oe(n)?ut(n):[n],Ze(t,1))}var Id=fe(function(e,t){return Be(e)?ir(e,Ze(t,1,Be,!0)):[]}),Md=fe(function(e,t){var n=kt(t);return Be(n)&&(n=r),Be(e)?ir(e,Ze(t,1,Be,!0),X(n,2)):[]}),Ld=fe(function(e,t){var n=kt(t);return Be(n)&&(n=r),Be(e)?ir(e,Ze(t,1,Be,!0),r,n):[]});function Od(e,t,n){var s=e==null?0:e.length;return s?(t=n||t===r?1:ue(t),Ct(e,t<0?0:t,s)):[]}function Td(e,t,n){var s=e==null?0:e.length;return s?(t=n||t===r?1:ue(t),t=s-t,Ct(e,0,t<0?0:t)):[]}function Pd(e,t){return e&&e.length?Jr(e,X(t,3),!0,!0):[]}function Rd(e,t){return e&&e.length?Jr(e,X(t,3),!0):[]}function Dd(e,t,n,s){var o=e==null?0:e.length;return o?(n&&typeof n!="number"&&ot(e,t,n)&&(n=0,s=o),Au(e,t,n,s)):[]}function Ma(e,t,n){var s=e==null?0:e.length;if(!s)return-1;var o=n==null?0:ue(n);return o<0&&(o=He(s+o,0)),kr(e,X(t,3),o)}function La(e,t,n){var s=e==null?0:e.length;if(!s)return-1;var o=s-1;return n!==r&&(o=ue(n),o=n<0?He(s+o,0):Qe(o,s-1)),kr(e,X(t,3),o,!0)}function Oa(e){var t=e==null?0:e.length;return t?Ze(e,1):[]}function Wd(e){var t=e==null?0:e.length;return t?Ze(e,he):[]}function $d(e,t){var n=e==null?0:e.length;return n?(t=t===r?1:ue(t),Ze(e,t)):[]}function Bd(e){for(var t=-1,n=e==null?0:e.length,s={};++t<n;){var o=e[t];s[o[0]]=o[1]}return s}function Ta(e){return e&&e.length?e[0]:r}function Fd(e,t,n){var s=e==null?0:e.length;if(!s)return-1;var o=n==null?0:ue(n);return o<0&&(o=He(s+o,0)),An(e,t,o)}function zd(e){var t=e==null?0:e.length;return t?Ct(e,0,-1):[]}var Ud=fe(function(e){var t=Le(e,oi);return t.length&&t[0]===e[0]?Zs(t):[]}),Gd=fe(function(e){var t=kt(e),n=Le(e,oi);return t===kt(n)?t=r:n.pop(),n.length&&n[0]===e[0]?Zs(n,X(t,2)):[]}),Hd=fe(function(e){var t=kt(e),n=Le(e,oi);return t=typeof t=="function"?t:r,t&&n.pop(),n.length&&n[0]===e[0]?Zs(n,r,t):[]});function Kd(e,t){return e==null?"":zc.call(e,t)}function kt(e){var t=e==null?0:e.length;return t?e[t-1]:r}function qd(e,t,n){var s=e==null?0:e.length;if(!s)return-1;var o=s;return n!==r&&(o=ue(n),o=o<0?He(s+o,0):Qe(o,s-1)),t===t?Cc(e,t,o):kr(e,go,o,!0)}function Jd(e,t){return e&&e.length?Ho(e,ue(t)):r}var Yd=fe(Pa);function Pa(e,t){return e&&e.length&&t&&t.length?ei(e,t):e}function Zd(e,t,n){return e&&e.length&&t&&t.length?ei(e,t,X(n,2)):e}function Vd(e,t,n){return e&&e.length&&t&&t.length?ei(e,t,r,n):e}var Xd=Gt(function(e,t){var n=e==null?0:e.length,s=Ks(e,t);return Jo(e,Le(t,function(o){return Ht(o,n)?+o:o}).sort(sa)),s});function Qd(e,t){var n=[];if(!(e&&e.length))return n;var s=-1,o=[],c=e.length;for(t=X(t,3);++s<c;){var g=e[s];t(g,s,e)&&(n.push(g),o.push(s))}return Jo(e,o),n}function bi(e){return e==null?e:Kc.call(e)}function ef(e,t,n){var s=e==null?0:e.length;return s?(n&&typeof n!="number"&&ot(e,t,n)?(t=0,n=s):(t=t==null?0:ue(t),n=n===r?s:ue(n)),Ct(e,t,n)):[]}function tf(e,t){return qr(e,t)}function nf(e,t,n){return ri(e,t,X(n,2))}function rf(e,t){var n=e==null?0:e.length;if(n){var s=qr(e,t);if(s<n&&Lt(e[s],t))return s}return-1}function sf(e,t){return qr(e,t,!0)}function of(e,t,n){return ri(e,t,X(n,2),!0)}function af(e,t){var n=e==null?0:e.length;if(n){var s=qr(e,t,!0)-1;if(Lt(e[s],t))return s}return-1}function lf(e){return e&&e.length?Zo(e):[]}function cf(e,t){return e&&e.length?Zo(e,X(t,2)):[]}function uf(e){var t=e==null?0:e.length;return t?Ct(e,1,t):[]}function df(e,t,n){return e&&e.length?(t=n||t===r?1:ue(t),Ct(e,0,t<0?0:t)):[]}function ff(e,t,n){var s=e==null?0:e.length;return s?(t=n||t===r?1:ue(t),t=s-t,Ct(e,t<0?0:t,s)):[]}function hf(e,t){return e&&e.length?Jr(e,X(t,3),!1,!0):[]}function gf(e,t){return e&&e.length?Jr(e,X(t,3)):[]}var pf=fe(function(e){return sn(Ze(e,1,Be,!0))}),mf=fe(function(e){var t=kt(e);return Be(t)&&(t=r),sn(Ze(e,1,Be,!0),X(t,2))}),xf=fe(function(e){var t=kt(e);return t=typeof t=="function"?t:r,sn(Ze(e,1,Be,!0),r,t)});function vf(e){return e&&e.length?sn(e):[]}function yf(e,t){return e&&e.length?sn(e,X(t,2)):[]}function bf(e,t){return t=typeof t=="function"?t:r,e&&e.length?sn(e,r,t):[]}function _i(e){if(!(e&&e.length))return[];var t=0;return e=Qt(e,function(n){if(Be(n))return t=He(n.length,t),!0}),Ws(t,function(n){return Le(e,Ps(n))})}function Ra(e,t){if(!(e&&e.length))return[];var n=_i(e);return t==null?n:Le(n,function(s){return gt(t,r,s)})}var _f=fe(function(e,t){return Be(e)?ir(e,t):[]}),wf=fe(function(e){return ii(Qt(e,Be))}),Sf=fe(function(e){var t=kt(e);return Be(t)&&(t=r),ii(Qt(e,Be),X(t,2))}),Nf=fe(function(e){var t=kt(e);return t=typeof t=="function"?t:r,ii(Qt(e,Be),r,t)}),jf=fe(_i);function Cf(e,t){return ea(e||[],t||[],sr)}function kf(e,t){return ea(e||[],t||[],lr)}var Ef=fe(function(e){var t=e.length,n=t>1?e[t-1]:r;return n=typeof n=="function"?(e.pop(),n):r,Ra(e,n)});function Da(e){var t=l(e);return t.__chain__=!0,t}function Af(e,t){return t(e),e}function rs(e,t){return t(e)}var If=Gt(function(e){var t=e.length,n=t?e[0]:0,s=this.__wrapped__,o=function(c){return Ks(c,e)};return t>1||this.__actions__.length||!(s instanceof me)||!Ht(n)?this.thru(o):(s=s.slice(n,+n+(t?1:0)),s.__actions__.push({func:rs,args:[o],thisArg:r}),new Nt(s,this.__chain__).thru(function(c){return t&&!c.length&&c.push(r),c}))});function Mf(){return Da(this)}function Lf(){return new Nt(this.value(),this.__chain__)}function Of(){this.__values__===r&&(this.__values__=Va(this.value()));var e=this.__index__>=this.__values__.length,t=e?r:this.__values__[this.__index__++];return{done:e,value:t}}function Tf(){return this}function Pf(e){for(var t,n=this;n instanceof zr;){var s=Ia(n);s.__index__=0,s.__values__=r,t?o.__wrapped__=s:t=s;var o=s;n=n.__wrapped__}return o.__wrapped__=e,t}function Rf(){var e=this.__wrapped__;if(e instanceof me){var t=e;return this.__actions__.length&&(t=new me(this)),t=t.reverse(),t.__actions__.push({func:rs,args:[bi],thisArg:r}),new Nt(t,this.__chain__)}return this.thru(bi)}function Df(){return Qo(this.__wrapped__,this.__actions__)}var Wf=Yr(function(e,t,n){Se.call(e,n)?++e[n]:zt(e,n,1)});function $f(e,t,n){var s=oe(e)?fo:Eu;return n&&ot(e,t,n)&&(t=r),s(e,X(t,3))}function Bf(e,t){var n=oe(e)?Qt:Ro;return n(e,X(t,3))}var Ff=ua(Ma),zf=ua(La);function Uf(e,t){return Ze(ss(e,t),1)}function Gf(e,t){return Ze(ss(e,t),he)}function Hf(e,t,n){return n=n===r?1:ue(n),Ze(ss(e,t),n)}function Wa(e,t){var n=oe(e)?wt:rn;return n(e,X(t,3))}function $a(e,t){var n=oe(e)?cc:Po;return n(e,X(t,3))}var Kf=Yr(function(e,t,n){Se.call(e,n)?e[n].push(t):zt(e,n,[t])});function qf(e,t,n,s){e=dt(e)?e:Fn(e),n=n&&!s?ue(n):0;var o=e.length;return n<0&&(n=He(o+n,0)),cs(e)?n<=o&&e.indexOf(t,n)>-1:!!o&&An(e,t,n)>-1}var Jf=fe(function(e,t,n){var s=-1,o=typeof t=="function",c=dt(e)?w(e.length):[];return rn(e,function(g){c[++s]=o?gt(t,g,n):or(g,t,n)}),c}),Yf=Yr(function(e,t,n){zt(e,n,t)});function ss(e,t){var n=oe(e)?Le:zo;return n(e,X(t,3))}function Zf(e,t,n,s){return e==null?[]:(oe(t)||(t=t==null?[]:[t]),n=s?r:n,oe(n)||(n=n==null?[]:[n]),Ko(e,t,n))}var Vf=Yr(function(e,t,n){e[n?0:1].push(t)},function(){return[[],[]]});function Xf(e,t,n){var s=oe(e)?Os:mo,o=arguments.length<3;return s(e,X(t,4),n,o,rn)}function Qf(e,t,n){var s=oe(e)?uc:mo,o=arguments.length<3;return s(e,X(t,4),n,o,Po)}function eh(e,t){var n=oe(e)?Qt:Ro;return n(e,as(X(t,3)))}function th(e){var t=oe(e)?Mo:Ku;return t(e)}function nh(e,t,n){(n?ot(e,t,n):t===r)?t=1:t=ue(t);var s=oe(e)?Su:qu;return s(e,t)}function rh(e){var t=oe(e)?Nu:Yu;return t(e)}function sh(e){if(e==null)return 0;if(dt(e))return cs(e)?Mn(e):e.length;var t=et(e);return t==Ke||t==we?e.size:Xs(e).length}function ih(e,t,n){var s=oe(e)?Ts:Zu;return n&&ot(e,t,n)&&(t=r),s(e,X(t,3))}var oh=fe(function(e,t){if(e==null)return[];var n=t.length;return n>1&&ot(e,t[0],t[1])?t=[]:n>2&&ot(t[0],t[1],t[2])&&(t=[t[0]]),Ko(e,Ze(t,1),[])}),is=$c||function(){return Ye.Date.now()};function ah(e,t){if(typeof t!="function")throw new St(p);return e=ue(e),function(){if(--e<1)return t.apply(this,arguments)}}function Ba(e,t,n){return t=n?r:t,t=e&&t==null?e.length:t,Ut(e,Q,r,r,r,r,t)}function Fa(e,t){var n;if(typeof t!="function")throw new St(p);return e=ue(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=r),n}}var wi=fe(function(e,t,n){var s=q;if(n.length){var o=tn(n,$n(wi));s|=L}return Ut(e,s,t,n,o)}),za=fe(function(e,t,n){var s=q|B;if(n.length){var o=tn(n,$n(za));s|=L}return Ut(t,s,e,n,o)});function Ua(e,t,n){t=n?r:t;var s=Ut(e,F,r,r,r,r,r,t);return s.placeholder=Ua.placeholder,s}function Ga(e,t,n){t=n?r:t;var s=Ut(e,j,r,r,r,r,r,t);return s.placeholder=Ga.placeholder,s}function Ha(e,t,n){var s,o,c,g,m,y,E=0,A=!1,M=!1,$=!0;if(typeof e!="function")throw new St(p);t=Et(t)||0,Re(n)&&(A=!!n.leading,M="maxWait"in n,c=M?He(Et(n.maxWait)||0,t):c,$="trailing"in n?!!n.trailing:$);function Y(Fe){var Ot=s,Jt=o;return s=o=r,E=Fe,g=e.apply(Jt,Ot),g}function ee(Fe){return E=Fe,m=dr(ge,t),A?Y(Fe):g}function de(Fe){var Ot=Fe-y,Jt=Fe-E,ul=t-Ot;return M?Qe(ul,c-Jt):ul}function te(Fe){var Ot=Fe-y,Jt=Fe-E;return y===r||Ot>=t||Ot<0||M&&Jt>=c}function ge(){var Fe=is();if(te(Fe))return xe(Fe);m=dr(ge,de(Fe))}function xe(Fe){return m=r,$&&s?Y(Fe):(s=o=r,g)}function vt(){m!==r&&ta(m),E=0,s=y=o=m=r}function at(){return m===r?g:xe(is())}function yt(){var Fe=is(),Ot=te(Fe);if(s=arguments,o=this,y=Fe,Ot){if(m===r)return ee(y);if(M)return ta(m),m=dr(ge,t),Y(y)}return m===r&&(m=dr(ge,t)),g}return yt.cancel=vt,yt.flush=at,yt}var lh=fe(function(e,t){return To(e,1,t)}),ch=fe(function(e,t,n){return To(e,Et(t)||0,n)});function uh(e){return Ut(e,U)}function os(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new St(p);var n=function(){var s=arguments,o=t?t.apply(this,s):s[0],c=n.cache;if(c.has(o))return c.get(o);var g=e.apply(this,s);return n.cache=c.set(o,g)||c,g};return n.cache=new(os.Cache||Ft),n}os.Cache=Ft;function as(e){if(typeof e!="function")throw new St(p);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function dh(e){return Fa(2,e)}var fh=Vu(function(e,t){t=t.length==1&&oe(t[0])?Le(t[0],pt(X())):Le(Ze(t,1),pt(X()));var n=t.length;return fe(function(s){for(var o=-1,c=Qe(s.length,n);++o<c;)s[o]=t[o].call(this,s[o]);return gt(e,this,s)})}),Si=fe(function(e,t){var n=tn(t,$n(Si));return Ut(e,L,r,t,n)}),Ka=fe(function(e,t){var n=tn(t,$n(Ka));return Ut(e,z,r,t,n)}),hh=Gt(function(e,t){return Ut(e,Ce,r,r,r,t)});function gh(e,t){if(typeof e!="function")throw new St(p);return t=t===r?t:ue(t),fe(e,t)}function ph(e,t){if(typeof e!="function")throw new St(p);return t=t==null?0:He(ue(t),0),fe(function(n){var s=n[t],o=an(n,0,t);return s&&en(o,s),gt(e,this,o)})}function mh(e,t,n){var s=!0,o=!0;if(typeof e!="function")throw new St(p);return Re(n)&&(s="leading"in n?!!n.leading:s,o="trailing"in n?!!n.trailing:o),Ha(e,t,{leading:s,maxWait:t,trailing:o})}function xh(e){return Ba(e,1)}function vh(e,t){return Si(ai(t),e)}function yh(){if(!arguments.length)return[];var e=arguments[0];return oe(e)?e:[e]}function bh(e){return jt(e,P)}function _h(e,t){return t=typeof t=="function"?t:r,jt(e,P,t)}function wh(e){return jt(e,b|P)}function Sh(e,t){return t=typeof t=="function"?t:r,jt(e,b|P,t)}function Nh(e,t){return t==null||Oo(e,t,qe(t))}function Lt(e,t){return e===t||e!==e&&t!==t}var jh=Qr(Ys),Ch=Qr(function(e,t){return e>=t}),Sn=$o(function(){return arguments}())?$o:function(e){return We(e)&&Se.call(e,"callee")&&!jo.call(e,"callee")},oe=w.isArray,kh=io?pt(io):Tu;function dt(e){return e!=null&&ls(e.length)&&!Kt(e)}function Be(e){return We(e)&&dt(e)}function Eh(e){return e===!0||e===!1||We(e)&&it(e)==Ve}var ln=Fc||Ti,Ah=oo?pt(oo):Pu;function Ih(e){return We(e)&&e.nodeType===1&&!fr(e)}function Mh(e){if(e==null)return!0;if(dt(e)&&(oe(e)||typeof e=="string"||typeof e.splice=="function"||ln(e)||Bn(e)||Sn(e)))return!e.length;var t=et(e);if(t==Ke||t==we)return!e.size;if(ur(e))return!Xs(e).length;for(var n in e)if(Se.call(e,n))return!1;return!0}function Lh(e,t){return ar(e,t)}function Oh(e,t,n){n=typeof n=="function"?n:r;var s=n?n(e,t):r;return s===r?ar(e,t,r,n):!!s}function Ni(e){if(!We(e))return!1;var t=it(e);return t==bt||t==Ue||typeof e.message=="string"&&typeof e.name=="string"&&!fr(e)}function Th(e){return typeof e=="number"&&ko(e)}function Kt(e){if(!Re(e))return!1;var t=it(e);return t==At||t==Pt||t==nt||t==$e}function qa(e){return typeof e=="number"&&e==ue(e)}function ls(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=K}function Re(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function We(e){return e!=null&&typeof e=="object"}var Ja=ao?pt(ao):Du;function Ph(e,t){return e===t||Vs(e,t,gi(t))}function Rh(e,t,n){return n=typeof n=="function"?n:r,Vs(e,t,gi(t),n)}function Dh(e){return Ya(e)&&e!=+e}function Wh(e){if(bd(e))throw new ie(h);return Bo(e)}function $h(e){return e===null}function Bh(e){return e==null}function Ya(e){return typeof e=="number"||We(e)&&it(e)==rt}function fr(e){if(!We(e)||it(e)!=se)return!1;var t=Pr(e);if(t===null)return!0;var n=Se.call(t,"constructor")&&t.constructor;return typeof n=="function"&&n instanceof n&&Mr.call(n)==Pc}var ji=lo?pt(lo):Wu;function Fh(e){return qa(e)&&e>=-K&&e<=K}var Za=co?pt(co):$u;function cs(e){return typeof e=="string"||!oe(e)&&We(e)&&it(e)==Te}function xt(e){return typeof e=="symbol"||We(e)&&it(e)==Pe}var Bn=uo?pt(uo):Bu;function zh(e){return e===r}function Uh(e){return We(e)&&et(e)==st}function Gh(e){return We(e)&&it(e)==cn}var Hh=Qr(Qs),Kh=Qr(function(e,t){return e<=t});function Va(e){if(!e)return[];if(dt(e))return cs(e)?It(e):ut(e);if(Qn&&e[Qn])return Sc(e[Qn]());var t=et(e),n=t==Ke?Bs:t==we?Er:Fn;return n(e)}function qt(e){if(!e)return e===0?e:0;if(e=Et(e),e===he||e===-he){var t=e<0?-1:1;return t*ce}return e===e?e:0}function ue(e){var t=qt(e),n=t%1;return t===t?n?t-n:t:0}function Xa(e){return e?yn(ue(e),0,V):0}function Et(e){if(typeof e=="number")return e;if(xt(e))return J;if(Re(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Re(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=xo(e);var n=W.test(e);return n||Xe.test(e)?oc(e.slice(2),n?2:8):O.test(e)?J:+e}function Qa(e){return Dt(e,ft(e))}function qh(e){return e?yn(ue(e),-K,K):e===0?e:0}function _e(e){return e==null?"":mt(e)}var Jh=Dn(function(e,t){if(ur(t)||dt(t)){Dt(t,qe(t),e);return}for(var n in t)Se.call(t,n)&&sr(e,n,t[n])}),el=Dn(function(e,t){Dt(t,ft(t),e)}),us=Dn(function(e,t,n,s){Dt(t,ft(t),e,s)}),Yh=Dn(function(e,t,n,s){Dt(t,qe(t),e,s)}),Zh=Gt(Ks);function Vh(e,t){var n=Rn(e);return t==null?n:Lo(n,t)}var Xh=fe(function(e,t){e=je(e);var n=-1,s=t.length,o=s>2?t[2]:r;for(o&&ot(t[0],t[1],o)&&(s=1);++n<s;)for(var c=t[n],g=ft(c),m=-1,y=g.length;++m<y;){var E=g[m],A=e[E];(A===r||Lt(A,On[E])&&!Se.call(e,E))&&(e[E]=c[E])}return e}),Qh=fe(function(e){return e.push(r,xa),gt(tl,r,e)});function e0(e,t){return ho(e,X(t,3),Rt)}function t0(e,t){return ho(e,X(t,3),Js)}function n0(e,t){return e==null?e:qs(e,X(t,3),ft)}function r0(e,t){return e==null?e:Do(e,X(t,3),ft)}function s0(e,t){return e&&Rt(e,X(t,3))}function i0(e,t){return e&&Js(e,X(t,3))}function o0(e){return e==null?[]:Hr(e,qe(e))}function a0(e){return e==null?[]:Hr(e,ft(e))}function Ci(e,t,n){var s=e==null?r:bn(e,t);return s===r?n:s}function l0(e,t){return e!=null&&ba(e,t,Iu)}function ki(e,t){return e!=null&&ba(e,t,Mu)}var c0=fa(function(e,t,n){t!=null&&typeof t.toString!="function"&&(t=Lr.call(t)),e[t]=n},Ai(ht)),u0=fa(function(e,t,n){t!=null&&typeof t.toString!="function"&&(t=Lr.call(t)),Se.call(e,t)?e[t].push(n):e[t]=[n]},X),d0=fe(or);function qe(e){return dt(e)?Io(e):Xs(e)}function ft(e){return dt(e)?Io(e,!0):Fu(e)}function f0(e,t){var n={};return t=X(t,3),Rt(e,function(s,o,c){zt(n,t(s,o,c),s)}),n}function h0(e,t){var n={};return t=X(t,3),Rt(e,function(s,o,c){zt(n,o,t(s,o,c))}),n}var g0=Dn(function(e,t,n){Kr(e,t,n)}),tl=Dn(function(e,t,n,s){Kr(e,t,n,s)}),p0=Gt(function(e,t){var n={};if(e==null)return n;var s=!1;t=Le(t,function(c){return c=on(c,e),s||(s=c.length>1),c}),Dt(e,fi(e),n),s&&(n=jt(n,b|I|P,ld));for(var o=t.length;o--;)si(n,t[o]);return n});function m0(e,t){return nl(e,as(X(t)))}var x0=Gt(function(e,t){return e==null?{}:Uu(e,t)});function nl(e,t){if(e==null)return{};var n=Le(fi(e),function(s){return[s]});return t=X(t),qo(e,n,function(s,o){return t(s,o[0])})}function v0(e,t,n){t=on(t,e);var s=-1,o=t.length;for(o||(o=1,e=r);++s<o;){var c=e==null?r:e[Wt(t[s])];c===r&&(s=o,c=n),e=Kt(c)?c.call(e):c}return e}function y0(e,t,n){return e==null?e:lr(e,t,n)}function b0(e,t,n,s){return s=typeof s=="function"?s:r,e==null?e:lr(e,t,n,s)}var rl=pa(qe),sl=pa(ft);function _0(e,t,n){var s=oe(e),o=s||ln(e)||Bn(e);if(t=X(t,4),n==null){var c=e&&e.constructor;o?n=s?new c:[]:Re(e)?n=Kt(c)?Rn(Pr(e)):{}:n={}}return(o?wt:Rt)(e,function(g,m,y){return t(n,g,m,y)}),n}function w0(e,t){return e==null?!0:si(e,t)}function S0(e,t,n){return e==null?e:Xo(e,t,ai(n))}function N0(e,t,n,s){return s=typeof s=="function"?s:r,e==null?e:Xo(e,t,ai(n),s)}function Fn(e){return e==null?[]:$s(e,qe(e))}function j0(e){return e==null?[]:$s(e,ft(e))}function C0(e,t,n){return n===r&&(n=t,t=r),n!==r&&(n=Et(n),n=n===n?n:0),t!==r&&(t=Et(t),t=t===t?t:0),yn(Et(e),t,n)}function k0(e,t,n){return t=qt(t),n===r?(n=t,t=0):n=qt(n),e=Et(e),Lu(e,t,n)}function E0(e,t,n){if(n&&typeof n!="boolean"&&ot(e,t,n)&&(t=n=r),n===r&&(typeof t=="boolean"?(n=t,t=r):typeof e=="boolean"&&(n=e,e=r)),e===r&&t===r?(e=0,t=1):(e=qt(e),t===r?(t=e,e=0):t=qt(t)),e>t){var s=e;e=t,t=s}if(n||e%1||t%1){var o=Eo();return Qe(e+o*(t-e+ic("1e-"+((o+"").length-1))),t)}return ti(e,t)}var A0=Wn(function(e,t,n){return t=t.toLowerCase(),e+(n?il(t):t)});function il(e){return Ei(_e(e).toLowerCase())}function ol(e){return e=_e(e),e&&e.replace(Il,vc).replace(Yl,"")}function I0(e,t,n){e=_e(e),t=mt(t);var s=e.length;n=n===r?s:yn(ue(n),0,s);var o=n;return n-=t.length,n>=0&&e.slice(n,o)==t}function M0(e){return e=_e(e),e&&vs.test(e)?e.replace(Jn,yc):e}function L0(e){return e=_e(e),e&&ws.test(e)?e.replace(Yn,"\\$&"):e}var O0=Wn(function(e,t,n){return e+(n?"-":"")+t.toLowerCase()}),T0=Wn(function(e,t,n){return e+(n?" ":"")+t.toLowerCase()}),P0=ca("toLowerCase");function R0(e,t,n){e=_e(e),t=ue(t);var s=t?Mn(e):0;if(!t||s>=t)return e;var o=(t-s)/2;return Xr($r(o),n)+e+Xr(Wr(o),n)}function D0(e,t,n){e=_e(e),t=ue(t);var s=t?Mn(e):0;return t&&s<t?e+Xr(t-s,n):e}function W0(e,t,n){e=_e(e),t=ue(t);var s=t?Mn(e):0;return t&&s<t?Xr(t-s,n)+e:e}function $0(e,t,n){return n||t==null?t=0:t&&(t=+t),Hc(_e(e).replace(Zn,""),t||0)}function B0(e,t,n){return(n?ot(e,t,n):t===r)?t=1:t=ue(t),ni(_e(e),t)}function F0(){var e=arguments,t=_e(e[0]);return e.length<3?t:t.replace(e[1],e[2])}var z0=Wn(function(e,t,n){return e+(n?"_":"")+t.toLowerCase()});function U0(e,t,n){return n&&typeof n!="number"&&ot(e,t,n)&&(t=n=r),n=n===r?V:n>>>0,n?(e=_e(e),e&&(typeof t=="string"||t!=null&&!ji(t))&&(t=mt(t),!t&&In(e))?an(It(e),0,n):e.split(t,n)):[]}var G0=Wn(function(e,t,n){return e+(n?" ":"")+Ei(t)});function H0(e,t,n){return e=_e(e),n=n==null?0:yn(ue(n),0,e.length),t=mt(t),e.slice(n,n+t.length)==t}function K0(e,t,n){var s=l.templateSettings;n&&ot(e,t,n)&&(t=r),e=_e(e),t=us({},t,s,ma);var o=us({},t.imports,s.imports,ma),c=qe(o),g=$s(o,c),m,y,E=0,A=t.interpolate||Sr,M="__p += '",$=Fs((t.escape||Sr).source+"|"+A.source+"|"+(A===kn?Vt:Sr).source+"|"+(t.evaluate||Sr).source+"|$","g"),Y="//# sourceURL="+(Se.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++ec+"]")+`
`;e.replace($,function(te,ge,xe,vt,at,yt){return xe||(xe=vt),M+=e.slice(E,yt).replace(Ml,bc),ge&&(m=!0,M+=`' +
__e(`+ge+`) +
'`),at&&(y=!0,M+=`';
`+at+`;
__p += '`),xe&&(M+=`' +
((__t = (`+xe+`)) == null ? '' : __t) +
'`),E=yt+te.length,te}),M+=`';
`;var ee=Se.call(t,"variable")&&t.variable;if(!ee)M=`with (obj) {
`+M+`
}
`;else if(hn.test(ee))throw new ie(x);M=(y?M.replace(gs,""):M).replace(ps,"$1").replace(ms,"$1;"),M="function("+(ee||"obj")+`) {
`+(ee?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(m?", __e = _.escape":"")+(y?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+M+`return __p
}`;var de=ll(function(){return be(c,Y+"return "+M).apply(r,g)});if(de.source=M,Ni(de))throw de;return de}function q0(e){return _e(e).toLowerCase()}function J0(e){return _e(e).toUpperCase()}function Y0(e,t,n){if(e=_e(e),e&&(n||t===r))return xo(e);if(!e||!(t=mt(t)))return e;var s=It(e),o=It(t),c=vo(s,o),g=yo(s,o)+1;return an(s,c,g).join("")}function Z0(e,t,n){if(e=_e(e),e&&(n||t===r))return e.slice(0,_o(e)+1);if(!e||!(t=mt(t)))return e;var s=It(e),o=yo(s,It(t))+1;return an(s,0,o).join("")}function V0(e,t,n){if(e=_e(e),e&&(n||t===r))return e.replace(Zn,"");if(!e||!(t=mt(t)))return e;var s=It(e),o=vo(s,It(t));return an(s,o).join("")}function X0(e,t){var n=ae,s=pe;if(Re(t)){var o="separator"in t?t.separator:o;n="length"in t?ue(t.length):n,s="omission"in t?mt(t.omission):s}e=_e(e);var c=e.length;if(In(e)){var g=It(e);c=g.length}if(n>=c)return e;var m=n-Mn(s);if(m<1)return s;var y=g?an(g,0,m).join(""):e.slice(0,m);if(o===r)return y+s;if(g&&(m+=y.length-m),ji(o)){if(e.slice(m).search(o)){var E,A=y;for(o.global||(o=Fs(o.source,_e(gn.exec(o))+"g")),o.lastIndex=0;E=o.exec(A);)var M=E.index;y=y.slice(0,M===r?m:M)}}else if(e.indexOf(mt(o),m)!=m){var $=y.lastIndexOf(o);$>-1&&(y=y.slice(0,$))}return y+s}function Q0(e){return e=_e(e),e&&xs.test(e)?e.replace(vr,kc):e}var eg=Wn(function(e,t,n){return e+(n?" ":"")+t.toUpperCase()}),Ei=ca("toUpperCase");function al(e,t,n){return e=_e(e),t=n?r:t,t===r?wc(e)?Ic(e):hc(e):e.match(t)||[]}var ll=fe(function(e,t){try{return gt(e,r,t)}catch(n){return Ni(n)?n:new ie(n)}}),tg=Gt(function(e,t){return wt(t,function(n){n=Wt(n),zt(e,n,wi(e[n],e))}),e});function ng(e){var t=e==null?0:e.length,n=X();return e=t?Le(e,function(s){if(typeof s[1]!="function")throw new St(p);return[n(s[0]),s[1]]}):[],fe(function(s){for(var o=-1;++o<t;){var c=e[o];if(gt(c[0],this,s))return gt(c[1],this,s)}})}function rg(e){return ku(jt(e,b))}function Ai(e){return function(){return e}}function sg(e,t){return e==null||e!==e?t:e}var ig=da(),og=da(!0);function ht(e){return e}function Ii(e){return Fo(typeof e=="function"?e:jt(e,b))}function ag(e){return Uo(jt(e,b))}function lg(e,t){return Go(e,jt(t,b))}var cg=fe(function(e,t){return function(n){return or(n,e,t)}}),ug=fe(function(e,t){return function(n){return or(e,n,t)}});function Mi(e,t,n){var s=qe(t),o=Hr(t,s);n==null&&!(Re(t)&&(o.length||!s.length))&&(n=t,t=e,e=this,o=Hr(t,qe(t)));var c=!(Re(n)&&"chain"in n)||!!n.chain,g=Kt(e);return wt(o,function(m){var y=t[m];e[m]=y,g&&(e.prototype[m]=function(){var E=this.__chain__;if(c||E){var A=e(this.__wrapped__),M=A.__actions__=ut(this.__actions__);return M.push({func:y,args:arguments,thisArg:e}),A.__chain__=E,A}return y.apply(e,en([this.value()],arguments))})}),e}function dg(){return Ye._===this&&(Ye._=Rc),this}function Li(){}function fg(e){return e=ue(e),fe(function(t){return Ho(t,e)})}var hg=ci(Le),gg=ci(fo),pg=ci(Ts);function cl(e){return mi(e)?Ps(Wt(e)):Gu(e)}function mg(e){return function(t){return e==null?r:bn(e,t)}}var xg=ha(),vg=ha(!0);function Oi(){return[]}function Ti(){return!1}function yg(){return{}}function bg(){return""}function _g(){return!0}function wg(e,t){if(e=ue(e),e<1||e>K)return[];var n=V,s=Qe(e,V);t=X(t),e-=V;for(var o=Ws(s,t);++n<e;)t(n);return o}function Sg(e){return oe(e)?Le(e,Wt):xt(e)?[e]:ut(Aa(_e(e)))}function Ng(e){var t=++Tc;return _e(e)+t}var jg=Vr(function(e,t){return e+t},0),Cg=ui("ceil"),kg=Vr(function(e,t){return e/t},1),Eg=ui("floor");function Ag(e){return e&&e.length?Gr(e,ht,Ys):r}function Ig(e,t){return e&&e.length?Gr(e,X(t,2),Ys):r}function Mg(e){return po(e,ht)}function Lg(e,t){return po(e,X(t,2))}function Og(e){return e&&e.length?Gr(e,ht,Qs):r}function Tg(e,t){return e&&e.length?Gr(e,X(t,2),Qs):r}var Pg=Vr(function(e,t){return e*t},1),Rg=ui("round"),Dg=Vr(function(e,t){return e-t},0);function Wg(e){return e&&e.length?Ds(e,ht):0}function $g(e,t){return e&&e.length?Ds(e,X(t,2)):0}return l.after=ah,l.ary=Ba,l.assign=Jh,l.assignIn=el,l.assignInWith=us,l.assignWith=Yh,l.at=Zh,l.before=Fa,l.bind=wi,l.bindAll=tg,l.bindKey=za,l.castArray=yh,l.chain=Da,l.chunk=kd,l.compact=Ed,l.concat=Ad,l.cond=ng,l.conforms=rg,l.constant=Ai,l.countBy=Wf,l.create=Vh,l.curry=Ua,l.curryRight=Ga,l.debounce=Ha,l.defaults=Xh,l.defaultsDeep=Qh,l.defer=lh,l.delay=ch,l.difference=Id,l.differenceBy=Md,l.differenceWith=Ld,l.drop=Od,l.dropRight=Td,l.dropRightWhile=Pd,l.dropWhile=Rd,l.fill=Dd,l.filter=Bf,l.flatMap=Uf,l.flatMapDeep=Gf,l.flatMapDepth=Hf,l.flatten=Oa,l.flattenDeep=Wd,l.flattenDepth=$d,l.flip=uh,l.flow=ig,l.flowRight=og,l.fromPairs=Bd,l.functions=o0,l.functionsIn=a0,l.groupBy=Kf,l.initial=zd,l.intersection=Ud,l.intersectionBy=Gd,l.intersectionWith=Hd,l.invert=c0,l.invertBy=u0,l.invokeMap=Jf,l.iteratee=Ii,l.keyBy=Yf,l.keys=qe,l.keysIn=ft,l.map=ss,l.mapKeys=f0,l.mapValues=h0,l.matches=ag,l.matchesProperty=lg,l.memoize=os,l.merge=g0,l.mergeWith=tl,l.method=cg,l.methodOf=ug,l.mixin=Mi,l.negate=as,l.nthArg=fg,l.omit=p0,l.omitBy=m0,l.once=dh,l.orderBy=Zf,l.over=hg,l.overArgs=fh,l.overEvery=gg,l.overSome=pg,l.partial=Si,l.partialRight=Ka,l.partition=Vf,l.pick=x0,l.pickBy=nl,l.property=cl,l.propertyOf=mg,l.pull=Yd,l.pullAll=Pa,l.pullAllBy=Zd,l.pullAllWith=Vd,l.pullAt=Xd,l.range=xg,l.rangeRight=vg,l.rearg=hh,l.reject=eh,l.remove=Qd,l.rest=gh,l.reverse=bi,l.sampleSize=nh,l.set=y0,l.setWith=b0,l.shuffle=rh,l.slice=ef,l.sortBy=oh,l.sortedUniq=lf,l.sortedUniqBy=cf,l.split=U0,l.spread=ph,l.tail=uf,l.take=df,l.takeRight=ff,l.takeRightWhile=hf,l.takeWhile=gf,l.tap=Af,l.throttle=mh,l.thru=rs,l.toArray=Va,l.toPairs=rl,l.toPairsIn=sl,l.toPath=Sg,l.toPlainObject=Qa,l.transform=_0,l.unary=xh,l.union=pf,l.unionBy=mf,l.unionWith=xf,l.uniq=vf,l.uniqBy=yf,l.uniqWith=bf,l.unset=w0,l.unzip=_i,l.unzipWith=Ra,l.update=S0,l.updateWith=N0,l.values=Fn,l.valuesIn=j0,l.without=_f,l.words=al,l.wrap=vh,l.xor=wf,l.xorBy=Sf,l.xorWith=Nf,l.zip=jf,l.zipObject=Cf,l.zipObjectDeep=kf,l.zipWith=Ef,l.entries=rl,l.entriesIn=sl,l.extend=el,l.extendWith=us,Mi(l,l),l.add=jg,l.attempt=ll,l.camelCase=A0,l.capitalize=il,l.ceil=Cg,l.clamp=C0,l.clone=bh,l.cloneDeep=wh,l.cloneDeepWith=Sh,l.cloneWith=_h,l.conformsTo=Nh,l.deburr=ol,l.defaultTo=sg,l.divide=kg,l.endsWith=I0,l.eq=Lt,l.escape=M0,l.escapeRegExp=L0,l.every=$f,l.find=Ff,l.findIndex=Ma,l.findKey=e0,l.findLast=zf,l.findLastIndex=La,l.findLastKey=t0,l.floor=Eg,l.forEach=Wa,l.forEachRight=$a,l.forIn=n0,l.forInRight=r0,l.forOwn=s0,l.forOwnRight=i0,l.get=Ci,l.gt=jh,l.gte=Ch,l.has=l0,l.hasIn=ki,l.head=Ta,l.identity=ht,l.includes=qf,l.indexOf=Fd,l.inRange=k0,l.invoke=d0,l.isArguments=Sn,l.isArray=oe,l.isArrayBuffer=kh,l.isArrayLike=dt,l.isArrayLikeObject=Be,l.isBoolean=Eh,l.isBuffer=ln,l.isDate=Ah,l.isElement=Ih,l.isEmpty=Mh,l.isEqual=Lh,l.isEqualWith=Oh,l.isError=Ni,l.isFinite=Th,l.isFunction=Kt,l.isInteger=qa,l.isLength=ls,l.isMap=Ja,l.isMatch=Ph,l.isMatchWith=Rh,l.isNaN=Dh,l.isNative=Wh,l.isNil=Bh,l.isNull=$h,l.isNumber=Ya,l.isObject=Re,l.isObjectLike=We,l.isPlainObject=fr,l.isRegExp=ji,l.isSafeInteger=Fh,l.isSet=Za,l.isString=cs,l.isSymbol=xt,l.isTypedArray=Bn,l.isUndefined=zh,l.isWeakMap=Uh,l.isWeakSet=Gh,l.join=Kd,l.kebabCase=O0,l.last=kt,l.lastIndexOf=qd,l.lowerCase=T0,l.lowerFirst=P0,l.lt=Hh,l.lte=Kh,l.max=Ag,l.maxBy=Ig,l.mean=Mg,l.meanBy=Lg,l.min=Og,l.minBy=Tg,l.stubArray=Oi,l.stubFalse=Ti,l.stubObject=yg,l.stubString=bg,l.stubTrue=_g,l.multiply=Pg,l.nth=Jd,l.noConflict=dg,l.noop=Li,l.now=is,l.pad=R0,l.padEnd=D0,l.padStart=W0,l.parseInt=$0,l.random=E0,l.reduce=Xf,l.reduceRight=Qf,l.repeat=B0,l.replace=F0,l.result=v0,l.round=Rg,l.runInContext=v,l.sample=th,l.size=sh,l.snakeCase=z0,l.some=ih,l.sortedIndex=tf,l.sortedIndexBy=nf,l.sortedIndexOf=rf,l.sortedLastIndex=sf,l.sortedLastIndexBy=of,l.sortedLastIndexOf=af,l.startCase=G0,l.startsWith=H0,l.subtract=Dg,l.sum=Wg,l.sumBy=$g,l.template=K0,l.times=wg,l.toFinite=qt,l.toInteger=ue,l.toLength=Xa,l.toLower=q0,l.toNumber=Et,l.toSafeInteger=qh,l.toString=_e,l.toUpper=J0,l.trim=Y0,l.trimEnd=Z0,l.trimStart=V0,l.truncate=X0,l.unescape=Q0,l.uniqueId=Ng,l.upperCase=eg,l.upperFirst=Ei,l.each=Wa,l.eachRight=$a,l.first=Ta,Mi(l,function(){var e={};return Rt(l,function(t,n){Se.call(l.prototype,n)||(e[n]=t)}),e}(),{chain:!1}),l.VERSION=f,wt(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){l[e].placeholder=l}),wt(["drop","take"],function(e,t){me.prototype[e]=function(n){n=n===r?1:He(ue(n),0);var s=this.__filtered__&&!t?new me(this):this.clone();return s.__filtered__?s.__takeCount__=Qe(n,s.__takeCount__):s.__views__.push({size:Qe(n,V),type:e+(s.__dir__<0?"Right":"")}),s},me.prototype[e+"Right"]=function(n){return this.reverse()[e](n).reverse()}}),wt(["filter","map","takeWhile"],function(e,t){var n=t+1,s=n==le||n==ne;me.prototype[e]=function(o){var c=this.clone();return c.__iteratees__.push({iteratee:X(o,3),type:n}),c.__filtered__=c.__filtered__||s,c}}),wt(["head","last"],function(e,t){var n="take"+(t?"Right":"");me.prototype[e]=function(){return this[n](1).value()[0]}}),wt(["initial","tail"],function(e,t){var n="drop"+(t?"":"Right");me.prototype[e]=function(){return this.__filtered__?new me(this):this[n](1)}}),me.prototype.compact=function(){return this.filter(ht)},me.prototype.find=function(e){return this.filter(e).head()},me.prototype.findLast=function(e){return this.reverse().find(e)},me.prototype.invokeMap=fe(function(e,t){return typeof e=="function"?new me(this):this.map(function(n){return or(n,e,t)})}),me.prototype.reject=function(e){return this.filter(as(X(e)))},me.prototype.slice=function(e,t){e=ue(e);var n=this;return n.__filtered__&&(e>0||t<0)?new me(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),t!==r&&(t=ue(t),n=t<0?n.dropRight(-t):n.take(t-e)),n)},me.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},me.prototype.toArray=function(){return this.take(V)},Rt(me.prototype,function(e,t){var n=/^(?:filter|find|map|reject)|While$/.test(t),s=/^(?:head|last)$/.test(t),o=l[s?"take"+(t=="last"?"Right":""):t],c=s||/^find/.test(t);o&&(l.prototype[t]=function(){var g=this.__wrapped__,m=s?[1]:arguments,y=g instanceof me,E=m[0],A=y||oe(g),M=function(ge){var xe=o.apply(l,en([ge],m));return s&&$?xe[0]:xe};A&&n&&typeof E=="function"&&E.length!=1&&(y=A=!1);var $=this.__chain__,Y=!!this.__actions__.length,ee=c&&!$,de=y&&!Y;if(!c&&A){g=de?g:new me(this);var te=e.apply(g,m);return te.__actions__.push({func:rs,args:[M],thisArg:r}),new Nt(te,$)}return ee&&de?e.apply(this,m):(te=this.thru(M),ee?s?te.value()[0]:te.value():te)})}),wt(["pop","push","shift","sort","splice","unshift"],function(e){var t=Ar[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",s=/^(?:pop|shift)$/.test(e);l.prototype[e]=function(){var o=arguments;if(s&&!this.__chain__){var c=this.value();return t.apply(oe(c)?c:[],o)}return this[n](function(g){return t.apply(oe(g)?g:[],o)})}}),Rt(me.prototype,function(e,t){var n=l[t];if(n){var s=n.name+"";Se.call(Pn,s)||(Pn[s]=[]),Pn[s].push({name:t,func:n})}}),Pn[Zr(r,B).name]=[{name:"wrapper",func:r}],me.prototype.clone=Xc,me.prototype.reverse=Qc,me.prototype.value=eu,l.prototype.at=If,l.prototype.chain=Mf,l.prototype.commit=Lf,l.prototype.next=Of,l.prototype.plant=Pf,l.prototype.reverse=Rf,l.prototype.toJSON=l.prototype.valueOf=l.prototype.value=Df,l.prototype.first=l.prototype.head,Qn&&(l.prototype[Qn]=Tf),l},Ln=Mc();pn?((pn.exports=Ln)._=Ln,Is._=Ln):Ye._=Ln}).call(hr)})(fs,fs.exports);var Di=fs.exports;function Lp(a=!0){k.useEffect(()=>{if(!a)return;const u=Di.debounce(r=>{document.documentElement.style.setProperty("--mouse-x",`${r.clientX}px`),document.documentElement.style.setProperty("--mouse-y",`${r.clientY}px`)},16);return document.addEventListener("mousemove",u),()=>{u.cancel(),document.removeEventListener("mousemove",u)}},[a])}function Op(a=!0){const{state:u,dispatch:r}=Un(),{activeTab:f,screenState:d}=u;k.useEffect(()=>{if(!a)return;const h=p=>{const x=f==="parameter-debug",_=f==="chat",N=!d||d.currentScreen===0;if(_||N&&x){const S=De.canvas.selected_nodes;Object.keys(S??{}).length?r({type:"SET_SELECTED_NODE",payload:Object.values(S)}):r({type:"SET_SELECTED_NODE",payload:null})}};return document.addEventListener("click",h),()=>{document.removeEventListener("click",h)}},[r,a,f,d])}const Tp=({selectedNodes:a,handleParamSelect:u,selectedParams:r,handleNext:f,handleClose:d})=>{const p=a.flatMap(x=>(x.widgets||[]).map(_=>_.name)).some(x=>r[x]===!0);return i.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[i.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Select parameters"}),i.jsx("p",{className:"text-xs text-gray-500",children:"multiple selections supported"})]}),i.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:d,children:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),a.map((x,_)=>{const N=x.title||"Unknown Node",S=x.widgets||[];return i.jsxs("div",{className:"border rounded-md mb-4 overflow-hidden",children:[i.jsx("div",{className:"bg-gray-50 px-3 py-2 text-sm font-medium text-gray-700 border-b",children:N}),i.jsx("div",{className:"p-4 space-y-3",children:i.jsx("div",{className:"flex items-center gap-3 flex-wrap",children:S.map((b,I)=>{const P=b.name;return i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:`w-5 h-5 rounded-full border flex items-center justify-center ${r[P]?"border-red-500 bg-red-100":"border-gray-300"}`,onClick:T=>u(P,T),children:r[P]&&i.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"})}),i.jsx("span",{className:"ml-2 text-gray-700 text-xs",children:P})]},`widget-${I}`)})})})]},`node-${_}`)}),i.jsx("div",{className:"mt-6 flex justify-center",children:i.jsx("button",{onClick:x=>f(x),disabled:!p,className:`px-3 py-1.5 text-xs ${p?"bg-pink-200 text-pink-700 hover:bg-pink-300":"bg-gray-200 text-gray-500 cursor-not-allowed"} rounded-md transition-colors`,children:"Next"})})]})},Pp=({selectedNodes:a,paramTestValues:u,selectedParams:r,updateParamTestValues:f,toggleDropdown:d,openDropdowns:h,handleTestValueSelect:p,searchTerms:x,handleSearch:_,handleSelectAll:N,handleNext:S,handlePrevious:b,handleClose:I,inputValues:P,setInputValues:T,textInputs:G,handleTextInputChange:q,handleAddTextInput:B,handleRemoveTextInput:D,openAiWritingModal:F})=>{const j=(L,z,Q,Ce=0)=>{if(L=isNaN(L)?0:L,z=isNaN(z)?100:z,Q=isNaN(Q)||Q<=0?1:Q,z<L&&(z=L),Math.floor((z-L)/Q)+1<=1)return[L];const ae=[];let pe=L;for(;pe<=z;){const R=Math.pow(10,Ce),ye=Math.round(pe*R)/R;ae.push(ye),pe+=Q}return ae};return k.useEffect(()=>{!a||a.length===0||a.forEach(L=>{const z=L.id.toString(),Q=L.widgets||{};Object.values(Q).forEach(U=>{const ae=U.name;if(!r[ae])return;if(!(u[z]?.[ae]?.length>0)&&U.type==="number"){const R=U.options?.min||0,ye=U.options?.max||100;let le=(U.options?.step||10)/10;le<.1&&(le=.1);const re=U.options?.precision||0,ne=j(R,ye,le,re);if(ne.length>0){f(z,ae,ne);const he=`${z}_${ae}`;T(K=>({...K,[he]:{min:R.toString(),max:ye.toString(),step:le.toString()}}))}}if(U.type==="customtext"||U.type.toLowerCase().includes("text")){const R=`${z}_${ae}`,ye=G[R]||[""];JSON.stringify(ye)!==JSON.stringify(u[z]?.[ae]||[""])&&f(z,ae,ye)}})})},[a,r,u,G,f,T,j]),i.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[i.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Set test values"}),i.jsx("p",{className:"text-xs text-gray-500",children:"Configure the test values for each parameter"})]}),i.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:I,children:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),a.length>0?a.map((L,z)=>{const Q=L.widgets||{},Ce=Object.values(Q),U=L.id;return i.jsxs("div",{className:"border rounded-md mb-4 overflow-hidden",children:[i.jsxs("div",{className:"bg-gray-50 px-3 py-2 text-xs font-medium text-gray-700 border-b flex justify-between items-center",children:[i.jsxs("span",{children:[L.type," (ID: ",U,")"]}),i.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:ae=>I(ae,z),children:i.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),i.jsx("div",{className:"p-4 space-y-4",children:Ce.map((ae,pe)=>{const R=ae.name;if(!r[R])return null;const ye=`${U}_${R}`;if(ae.type==="customtext"||ae.type.toLowerCase().includes("text")){const le=G[ye]||[""];return i.jsxs("div",{className:"border-b pb-3",children:[i.jsxs("div",{className:"flex justify-between items-center mb-2",children:[i.jsxs("label",{className:"text-xs font-medium text-gray-700",children:[R,":"]}),i.jsxs("button",{className:"px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs flex items-center hover:bg-blue-200 transition-colors",onClick:()=>F(U,R),children:[i.jsx("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),"AI Writing"]})]}),i.jsx("div",{className:"space-y-2",children:le.map((re,ne)=>i.jsxs("div",{className:"flex items-start",children:[i.jsx("textarea",{className:`flex-1 border ${re?"border-gray-300":"border-red-500"} rounded p-2 text-xs resize-y`,rows:2,placeholder:"Enter text...",value:re,onChange:he=>q(U,R,ne,he.target.value),required:!0}),i.jsx("button",{className:"ml-2 text-red-500 hover:text-red-700",onClick:()=>D(U,R,ne),title:"Remove",children:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},ne))}),i.jsxs("button",{className:"mt-2 px-2 py-1 border border-dashed border-gray-300 rounded text-xs text-gray-600 hover:bg-gray-50 flex items-center",onClick:()=>B(U,R),children:[i.jsx("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Add Text"]})]},pe)}if(ae.type==="number"){const le=ae.options?.min||0,re=ae.options?.max||100,ne=(ae.options?.step||10)/10,he=ae.options?.precision||0,K=j(le,re,ne,he),ce=P[ye]||{min:le.toString(),max:re.toString(),step:ne.toString()};return i.jsxs("div",{className:"border-b pb-3",children:[i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsxs("label",{className:"text-xs font-medium text-gray-700",children:[R,":"]}),i.jsx("div",{className:"w-4"})]}),i.jsxs("div",{className:"flex space-x-2 items-center",children:[i.jsx("label",{className:"text-xs text-gray-600",children:"Min"}),i.jsx("input",{type:"text",className:"w-12 h-6 border border-gray-300 rounded text-xs px-2",value:ce.min,required:!0,onClick:J=>{J.preventDefault(),J.stopPropagation()},onChange:J=>{J.preventDefault(),J.stopPropagation();const V=J.target.value;if(T(ve=>({...ve,[ye]:{...ve[ye],min:V}})),V===""||!isNaN(parseFloat(V))){const ve=V===""?0:parseFloat(V),Oe=parseFloat(ce.max||re.toString()),Ie=parseFloat(ce.step||ne.toString()),Ee=j(ve,Oe,Ie,he);f(U,R,Ee)}}}),i.jsx("label",{className:"text-xs text-gray-600",children:"Max"}),i.jsx("input",{type:"text",className:"w-12 h-6 border border-gray-300 rounded text-xs px-2",value:ce.max,onClick:J=>{J.preventDefault(),J.stopPropagation()},required:!0,onChange:J=>{J.preventDefault(),J.stopPropagation();const V=J.target.value;if(T(ve=>({...ve,[ye]:{...ve[ye],max:V}})),V===""||!isNaN(parseFloat(V))){const ve=parseFloat(ce.min||le.toString()),Oe=V===""?ve:parseFloat(V),Ie=parseFloat(ce.step||ne.toString()),Ee=j(ve,Oe,Ie,he);f(U,R,Ee)}}}),i.jsx("label",{className:"text-xs text-gray-600",children:"Step"}),i.jsx("input",{type:"text",className:"w-12 h-6 border border-gray-300 rounded text-xs px-2",value:ce.step,required:!0,onClick:J=>{J.preventDefault(),J.stopPropagation()},onChange:J=>{J.preventDefault(),J.stopPropagation();const V=J.target.value;if(T(ve=>({...ve,[ye]:{...ve[ye],step:V}})),V===""||!isNaN(parseFloat(V))&&parseFloat(V)>0){const ve=parseFloat(ce.min||le.toString()),Oe=parseFloat(ce.max||re.toString());let Ie=V===""?1:parseFloat(V);Ie<.1&&(Ie=.1);const Ee=j(ve,Oe,Ie,he);f(U,R,Ee)}}})]}),i.jsxs("div",{className:"mt-1",children:[i.jsx("label",{className:"text-xs text-gray-600",children:"Test values"}),i.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:(()=>{const J=u[U]?.[R]||K;if(J.length<=10)return J.map((V,ve)=>i.jsxs("div",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-md flex items-center text-xs cursor-pointer hover:bg-blue-200",onClick:Oe=>{Oe.stopPropagation(),p(U,R,V,Oe)},children:[i.jsx("span",{children:V}),i.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},ve));{const V=J.slice(0,5),ve=J.slice(J.length-5);return i.jsxs(i.Fragment,{children:[V.map((Oe,Ie)=>i.jsxs("div",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-md flex items-center text-xs cursor-pointer hover:bg-blue-200",onClick:Ee=>{Ee.stopPropagation(),p(U,R,Oe,Ee)},children:[i.jsx("span",{children:Oe}),i.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},`first-${Ie}`)),i.jsx("div",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 rounded-md flex items-center text-xs",children:"..."}),ve.map((Oe,Ie)=>i.jsxs("div",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-md flex items-center text-xs cursor-pointer hover:bg-blue-200",onClick:Ee=>{Ee.stopPropagation(),p(U,R,Oe,Ee)},children:[i.jsx("span",{children:Oe}),i.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},`last-${Ie}`))]})}})()})]}),i.jsx("div",{className:"mt-1",children:i.jsx("p",{className:"text-xs text-gray-500",children:"Values are distributed evenly between Min and Max"})})]},pe)}else if(ae.type==="combo"){const le=ae.options?.values||[],re=`${U}_${R}`,ne=K=>typeof K=="string"?K:K&&typeof K=="object"&&"name"in K?K.name:String(K),he=K=>typeof K=="object"&&K!==null&&"name"in K?K.name:K;return i.jsxs("div",{className:"border-b pb-3",children:[i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx("label",{className:"text-xs font-medium text-gray-700",children:R}),i.jsxs("div",{className:"relative dropdown-container",children:[i.jsxs("button",{className:`appearance-none border ${(u[U]?.[R]||[]).length===0?"border-red-500":"border-gray-300"} rounded px-2 py-0.5 pr-6 text-xs flex items-center bg-white text-gray-700`,onClick:K=>{K.preventDefault(),K.stopPropagation(),d(U,R,K)},"data-dropdown":re,children:[i.jsx("span",{children:(u[U]?.[R]||[]).length>0?`${R}: ${(u[U]?.[R]||[]).length} selected`:`Select ${R}`}),i.jsx("div",{className:"ml-2",children:i.jsx("svg",{className:"fill-current h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:i.jsx("path",{d:"M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"})})})]}),h[re]&&i.jsxs("div",{className:"absolute z-[9999] mt-1 w-64 bg-white border border-gray-300 rounded-md shadow-lg dropdown-menu",style:{position:"fixed",top:typeof h[re]=="object"?`${h[re].y}px`:"0px",left:typeof h[re]=="object"?`${h[re].x}px`:"0px",maxHeight:"300px",overflowY:"auto"},children:[i.jsx("div",{className:"p-2 border-b sticky top-0 bg-white",children:i.jsx("input",{type:"text",className:"w-full px-2 py-0.5 text-xs border border-gray-300 rounded",placeholder:"Search...",value:x[re]||"",onChange:K=>{K.preventDefault(),K.stopPropagation(),_(U,R,K.target.value)},onClick:K=>{K.preventDefault(),K.stopPropagation()},autoFocus:!0})}),i.jsxs("div",{className:"px-3 py-1.5 bg-gray-50 border-b cursor-pointer text-xs flex items-center text-gray-700 hover:bg-gray-100",onClick:K=>{K.preventDefault(),K.stopPropagation();const J=le.filter(V=>!x[re]||ne(V).toLowerCase().includes((x[re]||"").toLowerCase())).map(he);N(U,R,J)},children:[i.jsx("div",{className:`w-4 h-4 mr-2 border rounded-sm flex items-center justify-center ${le.length>0&&(u[U]?.[R]||[]).length===le.length?"bg-blue-500 border-blue-500":(u[U]?.[R]||[]).length>0?"bg-blue-500 border-blue-500 opacity-50":"border-gray-300"}`,children:(u[U]?.[R]||[]).length>0&&i.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),i.jsx("span",{className:"font-medium",children:le.length>0&&(u[U]?.[R]||[]).length===le.length?"Deselect All":"Select All"})]}),i.jsxs("div",{className:"max-h-60 overflow-y-auto",children:[le.filter(K=>!x[re]||ne(K).toLowerCase().includes((x[re]||"").toLowerCase())).map((K,ce)=>i.jsxs("div",{className:"px-3 py-1.5 hover:bg-gray-100 cursor-pointer text-xs flex items-center text-gray-700",onClick:J=>{J.preventDefault(),J.stopPropagation(),p(U,R,he(K),J)},children:[i.jsx("div",{className:`w-4 h-4 mr-2 border rounded-sm flex items-center justify-center ${(u[U]?.[R]||[]).includes(he(K))?"bg-blue-500 border-blue-500":"border-gray-300"}`,children:(u[U]?.[R]||[]).includes(he(K))&&i.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),i.jsx("span",{className:"whitespace-normal overflow-hidden text-ellipsis",children:ne(K)})]},ce)),le.filter(K=>!x[re]||ne(K).toLowerCase().includes((x[re]||"").toLowerCase())).length===0&&i.jsx("div",{className:"px-3 py-4 text-sm text-gray-500 text-center",children:"No matching options"})]})]})]})]}),i.jsxs("div",{className:"mt-2",children:[i.jsx("label",{className:"text-xs text-gray-600",children:"Test values"}),(u[U]?.[R]||[]).length===0&&i.jsx("div",{className:"text-xs text-red-500 mt-1",children:"Please select at least one value"}),i.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:(u[U]?.[R]||[]).map((K,ce)=>i.jsxs("div",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-md flex items-center text-xs",children:[i.jsx("span",{children:K}),i.jsx("svg",{className:"w-4 h-4 ml-1 cursor-pointer hover:text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",onClick:J=>{J.preventDefault(),J.stopPropagation(),p(U,R,K,J)},children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},ce))})]})]},pe)}else return i.jsxs("div",{className:"border-b pb-3",children:[i.jsx("div",{className:"flex justify-between items-center",children:i.jsx("label",{className:"text-xs font-medium text-gray-700",children:R})}),i.jsxs("div",{className:"mt-2",children:[i.jsx("label",{className:"text-xs text-gray-600",children:"Test values"}),i.jsxs("div",{className:"mt-1 flex flex-wrap gap-1",children:[(u[U]?.[R]||[]).map((le,re)=>i.jsxs("div",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-md flex items-center text-xs",children:[i.jsx("span",{children:le}),i.jsx("svg",{className:"w-4 h-4 ml-1 cursor-pointer hover:text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",onClick:ne=>{ne.preventDefault(),ne.stopPropagation(),p(U,R,le,ne)},children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},re)),i.jsxs("button",{className:"px-2 py-0.5 border border-dashed border-blue-300 text-blue-600 rounded-md text-xs flex items-center hover:bg-blue-50",onClick:le=>{le.preventDefault(),le.stopPropagation();const re=`${R}${(u[U]?.[R]||[]).length+1}`;f(U,R,[...u[U]?.[R]||[],re])},children:[i.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),i.jsx("span",{children:"Add"})]})]})]})]},pe)})})]},z)}):i.jsx("div",{className:"border rounded-md mb-4 p-4 text-center text-gray-500",children:"No nodes selected. Please select a node in the workflow to configure parameters."}),i.jsxs("div",{className:"mt-6 flex justify-between",children:[i.jsx("button",{onClick:L=>b(L),className:"px-3 py-1.5 text-xs bg-gray-100 text-gray-800 rounded-md hover:bg-gray-200 transition-colors",children:"Previous"}),i.jsx("button",{onClick:L=>S(L),className:"px-3 py-1.5 text-xs bg-pink-200 text-pink-700 rounded-md hover:bg-pink-300 transition-colors",children:"Next"})]})]})},Rp=({selectedNodes:a,paramTestValues:u,selectedParams:r,totalCount:f,errorMessage:d,handlePrevious:h,handleStartGeneration:p,handleClose:x})=>{const[_,N]=k.useState([]),[S,b]=k.useState(null),[I,P]=k.useState(!1),{dispatch:T}=Un(),G=()=>{const B=Object.values(De.graph._nodes_by_id),D=[],F=[];for(const L of B)L.type==="SaveImage"?D.push(L.id):L.type==="PreviewImage"&&F.push(L.id);const j=[...D,...F];N(j),j.length===1?b(j[0]):j.length>1&&(P(!0),b(null))};k.useEffect(()=>{G()},[]),k.useEffect(()=>{const B=()=>{if(!De.canvas.selected_nodes)return;const D=Object.values(De.canvas.selected_nodes);if(D.length===0)return;const F=D[0];F&&(F.type==="SaveImage"||F.type==="PreviewImage")&&(console.log("Selected image node:",F.id),b(F.id))};return document.addEventListener("click",B),()=>{document.removeEventListener("click",B)}},[]);const q=B=>{if(B&&(B.preventDefault(),B.stopPropagation()),_.length>1&&!S){P(!0);return}p(B,S||void 0)};return i.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[i.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Conform combinations"}),i.jsxs("p",{className:"text-xs text-gray-500",children:["In the selected parameter combinations, there are ",f," total runs. Each run will generate a separate image."]})]}),i.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:x,children:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),I&&_.length>1&&i.jsx("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-md text-amber-600 text-xs",children:i.jsxs("div",{className:"flex items-start",children:[i.jsx("div",{className:"flex-shrink-0 mt-0.5",children:i.jsx("svg",{className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),i.jsx("div",{className:"ml-2",children:S===null?`Multiple SaveImage and PreviewImage nodes detected with IDs ${_.join(",")}. Please click the node on canvas.`:`Current node ID is ${S}, please click Start Generation again`})]})}),d&&i.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md text-red-600 text-xs",children:i.jsxs("div",{className:"flex items-start",children:[i.jsx("div",{className:"flex-shrink-0 mt-0.5",children:i.jsx("svg",{className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),i.jsx("div",{className:"ml-2",children:d})]})}),a.length>0?a.map((B,D)=>{const F=B.type||"Unknown Node",j=B.widgets||[],L=B.id;return i.jsxs("div",{className:"border rounded-md mb-4 overflow-hidden",children:[i.jsxs("div",{className:"bg-gray-50 px-3 py-2 text-xs font-medium text-gray-700 border-b",children:[F," (ID: ",L,")"]}),i.jsx("div",{className:"p-4 space-y-3",children:j.map((z,Q)=>{const Ce=z.name;if(!r[Ce])return null;const U=u[L]?.[Ce]||[],ae=Array.isArray(U)?`[${U.join(", ")}]`:JSON.stringify(U);return i.jsxs("div",{className:Q<j.length-1?"flex justify-between items-center border-b pb-2":"flex justify-between items-center",children:[i.jsx("label",{className:"font-medium text-gray-700 text-xs",children:Ce}),i.jsx("div",{className:"flex space-x-2 items-center",children:i.jsx("input",{type:"text",className:"w-64 h-7 border border-gray-300 rounded text-xs px-2 bg-gray-50 cursor-not-allowed text-gray-500",readOnly:!0,disabled:!0,value:ae,onClick:pe=>pe.preventDefault()})})]},Q)})})]},D)}):i.jsx("div",{className:"border rounded-md mb-4 p-4 text-center text-gray-500 text-xs",children:"No nodes selected. Please select a node in the workflow to configure parameters."}),i.jsxs("div",{className:"mt-6 flex justify-between",children:[i.jsx("button",{onClick:B=>h(B),className:"px-3 py-1.5 text-xs bg-gray-100 text-gray-800 rounded-md hover:bg-gray-200 transition-colors",children:"Previous"}),i.jsx("button",{onClick:B=>q(B),className:`px-3 py-1.5 text-xs rounded-md transition-colors ${_.length>1&&!S?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-pink-200 text-pink-700 hover:bg-pink-300"}`,disabled:_.length>1&&!S,children:"Generate & Compare"})]})]})},Dp=({selectedNodes:a,paramTestValues:u,selectedParams:r,totalCount:f,completedCount:d,errorMessage:h,handleClose:p,setIsProcessing:x,setCurrentScreen:_,cleanupPolling:N})=>{const S=b=>{b.preventDefault(),b.stopPropagation(),Ap({clear:!0}),Ip(),N&&N(),x(!1),_(2)};return i.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 relative",children:[i.jsx("div",{className:"absolute inset-0 bg-gray-500 bg-opacity-30 flex flex-col items-center justify-center z-10",children:i.jsxs("div",{className:"text-center text-gray-800 bg-white p-4 rounded-lg shadow-lg",children:[i.jsx("div",{className:"mb-2 text-sm font-medium",children:"Processing..."}),i.jsxs("div",{className:"text-xs mb-3",children:["Completed ",d," of ",f," runs"]}),i.jsx("div",{className:"w-48 h-2 bg-gray-200 rounded-full overflow-hidden",children:i.jsx("div",{className:"h-full bg-pink-500 transition-all duration-200",style:{width:`${d/f*100}%`}})}),i.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:["Already generated ",d," images"]}),i.jsx("button",{onClick:S,className:"mt-4 px-3 py-1.5 text-xs bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"})]})}),i.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Confirm Test Configuration"}),i.jsxs("p",{className:"text-xs text-gray-500",children:["In the selected parameter combinations, there are ",f," total runs. Each run will generate a separate image."]})]}),i.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:p,children:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),h&&i.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md text-red-600 text-xs",children:i.jsxs("div",{className:"flex items-start",children:[i.jsx("div",{className:"flex-shrink-0 mt-0.5",children:i.jsx("svg",{className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),i.jsx("div",{className:"ml-2",children:h})]})}),a.length>0?a.map((b,I)=>{const P=b.type||"Unknown Node",T=b.widgets||[],G=b.id;return i.jsxs("div",{className:"border rounded-md mb-4 overflow-hidden",children:[i.jsxs("div",{className:"bg-gray-50 px-3 py-2 text-xs font-medium text-gray-700 border-b",children:[P," (ID: ",G,")"]}),i.jsx("div",{className:"p-4 space-y-3",children:T.map((q,B)=>{const D=q.name;if(!r[D])return null;const F=u[G]?.[D]||[],j=Array.isArray(F)?`[${F.join(", ")}]`:JSON.stringify(F);return i.jsxs("div",{className:B<T.length-1?"flex justify-between items-center border-b pb-2":"flex justify-between items-center",children:[i.jsx("label",{className:"font-medium text-gray-700",children:D}),i.jsx("div",{className:"flex space-x-2 items-center",children:i.jsx("input",{type:"text",className:"w-64 h-7 border border-gray-300 rounded text-sm px-2 bg-gray-50 cursor-not-allowed text-gray-500",readOnly:!0,disabled:!0,value:j,onClick:L=>L.preventDefault()})})]},B)})})]},I)}):i.jsx("div",{className:"border rounded-md mb-4 p-4 text-center text-gray-500",children:"No nodes selected. Please select a node in the workflow to configure parameters."})]})},pr=({visible:a,imageUrl:u,params:r,onClose:f})=>{if(!a)return null;const d=()=>{if(!r||!r.nodeParams)return null;const h=Object.entries(r.nodeParams).map(([p,x])=>{const _=r.nodeNames?.[p]||r.selectedNodeInfoMap&&r.selectedNodeInfoMap[p]||(p.includes("text")?"Text Node":`Node ${p}`),N=Object.entries(x).filter(([S,b])=>typeof b!="object"||b===null).map(([S,b])=>i.jsxs("div",{className:"pl-4 text-sm py-1 flex",children:[i.jsx("span",{className:"text-gray-600 dark:text-gray-400 mr-2",children:"-"}),i.jsxs("span",{className:"font-medium mr-1",children:[S,":"]}),i.jsx("span",{className:"text-gray-700 dark:text-gray-300 break-all",children:String(b)})]},S));return i.jsxs("div",{className:"mb-4",children:[i.jsx("div",{className:"font-semibold text-pink-600 dark:text-pink-400 text-base py-1 border-b border-gray-200 dark:border-gray-700 mb-2",children:_}),N.length>0?N:i.jsx("div",{className:"pl-4 text-sm text-gray-500 italic",children:"nodeParams is null"})]},p)});return i.jsx("div",{className:"overflow-y-auto max-h-full",children:h.length>0?h:i.jsx("div",{className:"text-sm text-gray-500 italic",children:"nodeParams is null"})})};return i.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50",onClick:f,children:i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl flex flex-row w-[90%] max-w-6xl max-h-[90vh] relative m-4 overflow-hidden",onClick:h=>h.stopPropagation(),style:{display:"flex",flexDirection:"row"},children:[i.jsx("button",{className:"absolute top-2 right-2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 p-1 z-10",onClick:f,children:i.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),i.jsx("div",{className:"w-[65%] border-r border-gray-200 dark:border-gray-700",children:i.jsx("div",{className:"p-4 h-full flex items-center justify-center",children:i.jsx("img",{src:u,alt:"Enlarged image",className:"max-w-full max-h-[calc(90vh-2rem)] object-contain"})})}),i.jsx("div",{className:"w-[35%] h-full overflow-hidden flex flex-col",children:i.jsxs("div",{className:"p-4 flex-1 overflow-y-auto",children:[i.jsx("h3",{className:"text-lg font-medium text-gray-800 dark:text-gray-200 mb-4",children:"Parameters"}),r&&!r.nodeParams&&Object.entries(r).filter(([h,p])=>h!=="nodeParams"&&typeof p!="object").map(([h,p])=>i.jsxs("div",{className:"py-1 text-sm text-gray-600 dark:text-gray-300",children:[i.jsxs("span",{className:"font-medium",children:[h,":"]})," ",String(p)]},h)),i.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:d()})]})})]})})};function zn(a,u,r){let f=r.initialDeps??[],d;function h(){var p,x,_,N;let S;r.key&&((p=r.debug)!=null&&p.call(r))&&(S=Date.now());const b=a();if(!(b.length!==f.length||b.some((T,G)=>f[G]!==T)))return d;f=b;let P;if(r.key&&((x=r.debug)!=null&&x.call(r))&&(P=Date.now()),d=u(...b),r.key&&((_=r.debug)!=null&&_.call(r))){const T=Math.round((Date.now()-S)*100)/100,G=Math.round((Date.now()-P)*100)/100,q=G/16,B=(D,F)=>{for(D=String(D);D.length<F;)D=" "+D;return D};console.info(`%c⏱ ${B(G,5)} /${B(T,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*q,120))}deg 100% 31%);`,r?.key)}return(N=r?.onChange)==null||N.call(r,d),d}return h.updateDeps=p=>{f=p},h}function fl(a,u){if(a===void 0)throw new Error("Unexpected undefined");return a}const Wp=(a,u)=>Math.abs(a-u)<1.01,$p=(a,u,r)=>{let f;return function(...d){a.clearTimeout(f),f=a.setTimeout(()=>u.apply(this,d),r)}},hl=a=>{const{offsetWidth:u,offsetHeight:r}=a;return{width:u,height:r}},Bp=a=>a,Fp=a=>{const u=Math.max(a.startIndex-a.overscan,0),r=Math.min(a.endIndex+a.overscan,a.count-1),f=[];for(let d=u;d<=r;d++)f.push(d);return f},zp=(a,u)=>{const r=a.scrollElement;if(!r)return;const f=a.targetWindow;if(!f)return;const d=p=>{const{width:x,height:_}=p;u({width:Math.round(x),height:Math.round(_)})};if(d(hl(r)),!f.ResizeObserver)return()=>{};const h=new f.ResizeObserver(p=>{const x=()=>{const _=p[0];if(_?.borderBoxSize){const N=_.borderBoxSize[0];if(N){d({width:N.inlineSize,height:N.blockSize});return}}d(hl(r))};a.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(x):x()});return h.observe(r,{box:"border-box"}),()=>{h.unobserve(r)}},gl={passive:!0},pl=typeof window>"u"?!0:"onscrollend"in window,Up=(a,u)=>{const r=a.scrollElement;if(!r)return;const f=a.targetWindow;if(!f)return;let d=0;const h=a.options.useScrollendEvent&&pl?()=>{}:$p(f,()=>{u(d,!1)},a.options.isScrollingResetDelay),p=S=>()=>{const{horizontal:b,isRtl:I}=a.options;d=b?r.scrollLeft*(I&&-1||1):r.scrollTop,h(),u(d,S)},x=p(!0),_=p(!1);_(),r.addEventListener("scroll",x,gl);const N=a.options.useScrollendEvent&&pl;return N&&r.addEventListener("scrollend",_,gl),()=>{r.removeEventListener("scroll",x),N&&r.removeEventListener("scrollend",_)}},Gp=(a,u,r)=>{if(u?.borderBoxSize){const f=u.borderBoxSize[0];if(f)return Math.round(f[r.options.horizontal?"inlineSize":"blockSize"])}return a[r.options.horizontal?"offsetWidth":"offsetHeight"]},Hp=(a,{adjustments:u=0,behavior:r},f)=>{var d,h;const p=a+u;(h=(d=f.scrollElement)==null?void 0:d.scrollTo)==null||h.call(d,{[f.options.horizontal?"left":"top"]:p,behavior:r})};class Kp{constructor(u){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let r=null;const f=()=>r||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:r=new this.targetWindow.ResizeObserver(d=>{d.forEach(h=>{const p=()=>{this._measureElement(h.target,h)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(p):p()})}));return{disconnect:()=>{var d;(d=f())==null||d.disconnect(),r=null},observe:d=>{var h;return(h=f())==null?void 0:h.observe(d,{box:"border-box"})},unobserve:d=>{var h;return(h=f())==null?void 0:h.unobserve(d)}}})(),this.range=null,this.setOptions=r=>{Object.entries(r).forEach(([f,d])=>{typeof d>"u"&&delete r[f]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:Bp,rangeExtractor:Fp,onChange:()=>{},measureElement:Gp,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...r}},this.notify=r=>{var f,d;(d=(f=this.options).onChange)==null||d.call(f,this,r)},this.maybeNotify=zn(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),r=>{this.notify(r)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(r=>r()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var r;const f=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==f){if(this.cleanup(),!f){this.maybeNotify();return}this.scrollElement=f,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((r=this.scrollElement)==null?void 0:r.window)??null,this.elementsCache.forEach(d=>{this.observer.observe(d)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,d=>{this.scrollRect=d,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(d,h)=>{this.scrollAdjustments=0,this.scrollDirection=h?this.getScrollOffset()<d?"forward":"backward":null,this.scrollOffset=d,this.isScrolling=h,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(r,f)=>{const d=new Map,h=new Map;for(let p=f-1;p>=0;p--){const x=r[p];if(d.has(x.lane))continue;const _=h.get(x.lane);if(_==null||x.end>_.end?h.set(x.lane,x):x.end<_.end&&d.set(x.lane,!0),d.size===this.options.lanes)break}return h.size===this.options.lanes?Array.from(h.values()).sort((p,x)=>p.end===x.end?p.index-x.index:p.end-x.end)[0]:void 0},this.getMeasurementOptions=zn(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled],(r,f,d,h,p)=>(this.pendingMeasuredCacheIndexes=[],{count:r,paddingStart:f,scrollMargin:d,getItemKey:h,enabled:p}),{key:!1}),this.getMeasurements=zn(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:r,paddingStart:f,scrollMargin:d,getItemKey:h,enabled:p},x)=>{if(!p)return this.measurementsCache=[],this.itemSizeCache.clear(),[];this.measurementsCache.length===0&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(S=>{this.itemSizeCache.set(S.key,S.size)}));const _=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const N=this.measurementsCache.slice(0,_);for(let S=_;S<r;S++){const b=h(S),I=this.options.lanes===1?N[S-1]:this.getFurthestMeasurement(N,S),P=I?I.end+this.options.gap:f+d,T=x.get(b),G=typeof T=="number"?T:this.options.estimateSize(S),q=P+G,B=I?I.lane:S%this.options.lanes;N[S]={index:S,start:P,size:G,end:q,key:b,lane:B}}return this.measurementsCache=N,N},{key:!1,debug:()=>this.options.debug}),this.calculateRange=zn(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(r,f,d,h)=>this.range=r.length>0&&f>0?qp({measurements:r,outerSize:f,scrollOffset:d,lanes:h}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=zn(()=>{let r=null,f=null;const d=this.calculateRange();return d&&(r=d.startIndex,f=d.endIndex),this.maybeNotify.updateDeps([this.isScrolling,r,f]),[this.options.rangeExtractor,this.options.overscan,this.options.count,r,f]},(r,f,d,h,p)=>h===null||p===null?[]:r({startIndex:h,endIndex:p,overscan:f,count:d}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=r=>{const f=this.options.indexAttribute,d=r.getAttribute(f);return d?parseInt(d,10):(console.warn(`Missing attribute name '${f}={index}' on measured element.`),-1)},this._measureElement=(r,f)=>{const d=this.indexFromElement(r),h=this.measurementsCache[d];if(!h)return;const p=h.key,x=this.elementsCache.get(p);x!==r&&(x&&this.observer.unobserve(x),this.observer.observe(r),this.elementsCache.set(p,r)),r.isConnected&&this.resizeItem(d,this.options.measureElement(r,f,this))},this.resizeItem=(r,f)=>{const d=this.measurementsCache[r];if(!d)return;const h=this.itemSizeCache.get(d.key)??d.size,p=f-h;p!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(d,p,this):d.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=p,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(d.index),this.itemSizeCache=new Map(this.itemSizeCache.set(d.key,f)),this.notify(!1))},this.measureElement=r=>{if(!r){this.elementsCache.forEach((f,d)=>{f.isConnected||(this.observer.unobserve(f),this.elementsCache.delete(d))});return}this._measureElement(r,void 0)},this.getVirtualItems=zn(()=>[this.getVirtualIndexes(),this.getMeasurements()],(r,f)=>{const d=[];for(let h=0,p=r.length;h<p;h++){const x=r[h],_=f[x];d.push(_)}return d},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=r=>{const f=this.getMeasurements();if(f.length!==0)return fl(f[Sl(0,f.length-1,d=>fl(f[d]).start,r)])},this.getOffsetForAlignment=(r,f,d=0)=>{const h=this.getSize(),p=this.getScrollOffset();f==="auto"&&(f=r>=p+h?"end":"start"),f==="center"?r+=(d-h)/2:f==="end"&&(r-=h);const x=this.getTotalSize()+this.options.scrollMargin-h;return Math.max(Math.min(x,r),0)},this.getOffsetForIndex=(r,f="auto")=>{r=Math.max(0,Math.min(r,this.options.count-1));const d=this.measurementsCache[r];if(!d)return;const h=this.getSize(),p=this.getScrollOffset();if(f==="auto")if(d.end>=p+h-this.options.scrollPaddingEnd)f="end";else if(d.start<=p+this.options.scrollPaddingStart)f="start";else return[p,f];const x=f==="end"?d.end+this.options.scrollPaddingEnd:d.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(x,f,d.size),f]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(r,{align:f="start",behavior:d}={})=>{d==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(r,f),{adjustments:void 0,behavior:d})},this.scrollToIndex=(r,{align:f="auto",behavior:d}={})=>{d==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),r=Math.max(0,Math.min(r,this.options.count-1));let h=0;const p=10,x=N=>{if(!this.targetWindow)return;const S=this.getOffsetForIndex(r,N);if(!S){console.warn("Failed to get offset for index:",r);return}const[b,I]=S;this._scrollToOffset(b,{adjustments:void 0,behavior:d}),this.targetWindow.requestAnimationFrame(()=>{const P=this.getScrollOffset(),T=this.getOffsetForIndex(r,I);if(!T){console.warn("Failed to get offset for index:",r);return}Wp(T[0],P)||_(I)})},_=N=>{this.targetWindow&&(h++,h<p?this.targetWindow.requestAnimationFrame(()=>x(N)):console.warn(`Failed to scroll to index ${r} after ${p} attempts.`))};x(f)},this.scrollBy=(r,{behavior:f}={})=>{f==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+r,{adjustments:void 0,behavior:f})},this.getTotalSize=()=>{var r;const f=this.getMeasurements();let d;if(f.length===0)d=this.options.paddingStart;else if(this.options.lanes===1)d=((r=f[f.length-1])==null?void 0:r.end)??0;else{const h=Array(this.options.lanes).fill(null);let p=f.length-1;for(;p>=0&&h.some(x=>x===null);){const x=f[p];h[x.lane]===null&&(h[x.lane]=x.end),p--}d=Math.max(...h.filter(x=>x!==null))}return Math.max(d-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(r,{adjustments:f,behavior:d})=>{this.options.scrollToFn(r,{behavior:d,adjustments:f},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(u)}}const Sl=(a,u,r,f)=>{for(;a<=u;){const d=(a+u)/2|0,h=r(d);if(h<f)a=d+1;else if(h>f)u=d-1;else return d}return a>0?a-1:0};function qp({measurements:a,outerSize:u,scrollOffset:r,lanes:f}){const d=a.length-1,h=_=>a[_].start;if(a.length<=f)return{startIndex:0,endIndex:d};let p=Sl(0,d,h,r),x=p;if(f===1)for(;x<d&&a[x].end<r+u;)x++;else if(f>1){const _=Array(f).fill(0);for(;x<d&&_.some(S=>S<r+u);){const S=a[x];_[S.lane]=S.end,x++}const N=Array(f).fill(r+u);for(;p>=0&&N.some(S=>S>=r);){const S=a[p];N[S.lane]=S.start,p--}p=Math.max(0,p-p%f),x=Math.min(d,x+(f-1-x%f))}return{startIndex:p,endIndex:x}}const ml=typeof document<"u"?k.useLayoutEffect:k.useEffect;function Jp(a){const u=k.useReducer(()=>({}),{})[1],r={...a,onChange:(d,h)=>{var p;h?zg.flushSync(u):u(),(p=a.onChange)==null||p.call(a,d,h)}},[f]=k.useState(()=>new Kp(r));return f.setOptions(r),ml(()=>f._didMount(),[]),ml(()=>f._willUpdate()),f}function Yp(a){return Jp({observeElementRect:zp,observeElementOffset:Up,scrollToFn:Hp,...a})}const Nl=a=>{const{items:u,renderItem:r,minWidth:f=200,gap:d=16}=a,h=k.useRef(null),[p,x]=k.useState(1),[_,N]=k.useState(0);k.useLayoutEffect(()=>{if(!h.current)return;const b=()=>{if(h.current){const P=h.current.offsetWidth,T=Math.max(1,Math.floor(P/(f+d/2)));x(T),N(Math.ceil(u.length/T))}};b();const I=new window.ResizeObserver(Di.debounce(b,50));return I.observe(h.current),()=>I.disconnect()},[]);const S=Yp({count:_,getScrollElement:()=>h.current,estimateSize:()=>f+40,overscan:3,gap:d});return i.jsx("div",{ref:h,className:"h-full relative overflow-auto hide-scrollbar",children:i.jsx("div",{style:{height:S.getTotalSize(),position:"relative"},children:S.getVirtualItems().map(b=>{const I=b.index,P=I*p,T=Math.min(P+p,u.length);return i.jsx("div",{"data-index":I,ref:S.measureElement,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${b.start}px)`,display:"grid",gridTemplateColumns:`repeat(${p}, minmax(${f}px, 1fr))`,gap:`${d}px`},children:u.slice(P,T).map((G,q)=>r(G,P+q))},I)})})})},Zp=({generatedImages:a,selectedImageIndex:u,handleSelectImage:r,handleApplySelected:f,handleClose:d,notificationVisible:h,modalVisible:p,modalImageUrl:x,modalImageParams:_,openImageModal:N,closeImageModal:S})=>{const b=(I,P)=>i.jsxs("div",{className:`relative flex flex-col rounded-lg overflow-hidden border ${u===I.index?"border-pink-500 ring-2 ring-pink-300":"border-gray-200"}`,onClick:T=>r(P,T),children:[i.jsx("button",{className:"absolute top-2 right-2 bg-white bg-opacity-75 rounded-full p-0.5 text-gray-600 hover:text-gray-900 shadow-sm z-10",onClick:T=>N(I.url,I.params,T),children:i.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5v-4m0 4h-4m4 0l-5-5"})})}),i.jsx("div",{className:"aspect-square",children:i.jsx("img",{src:I.url,alt:`Generated image ${P+1}`,className:"w-full h-full object-cover"})}),i.jsx("div",{className:"p-2 text-xs text-gray-600 bg-white max-h-16 overflow-y-auto",children:Object.entries(I.params).filter(([T,G])=>T!=="nodeParams"&&typeof G!="object").map(([T,G])=>i.jsxs("div",{children:[T,": ",String(G)]},T))})]},P.toString());return i.jsxs("div",{className:"h-full flex flex-col relative bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[i.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Generation Complete"}),i.jsxs("p",{className:"text-xs text-gray-500",children:["All ",a.length," images have been generated."]})]}),i.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:d,children:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),h&&i.jsx("div",{className:"fixed top-4 right-4 bg-green-100 border-l-4 border-green-500 text-green-700 p-3 shadow-md rounded animate-fade-in-out z-50",children:i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:"py-1",children:i.jsx("svg",{className:"h-4 w-4 text-green-500 mr-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),i.jsx("p",{className:"text-xs",children:"Parameters has been applied."})]})}),i.jsx("div",{className:"flex-1 min-h-0",children:i.jsx(Nl,{items:a,renderItem:b})}),i.jsx("div",{className:"mt-6 flex justify-end",children:i.jsx("button",{onClick:I=>f(I),className:"px-3 py-1.5 text-xs bg-pink-200 text-pink-700 rounded-md hover:bg-pink-300 transition-colors",disabled:u===null,children:"Apply Selected"})}),i.jsx(pr,{visible:p,imageUrl:x,params:_||{},onClose:S})]})},Vp=({visible:a,aiWritingModalText:u,setAiWritingModalText:r,aiGeneratedTexts:f,aiSelectedTexts:d,aiWritingLoading:h,aiWritingError:p,handleAiWriting:x,toggleTextSelection:_,addSelectedTexts:N,onClose:S})=>a?i.jsx("div",{className:"fixed inset-0 bg-black flex items-center justify-center z-50",children:i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col",children:[i.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"AI Writing Assistant"}),i.jsx("button",{className:"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200",onClick:S,children:i.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),i.jsxs("div",{className:"p-4 overflow-y-auto flex-1",children:[i.jsxs("div",{className:"mb-4",children:[i.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 mb-2",children:"Enter text and AI will generate variations"}),i.jsx("textarea",{className:`w-full px-4 py-3 border border-gray-200 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white
                bg-gray-50 dark:bg-gray-700 
                placeholder-gray-500 dark:placeholder-gray-400
                focus:border-blue-500 dark:focus:border-blue-400 
                focus:ring-2 focus:ring-blue-500/20 dark:focus:ring-blue-400/20
                focus:outline-none`,rows:3,placeholder:"Enter some text here...",value:u,onChange:b=>r(b.target.value)}),i.jsx("button",{className:`mt-2 px-4 py-2 rounded-lg text-sm flex items-center transition-colors ${h?"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white"}`,onClick:x,disabled:h,children:h?i.jsxs(i.Fragment,{children:[i.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-gray-500 dark:text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[i.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),i.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Generating..."]}):i.jsx(i.Fragment,{children:"Generate"})})]}),p&&i.jsx("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800/20 rounded-md text-red-700 dark:text-red-400 text-sm",children:p}),f.length>0&&i.jsxs("div",{className:"mb-4",children:[i.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Generated variations (select items to add):"}),i.jsx("div",{className:"space-y-2 max-h-[40vh] overflow-y-auto p-2",children:f.map((b,I)=>i.jsxs("div",{className:"flex items-start border border-gray-200 dark:border-gray-600 rounded-md p-2",children:[i.jsx("div",{className:"mr-2 mt-1",children:i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:"checkbox",id:`text${I+1}`,checked:!!d[`text${I+1}`],onChange:()=>_(`text${I+1}`),className:"sr-only"}),i.jsx("div",{className:`h-4 w-4 rounded border ${d[`text${I+1}`]?"bg-blue-600 dark:bg-blue-500 border-blue-600 dark:border-blue-500":"border-gray-300 dark:border-gray-600"} flex items-center justify-center cursor-pointer`,onClick:()=>_(`text${I+1}`),children:d[`text${I+1}`]&&i.jsx("svg",{className:"h-3 w-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]})}),i.jsx("label",{htmlFor:`text${I+1}`,className:"text-sm text-gray-700 dark:text-gray-300 cursor-pointer flex-1",children:b})]},I))})]})]}),i.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex justify-end flex-shrink-0",children:[i.jsx("button",{className:`px-5 py-2.5 text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 
            rounded-lg font-medium transition-colors mr-3`,onClick:S,children:"Cancel"}),i.jsx("button",{className:`px-5 py-2.5 rounded-lg font-medium transition-colors ${Object.values(d).every(b=>!b)?"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white"}`,onClick:N,disabled:Object.values(d).every(b=>!b),children:"Add Selected"})]})]})}):null,Ri=a=>{const u=[],r={};if(Object.keys(a).forEach(h=>{const p=parseInt(h),x=a[h]||{},_=Object.keys(x).filter(S=>x[S]&&x[S].length>0);if(_.length===0)return;const N=[[]];_.forEach(S=>{const b=x[S],I=[];N.forEach(P=>{b.forEach(T=>{const G=[...P,{nodeId:p,paramName:S,paramValue:String(T)}];I.push(G)})}),N.length=0,N.push(...I)}),r[h]=N}),Object.keys(r).length===0)return u;if(Object.keys(r).length===1){const h=Object.keys(r)[0];return r[h]}const f=Object.keys(r);let d=r[f[0]];for(let h=1;h<f.length;h++){const p=r[f[h]],x=[];d.forEach(_=>{p.forEach(N=>{x.push([..._,...N])})}),d=x}return d},Xp=(a,u)=>{const r={};r.nodeParams={};const f=Ri(a);return u<f.length&&f[u].forEach(h=>{const p=h.nodeId.toString(),x=h.paramName,_=h.paramValue;r.nodeParams[p]||(r.nodeParams[p]={}),r.nodeParams[p][x]=_,r[x]=_}),r},jl="parameter_debug_history",xl=30,vl=async(a,u,r,f,d)=>{try{const h=Cl(),p={id:tt(),timestamp:Date.now(),title:Wi(a,u),nodeName:a,params:{...u,nodeNames:{...u.nodeNames||{},[a.split("<")[0]]:a.split("<")[0]}},generatedImages:r,totalCount:f,workflow:d};return h.unshift(p),h.length>xl&&h.splice(xl),localStorage.setItem(jl,JSON.stringify(h)),p}catch(h){return console.error("Error saving parameter debug history:",h),null}},Cl=()=>{try{const a=localStorage.getItem(jl);if(a)return JSON.parse(a)}catch(a){console.error("Error loading parameter debug history:",a)}return[]},kl=a=>{const u=new Date(a);return`${u.getFullYear()}-${String(u.getMonth()+1).padStart(2,"0")}-${String(u.getDate()).padStart(2,"0")} ${String(u.getHours()).padStart(2,"0")}:${String(u.getMinutes()).padStart(2,"0")}`},Wi=(a,u)=>{if(u.nodeParams)return Object.entries(u.nodeParams).map(([h,p])=>{let x=a;u.selectedNodeInfoMap&&u.selectedNodeInfoMap[h]&&(x=u.selectedNodeInfoMap[h]);const _=Object.keys(p).slice(0,3);return`${x}<${_.join(",")}>`}).join(";");const r=Object.keys(u).filter(f=>f!=="nodeParams"&&f!=="selectedNodeInfoMap").slice(0,3);return`${a}<${r.join(",")}>`},Qp=({historyItems:a,onViewHistoryItem:u,onClose:r})=>i.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 flex flex-col h-full",children:[i.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Experiments History"}),i.jsxs("p",{className:"text-xs text-gray-500",children:["Last ",a.length," experiments"]})]}),i.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:r,children:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),a.length===0?i.jsx("div",{className:"flex-1 flex items-center justify-center text-gray-500 text-sm",children:"No history items found"}):i.jsx("div",{className:"flex-1 overflow-y-auto",children:a.map(f=>i.jsxs("div",{className:"border border-gray-200 rounded-lg mb-3 overflow-hidden",children:[i.jsxs("div",{className:"bg-gray-50 py-2 px-3 flex items-center justify-between border-b",children:[i.jsx("div",{className:"text-[14px] text-gray-600",children:kl(f.timestamp)}),i.jsx("button",{onClick:()=>u(f),className:"px-3 py-1 text-xs bg-pink-200 text-pink-700 rounded-md hover:bg-pink-300 transition-colors",children:"view"})]}),i.jsx("div",{className:"p-3",children:i.jsx("div",{className:"text-[10px] font-medium text-gray-700",children:Wi(f.nodeName,f.params)})})]},f.id))})]}),em=({historyItem:a,selectedImageIndex:u,handleSelectImage:r,handleClose:f,modalVisible:d,modalImageUrl:h,modalImageParams:p,openImageModal:x,closeImageModal:_})=>{const{timestamp:N,nodeName:S,generatedImages:b,params:I}=a,P=(T,G)=>i.jsxs("div",{className:`relative flex flex-col rounded-lg overflow-hidden border ${u===G?"border-pink-500 ring-2 ring-pink-300":"border-gray-200"}`,onClick:q=>r(G,q),children:[i.jsx("button",{className:"absolute top-2 right-2 bg-white bg-opacity-75 rounded-full p-0.5 text-gray-600 hover:text-gray-900 shadow-sm z-10",onClick:q=>x(T.url,T.params,q),children:i.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5v-4m0 4h-4m4 0l-5-5"})})}),i.jsx("div",{className:"aspect-square",children:i.jsx("img",{src:T.url,alt:`Generated image ${G+1}`,className:"w-full h-full object-cover"})}),i.jsx("div",{className:"p-2 text-xs text-gray-600 bg-white max-h-16 overflow-y-auto",children:Object.entries(T.params).filter(([q,B])=>q!=="nodeParams"&&typeof B!="object").map(([q,B])=>i.jsxs("div",{children:[q,": ",String(B)]},q))})]},G.toString());return i.jsxs("div",{className:"h-full flex flex-col relative bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[i.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-start",children:[i.jsxs("div",{className:"min-w-0",children:[i.jsx("h3",{className:"text-base font-medium text-gray-800 truncate hover:!break-words hover:!whitespace-normal hover:!overflow-visible",children:Wi(S,I)}),i.jsxs("p",{className:"text-xs text-gray-500",children:[kl(N)," • ",b.length," images"]})]}),i.jsx("button",{className:"text-gray-400 hover:text-gray-600 mt-0",onClick:f,children:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),i.jsx("div",{className:"flex-1 min-h-0",children:i.jsx(Nl,{items:b,renderItem:P})}),i.jsx(pr,{visible:d,imageUrl:h,params:p?{...p,nodeNames:{[a.nodeName.split("<")[0]]:a.nodeName.split("<")[0]}}:void 0,onClose:_})]})},tm=`
  @keyframes highlight-pulse {
    0% { 
      box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.5);
    }
    70% { 
      box-shadow: 0 0 0 15px rgba(59, 130, 246, 0);
    }
    100% { 
      box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
    }
  }
  
  .highlight-pulse {
    animation: highlight-pulse 1.5s infinite;
    border: 2px solid #3b82f6;
  }

  @keyframes fade-in-out {
    0% { opacity: 0; transform: translateY(-20px); }
    10% { opacity: 1; transform: translateY(0); }
    90% { opacity: 1; transform: translateY(0); }
    100% { opacity: 0; transform: translateY(-20px); }
  }
  
  .animate-fade-in-out {
    animation: fade-in-out 3s forwards;
  }
`,mr="parameter_debug_state",yl=a=>{try{localStorage.setItem(mr,JSON.stringify(a))}catch(u){console.error("Error saving parameter debug state:",u)}},nm=()=>{try{const a=localStorage.getItem(mr);if(a)return JSON.parse(a)}catch(a){console.error("Error loading parameter debug state:",a)}return null},rm=()=>{try{localStorage.removeItem(mr)}catch(a){console.error("Error clearing parameter debug state:",a)}},sm=(a,u,r,f,d,h)=>{const p=`${a}_${u}`;h(_=>{const N=[..._[p]||[]];return N[r]=f,{..._,[p]:N}});const x=[...d[p]||[]];return x[r]=f,x},im=(a,u,r,f)=>{const d=`${a}_${u}`;return f(h=>{const p=[...h[d]||[]];return p.push(""),{...h,[d]:p}}),[...r[d]||[],""]},om=(a,u,r,f,d)=>{const h=`${a}_${u}`;d(x=>{const _=[...x[h]||[]];return _.splice(r,1),{...x,[h]:_}});const p=[...f[h]||[]];return p.splice(r,1),p},am=(a,u,r,f,d)=>{r.preventDefault(),r.stopPropagation();const h=`${a}_${u}`;d(p=>{if(p[h]&&typeof p[h]=="object"?p[h].isOpen:!!p[h])return{...p,[h]:!1};{let _=0,N=0;if(r.currentTarget){const I=r.currentTarget.getBoundingClientRect();_=I.left,N=I.bottom}else _=r.clientX,N=r.clientY+20;const S=window.innerWidth,b=250;return _+b>S&&(_=S-b-10),_<0&&(_=10),{...p,[h]:{isOpen:!0,x:_,y:N}}}})},lm=(a,u,r,f,d)=>{d(h=>{const p={...h};return p[a]||(p[a]={}),p[a][u]=r,p})},cm=(a,u,r,f,d,h)=>{h&&(h.preventDefault(),h.stopPropagation()),d(p=>{const x={...p};x[a]||(x[a]={}),x[a][u]||(x[a][u]=[]);const _=x[a][u];return _.includes(r)?x[a][u]=_.filter(N=>N!==r):x[a][u]=[..._,r],x})},um=(a,u,r,f,d)=>{const h=`${a}_${u}`;d(p=>({...p,[h]:r}))},dm=(a,u,r,f,d)=>{if(!f[a]){d(a,u,r);return}const h=f[a][u]||[];r.length===h.length?d(a,u,[]):d(a,u,[...r])},fm=(a,u,r,f,d,h)=>{h&&(h.preventDefault(),h.stopPropagation());const p=u[a];if(r(x=>({...x,[a]:!p})),p){const x={...f};Object.keys(x).forEach(_=>{x[_][a]&&delete x[_][a]}),d(x)}},hm=(a,u,r,f,d,h,p)=>{p.preventDefault(),p.stopPropagation();const x={...u};if(u.nodeParams){const _={};Object.keys(u.nodeParams).forEach(N=>{const S=r.find(b=>b.id.toString()===N);_[N]=S?S.title||`Node ${N}`:`Node ${N}`}),x.nodeNames=_}else if(Object.keys(u).length>0){const _={};Object.entries(u).forEach(([N,S])=>{(typeof S!="object"||S===null)&&(_[N]=S)}),Object.keys(_).length>0&&(x.nodeParams={default:_},x.nodeNames={default:u.node_name||u.nodeName||"参数"})}f(a),d(x),h(!0)},gm=(a,u)=>{u&&(u.preventDefault(),u.stopPropagation()),a(!1)},pm=(a,u,r,f,d,h,p,x,_,N,S)=>{if(S&&(S.preventDefault(),S.stopPropagation()),a===0){const b={...f};Object.keys(b).forEach(I=>{const P=b[I];Object.keys(P).forEach(T=>{r[T]||delete P[T]})}),d(b)}if(a===1){const b={...f};p.forEach(P=>{const T=P.id.toString(),G=P.widgets||{};Object.values(G).forEach(q=>{const B=q.name;if(r[B]&&(q.type==="customtext"||q.type.toLowerCase().includes("text"))){const D=`${T}_${B}`,F=h[D]||[""];b[T]=b[T]||{},b[T][B]=F}})}),d(b);const I=N(b);x(I.length)}_(null),u(b=>Math.min(b+1,2))},mm=(a,u,r,f,d,h,p,x,_,N)=>{if(N&&(N.preventDefault(),N.stopPropagation()),_(null),p&&x(!1),a===1){const S=r.map(P=>P.id.toString()),b=Object.keys(f),I={...f};b.forEach(P=>{S.includes(P)||delete I[P]}),d(I)}if(a===2||p){const S={...f};Object.entries(h).forEach(([b,I])=>{if(!I||I.length===0)return;const[P,T]=b.split("_");r.some(G=>G.id.toString()===P)&&(S[P]=S[P]||{},JSON.stringify(S[P][T])!==JSON.stringify(I)&&(S[P][T]=I))}),d(S)}u(S=>Math.max(S-1,0))},xm=(a,u,r,f,d)=>{d&&(d.preventDefault(),d.stopPropagation()),f(Math.max(1,Math.min(a,Math.ceil(r.length/u))))};function vm(a,u){try{if(!a)return console.error("Invalid prompt_output: ",a),a;for(const r of u){if(!a[r.nodeId]){console.error(`Node with ID ${r.nodeId} not found`);continue}if(!a[r.nodeId].inputs){console.error(`Inputs not found for node with ID ${r.nodeId}`);continue}a[r.nodeId].inputs[r.paramName]=r.paramValue}return a}catch(r){return console.error("Error updating prompt:",r),a}}async function ym(a){const u=await De.graphToPrompt(),r=vm(u.output,a);console.log("queuePrompt updated_prompt:",r);const f={prompt:r,client_id:De.api.clientId,extra_data:{extra_pageinfo:{workflow:u.workflow}}};console.debug("queuePrompt request_body.prompt:",r);const d=await Ep(f);return console.debug("queuePrompt response:",d),d}function bl(a){const u=document.createElement("canvas"),r=u.getContext("2d");if(u.width=512,u.height=512,r){r.fillStyle="#f8d7da",r.fillRect(0,0,u.width,u.height),r.strokeStyle="#dc3545",r.lineWidth=4,r.strokeRect(10,10,u.width-20,u.height-20),r.fillStyle="#dc3545",r.beginPath(),r.arc(u.width/2,150,50,0,2*Math.PI),r.fill(),r.fillStyle="white",r.font="bold 80px Arial",r.textAlign="center",r.textBaseline="middle",r.fillText("!",u.width/2,150),r.fillStyle="#721c24",r.font="20px Arial",r.textAlign="center",r.textBaseline="middle";const f=u.width-60,d=30,h=a.split(" ");let p="",x=250;for(let _=0;_<h.length;_++){const N=p+h[_]+" ";r.measureText(N).width>f&&_>0?(r.fillText(p,u.width/2,x),p=h[_]+" ",x+=d):p=N}r.fillText(p,u.width/2,x)}return u.toDataURL("image/png")}async function bm(a){try{if(!a||a==="")return console.log("No prompt ID provided"),{1:[bl("Fail to generate prompt ID")]};const u=await Mp(a);if(!u||!u[a])return console.log("Not finished for prompt ID:",a),{};const r=u[a];if(r.status&&r.status.status_str==="error"){console.error("Error for prompt ID:",a);const d=r.status.messages;if(d&&d.length>0){const h=d[d.length-1];if(h&&h.length>0){const p=h[0];return{1:[bl(p)]}}}}const f={};if(r.outputs)for(const d in r.outputs){const h=r.outputs[d];if(h&&h.images){f[d]=[];for(const p of h.images)if(p&&p.filename&&p.type){const x=De.graph._nodes_by_id[d].imgs[0].currentSrc.split("?")[0];f[d].push(x+"?filename="+encodeURIComponent(p.filename)+"&type="+encodeURIComponent(p.type)+(p.subfolder?"&subfolder="+encodeURIComponent(p.subfolder):""))}console.log("outputImages for nodeId:",d,f[d])}}return f}catch(u){throw console.error("Error getting output images from prompt:",u),u}}function _m(){const a=Object.values(De.graph._nodes_by_id),u=[],r=[];for(const f of a)f.type==="SaveImage"?u.push(f.id):f.type==="PreviewImage"&&r.push(f.id);if(console.log("saveNodeIds:",u),console.log("previewNodeIds:",r),u.length===0&&r.length===0)throw new Error("No SaveImage or PreviewImage node found, please add one to the graph");return u.length===1?u[0]:u.length==0&&r.length===1?r[0]:null}async function wm(a,u){const r=await bm(a);return Object.keys(r).length===0?null:r[u.toString()]&&r[u.toString()].length>0?r[u.toString()][0]:null}const Sm=async(a,u,r,f,d,h,p,x,_,N,S,b,I,P)=>{I&&(I.preventDefault(),I.stopPropagation()),Al(N,_);const T=S(a),G=T.length;if(G>100){d(`Cannot generate more than 100 images at once (currently: ${G} images)`);return}d(null),r(!0),f(0),console.log("Generated parameter combinations:",T);let q=null;try{q=(await b.graphToPrompt()).output}catch(j){console.error("Error capturing workflow data:",j)}if(Tt.trackEvent({event_type:"start_generation",message_type:"parameter_debug",message_id:u,data:{workflow:q,all_params:a,count:G}}),T.length===0){d("No valid parameter combinations found. Please check your parameter selections."),r(!1);return}let B=P||null;if(B===null){const j=_m();j!==null&&(B=j)}if(B===null){d("Please select a SaveImage or PreviewImage node first."),r(!1);return}const D={};Object.keys(a).forEach(j=>{const L=b.graph._nodes_by_id[j];L&&(D[j]=L.type||L.comfyClass||"Unknown Node")});const F=[];try{const j=Date.now().toString();_.current=j;for(const ae of T){const pe=await ym(ae);pe.prompt_id?F.push(pe.prompt_id):(console.error("Failed to get prompt_id from response:",pe),F.push(""))}const L=Array(T.length).fill(null).map((ae,pe)=>({url:`https://source.unsplash.com/random/300x300?sig=${Math.random()}`,params:Xp(a,pe)}));h(L);const z=Date.now(),Q=5*60*1e3,Ce=Object.keys(a)[0],U=D[Ce]||"Unknown Node";El(F,B,L,j,z,Q,_,N,h,f,r,p,x,U,a,G,q,D)}catch(j){console.error("Error generating images:",j),r(!1)}},El=async(a,u,r,f,d,h,p,x,_,N,S,b,I,P,T,G,q,B)=>{if(p.current!==f){console.log("Another polling session has started, stopping this one");return}if(Date.now()-d>h){if(console.log("Timeout reached while waiting for images"),p.current===f&&(S(!1),b(!0),I(1),r.length>0&&P&&T)){const F=r[0].params;B&&(F.selectedNodeInfoMap=B),vl(P,F,r,G||r.length,q)}return}let D=0;for(let F=0;F<a.length;F++){const j=a[F];if(j)try{const L=await wm(j,Number(u));L&&(r[F]={...r[F],url:L},D++)}catch(L){console.error(`Error fetching image for prompt ID ${j}:`,L)}}if(_([...r]),N(D),D===a.length){if(console.log("All images have been generated!"),p.current===f&&(S(!1),b(!0),I(1),r.length>0&&P&&T)){const F=r[0].params;B&&(F.selectedNodeInfoMap=B),vl(P,F,r,G||r.length,q)}return}p.current===f&&(x.current=setTimeout(()=>{El(a,u,r,f,d,h,p,x,_,N,S,b,I,P,T,G,q,B)},2e3))},Al=(a,u)=>{a.current&&(clearTimeout(a.current),a.current=null),u.current=null},Nm=async(a,u,r,f,d,h)=>{if(!a.trim()){f("Please enter some text to generate variations");return}r(!0),f(null),d([]),h({});try{const p=await Tt.generateSDPrompts(a);d(p),Tt.trackEvent({event_type:"prompt_generate",message_type:"parameter_debug",message_id:u,data:{input_text:a,generated_texts:p}});const x={};p.forEach((_,N)=>{x[`text${N+1}`]=!1}),h(x)}catch(p){console.error("Error generating text:",p),f("Failed to generate text variations. Please try again.")}finally{r(!1)}},jm=(a,u)=>{u(r=>({...r,[a]:!r[a]}))},Cm=(a,u,r,f,d,h,p,x,_,N)=>{const S=`${a}_${u}`,b=Object.entries(r).filter(([P,T])=>T).map(([P])=>{const T=parseInt(P.replace("text",""))-1;return f[T]});if(b.length===0)return;x(P=>{const T=[...P[S]||[]];return{...P,[S]:[...T,...b]}}),Tt.trackEvent({event_type:"prompt_apply",message_type:"parameter_debug",message_id:h,data:{input_text:d,generated_texts:f,selected_texts:b}});const I=[...p[S]||[],...b];_(a,u,I),N(!1)},km=(a,u,r,f,d,h,p,x,_,N)=>{r(!0),f(a),d(u),h(""),p([]),x({}),_(!1),N(null)},Em=(a,u,r,f,d,h,p,x,_,N,S,b,I,P,T,G,q,B,D,F,j,L,z,Q,Ce,U,ae,pe,R,ye=!1)=>{a(0),u({Steps:!0,CFG:!0,sampler_name:!0,threshold:!1,prompt:!1}),r(tt()),f(),d(!1),h(!1),p(0),x(12),_(null),N(Array(12).fill(null).map((le,re)=>({url:`https://source.unsplash.com/random/300x300?sig=${Math.random()}`,params:{step:re%3===0?5:re%3===1?10:15,sampler_name:"euler",cfg:1}}))),S({}),b({}),I({}),P({}),T(1),G(null),q(!1),B(!1),D(""),F(null),j({}),L(!1),z(""),Q([]),Ce(!1),U(""),ae(""),pe(null),R({}),ye&&rm()},Am=(a,u,r)=>{r&&(r.preventDefault(),r.stopPropagation()),u(a)},Im=async(a,u,r,f,d,h,p)=>{if(p&&(p.preventDefault(),p.stopPropagation()),a!==null){console.log(`Applied image ${a+1} with parameters:`,u[a].params);let x=1;if(d){for(const N in d)if(d[N])for(const S in d[N]){const b=d[N][S];if(b){let I=1;Array.isArray(b)?I=b.length>0?b.length:1:typeof b=="object"&&b!==null&&(I=Object.keys(b).length>0?Object.keys(b).length:1),x=x*I}}}Tt.trackEvent({event_type:"parameter_debug_apply",message_type:"parameter_debug",message_id:f,data:{workflow:(await r.graphToPrompt()).output,selected_params:u[a].params,all_params:d,count:x}});const _=u[a].params;_.nodeParams&&(Object.entries(_.nodeParams).forEach(([N,S])=>{const b=r.graph._nodes_by_id[N];!b||!b.widgets||Object.entries(S).forEach(([I,P])=>{for(const T of b.widgets)if(T.name===I){T.value=P;break}})}),r.graph.setDirtyCanvas(!1,!0),h(!0),setTimeout(()=>{h(!1)},3e3))}},Mm=(a,u,r,f,d,h,p)=>{if(p&&(p.preventDefault(),p.stopPropagation()),a===1&&r!==void 0){const x=[...u];x[r],x.splice(r,1),x.length===0?d&&(f({type:"SET_SCREEN_STATE",payload:null}),h(!0),d()):f({type:"SET_SELECTED_NODE",payload:x});return}d&&(f({type:"SET_SCREEN_STATE",payload:null}),h(!0),d())},Lm=({selectedNodes:a,visible:u,onClose:r})=>{const[f,d]=k.useState(0),[h,p]=k.useState({Steps:!0,CFG:!0,sampler_name:!0,threshold:!1,prompt:!1}),[x,_]=k.useState(tt()),[N,S]=k.useState(!1),[b,I]=k.useState(!1),[P,T]=k.useState(0),[G,q]=k.useState(12),[B,D]=k.useState(null),[F,j]=k.useState(()=>Array(12).fill(null).map((O,W)=>({url:`https://source.unsplash.com/random/300x300?sig=${Math.random()}`,params:{step:W%3===0?5:W%3===1?10:15,sampler_name:"euler",cfg:1}}))),[L,z]=k.useState({}),[Q,Ce]=k.useState({}),[U,ae]=k.useState({}),[pe,R]=k.useState({}),[ye,le]=k.useState(1),re=6,[ne,he]=k.useState(null),[K,ce]=k.useState(!1),[J,V]=k.useState(!1),[ve,Oe]=k.useState(""),[Ie,Ee]=k.useState(null),[ze,nt]=k.useState({}),[Ve,lt]=k.useState(!1),[Ue,bt]=k.useState(""),[At,Pt]=k.useState([]),[Ke,rt]=k.useState(!1),[Z,se]=k.useState(""),[Me,$e]=k.useState(""),[ct,we]=k.useState(null),[Te,Pe]=k.useState({}),[Je,st]=k.useState(!1),[cn,un]=k.useState([]),[$t,dn]=k.useState(null),{dispatch:fn}=Un(),jn=k.useRef(null),Cn=k.useRef(null),[Gn,Yt]=k.useState(()=>u);k.useEffect(()=>{if(Je){const O=Cl();un(O)}},[Je]);const Hn=async()=>{Nm(Ue,x,rt,we,Pt,Pe)},Kn=(O,W,Ne,Xe)=>{const Xt=sm(O,W,Ne,Xe,ze,nt);Zt(O,W,Xt)},qn=(O,W)=>{const Ne=im(O,W,ze,nt);Zt(O,W,Ne)},gs=(O,W,Ne)=>{const Xe=om(O,W,Ne,ze,nt);Zt(O,W,Xe)},ps=O=>{jm(O,Pe)},ms=()=>{Cm(Z,Me,Te,At,Ue,x,ze,nt,Zt,lt)},vr=(O,W)=>{km(O,W,lt,se,$e,bt,Pt,Pe,rt,we)},Jn=O=>{O&&(O.preventDefault(),O.stopPropagation()),st(W=>!W)},xs=O=>{dn(O),st(!1),j(O.generatedImages||[]),D(null),le(1)},vs=O=>{O&&(O.preventDefault(),O.stopPropagation()),dn(null)};k.useEffect(()=>{if(!a||a.length===0)return;const O={...L},W=a.map(Xe=>Xe.id.toString());Object.keys(O).forEach(Xe=>{W.includes(Xe)||delete O[Xe]}),a.forEach(Xe=>{const Xt=Xe.id.toString();O[Xt]||(O[Xt]={})}),JSON.stringify(O)!==JSON.stringify(L)&&z(O)},[a,L]),k.useEffect(()=>{fn({type:"SET_SCREEN_STATE",payload:{currentScreen:f,isProcessing:N,isCompleted:b}})},[f,N,b,fn]),k.useEffect(()=>{const O=document.createElement("style");return O.textContent=tm,document.head.appendChild(O),()=>{document.head.removeChild(O)}},[]),k.useEffect(()=>{const O=W=>{if(Object.values(Q).some(Ne=>Ne)){const Ne=W.target,Xe=!!Ne.closest(".dropdown-menu"),Xt=!!Ne.closest("[data-dropdown]");!Xe&&!Xt&&Ce({})}};return document.addEventListener("mousedown",O),()=>{document.removeEventListener("mousedown",O)}},[Q]),k.useEffect(()=>{u&&(JSON.parse(localStorage.getItem(mr)||"{}").task_id||_(tt()))},[u]),k.useEffect(()=>{if(u){Yt(!0);try{const O=localStorage.getItem(mr);if(O){const W=JSON.parse(O);if(!a||a.length===0){console.log("Not restoring parameter debug state: no nodes selected"),Yt(!1);return}W.currentScreen!==void 0&&d(W.currentScreen),W.selectedParams&&p(W.selectedParams),W.task_id&&_(W.task_id);const Ne=W.generatedImages&&W.generatedImages.length>0;W.isProcessing!==void 0&&!W.isProcessing&&S(!1),W.isCompleted!==void 0&&Ne&&I(W.isCompleted),W.completedCount!==void 0&&T(W.completedCount),W.totalCount!==void 0&&q(W.totalCount),W.selectedImageIndex!==void 0&&D(W.selectedImageIndex),W.generatedImages&&j(W.generatedImages),W.paramTestValues&&z(W.paramTestValues),W.searchTerms&&ae(W.searchTerms),W.inputValues&&R(W.inputValues),W.currentPage!==void 0&&le(W.currentPage),W.textInputs&&nt(W.textInputs)}}catch(O){console.error("Error loading parameter debug state:",O)}finally{setTimeout(()=>{Yt(!1)},50)}}else Yt(!0);return()=>{if(!u)return;yl({currentScreen:f,selectedParams:h,task_id:x,isProcessing:N,isCompleted:b,completedCount:P,totalCount:G,selectedImageIndex:B,generatedImages:F,paramTestValues:L,searchTerms:U,inputValues:pe,currentPage:ye,textInputs:ze})}},[u]);const ys=(O=!1)=>{Em(d,p,_,Vn,S,I,T,q,D,j,z,Ce,ae,R,le,he,ce,V,Oe,Ee,nt,lt,bt,Pt,rt,se,$e,we,Pe,O),st(!1),dn(null)};k.useEffect(()=>{if(!u)return;const O=setTimeout(()=>{yl({currentScreen:f,selectedParams:h,task_id:x,isProcessing:N,isCompleted:b,completedCount:P,totalCount:G,selectedImageIndex:B,generatedImages:F,paramTestValues:L,searchTerms:U,inputValues:pe,currentPage:ye,textInputs:ze})},500);return()=>clearTimeout(O)},[u,f,h,x,N,b,P,G,B,F,L,U,pe,ye,ze]);const yr=O=>{pm(f,d,h,L,z,ze,a,q,he,Ri,O)},kn=O=>{mm(f,d,a,L,z,ze,b,I,he,O)},bs=(O,W)=>{fm(O,h,p,L,z,W)},_s=(O,W,Ne)=>{am(O,W,Ne,Q,Ce)},Zt=(O,W,Ne)=>{lm(O,W,Ne,L,z)},Yn=(O,W,Ne,Xe)=>{cm(O,W,Ne,L,z,Xe)},ws=(O,W,Ne)=>{um(O,W,Ne,U,ae)},Zn=(O,W,Ne)=>{dm(O,W,Ne,L,Zt)},br=(O,W)=>{xm(O,re,F,le,W)},Vn=()=>{Al(jn,Cn)};k.useEffect(()=>()=>{Vn()},[]);const Ss=async(O,W)=>{Sm(L,x,S,T,he,j,I,le,Cn,jn,Ri,De,O,W)},_r=(O,W)=>{Am(O,D,W)},wr=(O,W,Ne)=>{hm(O,W,a,Oe,Ee,V,Ne)},hn=O=>{gm(V,O)},Ns=async O=>{Im(B,F,De,x,L,ce,O)},Vt=(O,W)=>{Mm(f,a,W,fn,r,ys,O)},gn=()=>i.jsx(i.Fragment,{children:i.jsx(pr,{visible:J,imageUrl:ve,params:Ie||{},onClose:hn})});return $t?i.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4",onClick:O=>O.stopPropagation(),children:i.jsx(em,{historyItem:$t,selectedImageIndex:B,handleSelectImage:_r,handleClose:vs,currentPage:ye,handlePageChange:br,imagesPerPage:re,modalVisible:J,modalImageUrl:ve,modalImageParams:Ie,openImageModal:wr,closeImageModal:hn})}):Je?i.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4 flex flex-col h-full max-h-[80vh]",onClick:O=>O.stopPropagation(),children:i.jsx(Qp,{historyItems:cn,onViewHistoryItem:xs,onClose:Jn})}):Gn&&u&&a.length>0?i.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 bg-gray-50 overflow-y-auto",onClick:O=>O.stopPropagation(),children:[i.jsxs("div",{className:"p-8 rounded-lg shadow-sm relative flex flex-col items-center",children:[i.jsx("div",{className:"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),i.jsx("div",{className:"mt-4 text-gray-600 text-sm",children:"Loading interface..."})]}),i.jsx(pr,{visible:J,imageUrl:ve,params:Ie||{},onClose:hn})]}):!u||a.length===0?i.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 bg-gray-50 overflow-y-auto",onClick:O=>O.stopPropagation(),children:[i.jsxs("div",{className:"max-w-lg p-8 rounded-lg shadow-sm border border-blue-100 relative",children:[i.jsxs("div",{className:"absolute top-3 right-3 flex",children:[i.jsx("button",{className:"text-blue-500 hover:text-blue-700 mr-2",onClick:Jn,title:"Show History",children:i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:i.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z",clipRule:"evenodd"})})}),i.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:Vt,children:i.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),i.jsxs("div",{className:"mb-6 text-center",children:[i.jsx("h3",{className:"text-base font-bold text-blue-600 mb-2",children:"GenLab"}),i.jsx("div",{className:"h-1 w-16 bg-blue-500 mx-auto rounded-full mb-4"})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"text-left mb-4",children:[i.jsx("h3",{className:"text-sm font-medium text-gray-800 mb-3",children:"Batch-test parameters & find the best combo in one click."}),i.jsx("div",{className:"h-px w-full bg-gray-200 my-4"})]}),i.jsxs("div",{className:"text-left",children:[i.jsx("h4",{className:"text-base font-medium text-gray-800 mb-4",children:"How to use"}),i.jsxs("div",{className:"space-y-2 mb-4",children:[i.jsxs("p",{className:"text-sm text-gray-700",children:[i.jsx("span",{className:"font-bold",children:"1 - "}),"Click any node(hold Shift to select multiple nodes)"]}),i.jsxs("p",{className:"text-sm text-gray-700",children:[i.jsx("span",{className:"font-bold",children:"2 - "}),"Set parameter ranges and start batch generation."]})]}),i.jsx("div",{className:"h-px w-full bg-gray-200 my-4"}),i.jsx("p",{className:"text-sm text-blue-600 mt-6",children:"Let's select a node to begin!"})]})]})]}),i.jsx(pr,{visible:J,imageUrl:ve,params:Ie||{},onClose:hn})]}):b?i.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4",onClick:O=>O.stopPropagation(),children:i.jsx(Zp,{generatedImages:F,selectedImageIndex:B,handleSelectImage:_r,handleApplySelected:Ns,handlePrevious:kn,handleClose:Vt,currentPage:ye,handlePageChange:br,imagesPerPage:re,notificationVisible:K,modalVisible:J,modalImageUrl:ve,modalImageParams:Ie,openImageModal:wr,closeImageModal:hn})}):N?i.jsxs("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4",onClick:O=>O.stopPropagation(),children:[i.jsx(Dp,{selectedNodes:a,paramTestValues:L,selectedParams:h,totalCount:G,completedCount:P,errorMessage:ne,handleClose:Vt,setIsProcessing:S,setCurrentScreen:d,cleanupPolling:Vn}),i.jsx(gn,{})]}):f===0?i.jsxs("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4 flex flex-col h-full max-h-[80vh]",onClick:O=>O.stopPropagation(),children:[i.jsx(Tp,{selectedNodes:a,handleParamSelect:bs,selectedParams:h,handleNext:yr,handleClose:Vt}),i.jsx(gn,{})]}):f===1?i.jsxs("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4 flex flex-col h-full max-h-[80vh]",onClick:O=>O.stopPropagation(),children:[i.jsx(Pp,{selectedNodes:a,paramTestValues:L,selectedParams:h,updateParamTestValues:Zt,toggleDropdown:_s,openDropdowns:Q,handleTestValueSelect:Yn,searchTerms:U,handleSearch:ws,handleSelectAll:Zn,handleNext:yr,handlePrevious:kn,handleClose:Vt,inputValues:pe,setInputValues:R,textInputs:ze,handleTextInputChange:Kn,handleAddTextInput:qn,handleRemoveTextInput:gs,openAiWritingModal:vr}),i.jsx(Vp,{visible:Ve,aiWritingModalText:Ue,setAiWritingModalText:bt,aiGeneratedTexts:At,aiSelectedTexts:Te,aiWritingLoading:Ke,aiWritingError:ct,handleAiWriting:Hn,toggleTextSelection:ps,addSelectedTexts:ms,onClose:()=>lt(!1)}),i.jsx(gn,{})]}):i.jsxs("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4 flex flex-col h-full max-h-[80vh]",onClick:O=>O.stopPropagation(),children:[i.jsx(Rp,{selectedNodes:a,paramTestValues:L,selectedParams:h,totalCount:G,errorMessage:ne,handlePrevious:kn,handleStartGeneration:Ss,handleClose:Vt}),i.jsx(gn,{})]})},Om=a=>{const{dispatch:u}=Un(),[r,f]=k.useState(!1);return k.useEffect(()=>{if(a.visible&&!r){const d=nm();d&&d.screenState&&u({type:"SET_SCREEN_STATE",payload:{currentScreen:d.currentScreen,isProcessing:d.isProcessing,isCompleted:d.isCompleted}}),f(!0)}},[a.visible,r,u]),k.useEffect(()=>()=>{a.visible||u({type:"SET_SCREEN_STATE",payload:null})},[a.visible,u]),i.jsx(Lm,{...a})},Tm=({message:a,onClose:u})=>a?i.jsxs("div",{className:`bg-gradient-to-r from-gray-50 to-gray-100 
            border border-gray-300 px-2 py-1 mt-2 ml-2 mr-2 relative shadow-sm rounded-sm`,children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:"flex-shrink-0 mr-1",children:i.jsx("svg",{className:"w-3.5 h-3.5 text-gray-700",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:i.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),i.jsx("div",{className:"text-gray-700 font-medium leading-relaxed pr-6 markdown-content",style:{fontSize:"11px"},children:i.jsx(Jg,{rehypePlugins:[[Fg,{target:"_blank",rel:["noopener","noreferrer"]}]],remarkPlugins:[Bg],className:"prose !text-[11px] prose-a:text-gray-700 prose-a:underline prose-a:font-medium hover:prose-a:text-gray-800",components:{a:({node:r,...f})=>i.jsx("a",{...f,className:"text-gray-700 underline hover:text-gray-800 transition-colors",style:{fontSize:"11px"}}),p:({children:r})=>i.jsx("span",{className:"inline",style:{fontSize:"11px"},children:r}),span:({children:r})=>i.jsx("span",{style:{fontSize:"11px"},children:r}),li:({children:r})=>i.jsx("li",{style:{fontSize:"11px"},children:r}),ul:({children:r})=>i.jsx("ul",{style:{fontSize:"11px"},children:r}),ol:({children:r})=>i.jsx("ol",{style:{fontSize:"11px"},children:r})},children:a})})]}),i.jsx("button",{onClick:u,className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-700 hover:text-gray-800 transition-colors p-1 rounded-full hover:bg-gray-800","aria-label":"Close announcement",children:i.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}):null,Pm=()=>{const{state:a,dispatch:u}=Un(),{selectedNode:r,screenState:f}=a,d=r||[],h=()=>{u({type:"SET_SELECTED_NODE",payload:null}),u({type:"SET_SCREEN_STATE",payload:null}),localStorage.removeItem("screenState")};return i.jsx("div",{className:"flex-1 flex flex-col overflow-y-auto",children:i.jsx(Om,{selectedNodes:d,visible:!0,onClose:h})})},_l=({active:a,onClick:u,children:r})=>i.jsx("button",{onClick:u,className:`px-4 py-2 font-medium text-xs transition-colors duration-200 ${a?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-blue-500 hover:border-b-2 hover:border-blue-300"}`,children:r});function Fm({onClose:a,visible:u=!0,triggerUsage:r=!1,onUsageTriggered:f}){const{state:d,dispatch:h}=Un(),{messages:p,installedNodes:x,loading:_,sessionId:N,selectedNode:S,activeTab:b}=d;k.useRef(null);const[I,P]=k.useState(""),[T,G]=k.useState(""),[q,B]=k.useState(window.innerWidth/3),[D,F]=k.useState(!1),[j,L]=k.useState([]),[z,Q]=k.useState("gpt-4o-mini"),[Ce,U]=k.useState(window.innerHeight),[ae,pe]=k.useState(0),[R,ye]=k.useState(""),[le,re]=k.useState(!1),ne=k.useRef(null);Lp(u&&b==="chat"),Op(u),k.useEffect(()=>{if(b!=="chat")return;(async()=>{const se=await kp();console.log("[WorkflowChat] Received installed nodes:",se.length),h({type:"SET_INSTALLED_NODES",payload:se})})()},[b]);const he=async Z=>{try{const se=await Tt.fetchMessages(Z);h({type:"SET_MESSAGES",payload:se})}catch(se){console.error("Error fetching messages:",se)}};k.useEffect(()=>{if(b!=="chat")return;let Z=localStorage.getItem("sessionId");Z?(h({type:"SET_SESSION_ID",payload:Z}),he(Z)):(Z=tt(),h({type:"SET_SESSION_ID",payload:Z}),localStorage.setItem("sessionId",Z))},[b]),k.useEffect(()=>{const Z=localStorage.getItem("activeTab");Z&&h({type:"SET_ACTIVE_TAB",payload:Z});const se=localStorage.getItem("screenState");se&&h({type:"SET_SCREEN_STATE",payload:JSON.parse(se)})},[]),k.useEffect(()=>{localStorage.setItem("activeTab",b)},[b]),k.useEffect(()=>{d.screenState&&localStorage.setItem("screenState",JSON.stringify(d.screenState))},[d.screenState]);const K=gr.useCallback(Z=>{if(!D)return;const se=window.innerWidth-Z.clientX,Me=Math.min(Math.max(300,se),window.innerWidth*.8);B(Me)},[D]),ce=gr.useMemo(()=>Di.debounce(K,16),[K]);k.useEffect(()=>(D&&(document.addEventListener("mousemove",ce),document.addEventListener("mouseup",Ue)),()=>{document.removeEventListener("mousemove",ce),document.removeEventListener("mouseup",Ue),ce.cancel()}),[D,ce]);const J=Z=>{P(Z.target.value)},V=()=>{ne.current&&(ne.current.abort(),ne.current=null,h({type:"SET_LOADING",payload:!1}))},ve=async()=>{if(h({type:"SET_LOADING",payload:!0}),I.trim()===""&&!S||!N)return;G(I);const Z=tt(),se={id:tt(),role:"user",content:I,trace_id:Z};h({type:"ADD_MESSAGE",payload:se}),P(""),ne.current=new AbortController;try{const Me={type:"model_select",data:[z]};let $e=tt(),ct=!0;for await(const we of Tt.streamInvokeServer(N,I,j.map(Te=>Te.file),null,Me,Z,ne.current.signal)){const Te={id:$e,role:"ai",content:JSON.stringify(we),format:we.format,finished:we.finished,name:"Assistant"};if(ct)h({type:"ADD_MESSAGE",payload:Te}),ct=!1;else{h({type:"UPDATE_MESSAGE",payload:Te});const Pe=d.messages.map(Je=>Je.id===Te.id&&!Je.finished?Te:Je);Ve(Pe)}we.finished&&(h({type:"SET_LOADING",payload:!1}),ne.current=null)}}catch(Me){Me instanceof Error&&Me.name==="AbortError"?console.log("User aborted the request"):console.error("Error sending message:",Me),h({type:"SET_LOADING",payload:!1}),ne.current=null}finally{L([])}},Oe=async Z=>{if(!N)return;h({type:"SET_LOADING",payload:!0}),G(Z);const se=tt(),Me={id:tt(),role:"user",content:Z,trace_id:se};h({type:"ADD_MESSAGE",payload:Me}),ne.current=new AbortController;try{const $e={type:"model_select",data:[z]};let ct=tt(),we=!0;for await(const Te of Tt.streamInvokeServer(N,Z,j.map(Pe=>Pe.file),null,$e,se,ne.current.signal)){const Pe={id:ct,role:"ai",content:JSON.stringify(Te),format:Te.format,finished:Te.finished,name:"Assistant"};if(we)h({type:"ADD_MESSAGE",payload:Pe}),we=!1;else{h({type:"UPDATE_MESSAGE",payload:Pe});const Je=d.messages.map(st=>st.id===Pe.id&&!st.finished?Pe:st);Ve(Je)}Te.finished&&(h({type:"SET_LOADING",payload:!1}),ne.current=null)}}catch($e){$e instanceof Error&&$e.name==="AbortError"?console.log("User aborted the request"):console.error("Error sending message:",$e),h({type:"SET_LOADING",payload:!1}),ne.current=null}finally{L([])}},Ie=Z=>{Z.metaKey&&Z.key==="Enter"&&ve()},Ee=()=>{h({type:"CLEAR_MESSAGES"});const Z=d.sessionId;Z&&localStorage.removeItem(`messages_${Z}`),localStorage.removeItem("sessionId");const se=tt();h({type:"SET_SESSION_ID",payload:se}),localStorage.setItem("sessionId",se)},ze=Z=>{P(Z)},nt=async(Z,se)=>{if(!N||!S)return;h({type:"SET_LOADING",payload:!0});const Me=S[0].comfyClass||S[0].type,$e=tt(),ct={id:tt(),role:"user",content:Me,trace_id:$e};h({type:"ADD_MESSAGE",payload:ct}),ne.current=new AbortController;try{let we=tt(),Te=!0;for await(const Pe of Tt.streamInvokeServer(N,Me,[],Z,se,$e,ne.current.signal)){const Je={id:we,role:"ai",content:JSON.stringify(Pe),format:Pe.format,finished:Pe.finished,name:"Assistant"};if(Z&&Z!==""&&(Je.metadata={intent:Z}),Te)h({type:"ADD_MESSAGE",payload:Je}),Te=!1;else{h({type:"UPDATE_MESSAGE",payload:Je});const st=d.messages.map(cn=>cn.id===Je.id&&!cn.finished?Je:cn);Ve(st)}Pe.finished&&(h({type:"SET_LOADING",payload:!1}),ne.current=null)}}catch(we){we instanceof Error&&we.name==="AbortError"?console.log("User aborted the request"):console.error("Error sending message:",we),h({type:"SET_LOADING",payload:!1}),ne.current=null}},Ve=Z=>{d.sessionId&&localStorage.setItem(`messages_${d.sessionId}`,JSON.stringify(Z))},lt=Z=>{console.log("[WorkflowChat] Adding new message:",Z);const se=[...d.messages,Z];h({type:"ADD_MESSAGE",payload:Z}),Ve(se)},Ue=()=>{F(!1)},bt=Z=>{const se=Array.from(Z).map(Me=>({id:Math.random().toString(36).substr(2,9),file:Me,preview:URL.createObjectURL(Me)}));L(Me=>[...Me,...se])},At=Z=>{L(se=>se.filter($e=>$e.id!==Z))};gr.useEffect(()=>()=>{j.forEach(Z=>URL.revokeObjectURL(Z.preview))},[j]),k.useEffect(()=>{r&&f&&b==="chat"&&(nt("node_explain"),f())},[r,b]),k.useEffect(()=>{if(!u||b!=="chat")return;(async()=>{try{const se=new Date().toDateString();if(localStorage.getItem("announcementLastShownDate")!==se){const $e=await Tt.fetchAnnouncement();$e&&$e.trim()!==""&&(ye($e),re(!0),localStorage.setItem("announcementLastShownDate",se))}}catch(se){console.error("Error fetching announcement:",se)}})()},[u,b]);const Pt=()=>{re(!1)},Ke=Z=>{h({type:"SET_ACTIVE_TAB",payload:Z})},rt=gr.useMemo(()=>i.jsx(Pm,{}),[]);return u?i.jsxs("div",{className:"flex flex-col h-full w-full bg-white relative",style:{display:u?"flex":"none"},children:[i.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1 cursor-ew-resize hover:bg-gray-300"}),i.jsxs("div",{className:"flex h-full flex-col",children:[i.jsx(hp,{onClose:a,onClear:Ee,hasMessages:p.length>0,title:"ComfyUI-Copilot"}),i.jsxs("div",{className:"flex border-b border-gray-200 mt-2",children:[i.jsx(_l,{active:b==="chat",onClick:()=>Ke("chat"),children:"Chat"}),i.jsx(_l,{active:b==="parameter-debug",onClick:()=>Ke("parameter-debug"),children:"GenLab"})]}),le&&R&&b==="chat"&&i.jsx(Tm,{message:R,onClose:Pt}),i.jsx(jp,{messages:p,latestInput:T,onOptionClick:ze,installedNodes:x,onAddMessage:lt,loading:_,isActive:b==="chat"}),i.jsxs("div",{className:"border-t px-4 py-3 border-gray-200 bg-white sticky bottom-0",style:{display:b==="chat"?"block":"none"},children:[S&&i.jsx(xp,{nodeInfo:S,onSendWithIntent:nt,loading:_,onSendWithContent:Oe}),i.jsx(pp,{input:I,loading:_,onChange:J,onSend:ve,onKeyPress:Ie,onUploadImages:bt,uploadedImages:j,onRemoveImage:At,selectedModel:z,onModelChange:Q,onStop:V})]}),i.jsx("div",{className:"flex-1 flex flex-col h-0",style:{display:b==="parameter-debug"?"flex":"none"},children:rt})]})]}):null}export{Fm as default};
