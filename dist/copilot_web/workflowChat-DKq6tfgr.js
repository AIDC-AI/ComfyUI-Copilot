function getImportPath(filename) {
            return `./${filename}`;
        }
            const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["copilot_web/WorkflowOption-CggLwCTe.js","copilot_web/vendor-markdown-CBmlBP6m.js","copilot_web/vendor-react-Dixhfmvb.js","copilot_web/message-components-wGrDwG40.js","copilot_web/DebugGuide-DLGkTPB4.js","copilot_web/DebugResult-PnLX_FEt.js"].map(path => {
                        const apiBase = window.comfyAPI?.api?.api?.api_base;
                        if (apiBase) {
                            // 有 API base 时，使用完整路径
                            return `${apiBase.substring(1)}/${path}`;
                        } else {        
                            // 没有 API base 时，使用相对路径
                            return `./${path}`;
                        }
                    }))))=>i.map(i=>d[i]);
import{j as s,r as qg,b as Vg}from"./vendor-markdown-CBmlBP6m.js";import{r as _,c as br,R as bs,a as Kg}from"./vendor-react-Dixhfmvb.js";import{f as Jg,c as Yg,v as Xg,W as Vt,g as Ze,a as Me,B as Ll,u as _n,U as Qg,A as xs,b as Zg,d as kr,e as em,M as tm}from"./message-components-wGrDwG40.js";import{_ as wn}from"./input.js";import{C as Yn}from"./App-Wmak8nEO.js";/* empty css     *//**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nm=a=>a.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Ml=(...a)=>a.filter((d,r,u)=>!!d&&d.trim()!==""&&u.indexOf(d)===r).join(" ").trim();/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var rm={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sm=_.forwardRef(({color:a="currentColor",size:d=24,strokeWidth:r=2,absoluteStrokeWidth:u,className:f="",children:h,iconNode:g,...p},b)=>_.createElement("svg",{ref:b,...rm,width:d,height:d,stroke:a,strokeWidth:u?Number(r)*24/Number(d):r,className:Ml("lucide",f),...p},[...g.map(([k,w])=>_.createElement(k,w)),...Array.isArray(h)?h:[h]]));/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kt=(a,d)=>{const r=_.forwardRef(({className:u,...f},h)=>_.createElement(sm,{ref:h,iconNode:d,className:Ml(`lucide-${nm(a)}`,u),...f}));return r.displayName=`${a}`,r};/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const im=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],om=Kt("ChevronDown",im);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const am=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],lm=Kt("ChevronUp",am);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cm=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["rect",{x:"9",y:"9",width:"6",height:"6",rx:"1",key:"1ssd4o"}]],dm=Kt("CircleStop",cm);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const um=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],fm=Kt("History",um);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hm=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],gm=Kt("Image",hm);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mm=[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],pm=Kt("MessageCircleWarning",mm);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xm=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],bm=Kt("Plus",xm);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ym=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],vm=Kt("Send",ym);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wm=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],_m=Kt("Settings",wm);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const km=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]],Sm=Kt("Trash",km);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Im=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],yr=Kt("X",Im),bl=a=>{const{isPassword:d=!1,value:r="",setValue:u=()=>{},setIsValueValid:f,placeholder:h="",className:g=""}=a,[p,b]=_.useState(!d),k=w=>{u(w.target.value),f?.(w.target.value)};return s.jsxs("div",{className:`relative ${g}`,children:[s.jsx("input",{type:p?"text":"password",value:r,onChange:k,placeholder:h,className:`w-full px-4 py-3 border border-gray-200 dark:border-gray-600 rounded-lg
          bg-gray-50 dark:bg-gray-700 
          text-gray-900 dark:text-white
          placeholder-gray-500 dark:placeholder-gray-400
          focus:border-blue-500 dark:focus:border-blue-400 
          focus:ring-2 focus:ring-blue-500/20 dark:focus:ring-blue-400/20
          focus:outline-none`}),d&&s.jsx("button",{type:"button",className:`absolute inset-y-0 right-4 flex items-center text-gray-500 dark:text-gray-400 
          hover:text-gray-700 dark:hover:text-gray-200 transition-colors bg-transparent border-none`,onClick:()=>b(!p),children:p?s.jsxs("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}):s.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})})})]})},Nm=a=>{const{title:d="",className:r="",children:u}=a,[f,h]=_.useState(!1);return s.jsxs("div",{className:`border border-gray-200 dark:border-gray-600 rounded-lg p-4 ${r}`,children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("div",{children:typeof d=="string"?s.jsx("h3",{className:"text-sm text-gray-900 dark:text-white font-medium mb-4",children:d}):d}),s.jsx("button",{onClick:()=>h(!f),children:f?s.jsx(lm,{}):s.jsx(om,{})})]}),s.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:f&&u})]})},jm=({open:a,onClose:d,children:r,className:u="",overlayClassName:f="",autoClose:h=!0})=>(_.useEffect(()=>{let g;return a&&h&&(g=setTimeout(()=>{d()},3e3)),()=>clearTimeout(g)},[a,h]),a?s.jsx("div",{className:`fixed inset-0 z-50 flex items-center justify-center bg-black/40 ${f}`,onClick:d,children:s.jsxs("div",{className:`relative bg-white rounded-lg shadow-lg p-6 min-w-[300px] max-w-full ${u}`,onClick:g=>g.stopPropagation(),children:[s.jsx("button",{className:"absolute top-2 right-4 text-gray-400 hover:text-gray-600",onClick:d,"aria-label":"Close",children:s.jsx(yr,{size:16})}),r]})}):null);var ys={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */ys.exports;(function(a,d){(function(){var r,u="4.17.21",f=200,h="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",g="Expected a function",p="Invalid `variable` option passed into `_.template`",b="__lodash_hash_undefined__",k=500,w="__lodash_placeholder__",S=1,N=2,E=4,P=1,F=2,U=1,z=2,te=4,Q=8,q=16,G=32,re=64,Z=128,j=256,D=512,J=30,xe="...",B=800,ke=16,ce=1,X=2,fe=3,_e=1/0,R=9007199254740991,je=17976931348623157e292,H=NaN,W=4294967295,ye=W-1,he=W>>>1,pe=[["ary",Z],["bind",U],["bindKey",z],["curry",Q],["curryRight",q],["flip",D],["partial",G],["partialRight",re],["rearg",j]],Ie="[object Arguments]",Pe="[object Array]",rt="[object AsyncFunction]",Ae="[object Boolean]",We="[object Date]",et="[object DOMException]",ht="[object Error]",vt="[object Function]",zt="[object GeneratorFunction]",st="[object Map]",gt="[object Number]",Qt="[object Null]",Be="[object Object]",Zt="[object Promise]",tt="[object Proxy]",Wt="[object RegExp]",Je="[object Set]",Ct="[object String]",wt="[object Symbol]",Bt="[object Undefined]",Et="[object WeakMap]",V="[object WeakSet]",ee="[object ArrayBuffer]",ae="[object DataView]",Ce="[object Float32Array]",Ye="[object Float64Array]",Fe="[object Int8Array]",Ue="[object Int16Array]",Re="[object Int32Array]",it="[object Uint8Array]",mt="[object Uint8ClampedArray]",Ut="[object Uint16Array]",Qn="[object Uint32Array]",ws=/\b__p \+= '';/g,_s=/\b(__p \+=) '' \+/g,ks=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Sr=/&(?:amp|lt|gt|quot|#39);/g,Ir=/[&<>"']/g,Ss=RegExp(Sr.source),Is=RegExp(Ir.source),Nr=/<%-([\s\S]+?)%>/g,Ns=/<%([\s\S]+?)%>/g,jr=/<%=([\s\S]+?)%>/g,js=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,$e=/^\w*$/,Cs=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Tn=/[\\^$.*+?()[\]{}|]/g,Zn=RegExp(Tn.source),er=/^\s+/,Es=/\s/,dn=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,As=/\{\n\/\* \[wrapped with (.+)\] \*/,Ls=/,? & /,Ms=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Cr=/[()=,{}\[\]\/\s]/,tr=/\\(\\)?/g,Er=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,nr=/\w*$/,Ar=/^[-+]0x[0-9a-f]+$/i,kn=/^0b[01]+$/i,Ts=/^\[object .+?Constructor\]$/,un=/^0o[0-7]+$/i,On=/^(?:0|[1-9]\d*)$/,M=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,O=/($^)/,Se=/['\n\r\u2028\u2029\\]/g,He="\\ud800-\\udfff",At="\\u0300-\\u036f",Pn="\\ufe20-\\ufe2f",Wl="\\u20d0-\\u20ff",qi=At+Pn+Wl,Vi="\\u2700-\\u27bf",Ki="a-z\\xdf-\\xf6\\xf8-\\xff",Bl="\\xac\\xb1\\xd7\\xf7",Ul="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Gl="\\u2000-\\u206f",$l=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ji="A-Z\\xc0-\\xd6\\xd8-\\xde",Yi="\\ufe0e\\ufe0f",Xi=Bl+Ul+Gl+$l,Os="['’]",Hl="["+He+"]",Qi="["+Xi+"]",Lr="["+qi+"]",Zi="\\d+",ql="["+Vi+"]",eo="["+Ki+"]",to="[^"+He+Xi+Zi+Vi+Ki+Ji+"]",Ps="\\ud83c[\\udffb-\\udfff]",Vl="(?:"+Lr+"|"+Ps+")",no="[^"+He+"]",Ds="(?:\\ud83c[\\udde6-\\uddff]){2}",Fs="[\\ud800-\\udbff][\\udc00-\\udfff]",Dn="["+Ji+"]",ro="\\u200d",so="(?:"+eo+"|"+to+")",Kl="(?:"+Dn+"|"+to+")",io="(?:"+Os+"(?:d|ll|m|re|s|t|ve))?",oo="(?:"+Os+"(?:D|LL|M|RE|S|T|VE))?",ao=Vl+"?",lo="["+Yi+"]?",Jl="(?:"+ro+"(?:"+[no,Ds,Fs].join("|")+")"+lo+ao+")*",Yl="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Xl="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",co=lo+ao+Jl,Ql="(?:"+[ql,Ds,Fs].join("|")+")"+co,Zl="(?:"+[no+Lr+"?",Lr,Ds,Fs,Hl].join("|")+")",ec=RegExp(Os,"g"),tc=RegExp(Lr,"g"),Rs=RegExp(Ps+"(?="+Ps+")|"+Zl+co,"g"),nc=RegExp([Dn+"?"+eo+"+"+io+"(?="+[Qi,Dn,"$"].join("|")+")",Kl+"+"+oo+"(?="+[Qi,Dn+so,"$"].join("|")+")",Dn+"?"+so+"+"+io,Dn+"+"+oo,Xl,Yl,Zi,Ql].join("|"),"g"),rc=RegExp("["+ro+He+qi+Yi+"]"),sc=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,ic=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],oc=-1,De={};De[Ce]=De[Ye]=De[Fe]=De[Ue]=De[Re]=De[it]=De[mt]=De[Ut]=De[Qn]=!0,De[Ie]=De[Pe]=De[ee]=De[Ae]=De[ae]=De[We]=De[ht]=De[vt]=De[st]=De[gt]=De[Be]=De[Wt]=De[Je]=De[Ct]=De[Et]=!1;var Oe={};Oe[Ie]=Oe[Pe]=Oe[ee]=Oe[ae]=Oe[Ae]=Oe[We]=Oe[Ce]=Oe[Ye]=Oe[Fe]=Oe[Ue]=Oe[Re]=Oe[st]=Oe[gt]=Oe[Be]=Oe[Wt]=Oe[Je]=Oe[Ct]=Oe[wt]=Oe[it]=Oe[mt]=Oe[Ut]=Oe[Qn]=!0,Oe[ht]=Oe[vt]=Oe[Et]=!1;var ac={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},lc={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},cc={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},dc={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},uc=parseFloat,fc=parseInt,uo=typeof br=="object"&&br&&br.Object===Object&&br,hc=typeof self=="object"&&self&&self.Object===Object&&self,ot=uo||hc||Function("return this")(),zs=d&&!d.nodeType&&d,Sn=zs&&!0&&a&&!a.nodeType&&a,fo=Sn&&Sn.exports===zs,Ws=fo&&uo.process,Lt=function(){try{var y=Sn&&Sn.require&&Sn.require("util").types;return y||Ws&&Ws.binding&&Ws.binding("util")}catch{}}(),ho=Lt&&Lt.isArrayBuffer,go=Lt&&Lt.isDate,mo=Lt&&Lt.isMap,po=Lt&&Lt.isRegExp,xo=Lt&&Lt.isSet,bo=Lt&&Lt.isTypedArray;function _t(y,C,I){switch(I.length){case 0:return y.call(C);case 1:return y.call(C,I[0]);case 2:return y.call(C,I[0],I[1]);case 3:return y.call(C,I[0],I[1],I[2])}return y.apply(C,I)}function gc(y,C,I,K){for(var oe=-1,Ne=y==null?0:y.length;++oe<Ne;){var Xe=y[oe];C(K,Xe,I(Xe),y)}return K}function Mt(y,C){for(var I=-1,K=y==null?0:y.length;++I<K&&C(y[I],I,y)!==!1;);return y}function mc(y,C){for(var I=y==null?0:y.length;I--&&C(y[I],I,y)!==!1;);return y}function yo(y,C){for(var I=-1,K=y==null?0:y.length;++I<K;)if(!C(y[I],I,y))return!1;return!0}function fn(y,C){for(var I=-1,K=y==null?0:y.length,oe=0,Ne=[];++I<K;){var Xe=y[I];C(Xe,I,y)&&(Ne[oe++]=Xe)}return Ne}function Mr(y,C){var I=y==null?0:y.length;return!!I&&Fn(y,C,0)>-1}function Bs(y,C,I){for(var K=-1,oe=y==null?0:y.length;++K<oe;)if(I(C,y[K]))return!0;return!1}function ze(y,C){for(var I=-1,K=y==null?0:y.length,oe=Array(K);++I<K;)oe[I]=C(y[I],I,y);return oe}function hn(y,C){for(var I=-1,K=C.length,oe=y.length;++I<K;)y[oe+I]=C[I];return y}function Us(y,C,I,K){var oe=-1,Ne=y==null?0:y.length;for(K&&Ne&&(I=y[++oe]);++oe<Ne;)I=C(I,y[oe],oe,y);return I}function pc(y,C,I,K){var oe=y==null?0:y.length;for(K&&oe&&(I=y[--oe]);oe--;)I=C(I,y[oe],oe,y);return I}function Gs(y,C){for(var I=-1,K=y==null?0:y.length;++I<K;)if(C(y[I],I,y))return!0;return!1}var xc=$s("length");function bc(y){return y.split("")}function yc(y){return y.match(Ms)||[]}function vo(y,C,I){var K;return I(y,function(oe,Ne,Xe){if(C(oe,Ne,Xe))return K=Ne,!1}),K}function Tr(y,C,I,K){for(var oe=y.length,Ne=I+(K?1:-1);K?Ne--:++Ne<oe;)if(C(y[Ne],Ne,y))return Ne;return-1}function Fn(y,C,I){return C===C?Lc(y,C,I):Tr(y,wo,I)}function vc(y,C,I,K){for(var oe=I-1,Ne=y.length;++oe<Ne;)if(K(y[oe],C))return oe;return-1}function wo(y){return y!==y}function _o(y,C){var I=y==null?0:y.length;return I?qs(y,C)/I:H}function $s(y){return function(C){return C==null?r:C[y]}}function Hs(y){return function(C){return y==null?r:y[C]}}function ko(y,C,I,K,oe){return oe(y,function(Ne,Xe,Te){I=K?(K=!1,Ne):C(I,Ne,Xe,Te)}),I}function wc(y,C){var I=y.length;for(y.sort(C);I--;)y[I]=y[I].value;return y}function qs(y,C){for(var I,K=-1,oe=y.length;++K<oe;){var Ne=C(y[K]);Ne!==r&&(I=I===r?Ne:I+Ne)}return I}function Vs(y,C){for(var I=-1,K=Array(y);++I<y;)K[I]=C(I);return K}function _c(y,C){return ze(C,function(I){return[I,y[I]]})}function So(y){return y&&y.slice(0,Co(y)+1).replace(er,"")}function kt(y){return function(C){return y(C)}}function Ks(y,C){return ze(C,function(I){return y[I]})}function rr(y,C){return y.has(C)}function Io(y,C){for(var I=-1,K=y.length;++I<K&&Fn(C,y[I],0)>-1;);return I}function No(y,C){for(var I=y.length;I--&&Fn(C,y[I],0)>-1;);return I}function kc(y,C){for(var I=y.length,K=0;I--;)y[I]===C&&++K;return K}var Sc=Hs(ac),Ic=Hs(lc);function Nc(y){return"\\"+dc[y]}function jc(y,C){return y==null?r:y[C]}function Rn(y){return rc.test(y)}function Cc(y){return sc.test(y)}function Ec(y){for(var C,I=[];!(C=y.next()).done;)I.push(C.value);return I}function Js(y){var C=-1,I=Array(y.size);return y.forEach(function(K,oe){I[++C]=[oe,K]}),I}function jo(y,C){return function(I){return y(C(I))}}function gn(y,C){for(var I=-1,K=y.length,oe=0,Ne=[];++I<K;){var Xe=y[I];(Xe===C||Xe===w)&&(y[I]=w,Ne[oe++]=I)}return Ne}function Or(y){var C=-1,I=Array(y.size);return y.forEach(function(K){I[++C]=K}),I}function Ac(y){var C=-1,I=Array(y.size);return y.forEach(function(K){I[++C]=[K,K]}),I}function Lc(y,C,I){for(var K=I-1,oe=y.length;++K<oe;)if(y[K]===C)return K;return-1}function Mc(y,C,I){for(var K=I+1;K--;)if(y[K]===C)return K;return K}function zn(y){return Rn(y)?Oc(y):xc(y)}function Gt(y){return Rn(y)?Pc(y):bc(y)}function Co(y){for(var C=y.length;C--&&Es.test(y.charAt(C)););return C}var Tc=Hs(cc);function Oc(y){for(var C=Rs.lastIndex=0;Rs.test(y);)++C;return C}function Pc(y){return y.match(Rs)||[]}function Dc(y){return y.match(nc)||[]}var Fc=function y(C){C=C==null?ot:Wn.defaults(ot.Object(),C,Wn.pick(ot,ic));var I=C.Array,K=C.Date,oe=C.Error,Ne=C.Function,Xe=C.Math,Te=C.Object,Ys=C.RegExp,Rc=C.String,Tt=C.TypeError,Pr=I.prototype,zc=Ne.prototype,Bn=Te.prototype,Dr=C["__core-js_shared__"],Fr=zc.toString,Le=Bn.hasOwnProperty,Wc=0,Eo=function(){var e=/[^.]+$/.exec(Dr&&Dr.keys&&Dr.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Rr=Bn.toString,Bc=Fr.call(Te),Uc=ot._,Gc=Ys("^"+Fr.call(Le).replace(Tn,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),zr=fo?C.Buffer:r,mn=C.Symbol,Wr=C.Uint8Array,Ao=zr?zr.allocUnsafe:r,Br=jo(Te.getPrototypeOf,Te),Lo=Te.create,Mo=Bn.propertyIsEnumerable,Ur=Pr.splice,To=mn?mn.isConcatSpreadable:r,sr=mn?mn.iterator:r,In=mn?mn.toStringTag:r,Gr=function(){try{var e=An(Te,"defineProperty");return e({},"",{}),e}catch{}}(),$c=C.clearTimeout!==ot.clearTimeout&&C.clearTimeout,Hc=K&&K.now!==ot.Date.now&&K.now,qc=C.setTimeout!==ot.setTimeout&&C.setTimeout,$r=Xe.ceil,Hr=Xe.floor,Xs=Te.getOwnPropertySymbols,Vc=zr?zr.isBuffer:r,Oo=C.isFinite,Kc=Pr.join,Jc=jo(Te.keys,Te),Qe=Xe.max,lt=Xe.min,Yc=K.now,Xc=C.parseInt,Po=Xe.random,Qc=Pr.reverse,Qs=An(C,"DataView"),ir=An(C,"Map"),Zs=An(C,"Promise"),Un=An(C,"Set"),or=An(C,"WeakMap"),ar=An(Te,"create"),qr=or&&new or,Gn={},Zc=Ln(Qs),ed=Ln(ir),td=Ln(Zs),nd=Ln(Un),rd=Ln(or),Vr=mn?mn.prototype:r,lr=Vr?Vr.valueOf:r,Do=Vr?Vr.toString:r;function l(e){if(qe(e)&&!le(e)&&!(e instanceof ve)){if(e instanceof Ot)return e;if(Le.call(e,"__wrapped__"))return Fa(e)}return new Ot(e)}var $n=function(){function e(){}return function(t){if(!Ge(t))return{};if(Lo)return Lo(t);e.prototype=t;var n=new e;return e.prototype=r,n}}();function Kr(){}function Ot(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=r}l.templateSettings={escape:Nr,evaluate:Ns,interpolate:jr,variable:"",imports:{_:l}},l.prototype=Kr.prototype,l.prototype.constructor=l,Ot.prototype=$n(Kr.prototype),Ot.prototype.constructor=Ot;function ve(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=W,this.__views__=[]}function sd(){var e=new ve(this.__wrapped__);return e.__actions__=pt(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=pt(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=pt(this.__views__),e}function id(){if(this.__filtered__){var e=new ve(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function od(){var e=this.__wrapped__.value(),t=this.__dir__,n=le(e),i=t<0,o=n?e.length:0,c=bu(0,o,this.__views__),m=c.start,x=c.end,v=x-m,A=i?x:m-1,L=this.__iteratees__,T=L.length,$=0,Y=lt(v,this.__takeCount__);if(!n||!i&&o==v&&Y==v)return oa(e,this.__actions__);var se=[];e:for(;v--&&$<Y;){A+=t;for(var ue=-1,ie=e[A];++ue<T;){var be=L[ue],we=be.iteratee,Nt=be.type,ft=we(ie);if(Nt==X)ie=ft;else if(!ft){if(Nt==ce)continue e;break e}}se[$++]=ie}return se}ve.prototype=$n(Kr.prototype),ve.prototype.constructor=ve;function Nn(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function ad(){this.__data__=ar?ar(null):{},this.size=0}function ld(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function cd(e){var t=this.__data__;if(ar){var n=t[e];return n===b?r:n}return Le.call(t,e)?t[e]:r}function dd(e){var t=this.__data__;return ar?t[e]!==r:Le.call(t,e)}function ud(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=ar&&t===r?b:t,this}Nn.prototype.clear=ad,Nn.prototype.delete=ld,Nn.prototype.get=cd,Nn.prototype.has=dd,Nn.prototype.set=ud;function en(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function fd(){this.__data__=[],this.size=0}function hd(e){var t=this.__data__,n=Jr(t,e);if(n<0)return!1;var i=t.length-1;return n==i?t.pop():Ur.call(t,n,1),--this.size,!0}function gd(e){var t=this.__data__,n=Jr(t,e);return n<0?r:t[n][1]}function md(e){return Jr(this.__data__,e)>-1}function pd(e,t){var n=this.__data__,i=Jr(n,e);return i<0?(++this.size,n.push([e,t])):n[i][1]=t,this}en.prototype.clear=fd,en.prototype.delete=hd,en.prototype.get=gd,en.prototype.has=md,en.prototype.set=pd;function tn(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function xd(){this.size=0,this.__data__={hash:new Nn,map:new(ir||en),string:new Nn}}function bd(e){var t=as(this,e).delete(e);return this.size-=t?1:0,t}function yd(e){return as(this,e).get(e)}function vd(e){return as(this,e).has(e)}function wd(e,t){var n=as(this,e),i=n.size;return n.set(e,t),this.size+=n.size==i?0:1,this}tn.prototype.clear=xd,tn.prototype.delete=bd,tn.prototype.get=yd,tn.prototype.has=vd,tn.prototype.set=wd;function jn(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new tn;++t<n;)this.add(e[t])}function _d(e){return this.__data__.set(e,b),this}function kd(e){return this.__data__.has(e)}jn.prototype.add=jn.prototype.push=_d,jn.prototype.has=kd;function $t(e){var t=this.__data__=new en(e);this.size=t.size}function Sd(){this.__data__=new en,this.size=0}function Id(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function Nd(e){return this.__data__.get(e)}function jd(e){return this.__data__.has(e)}function Cd(e,t){var n=this.__data__;if(n instanceof en){var i=n.__data__;if(!ir||i.length<f-1)return i.push([e,t]),this.size=++n.size,this;n=this.__data__=new tn(i)}return n.set(e,t),this.size=n.size,this}$t.prototype.clear=Sd,$t.prototype.delete=Id,$t.prototype.get=Nd,$t.prototype.has=jd,$t.prototype.set=Cd;function Fo(e,t){var n=le(e),i=!n&&Mn(e),o=!n&&!i&&vn(e),c=!n&&!i&&!o&&Kn(e),m=n||i||o||c,x=m?Vs(e.length,Rc):[],v=x.length;for(var A in e)(t||Le.call(e,A))&&!(m&&(A=="length"||o&&(A=="offset"||A=="parent")||c&&(A=="buffer"||A=="byteLength"||A=="byteOffset")||on(A,v)))&&x.push(A);return x}function Ro(e){var t=e.length;return t?e[di(0,t-1)]:r}function Ed(e,t){return ls(pt(e),Cn(t,0,e.length))}function Ad(e){return ls(pt(e))}function ei(e,t,n){(n!==r&&!Ht(e[t],n)||n===r&&!(t in e))&&nn(e,t,n)}function cr(e,t,n){var i=e[t];(!(Le.call(e,t)&&Ht(i,n))||n===r&&!(t in e))&&nn(e,t,n)}function Jr(e,t){for(var n=e.length;n--;)if(Ht(e[n][0],t))return n;return-1}function Ld(e,t,n,i){return pn(e,function(o,c,m){t(i,o,n(o),m)}),i}function zo(e,t){return e&&Yt(t,nt(t),e)}function Md(e,t){return e&&Yt(t,bt(t),e)}function nn(e,t,n){t=="__proto__"&&Gr?Gr(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function ti(e,t){for(var n=-1,i=t.length,o=I(i),c=e==null;++n<i;)o[n]=c?r:Pi(e,t[n]);return o}function Cn(e,t,n){return e===e&&(n!==r&&(e=e<=n?e:n),t!==r&&(e=e>=t?e:t)),e}function Pt(e,t,n,i,o,c){var m,x=t&S,v=t&N,A=t&E;if(n&&(m=o?n(e,i,o,c):n(e)),m!==r)return m;if(!Ge(e))return e;var L=le(e);if(L){if(m=vu(e),!x)return pt(e,m)}else{var T=ct(e),$=T==vt||T==zt;if(vn(e))return ca(e,x);if(T==Be||T==Ie||$&&!o){if(m=v||$?{}:Ca(e),!x)return v?cu(e,Md(m,e)):lu(e,zo(m,e))}else{if(!Oe[T])return o?e:{};m=wu(e,T,x)}}c||(c=new $t);var Y=c.get(e);if(Y)return Y;c.set(e,m),rl(e)?e.forEach(function(ie){m.add(Pt(ie,t,n,ie,e,c))}):tl(e)&&e.forEach(function(ie,be){m.set(be,Pt(ie,t,n,be,e,c))});var se=A?v?wi:vi:v?bt:nt,ue=L?r:se(e);return Mt(ue||e,function(ie,be){ue&&(be=ie,ie=e[be]),cr(m,be,Pt(ie,t,n,be,e,c))}),m}function Td(e){var t=nt(e);return function(n){return Wo(n,e,t)}}function Wo(e,t,n){var i=n.length;if(e==null)return!i;for(e=Te(e);i--;){var o=n[i],c=t[o],m=e[o];if(m===r&&!(o in e)||!c(m))return!1}return!0}function Bo(e,t,n){if(typeof e!="function")throw new Tt(g);return pr(function(){e.apply(r,n)},t)}function dr(e,t,n,i){var o=-1,c=Mr,m=!0,x=e.length,v=[],A=t.length;if(!x)return v;n&&(t=ze(t,kt(n))),i?(c=Bs,m=!1):t.length>=f&&(c=rr,m=!1,t=new jn(t));e:for(;++o<x;){var L=e[o],T=n==null?L:n(L);if(L=i||L!==0?L:0,m&&T===T){for(var $=A;$--;)if(t[$]===T)continue e;v.push(L)}else c(t,T,i)||v.push(L)}return v}var pn=ga(Jt),Uo=ga(ri,!0);function Od(e,t){var n=!0;return pn(e,function(i,o,c){return n=!!t(i,o,c),n}),n}function Yr(e,t,n){for(var i=-1,o=e.length;++i<o;){var c=e[i],m=t(c);if(m!=null&&(x===r?m===m&&!It(m):n(m,x)))var x=m,v=c}return v}function Pd(e,t,n,i){var o=e.length;for(n=de(n),n<0&&(n=-n>o?0:o+n),i=i===r||i>o?o:de(i),i<0&&(i+=o),i=n>i?0:il(i);n<i;)e[n++]=t;return e}function Go(e,t){var n=[];return pn(e,function(i,o,c){t(i,o,c)&&n.push(i)}),n}function at(e,t,n,i,o){var c=-1,m=e.length;for(n||(n=ku),o||(o=[]);++c<m;){var x=e[c];t>0&&n(x)?t>1?at(x,t-1,n,i,o):hn(o,x):i||(o[o.length]=x)}return o}var ni=ma(),$o=ma(!0);function Jt(e,t){return e&&ni(e,t,nt)}function ri(e,t){return e&&$o(e,t,nt)}function Xr(e,t){return fn(t,function(n){return an(e[n])})}function En(e,t){t=bn(t,e);for(var n=0,i=t.length;e!=null&&n<i;)e=e[Xt(t[n++])];return n&&n==i?e:r}function Ho(e,t,n){var i=t(e);return le(e)?i:hn(i,n(e))}function dt(e){return e==null?e===r?Bt:Qt:In&&In in Te(e)?xu(e):Au(e)}function si(e,t){return e>t}function Dd(e,t){return e!=null&&Le.call(e,t)}function Fd(e,t){return e!=null&&t in Te(e)}function Rd(e,t,n){return e>=lt(t,n)&&e<Qe(t,n)}function ii(e,t,n){for(var i=n?Bs:Mr,o=e[0].length,c=e.length,m=c,x=I(c),v=1/0,A=[];m--;){var L=e[m];m&&t&&(L=ze(L,kt(t))),v=lt(L.length,v),x[m]=!n&&(t||o>=120&&L.length>=120)?new jn(m&&L):r}L=e[0];var T=-1,$=x[0];e:for(;++T<o&&A.length<v;){var Y=L[T],se=t?t(Y):Y;if(Y=n||Y!==0?Y:0,!($?rr($,se):i(A,se,n))){for(m=c;--m;){var ue=x[m];if(!(ue?rr(ue,se):i(e[m],se,n)))continue e}$&&$.push(se),A.push(Y)}}return A}function zd(e,t,n,i){return Jt(e,function(o,c,m){t(i,n(o),c,m)}),i}function ur(e,t,n){t=bn(t,e),e=Ma(e,t);var i=e==null?e:e[Xt(Ft(t))];return i==null?r:_t(i,e,n)}function qo(e){return qe(e)&&dt(e)==Ie}function Wd(e){return qe(e)&&dt(e)==ee}function Bd(e){return qe(e)&&dt(e)==We}function fr(e,t,n,i,o){return e===t?!0:e==null||t==null||!qe(e)&&!qe(t)?e!==e&&t!==t:Ud(e,t,n,i,fr,o)}function Ud(e,t,n,i,o,c){var m=le(e),x=le(t),v=m?Pe:ct(e),A=x?Pe:ct(t);v=v==Ie?Be:v,A=A==Ie?Be:A;var L=v==Be,T=A==Be,$=v==A;if($&&vn(e)){if(!vn(t))return!1;m=!0,L=!1}if($&&!L)return c||(c=new $t),m||Kn(e)?Ia(e,t,n,i,o,c):mu(e,t,v,n,i,o,c);if(!(n&P)){var Y=L&&Le.call(e,"__wrapped__"),se=T&&Le.call(t,"__wrapped__");if(Y||se){var ue=Y?e.value():e,ie=se?t.value():t;return c||(c=new $t),o(ue,ie,n,i,c)}}return $?(c||(c=new $t),pu(e,t,n,i,o,c)):!1}function Gd(e){return qe(e)&&ct(e)==st}function oi(e,t,n,i){var o=n.length,c=o,m=!i;if(e==null)return!c;for(e=Te(e);o--;){var x=n[o];if(m&&x[2]?x[1]!==e[x[0]]:!(x[0]in e))return!1}for(;++o<c;){x=n[o];var v=x[0],A=e[v],L=x[1];if(m&&x[2]){if(A===r&&!(v in e))return!1}else{var T=new $t;if(i)var $=i(A,L,v,e,t,T);if(!($===r?fr(L,A,P|F,i,T):$))return!1}}return!0}function Vo(e){if(!Ge(e)||Iu(e))return!1;var t=an(e)?Gc:Ts;return t.test(Ln(e))}function $d(e){return qe(e)&&dt(e)==Wt}function Hd(e){return qe(e)&&ct(e)==Je}function qd(e){return qe(e)&&gs(e.length)&&!!De[dt(e)]}function Ko(e){return typeof e=="function"?e:e==null?yt:typeof e=="object"?le(e)?Xo(e[0],e[1]):Yo(e):pl(e)}function ai(e){if(!mr(e))return Jc(e);var t=[];for(var n in Te(e))Le.call(e,n)&&n!="constructor"&&t.push(n);return t}function Vd(e){if(!Ge(e))return Eu(e);var t=mr(e),n=[];for(var i in e)i=="constructor"&&(t||!Le.call(e,i))||n.push(i);return n}function li(e,t){return e<t}function Jo(e,t){var n=-1,i=xt(e)?I(e.length):[];return pn(e,function(o,c,m){i[++n]=t(o,c,m)}),i}function Yo(e){var t=ki(e);return t.length==1&&t[0][2]?Aa(t[0][0],t[0][1]):function(n){return n===e||oi(n,e,t)}}function Xo(e,t){return Ii(e)&&Ea(t)?Aa(Xt(e),t):function(n){var i=Pi(n,e);return i===r&&i===t?Di(n,e):fr(t,i,P|F)}}function Qr(e,t,n,i,o){e!==t&&ni(t,function(c,m){if(o||(o=new $t),Ge(c))Kd(e,t,m,n,Qr,i,o);else{var x=i?i(ji(e,m),c,m+"",e,t,o):r;x===r&&(x=c),ei(e,m,x)}},bt)}function Kd(e,t,n,i,o,c,m){var x=ji(e,n),v=ji(t,n),A=m.get(v);if(A){ei(e,n,A);return}var L=c?c(x,v,n+"",e,t,m):r,T=L===r;if(T){var $=le(v),Y=!$&&vn(v),se=!$&&!Y&&Kn(v);L=v,$||Y||se?le(x)?L=x:Ve(x)?L=pt(x):Y?(T=!1,L=ca(v,!0)):se?(T=!1,L=da(v,!0)):L=[]:xr(v)||Mn(v)?(L=x,Mn(x)?L=ol(x):(!Ge(x)||an(x))&&(L=Ca(v))):T=!1}T&&(m.set(v,L),o(L,v,i,c,m),m.delete(v)),ei(e,n,L)}function Qo(e,t){var n=e.length;if(n)return t+=t<0?n:0,on(t,n)?e[t]:r}function Zo(e,t,n){t.length?t=ze(t,function(c){return le(c)?function(m){return En(m,c.length===1?c[0]:c)}:c}):t=[yt];var i=-1;t=ze(t,kt(ne()));var o=Jo(e,function(c,m,x){var v=ze(t,function(A){return A(c)});return{criteria:v,index:++i,value:c}});return wc(o,function(c,m){return au(c,m,n)})}function Jd(e,t){return ea(e,t,function(n,i){return Di(e,i)})}function ea(e,t,n){for(var i=-1,o=t.length,c={};++i<o;){var m=t[i],x=En(e,m);n(x,m)&&hr(c,bn(m,e),x)}return c}function Yd(e){return function(t){return En(t,e)}}function ci(e,t,n,i){var o=i?vc:Fn,c=-1,m=t.length,x=e;for(e===t&&(t=pt(t)),n&&(x=ze(e,kt(n)));++c<m;)for(var v=0,A=t[c],L=n?n(A):A;(v=o(x,L,v,i))>-1;)x!==e&&Ur.call(x,v,1),Ur.call(e,v,1);return e}function ta(e,t){for(var n=e?t.length:0,i=n-1;n--;){var o=t[n];if(n==i||o!==c){var c=o;on(o)?Ur.call(e,o,1):hi(e,o)}}return e}function di(e,t){return e+Hr(Po()*(t-e+1))}function Xd(e,t,n,i){for(var o=-1,c=Qe($r((t-e)/(n||1)),0),m=I(c);c--;)m[i?c:++o]=e,e+=n;return m}function ui(e,t){var n="";if(!e||t<1||t>R)return n;do t%2&&(n+=e),t=Hr(t/2),t&&(e+=e);while(t);return n}function ge(e,t){return Ci(La(e,t,yt),e+"")}function Qd(e){return Ro(Jn(e))}function Zd(e,t){var n=Jn(e);return ls(n,Cn(t,0,n.length))}function hr(e,t,n,i){if(!Ge(e))return e;t=bn(t,e);for(var o=-1,c=t.length,m=c-1,x=e;x!=null&&++o<c;){var v=Xt(t[o]),A=n;if(v==="__proto__"||v==="constructor"||v==="prototype")return e;if(o!=m){var L=x[v];A=i?i(L,v,x):r,A===r&&(A=Ge(L)?L:on(t[o+1])?[]:{})}cr(x,v,A),x=x[v]}return e}var na=qr?function(e,t){return qr.set(e,t),e}:yt,eu=Gr?function(e,t){return Gr(e,"toString",{configurable:!0,enumerable:!1,value:Ri(t),writable:!0})}:yt;function tu(e){return ls(Jn(e))}function Dt(e,t,n){var i=-1,o=e.length;t<0&&(t=-t>o?0:o+t),n=n>o?o:n,n<0&&(n+=o),o=t>n?0:n-t>>>0,t>>>=0;for(var c=I(o);++i<o;)c[i]=e[i+t];return c}function nu(e,t){var n;return pn(e,function(i,o,c){return n=t(i,o,c),!n}),!!n}function Zr(e,t,n){var i=0,o=e==null?i:e.length;if(typeof t=="number"&&t===t&&o<=he){for(;i<o;){var c=i+o>>>1,m=e[c];m!==null&&!It(m)&&(n?m<=t:m<t)?i=c+1:o=c}return o}return fi(e,t,yt,n)}function fi(e,t,n,i){var o=0,c=e==null?0:e.length;if(c===0)return 0;t=n(t);for(var m=t!==t,x=t===null,v=It(t),A=t===r;o<c;){var L=Hr((o+c)/2),T=n(e[L]),$=T!==r,Y=T===null,se=T===T,ue=It(T);if(m)var ie=i||se;else A?ie=se&&(i||$):x?ie=se&&$&&(i||!Y):v?ie=se&&$&&!Y&&(i||!ue):Y||ue?ie=!1:ie=i?T<=t:T<t;ie?o=L+1:c=L}return lt(c,ye)}function ra(e,t){for(var n=-1,i=e.length,o=0,c=[];++n<i;){var m=e[n],x=t?t(m):m;if(!n||!Ht(x,v)){var v=x;c[o++]=m===0?0:m}}return c}function sa(e){return typeof e=="number"?e:It(e)?H:+e}function St(e){if(typeof e=="string")return e;if(le(e))return ze(e,St)+"";if(It(e))return Do?Do.call(e):"";var t=e+"";return t=="0"&&1/e==-_e?"-0":t}function xn(e,t,n){var i=-1,o=Mr,c=e.length,m=!0,x=[],v=x;if(n)m=!1,o=Bs;else if(c>=f){var A=t?null:hu(e);if(A)return Or(A);m=!1,o=rr,v=new jn}else v=t?[]:x;e:for(;++i<c;){var L=e[i],T=t?t(L):L;if(L=n||L!==0?L:0,m&&T===T){for(var $=v.length;$--;)if(v[$]===T)continue e;t&&v.push(T),x.push(L)}else o(v,T,n)||(v!==x&&v.push(T),x.push(L))}return x}function hi(e,t){return t=bn(t,e),e=Ma(e,t),e==null||delete e[Xt(Ft(t))]}function ia(e,t,n,i){return hr(e,t,n(En(e,t)),i)}function es(e,t,n,i){for(var o=e.length,c=i?o:-1;(i?c--:++c<o)&&t(e[c],c,e););return n?Dt(e,i?0:c,i?c+1:o):Dt(e,i?c+1:0,i?o:c)}function oa(e,t){var n=e;return n instanceof ve&&(n=n.value()),Us(t,function(i,o){return o.func.apply(o.thisArg,hn([i],o.args))},n)}function gi(e,t,n){var i=e.length;if(i<2)return i?xn(e[0]):[];for(var o=-1,c=I(i);++o<i;)for(var m=e[o],x=-1;++x<i;)x!=o&&(c[o]=dr(c[o]||m,e[x],t,n));return xn(at(c,1),t,n)}function aa(e,t,n){for(var i=-1,o=e.length,c=t.length,m={};++i<o;){var x=i<c?t[i]:r;n(m,e[i],x)}return m}function mi(e){return Ve(e)?e:[]}function pi(e){return typeof e=="function"?e:yt}function bn(e,t){return le(e)?e:Ii(e,t)?[e]:Da(Ee(e))}var ru=ge;function yn(e,t,n){var i=e.length;return n=n===r?i:n,!t&&n>=i?e:Dt(e,t,n)}var la=$c||function(e){return ot.clearTimeout(e)};function ca(e,t){if(t)return e.slice();var n=e.length,i=Ao?Ao(n):new e.constructor(n);return e.copy(i),i}function xi(e){var t=new e.constructor(e.byteLength);return new Wr(t).set(new Wr(e)),t}function su(e,t){var n=t?xi(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}function iu(e){var t=new e.constructor(e.source,nr.exec(e));return t.lastIndex=e.lastIndex,t}function ou(e){return lr?Te(lr.call(e)):{}}function da(e,t){var n=t?xi(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function ua(e,t){if(e!==t){var n=e!==r,i=e===null,o=e===e,c=It(e),m=t!==r,x=t===null,v=t===t,A=It(t);if(!x&&!A&&!c&&e>t||c&&m&&v&&!x&&!A||i&&m&&v||!n&&v||!o)return 1;if(!i&&!c&&!A&&e<t||A&&n&&o&&!i&&!c||x&&n&&o||!m&&o||!v)return-1}return 0}function au(e,t,n){for(var i=-1,o=e.criteria,c=t.criteria,m=o.length,x=n.length;++i<m;){var v=ua(o[i],c[i]);if(v){if(i>=x)return v;var A=n[i];return v*(A=="desc"?-1:1)}}return e.index-t.index}function fa(e,t,n,i){for(var o=-1,c=e.length,m=n.length,x=-1,v=t.length,A=Qe(c-m,0),L=I(v+A),T=!i;++x<v;)L[x]=t[x];for(;++o<m;)(T||o<c)&&(L[n[o]]=e[o]);for(;A--;)L[x++]=e[o++];return L}function ha(e,t,n,i){for(var o=-1,c=e.length,m=-1,x=n.length,v=-1,A=t.length,L=Qe(c-x,0),T=I(L+A),$=!i;++o<L;)T[o]=e[o];for(var Y=o;++v<A;)T[Y+v]=t[v];for(;++m<x;)($||o<c)&&(T[Y+n[m]]=e[o++]);return T}function pt(e,t){var n=-1,i=e.length;for(t||(t=I(i));++n<i;)t[n]=e[n];return t}function Yt(e,t,n,i){var o=!n;n||(n={});for(var c=-1,m=t.length;++c<m;){var x=t[c],v=i?i(n[x],e[x],x,n,e):r;v===r&&(v=e[x]),o?nn(n,x,v):cr(n,x,v)}return n}function lu(e,t){return Yt(e,Si(e),t)}function cu(e,t){return Yt(e,Na(e),t)}function ts(e,t){return function(n,i){var o=le(n)?gc:Ld,c=t?t():{};return o(n,e,ne(i,2),c)}}function Hn(e){return ge(function(t,n){var i=-1,o=n.length,c=o>1?n[o-1]:r,m=o>2?n[2]:r;for(c=e.length>3&&typeof c=="function"?(o--,c):r,m&&ut(n[0],n[1],m)&&(c=o<3?r:c,o=1),t=Te(t);++i<o;){var x=n[i];x&&e(t,x,i,c)}return t})}function ga(e,t){return function(n,i){if(n==null)return n;if(!xt(n))return e(n,i);for(var o=n.length,c=t?o:-1,m=Te(n);(t?c--:++c<o)&&i(m[c],c,m)!==!1;);return n}}function ma(e){return function(t,n,i){for(var o=-1,c=Te(t),m=i(t),x=m.length;x--;){var v=m[e?x:++o];if(n(c[v],v,c)===!1)break}return t}}function du(e,t,n){var i=t&U,o=gr(e);function c(){var m=this&&this!==ot&&this instanceof c?o:e;return m.apply(i?n:this,arguments)}return c}function pa(e){return function(t){t=Ee(t);var n=Rn(t)?Gt(t):r,i=n?n[0]:t.charAt(0),o=n?yn(n,1).join(""):t.slice(1);return i[e]()+o}}function qn(e){return function(t){return Us(gl(hl(t).replace(ec,"")),e,"")}}function gr(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=$n(e.prototype),i=e.apply(n,t);return Ge(i)?i:n}}function uu(e,t,n){var i=gr(e);function o(){for(var c=arguments.length,m=I(c),x=c,v=Vn(o);x--;)m[x]=arguments[x];var A=c<3&&m[0]!==v&&m[c-1]!==v?[]:gn(m,v);if(c-=A.length,c<n)return wa(e,t,ns,o.placeholder,r,m,A,r,r,n-c);var L=this&&this!==ot&&this instanceof o?i:e;return _t(L,this,m)}return o}function xa(e){return function(t,n,i){var o=Te(t);if(!xt(t)){var c=ne(n,3);t=nt(t),n=function(x){return c(o[x],x,o)}}var m=e(t,n,i);return m>-1?o[c?t[m]:m]:r}}function ba(e){return sn(function(t){var n=t.length,i=n,o=Ot.prototype.thru;for(e&&t.reverse();i--;){var c=t[i];if(typeof c!="function")throw new Tt(g);if(o&&!m&&os(c)=="wrapper")var m=new Ot([],!0)}for(i=m?i:n;++i<n;){c=t[i];var x=os(c),v=x=="wrapper"?_i(c):r;v&&Ni(v[0])&&v[1]==(Z|Q|G|j)&&!v[4].length&&v[9]==1?m=m[os(v[0])].apply(m,v[3]):m=c.length==1&&Ni(c)?m[x]():m.thru(c)}return function(){var A=arguments,L=A[0];if(m&&A.length==1&&le(L))return m.plant(L).value();for(var T=0,$=n?t[T].apply(this,A):L;++T<n;)$=t[T].call(this,$);return $}})}function ns(e,t,n,i,o,c,m,x,v,A){var L=t&Z,T=t&U,$=t&z,Y=t&(Q|q),se=t&D,ue=$?r:gr(e);function ie(){for(var be=arguments.length,we=I(be),Nt=be;Nt--;)we[Nt]=arguments[Nt];if(Y)var ft=Vn(ie),jt=kc(we,ft);if(i&&(we=fa(we,i,o,Y)),c&&(we=ha(we,c,m,Y)),be-=jt,Y&&be<A){var Ke=gn(we,ft);return wa(e,t,ns,ie.placeholder,n,we,Ke,x,v,A-be)}var qt=T?n:this,cn=$?qt[e]:e;return be=we.length,x?we=Lu(we,x):se&&be>1&&we.reverse(),L&&v<be&&(we.length=v),this&&this!==ot&&this instanceof ie&&(cn=ue||gr(cn)),cn.apply(qt,we)}return ie}function ya(e,t){return function(n,i){return zd(n,e,t(i),{})}}function rs(e,t){return function(n,i){var o;if(n===r&&i===r)return t;if(n!==r&&(o=n),i!==r){if(o===r)return i;typeof n=="string"||typeof i=="string"?(n=St(n),i=St(i)):(n=sa(n),i=sa(i)),o=e(n,i)}return o}}function bi(e){return sn(function(t){return t=ze(t,kt(ne())),ge(function(n){var i=this;return e(t,function(o){return _t(o,i,n)})})})}function ss(e,t){t=t===r?" ":St(t);var n=t.length;if(n<2)return n?ui(t,e):t;var i=ui(t,$r(e/zn(t)));return Rn(t)?yn(Gt(i),0,e).join(""):i.slice(0,e)}function fu(e,t,n,i){var o=t&U,c=gr(e);function m(){for(var x=-1,v=arguments.length,A=-1,L=i.length,T=I(L+v),$=this&&this!==ot&&this instanceof m?c:e;++A<L;)T[A]=i[A];for(;v--;)T[A++]=arguments[++x];return _t($,o?n:this,T)}return m}function va(e){return function(t,n,i){return i&&typeof i!="number"&&ut(t,n,i)&&(n=i=r),t=ln(t),n===r?(n=t,t=0):n=ln(n),i=i===r?t<n?1:-1:ln(i),Xd(t,n,i,e)}}function is(e){return function(t,n){return typeof t=="string"&&typeof n=="string"||(t=Rt(t),n=Rt(n)),e(t,n)}}function wa(e,t,n,i,o,c,m,x,v,A){var L=t&Q,T=L?m:r,$=L?r:m,Y=L?c:r,se=L?r:c;t|=L?G:re,t&=~(L?re:G),t&te||(t&=-4);var ue=[e,t,o,Y,T,se,$,x,v,A],ie=n.apply(r,ue);return Ni(e)&&Ta(ie,ue),ie.placeholder=i,Oa(ie,e,t)}function yi(e){var t=Xe[e];return function(n,i){if(n=Rt(n),i=i==null?0:lt(de(i),292),i&&Oo(n)){var o=(Ee(n)+"e").split("e"),c=t(o[0]+"e"+(+o[1]+i));return o=(Ee(c)+"e").split("e"),+(o[0]+"e"+(+o[1]-i))}return t(n)}}var hu=Un&&1/Or(new Un([,-0]))[1]==_e?function(e){return new Un(e)}:Bi;function _a(e){return function(t){var n=ct(t);return n==st?Js(t):n==Je?Ac(t):_c(t,e(t))}}function rn(e,t,n,i,o,c,m,x){var v=t&z;if(!v&&typeof e!="function")throw new Tt(g);var A=i?i.length:0;if(A||(t&=-97,i=o=r),m=m===r?m:Qe(de(m),0),x=x===r?x:de(x),A-=o?o.length:0,t&re){var L=i,T=o;i=o=r}var $=v?r:_i(e),Y=[e,t,n,i,o,L,T,c,m,x];if($&&Cu(Y,$),e=Y[0],t=Y[1],n=Y[2],i=Y[3],o=Y[4],x=Y[9]=Y[9]===r?v?0:e.length:Qe(Y[9]-A,0),!x&&t&(Q|q)&&(t&=-25),!t||t==U)var se=du(e,t,n);else t==Q||t==q?se=uu(e,t,x):(t==G||t==(U|G))&&!o.length?se=fu(e,t,n,i):se=ns.apply(r,Y);var ue=$?na:Ta;return Oa(ue(se,Y),e,t)}function ka(e,t,n,i){return e===r||Ht(e,Bn[n])&&!Le.call(i,n)?t:e}function Sa(e,t,n,i,o,c){return Ge(e)&&Ge(t)&&(c.set(t,e),Qr(e,t,r,Sa,c),c.delete(t)),e}function gu(e){return xr(e)?r:e}function Ia(e,t,n,i,o,c){var m=n&P,x=e.length,v=t.length;if(x!=v&&!(m&&v>x))return!1;var A=c.get(e),L=c.get(t);if(A&&L)return A==t&&L==e;var T=-1,$=!0,Y=n&F?new jn:r;for(c.set(e,t),c.set(t,e);++T<x;){var se=e[T],ue=t[T];if(i)var ie=m?i(ue,se,T,t,e,c):i(se,ue,T,e,t,c);if(ie!==r){if(ie)continue;$=!1;break}if(Y){if(!Gs(t,function(be,we){if(!rr(Y,we)&&(se===be||o(se,be,n,i,c)))return Y.push(we)})){$=!1;break}}else if(!(se===ue||o(se,ue,n,i,c))){$=!1;break}}return c.delete(e),c.delete(t),$}function mu(e,t,n,i,o,c,m){switch(n){case ae:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case ee:return!(e.byteLength!=t.byteLength||!c(new Wr(e),new Wr(t)));case Ae:case We:case gt:return Ht(+e,+t);case ht:return e.name==t.name&&e.message==t.message;case Wt:case Ct:return e==t+"";case st:var x=Js;case Je:var v=i&P;if(x||(x=Or),e.size!=t.size&&!v)return!1;var A=m.get(e);if(A)return A==t;i|=F,m.set(e,t);var L=Ia(x(e),x(t),i,o,c,m);return m.delete(e),L;case wt:if(lr)return lr.call(e)==lr.call(t)}return!1}function pu(e,t,n,i,o,c){var m=n&P,x=vi(e),v=x.length,A=vi(t),L=A.length;if(v!=L&&!m)return!1;for(var T=v;T--;){var $=x[T];if(!(m?$ in t:Le.call(t,$)))return!1}var Y=c.get(e),se=c.get(t);if(Y&&se)return Y==t&&se==e;var ue=!0;c.set(e,t),c.set(t,e);for(var ie=m;++T<v;){$=x[T];var be=e[$],we=t[$];if(i)var Nt=m?i(we,be,$,t,e,c):i(be,we,$,e,t,c);if(!(Nt===r?be===we||o(be,we,n,i,c):Nt)){ue=!1;break}ie||(ie=$=="constructor")}if(ue&&!ie){var ft=e.constructor,jt=t.constructor;ft!=jt&&"constructor"in e&&"constructor"in t&&!(typeof ft=="function"&&ft instanceof ft&&typeof jt=="function"&&jt instanceof jt)&&(ue=!1)}return c.delete(e),c.delete(t),ue}function sn(e){return Ci(La(e,r,Wa),e+"")}function vi(e){return Ho(e,nt,Si)}function wi(e){return Ho(e,bt,Na)}var _i=qr?function(e){return qr.get(e)}:Bi;function os(e){for(var t=e.name+"",n=Gn[t],i=Le.call(Gn,t)?n.length:0;i--;){var o=n[i],c=o.func;if(c==null||c==e)return o.name}return t}function Vn(e){var t=Le.call(l,"placeholder")?l:e;return t.placeholder}function ne(){var e=l.iteratee||zi;return e=e===zi?Ko:e,arguments.length?e(arguments[0],arguments[1]):e}function as(e,t){var n=e.__data__;return Su(t)?n[typeof t=="string"?"string":"hash"]:n.map}function ki(e){for(var t=nt(e),n=t.length;n--;){var i=t[n],o=e[i];t[n]=[i,o,Ea(o)]}return t}function An(e,t){var n=jc(e,t);return Vo(n)?n:r}function xu(e){var t=Le.call(e,In),n=e[In];try{e[In]=r;var i=!0}catch{}var o=Rr.call(e);return i&&(t?e[In]=n:delete e[In]),o}var Si=Xs?function(e){return e==null?[]:(e=Te(e),fn(Xs(e),function(t){return Mo.call(e,t)}))}:Ui,Na=Xs?function(e){for(var t=[];e;)hn(t,Si(e)),e=Br(e);return t}:Ui,ct=dt;(Qs&&ct(new Qs(new ArrayBuffer(1)))!=ae||ir&&ct(new ir)!=st||Zs&&ct(Zs.resolve())!=Zt||Un&&ct(new Un)!=Je||or&&ct(new or)!=Et)&&(ct=function(e){var t=dt(e),n=t==Be?e.constructor:r,i=n?Ln(n):"";if(i)switch(i){case Zc:return ae;case ed:return st;case td:return Zt;case nd:return Je;case rd:return Et}return t});function bu(e,t,n){for(var i=-1,o=n.length;++i<o;){var c=n[i],m=c.size;switch(c.type){case"drop":e+=m;break;case"dropRight":t-=m;break;case"take":t=lt(t,e+m);break;case"takeRight":e=Qe(e,t-m);break}}return{start:e,end:t}}function yu(e){var t=e.match(As);return t?t[1].split(Ls):[]}function ja(e,t,n){t=bn(t,e);for(var i=-1,o=t.length,c=!1;++i<o;){var m=Xt(t[i]);if(!(c=e!=null&&n(e,m)))break;e=e[m]}return c||++i!=o?c:(o=e==null?0:e.length,!!o&&gs(o)&&on(m,o)&&(le(e)||Mn(e)))}function vu(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&Le.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function Ca(e){return typeof e.constructor=="function"&&!mr(e)?$n(Br(e)):{}}function wu(e,t,n){var i=e.constructor;switch(t){case ee:return xi(e);case Ae:case We:return new i(+e);case ae:return su(e,n);case Ce:case Ye:case Fe:case Ue:case Re:case it:case mt:case Ut:case Qn:return da(e,n);case st:return new i;case gt:case Ct:return new i(e);case Wt:return iu(e);case Je:return new i;case wt:return ou(e)}}function _u(e,t){var n=t.length;if(!n)return e;var i=n-1;return t[i]=(n>1?"& ":"")+t[i],t=t.join(n>2?", ":" "),e.replace(dn,`{
/* [wrapped with `+t+`] */
`)}function ku(e){return le(e)||Mn(e)||!!(To&&e&&e[To])}function on(e,t){var n=typeof e;return t=t??R,!!t&&(n=="number"||n!="symbol"&&On.test(e))&&e>-1&&e%1==0&&e<t}function ut(e,t,n){if(!Ge(n))return!1;var i=typeof t;return(i=="number"?xt(n)&&on(t,n.length):i=="string"&&t in n)?Ht(n[t],e):!1}function Ii(e,t){if(le(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||It(e)?!0:$e.test(e)||!js.test(e)||t!=null&&e in Te(t)}function Su(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Ni(e){var t=os(e),n=l[t];if(typeof n!="function"||!(t in ve.prototype))return!1;if(e===n)return!0;var i=_i(n);return!!i&&e===i[0]}function Iu(e){return!!Eo&&Eo in e}var Nu=Dr?an:Gi;function mr(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||Bn;return e===n}function Ea(e){return e===e&&!Ge(e)}function Aa(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==r||e in Te(n))}}function ju(e){var t=fs(e,function(i){return n.size===k&&n.clear(),i}),n=t.cache;return t}function Cu(e,t){var n=e[1],i=t[1],o=n|i,c=o<(U|z|Z),m=i==Z&&n==Q||i==Z&&n==j&&e[7].length<=t[8]||i==(Z|j)&&t[7].length<=t[8]&&n==Q;if(!(c||m))return e;i&U&&(e[2]=t[2],o|=n&U?0:te);var x=t[3];if(x){var v=e[3];e[3]=v?fa(v,x,t[4]):x,e[4]=v?gn(e[3],w):t[4]}return x=t[5],x&&(v=e[5],e[5]=v?ha(v,x,t[6]):x,e[6]=v?gn(e[5],w):t[6]),x=t[7],x&&(e[7]=x),i&Z&&(e[8]=e[8]==null?t[8]:lt(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=o,e}function Eu(e){var t=[];if(e!=null)for(var n in Te(e))t.push(n);return t}function Au(e){return Rr.call(e)}function La(e,t,n){return t=Qe(t===r?e.length-1:t,0),function(){for(var i=arguments,o=-1,c=Qe(i.length-t,0),m=I(c);++o<c;)m[o]=i[t+o];o=-1;for(var x=I(t+1);++o<t;)x[o]=i[o];return x[t]=n(m),_t(e,this,x)}}function Ma(e,t){return t.length<2?e:En(e,Dt(t,0,-1))}function Lu(e,t){for(var n=e.length,i=lt(t.length,n),o=pt(e);i--;){var c=t[i];e[i]=on(c,n)?o[c]:r}return e}function ji(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var Ta=Pa(na),pr=qc||function(e,t){return ot.setTimeout(e,t)},Ci=Pa(eu);function Oa(e,t,n){var i=t+"";return Ci(e,_u(i,Mu(yu(i),n)))}function Pa(e){var t=0,n=0;return function(){var i=Yc(),o=ke-(i-n);if(n=i,o>0){if(++t>=B)return arguments[0]}else t=0;return e.apply(r,arguments)}}function ls(e,t){var n=-1,i=e.length,o=i-1;for(t=t===r?i:t;++n<t;){var c=di(n,o),m=e[c];e[c]=e[n],e[n]=m}return e.length=t,e}var Da=ju(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Cs,function(n,i,o,c){t.push(o?c.replace(tr,"$1"):i||n)}),t});function Xt(e){if(typeof e=="string"||It(e))return e;var t=e+"";return t=="0"&&1/e==-_e?"-0":t}function Ln(e){if(e!=null){try{return Fr.call(e)}catch{}try{return e+""}catch{}}return""}function Mu(e,t){return Mt(pe,function(n){var i="_."+n[0];t&n[1]&&!Mr(e,i)&&e.push(i)}),e.sort()}function Fa(e){if(e instanceof ve)return e.clone();var t=new Ot(e.__wrapped__,e.__chain__);return t.__actions__=pt(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function Tu(e,t,n){(n?ut(e,t,n):t===r)?t=1:t=Qe(de(t),0);var i=e==null?0:e.length;if(!i||t<1)return[];for(var o=0,c=0,m=I($r(i/t));o<i;)m[c++]=Dt(e,o,o+=t);return m}function Ou(e){for(var t=-1,n=e==null?0:e.length,i=0,o=[];++t<n;){var c=e[t];c&&(o[i++]=c)}return o}function Pu(){var e=arguments.length;if(!e)return[];for(var t=I(e-1),n=arguments[0],i=e;i--;)t[i-1]=arguments[i];return hn(le(n)?pt(n):[n],at(t,1))}var Du=ge(function(e,t){return Ve(e)?dr(e,at(t,1,Ve,!0)):[]}),Fu=ge(function(e,t){var n=Ft(t);return Ve(n)&&(n=r),Ve(e)?dr(e,at(t,1,Ve,!0),ne(n,2)):[]}),Ru=ge(function(e,t){var n=Ft(t);return Ve(n)&&(n=r),Ve(e)?dr(e,at(t,1,Ve,!0),r,n):[]});function zu(e,t,n){var i=e==null?0:e.length;return i?(t=n||t===r?1:de(t),Dt(e,t<0?0:t,i)):[]}function Wu(e,t,n){var i=e==null?0:e.length;return i?(t=n||t===r?1:de(t),t=i-t,Dt(e,0,t<0?0:t)):[]}function Bu(e,t){return e&&e.length?es(e,ne(t,3),!0,!0):[]}function Uu(e,t){return e&&e.length?es(e,ne(t,3),!0):[]}function Gu(e,t,n,i){var o=e==null?0:e.length;return o?(n&&typeof n!="number"&&ut(e,t,n)&&(n=0,i=o),Pd(e,t,n,i)):[]}function Ra(e,t,n){var i=e==null?0:e.length;if(!i)return-1;var o=n==null?0:de(n);return o<0&&(o=Qe(i+o,0)),Tr(e,ne(t,3),o)}function za(e,t,n){var i=e==null?0:e.length;if(!i)return-1;var o=i-1;return n!==r&&(o=de(n),o=n<0?Qe(i+o,0):lt(o,i-1)),Tr(e,ne(t,3),o,!0)}function Wa(e){var t=e==null?0:e.length;return t?at(e,1):[]}function $u(e){var t=e==null?0:e.length;return t?at(e,_e):[]}function Hu(e,t){var n=e==null?0:e.length;return n?(t=t===r?1:de(t),at(e,t)):[]}function qu(e){for(var t=-1,n=e==null?0:e.length,i={};++t<n;){var o=e[t];i[o[0]]=o[1]}return i}function Ba(e){return e&&e.length?e[0]:r}function Vu(e,t,n){var i=e==null?0:e.length;if(!i)return-1;var o=n==null?0:de(n);return o<0&&(o=Qe(i+o,0)),Fn(e,t,o)}function Ku(e){var t=e==null?0:e.length;return t?Dt(e,0,-1):[]}var Ju=ge(function(e){var t=ze(e,mi);return t.length&&t[0]===e[0]?ii(t):[]}),Yu=ge(function(e){var t=Ft(e),n=ze(e,mi);return t===Ft(n)?t=r:n.pop(),n.length&&n[0]===e[0]?ii(n,ne(t,2)):[]}),Xu=ge(function(e){var t=Ft(e),n=ze(e,mi);return t=typeof t=="function"?t:r,t&&n.pop(),n.length&&n[0]===e[0]?ii(n,r,t):[]});function Qu(e,t){return e==null?"":Kc.call(e,t)}function Ft(e){var t=e==null?0:e.length;return t?e[t-1]:r}function Zu(e,t,n){var i=e==null?0:e.length;if(!i)return-1;var o=i;return n!==r&&(o=de(n),o=o<0?Qe(i+o,0):lt(o,i-1)),t===t?Mc(e,t,o):Tr(e,wo,o,!0)}function ef(e,t){return e&&e.length?Qo(e,de(t)):r}var tf=ge(Ua);function Ua(e,t){return e&&e.length&&t&&t.length?ci(e,t):e}function nf(e,t,n){return e&&e.length&&t&&t.length?ci(e,t,ne(n,2)):e}function rf(e,t,n){return e&&e.length&&t&&t.length?ci(e,t,r,n):e}var sf=sn(function(e,t){var n=e==null?0:e.length,i=ti(e,t);return ta(e,ze(t,function(o){return on(o,n)?+o:o}).sort(ua)),i});function of(e,t){var n=[];if(!(e&&e.length))return n;var i=-1,o=[],c=e.length;for(t=ne(t,3);++i<c;){var m=e[i];t(m,i,e)&&(n.push(m),o.push(i))}return ta(e,o),n}function Ei(e){return e==null?e:Qc.call(e)}function af(e,t,n){var i=e==null?0:e.length;return i?(n&&typeof n!="number"&&ut(e,t,n)?(t=0,n=i):(t=t==null?0:de(t),n=n===r?i:de(n)),Dt(e,t,n)):[]}function lf(e,t){return Zr(e,t)}function cf(e,t,n){return fi(e,t,ne(n,2))}function df(e,t){var n=e==null?0:e.length;if(n){var i=Zr(e,t);if(i<n&&Ht(e[i],t))return i}return-1}function uf(e,t){return Zr(e,t,!0)}function ff(e,t,n){return fi(e,t,ne(n,2),!0)}function hf(e,t){var n=e==null?0:e.length;if(n){var i=Zr(e,t,!0)-1;if(Ht(e[i],t))return i}return-1}function gf(e){return e&&e.length?ra(e):[]}function mf(e,t){return e&&e.length?ra(e,ne(t,2)):[]}function pf(e){var t=e==null?0:e.length;return t?Dt(e,1,t):[]}function xf(e,t,n){return e&&e.length?(t=n||t===r?1:de(t),Dt(e,0,t<0?0:t)):[]}function bf(e,t,n){var i=e==null?0:e.length;return i?(t=n||t===r?1:de(t),t=i-t,Dt(e,t<0?0:t,i)):[]}function yf(e,t){return e&&e.length?es(e,ne(t,3),!1,!0):[]}function vf(e,t){return e&&e.length?es(e,ne(t,3)):[]}var wf=ge(function(e){return xn(at(e,1,Ve,!0))}),_f=ge(function(e){var t=Ft(e);return Ve(t)&&(t=r),xn(at(e,1,Ve,!0),ne(t,2))}),kf=ge(function(e){var t=Ft(e);return t=typeof t=="function"?t:r,xn(at(e,1,Ve,!0),r,t)});function Sf(e){return e&&e.length?xn(e):[]}function If(e,t){return e&&e.length?xn(e,ne(t,2)):[]}function Nf(e,t){return t=typeof t=="function"?t:r,e&&e.length?xn(e,r,t):[]}function Ai(e){if(!(e&&e.length))return[];var t=0;return e=fn(e,function(n){if(Ve(n))return t=Qe(n.length,t),!0}),Vs(t,function(n){return ze(e,$s(n))})}function Ga(e,t){if(!(e&&e.length))return[];var n=Ai(e);return t==null?n:ze(n,function(i){return _t(t,r,i)})}var jf=ge(function(e,t){return Ve(e)?dr(e,t):[]}),Cf=ge(function(e){return gi(fn(e,Ve))}),Ef=ge(function(e){var t=Ft(e);return Ve(t)&&(t=r),gi(fn(e,Ve),ne(t,2))}),Af=ge(function(e){var t=Ft(e);return t=typeof t=="function"?t:r,gi(fn(e,Ve),r,t)}),Lf=ge(Ai);function Mf(e,t){return aa(e||[],t||[],cr)}function Tf(e,t){return aa(e||[],t||[],hr)}var Of=ge(function(e){var t=e.length,n=t>1?e[t-1]:r;return n=typeof n=="function"?(e.pop(),n):r,Ga(e,n)});function $a(e){var t=l(e);return t.__chain__=!0,t}function Pf(e,t){return t(e),e}function cs(e,t){return t(e)}var Df=sn(function(e){var t=e.length,n=t?e[0]:0,i=this.__wrapped__,o=function(c){return ti(c,e)};return t>1||this.__actions__.length||!(i instanceof ve)||!on(n)?this.thru(o):(i=i.slice(n,+n+(t?1:0)),i.__actions__.push({func:cs,args:[o],thisArg:r}),new Ot(i,this.__chain__).thru(function(c){return t&&!c.length&&c.push(r),c}))});function Ff(){return $a(this)}function Rf(){return new Ot(this.value(),this.__chain__)}function zf(){this.__values__===r&&(this.__values__=sl(this.value()));var e=this.__index__>=this.__values__.length,t=e?r:this.__values__[this.__index__++];return{done:e,value:t}}function Wf(){return this}function Bf(e){for(var t,n=this;n instanceof Kr;){var i=Fa(n);i.__index__=0,i.__values__=r,t?o.__wrapped__=i:t=i;var o=i;n=n.__wrapped__}return o.__wrapped__=e,t}function Uf(){var e=this.__wrapped__;if(e instanceof ve){var t=e;return this.__actions__.length&&(t=new ve(this)),t=t.reverse(),t.__actions__.push({func:cs,args:[Ei],thisArg:r}),new Ot(t,this.__chain__)}return this.thru(Ei)}function Gf(){return oa(this.__wrapped__,this.__actions__)}var $f=ts(function(e,t,n){Le.call(e,n)?++e[n]:nn(e,n,1)});function Hf(e,t,n){var i=le(e)?yo:Od;return n&&ut(e,t,n)&&(t=r),i(e,ne(t,3))}function qf(e,t){var n=le(e)?fn:Go;return n(e,ne(t,3))}var Vf=xa(Ra),Kf=xa(za);function Jf(e,t){return at(ds(e,t),1)}function Yf(e,t){return at(ds(e,t),_e)}function Xf(e,t,n){return n=n===r?1:de(n),at(ds(e,t),n)}function Ha(e,t){var n=le(e)?Mt:pn;return n(e,ne(t,3))}function qa(e,t){var n=le(e)?mc:Uo;return n(e,ne(t,3))}var Qf=ts(function(e,t,n){Le.call(e,n)?e[n].push(t):nn(e,n,[t])});function Zf(e,t,n,i){e=xt(e)?e:Jn(e),n=n&&!i?de(n):0;var o=e.length;return n<0&&(n=Qe(o+n,0)),ms(e)?n<=o&&e.indexOf(t,n)>-1:!!o&&Fn(e,t,n)>-1}var eh=ge(function(e,t,n){var i=-1,o=typeof t=="function",c=xt(e)?I(e.length):[];return pn(e,function(m){c[++i]=o?_t(t,m,n):ur(m,t,n)}),c}),th=ts(function(e,t,n){nn(e,n,t)});function ds(e,t){var n=le(e)?ze:Jo;return n(e,ne(t,3))}function nh(e,t,n,i){return e==null?[]:(le(t)||(t=t==null?[]:[t]),n=i?r:n,le(n)||(n=n==null?[]:[n]),Zo(e,t,n))}var rh=ts(function(e,t,n){e[n?0:1].push(t)},function(){return[[],[]]});function sh(e,t,n){var i=le(e)?Us:ko,o=arguments.length<3;return i(e,ne(t,4),n,o,pn)}function ih(e,t,n){var i=le(e)?pc:ko,o=arguments.length<3;return i(e,ne(t,4),n,o,Uo)}function oh(e,t){var n=le(e)?fn:Go;return n(e,hs(ne(t,3)))}function ah(e){var t=le(e)?Ro:Qd;return t(e)}function lh(e,t,n){(n?ut(e,t,n):t===r)?t=1:t=de(t);var i=le(e)?Ed:Zd;return i(e,t)}function ch(e){var t=le(e)?Ad:tu;return t(e)}function dh(e){if(e==null)return 0;if(xt(e))return ms(e)?zn(e):e.length;var t=ct(e);return t==st||t==Je?e.size:ai(e).length}function uh(e,t,n){var i=le(e)?Gs:nu;return n&&ut(e,t,n)&&(t=r),i(e,ne(t,3))}var fh=ge(function(e,t){if(e==null)return[];var n=t.length;return n>1&&ut(e,t[0],t[1])?t=[]:n>2&&ut(t[0],t[1],t[2])&&(t=[t[0]]),Zo(e,at(t,1),[])}),us=Hc||function(){return ot.Date.now()};function hh(e,t){if(typeof t!="function")throw new Tt(g);return e=de(e),function(){if(--e<1)return t.apply(this,arguments)}}function Va(e,t,n){return t=n?r:t,t=e&&t==null?e.length:t,rn(e,Z,r,r,r,r,t)}function Ka(e,t){var n;if(typeof t!="function")throw new Tt(g);return e=de(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=r),n}}var Li=ge(function(e,t,n){var i=U;if(n.length){var o=gn(n,Vn(Li));i|=G}return rn(e,i,t,n,o)}),Ja=ge(function(e,t,n){var i=U|z;if(n.length){var o=gn(n,Vn(Ja));i|=G}return rn(t,i,e,n,o)});function Ya(e,t,n){t=n?r:t;var i=rn(e,Q,r,r,r,r,r,t);return i.placeholder=Ya.placeholder,i}function Xa(e,t,n){t=n?r:t;var i=rn(e,q,r,r,r,r,r,t);return i.placeholder=Xa.placeholder,i}function Qa(e,t,n){var i,o,c,m,x,v,A=0,L=!1,T=!1,$=!0;if(typeof e!="function")throw new Tt(g);t=Rt(t)||0,Ge(n)&&(L=!!n.leading,T="maxWait"in n,c=T?Qe(Rt(n.maxWait)||0,t):c,$="trailing"in n?!!n.trailing:$);function Y(Ke){var qt=i,cn=o;return i=o=r,A=Ke,m=e.apply(cn,qt),m}function se(Ke){return A=Ke,x=pr(be,t),L?Y(Ke):m}function ue(Ke){var qt=Ke-v,cn=Ke-A,xl=t-qt;return T?lt(xl,c-cn):xl}function ie(Ke){var qt=Ke-v,cn=Ke-A;return v===r||qt>=t||qt<0||T&&cn>=c}function be(){var Ke=us();if(ie(Ke))return we(Ke);x=pr(be,ue(Ke))}function we(Ke){return x=r,$&&i?Y(Ke):(i=o=r,m)}function Nt(){x!==r&&la(x),A=0,i=v=o=x=r}function ft(){return x===r?m:we(us())}function jt(){var Ke=us(),qt=ie(Ke);if(i=arguments,o=this,v=Ke,qt){if(x===r)return se(v);if(T)return la(x),x=pr(be,t),Y(v)}return x===r&&(x=pr(be,t)),m}return jt.cancel=Nt,jt.flush=ft,jt}var gh=ge(function(e,t){return Bo(e,1,t)}),mh=ge(function(e,t,n){return Bo(e,Rt(t)||0,n)});function ph(e){return rn(e,D)}function fs(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new Tt(g);var n=function(){var i=arguments,o=t?t.apply(this,i):i[0],c=n.cache;if(c.has(o))return c.get(o);var m=e.apply(this,i);return n.cache=c.set(o,m)||c,m};return n.cache=new(fs.Cache||tn),n}fs.Cache=tn;function hs(e){if(typeof e!="function")throw new Tt(g);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function xh(e){return Ka(2,e)}var bh=ru(function(e,t){t=t.length==1&&le(t[0])?ze(t[0],kt(ne())):ze(at(t,1),kt(ne()));var n=t.length;return ge(function(i){for(var o=-1,c=lt(i.length,n);++o<c;)i[o]=t[o].call(this,i[o]);return _t(e,this,i)})}),Mi=ge(function(e,t){var n=gn(t,Vn(Mi));return rn(e,G,r,t,n)}),Za=ge(function(e,t){var n=gn(t,Vn(Za));return rn(e,re,r,t,n)}),yh=sn(function(e,t){return rn(e,j,r,r,r,t)});function vh(e,t){if(typeof e!="function")throw new Tt(g);return t=t===r?t:de(t),ge(e,t)}function wh(e,t){if(typeof e!="function")throw new Tt(g);return t=t==null?0:Qe(de(t),0),ge(function(n){var i=n[t],o=yn(n,0,t);return i&&hn(o,i),_t(e,this,o)})}function _h(e,t,n){var i=!0,o=!0;if(typeof e!="function")throw new Tt(g);return Ge(n)&&(i="leading"in n?!!n.leading:i,o="trailing"in n?!!n.trailing:o),Qa(e,t,{leading:i,maxWait:t,trailing:o})}function kh(e){return Va(e,1)}function Sh(e,t){return Mi(pi(t),e)}function Ih(){if(!arguments.length)return[];var e=arguments[0];return le(e)?e:[e]}function Nh(e){return Pt(e,E)}function jh(e,t){return t=typeof t=="function"?t:r,Pt(e,E,t)}function Ch(e){return Pt(e,S|E)}function Eh(e,t){return t=typeof t=="function"?t:r,Pt(e,S|E,t)}function Ah(e,t){return t==null||Wo(e,t,nt(t))}function Ht(e,t){return e===t||e!==e&&t!==t}var Lh=is(si),Mh=is(function(e,t){return e>=t}),Mn=qo(function(){return arguments}())?qo:function(e){return qe(e)&&Le.call(e,"callee")&&!Mo.call(e,"callee")},le=I.isArray,Th=ho?kt(ho):Wd;function xt(e){return e!=null&&gs(e.length)&&!an(e)}function Ve(e){return qe(e)&&xt(e)}function Oh(e){return e===!0||e===!1||qe(e)&&dt(e)==Ae}var vn=Vc||Gi,Ph=go?kt(go):Bd;function Dh(e){return qe(e)&&e.nodeType===1&&!xr(e)}function Fh(e){if(e==null)return!0;if(xt(e)&&(le(e)||typeof e=="string"||typeof e.splice=="function"||vn(e)||Kn(e)||Mn(e)))return!e.length;var t=ct(e);if(t==st||t==Je)return!e.size;if(mr(e))return!ai(e).length;for(var n in e)if(Le.call(e,n))return!1;return!0}function Rh(e,t){return fr(e,t)}function zh(e,t,n){n=typeof n=="function"?n:r;var i=n?n(e,t):r;return i===r?fr(e,t,r,n):!!i}function Ti(e){if(!qe(e))return!1;var t=dt(e);return t==ht||t==et||typeof e.message=="string"&&typeof e.name=="string"&&!xr(e)}function Wh(e){return typeof e=="number"&&Oo(e)}function an(e){if(!Ge(e))return!1;var t=dt(e);return t==vt||t==zt||t==rt||t==tt}function el(e){return typeof e=="number"&&e==de(e)}function gs(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=R}function Ge(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function qe(e){return e!=null&&typeof e=="object"}var tl=mo?kt(mo):Gd;function Bh(e,t){return e===t||oi(e,t,ki(t))}function Uh(e,t,n){return n=typeof n=="function"?n:r,oi(e,t,ki(t),n)}function Gh(e){return nl(e)&&e!=+e}function $h(e){if(Nu(e))throw new oe(h);return Vo(e)}function Hh(e){return e===null}function qh(e){return e==null}function nl(e){return typeof e=="number"||qe(e)&&dt(e)==gt}function xr(e){if(!qe(e)||dt(e)!=Be)return!1;var t=Br(e);if(t===null)return!0;var n=Le.call(t,"constructor")&&t.constructor;return typeof n=="function"&&n instanceof n&&Fr.call(n)==Bc}var Oi=po?kt(po):$d;function Vh(e){return el(e)&&e>=-R&&e<=R}var rl=xo?kt(xo):Hd;function ms(e){return typeof e=="string"||!le(e)&&qe(e)&&dt(e)==Ct}function It(e){return typeof e=="symbol"||qe(e)&&dt(e)==wt}var Kn=bo?kt(bo):qd;function Kh(e){return e===r}function Jh(e){return qe(e)&&ct(e)==Et}function Yh(e){return qe(e)&&dt(e)==V}var Xh=is(li),Qh=is(function(e,t){return e<=t});function sl(e){if(!e)return[];if(xt(e))return ms(e)?Gt(e):pt(e);if(sr&&e[sr])return Ec(e[sr]());var t=ct(e),n=t==st?Js:t==Je?Or:Jn;return n(e)}function ln(e){if(!e)return e===0?e:0;if(e=Rt(e),e===_e||e===-_e){var t=e<0?-1:1;return t*je}return e===e?e:0}function de(e){var t=ln(e),n=t%1;return t===t?n?t-n:t:0}function il(e){return e?Cn(de(e),0,W):0}function Rt(e){if(typeof e=="number")return e;if(It(e))return H;if(Ge(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Ge(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=So(e);var n=kn.test(e);return n||un.test(e)?fc(e.slice(2),n?2:8):Ar.test(e)?H:+e}function ol(e){return Yt(e,bt(e))}function Zh(e){return e?Cn(de(e),-R,R):e===0?e:0}function Ee(e){return e==null?"":St(e)}var e0=Hn(function(e,t){if(mr(t)||xt(t)){Yt(t,nt(t),e);return}for(var n in t)Le.call(t,n)&&cr(e,n,t[n])}),al=Hn(function(e,t){Yt(t,bt(t),e)}),ps=Hn(function(e,t,n,i){Yt(t,bt(t),e,i)}),t0=Hn(function(e,t,n,i){Yt(t,nt(t),e,i)}),n0=sn(ti);function r0(e,t){var n=$n(e);return t==null?n:zo(n,t)}var s0=ge(function(e,t){e=Te(e);var n=-1,i=t.length,o=i>2?t[2]:r;for(o&&ut(t[0],t[1],o)&&(i=1);++n<i;)for(var c=t[n],m=bt(c),x=-1,v=m.length;++x<v;){var A=m[x],L=e[A];(L===r||Ht(L,Bn[A])&&!Le.call(e,A))&&(e[A]=c[A])}return e}),i0=ge(function(e){return e.push(r,Sa),_t(ll,r,e)});function o0(e,t){return vo(e,ne(t,3),Jt)}function a0(e,t){return vo(e,ne(t,3),ri)}function l0(e,t){return e==null?e:ni(e,ne(t,3),bt)}function c0(e,t){return e==null?e:$o(e,ne(t,3),bt)}function d0(e,t){return e&&Jt(e,ne(t,3))}function u0(e,t){return e&&ri(e,ne(t,3))}function f0(e){return e==null?[]:Xr(e,nt(e))}function h0(e){return e==null?[]:Xr(e,bt(e))}function Pi(e,t,n){var i=e==null?r:En(e,t);return i===r?n:i}function g0(e,t){return e!=null&&ja(e,t,Dd)}function Di(e,t){return e!=null&&ja(e,t,Fd)}var m0=ya(function(e,t,n){t!=null&&typeof t.toString!="function"&&(t=Rr.call(t)),e[t]=n},Ri(yt)),p0=ya(function(e,t,n){t!=null&&typeof t.toString!="function"&&(t=Rr.call(t)),Le.call(e,t)?e[t].push(n):e[t]=[n]},ne),x0=ge(ur);function nt(e){return xt(e)?Fo(e):ai(e)}function bt(e){return xt(e)?Fo(e,!0):Vd(e)}function b0(e,t){var n={};return t=ne(t,3),Jt(e,function(i,o,c){nn(n,t(i,o,c),i)}),n}function y0(e,t){var n={};return t=ne(t,3),Jt(e,function(i,o,c){nn(n,o,t(i,o,c))}),n}var v0=Hn(function(e,t,n){Qr(e,t,n)}),ll=Hn(function(e,t,n,i){Qr(e,t,n,i)}),w0=sn(function(e,t){var n={};if(e==null)return n;var i=!1;t=ze(t,function(c){return c=bn(c,e),i||(i=c.length>1),c}),Yt(e,wi(e),n),i&&(n=Pt(n,S|N|E,gu));for(var o=t.length;o--;)hi(n,t[o]);return n});function _0(e,t){return cl(e,hs(ne(t)))}var k0=sn(function(e,t){return e==null?{}:Jd(e,t)});function cl(e,t){if(e==null)return{};var n=ze(wi(e),function(i){return[i]});return t=ne(t),ea(e,n,function(i,o){return t(i,o[0])})}function S0(e,t,n){t=bn(t,e);var i=-1,o=t.length;for(o||(o=1,e=r);++i<o;){var c=e==null?r:e[Xt(t[i])];c===r&&(i=o,c=n),e=an(c)?c.call(e):c}return e}function I0(e,t,n){return e==null?e:hr(e,t,n)}function N0(e,t,n,i){return i=typeof i=="function"?i:r,e==null?e:hr(e,t,n,i)}var dl=_a(nt),ul=_a(bt);function j0(e,t,n){var i=le(e),o=i||vn(e)||Kn(e);if(t=ne(t,4),n==null){var c=e&&e.constructor;o?n=i?new c:[]:Ge(e)?n=an(c)?$n(Br(e)):{}:n={}}return(o?Mt:Jt)(e,function(m,x,v){return t(n,m,x,v)}),n}function C0(e,t){return e==null?!0:hi(e,t)}function E0(e,t,n){return e==null?e:ia(e,t,pi(n))}function A0(e,t,n,i){return i=typeof i=="function"?i:r,e==null?e:ia(e,t,pi(n),i)}function Jn(e){return e==null?[]:Ks(e,nt(e))}function L0(e){return e==null?[]:Ks(e,bt(e))}function M0(e,t,n){return n===r&&(n=t,t=r),n!==r&&(n=Rt(n),n=n===n?n:0),t!==r&&(t=Rt(t),t=t===t?t:0),Cn(Rt(e),t,n)}function T0(e,t,n){return t=ln(t),n===r?(n=t,t=0):n=ln(n),e=Rt(e),Rd(e,t,n)}function O0(e,t,n){if(n&&typeof n!="boolean"&&ut(e,t,n)&&(t=n=r),n===r&&(typeof t=="boolean"?(n=t,t=r):typeof e=="boolean"&&(n=e,e=r)),e===r&&t===r?(e=0,t=1):(e=ln(e),t===r?(t=e,e=0):t=ln(t)),e>t){var i=e;e=t,t=i}if(n||e%1||t%1){var o=Po();return lt(e+o*(t-e+uc("1e-"+((o+"").length-1))),t)}return di(e,t)}var P0=qn(function(e,t,n){return t=t.toLowerCase(),e+(n?fl(t):t)});function fl(e){return Fi(Ee(e).toLowerCase())}function hl(e){return e=Ee(e),e&&e.replace(M,Sc).replace(tc,"")}function D0(e,t,n){e=Ee(e),t=St(t);var i=e.length;n=n===r?i:Cn(de(n),0,i);var o=n;return n-=t.length,n>=0&&e.slice(n,o)==t}function F0(e){return e=Ee(e),e&&Is.test(e)?e.replace(Ir,Ic):e}function R0(e){return e=Ee(e),e&&Zn.test(e)?e.replace(Tn,"\\$&"):e}var z0=qn(function(e,t,n){return e+(n?"-":"")+t.toLowerCase()}),W0=qn(function(e,t,n){return e+(n?" ":"")+t.toLowerCase()}),B0=pa("toLowerCase");function U0(e,t,n){e=Ee(e),t=de(t);var i=t?zn(e):0;if(!t||i>=t)return e;var o=(t-i)/2;return ss(Hr(o),n)+e+ss($r(o),n)}function G0(e,t,n){e=Ee(e),t=de(t);var i=t?zn(e):0;return t&&i<t?e+ss(t-i,n):e}function $0(e,t,n){e=Ee(e),t=de(t);var i=t?zn(e):0;return t&&i<t?ss(t-i,n)+e:e}function H0(e,t,n){return n||t==null?t=0:t&&(t=+t),Xc(Ee(e).replace(er,""),t||0)}function q0(e,t,n){return(n?ut(e,t,n):t===r)?t=1:t=de(t),ui(Ee(e),t)}function V0(){var e=arguments,t=Ee(e[0]);return e.length<3?t:t.replace(e[1],e[2])}var K0=qn(function(e,t,n){return e+(n?"_":"")+t.toLowerCase()});function J0(e,t,n){return n&&typeof n!="number"&&ut(e,t,n)&&(t=n=r),n=n===r?W:n>>>0,n?(e=Ee(e),e&&(typeof t=="string"||t!=null&&!Oi(t))&&(t=St(t),!t&&Rn(e))?yn(Gt(e),0,n):e.split(t,n)):[]}var Y0=qn(function(e,t,n){return e+(n?" ":"")+Fi(t)});function X0(e,t,n){return e=Ee(e),n=n==null?0:Cn(de(n),0,e.length),t=St(t),e.slice(n,n+t.length)==t}function Q0(e,t,n){var i=l.templateSettings;n&&ut(e,t,n)&&(t=r),e=Ee(e),t=ps({},t,i,ka);var o=ps({},t.imports,i.imports,ka),c=nt(o),m=Ks(o,c),x,v,A=0,L=t.interpolate||O,T="__p += '",$=Ys((t.escape||O).source+"|"+L.source+"|"+(L===jr?Er:O).source+"|"+(t.evaluate||O).source+"|$","g"),Y="//# sourceURL="+(Le.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++oc+"]")+`
`;e.replace($,function(ie,be,we,Nt,ft,jt){return we||(we=Nt),T+=e.slice(A,jt).replace(Se,Nc),be&&(x=!0,T+=`' +
__e(`+be+`) +
'`),ft&&(v=!0,T+=`';
`+ft+`;
__p += '`),we&&(T+=`' +
((__t = (`+we+`)) == null ? '' : __t) +
'`),A=jt+ie.length,ie}),T+=`';
`;var se=Le.call(t,"variable")&&t.variable;if(!se)T=`with (obj) {
`+T+`
}
`;else if(Cr.test(se))throw new oe(p);T=(v?T.replace(ws,""):T).replace(_s,"$1").replace(ks,"$1;"),T="function("+(se||"obj")+`) {
`+(se?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(x?", __e = _.escape":"")+(v?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+T+`return __p
}`;var ue=ml(function(){return Ne(c,Y+"return "+T).apply(r,m)});if(ue.source=T,Ti(ue))throw ue;return ue}function Z0(e){return Ee(e).toLowerCase()}function eg(e){return Ee(e).toUpperCase()}function tg(e,t,n){if(e=Ee(e),e&&(n||t===r))return So(e);if(!e||!(t=St(t)))return e;var i=Gt(e),o=Gt(t),c=Io(i,o),m=No(i,o)+1;return yn(i,c,m).join("")}function ng(e,t,n){if(e=Ee(e),e&&(n||t===r))return e.slice(0,Co(e)+1);if(!e||!(t=St(t)))return e;var i=Gt(e),o=No(i,Gt(t))+1;return yn(i,0,o).join("")}function rg(e,t,n){if(e=Ee(e),e&&(n||t===r))return e.replace(er,"");if(!e||!(t=St(t)))return e;var i=Gt(e),o=Io(i,Gt(t));return yn(i,o).join("")}function sg(e,t){var n=J,i=xe;if(Ge(t)){var o="separator"in t?t.separator:o;n="length"in t?de(t.length):n,i="omission"in t?St(t.omission):i}e=Ee(e);var c=e.length;if(Rn(e)){var m=Gt(e);c=m.length}if(n>=c)return e;var x=n-zn(i);if(x<1)return i;var v=m?yn(m,0,x).join(""):e.slice(0,x);if(o===r)return v+i;if(m&&(x+=v.length-x),Oi(o)){if(e.slice(x).search(o)){var A,L=v;for(o.global||(o=Ys(o.source,Ee(nr.exec(o))+"g")),o.lastIndex=0;A=o.exec(L);)var T=A.index;v=v.slice(0,T===r?x:T)}}else if(e.indexOf(St(o),x)!=x){var $=v.lastIndexOf(o);$>-1&&(v=v.slice(0,$))}return v+i}function ig(e){return e=Ee(e),e&&Ss.test(e)?e.replace(Sr,Tc):e}var og=qn(function(e,t,n){return e+(n?" ":"")+t.toUpperCase()}),Fi=pa("toUpperCase");function gl(e,t,n){return e=Ee(e),t=n?r:t,t===r?Cc(e)?Dc(e):yc(e):e.match(t)||[]}var ml=ge(function(e,t){try{return _t(e,r,t)}catch(n){return Ti(n)?n:new oe(n)}}),ag=sn(function(e,t){return Mt(t,function(n){n=Xt(n),nn(e,n,Li(e[n],e))}),e});function lg(e){var t=e==null?0:e.length,n=ne();return e=t?ze(e,function(i){if(typeof i[1]!="function")throw new Tt(g);return[n(i[0]),i[1]]}):[],ge(function(i){for(var o=-1;++o<t;){var c=e[o];if(_t(c[0],this,i))return _t(c[1],this,i)}})}function cg(e){return Td(Pt(e,S))}function Ri(e){return function(){return e}}function dg(e,t){return e==null||e!==e?t:e}var ug=ba(),fg=ba(!0);function yt(e){return e}function zi(e){return Ko(typeof e=="function"?e:Pt(e,S))}function hg(e){return Yo(Pt(e,S))}function gg(e,t){return Xo(e,Pt(t,S))}var mg=ge(function(e,t){return function(n){return ur(n,e,t)}}),pg=ge(function(e,t){return function(n){return ur(e,n,t)}});function Wi(e,t,n){var i=nt(t),o=Xr(t,i);n==null&&!(Ge(t)&&(o.length||!i.length))&&(n=t,t=e,e=this,o=Xr(t,nt(t)));var c=!(Ge(n)&&"chain"in n)||!!n.chain,m=an(e);return Mt(o,function(x){var v=t[x];e[x]=v,m&&(e.prototype[x]=function(){var A=this.__chain__;if(c||A){var L=e(this.__wrapped__),T=L.__actions__=pt(this.__actions__);return T.push({func:v,args:arguments,thisArg:e}),L.__chain__=A,L}return v.apply(e,hn([this.value()],arguments))})}),e}function xg(){return ot._===this&&(ot._=Uc),this}function Bi(){}function bg(e){return e=de(e),ge(function(t){return Qo(t,e)})}var yg=bi(ze),vg=bi(yo),wg=bi(Gs);function pl(e){return Ii(e)?$s(Xt(e)):Yd(e)}function _g(e){return function(t){return e==null?r:En(e,t)}}var kg=va(),Sg=va(!0);function Ui(){return[]}function Gi(){return!1}function Ig(){return{}}function Ng(){return""}function jg(){return!0}function Cg(e,t){if(e=de(e),e<1||e>R)return[];var n=W,i=lt(e,W);t=ne(t),e-=W;for(var o=Vs(i,t);++n<e;)t(n);return o}function Eg(e){return le(e)?ze(e,Xt):It(e)?[e]:pt(Da(Ee(e)))}function Ag(e){var t=++Wc;return Ee(e)+t}var Lg=rs(function(e,t){return e+t},0),Mg=yi("ceil"),Tg=rs(function(e,t){return e/t},1),Og=yi("floor");function Pg(e){return e&&e.length?Yr(e,yt,si):r}function Dg(e,t){return e&&e.length?Yr(e,ne(t,2),si):r}function Fg(e){return _o(e,yt)}function Rg(e,t){return _o(e,ne(t,2))}function zg(e){return e&&e.length?Yr(e,yt,li):r}function Wg(e,t){return e&&e.length?Yr(e,ne(t,2),li):r}var Bg=rs(function(e,t){return e*t},1),Ug=yi("round"),Gg=rs(function(e,t){return e-t},0);function $g(e){return e&&e.length?qs(e,yt):0}function Hg(e,t){return e&&e.length?qs(e,ne(t,2)):0}return l.after=hh,l.ary=Va,l.assign=e0,l.assignIn=al,l.assignInWith=ps,l.assignWith=t0,l.at=n0,l.before=Ka,l.bind=Li,l.bindAll=ag,l.bindKey=Ja,l.castArray=Ih,l.chain=$a,l.chunk=Tu,l.compact=Ou,l.concat=Pu,l.cond=lg,l.conforms=cg,l.constant=Ri,l.countBy=$f,l.create=r0,l.curry=Ya,l.curryRight=Xa,l.debounce=Qa,l.defaults=s0,l.defaultsDeep=i0,l.defer=gh,l.delay=mh,l.difference=Du,l.differenceBy=Fu,l.differenceWith=Ru,l.drop=zu,l.dropRight=Wu,l.dropRightWhile=Bu,l.dropWhile=Uu,l.fill=Gu,l.filter=qf,l.flatMap=Jf,l.flatMapDeep=Yf,l.flatMapDepth=Xf,l.flatten=Wa,l.flattenDeep=$u,l.flattenDepth=Hu,l.flip=ph,l.flow=ug,l.flowRight=fg,l.fromPairs=qu,l.functions=f0,l.functionsIn=h0,l.groupBy=Qf,l.initial=Ku,l.intersection=Ju,l.intersectionBy=Yu,l.intersectionWith=Xu,l.invert=m0,l.invertBy=p0,l.invokeMap=eh,l.iteratee=zi,l.keyBy=th,l.keys=nt,l.keysIn=bt,l.map=ds,l.mapKeys=b0,l.mapValues=y0,l.matches=hg,l.matchesProperty=gg,l.memoize=fs,l.merge=v0,l.mergeWith=ll,l.method=mg,l.methodOf=pg,l.mixin=Wi,l.negate=hs,l.nthArg=bg,l.omit=w0,l.omitBy=_0,l.once=xh,l.orderBy=nh,l.over=yg,l.overArgs=bh,l.overEvery=vg,l.overSome=wg,l.partial=Mi,l.partialRight=Za,l.partition=rh,l.pick=k0,l.pickBy=cl,l.property=pl,l.propertyOf=_g,l.pull=tf,l.pullAll=Ua,l.pullAllBy=nf,l.pullAllWith=rf,l.pullAt=sf,l.range=kg,l.rangeRight=Sg,l.rearg=yh,l.reject=oh,l.remove=of,l.rest=vh,l.reverse=Ei,l.sampleSize=lh,l.set=I0,l.setWith=N0,l.shuffle=ch,l.slice=af,l.sortBy=fh,l.sortedUniq=gf,l.sortedUniqBy=mf,l.split=J0,l.spread=wh,l.tail=pf,l.take=xf,l.takeRight=bf,l.takeRightWhile=yf,l.takeWhile=vf,l.tap=Pf,l.throttle=_h,l.thru=cs,l.toArray=sl,l.toPairs=dl,l.toPairsIn=ul,l.toPath=Eg,l.toPlainObject=ol,l.transform=j0,l.unary=kh,l.union=wf,l.unionBy=_f,l.unionWith=kf,l.uniq=Sf,l.uniqBy=If,l.uniqWith=Nf,l.unset=C0,l.unzip=Ai,l.unzipWith=Ga,l.update=E0,l.updateWith=A0,l.values=Jn,l.valuesIn=L0,l.without=jf,l.words=gl,l.wrap=Sh,l.xor=Cf,l.xorBy=Ef,l.xorWith=Af,l.zip=Lf,l.zipObject=Mf,l.zipObjectDeep=Tf,l.zipWith=Of,l.entries=dl,l.entriesIn=ul,l.extend=al,l.extendWith=ps,Wi(l,l),l.add=Lg,l.attempt=ml,l.camelCase=P0,l.capitalize=fl,l.ceil=Mg,l.clamp=M0,l.clone=Nh,l.cloneDeep=Ch,l.cloneDeepWith=Eh,l.cloneWith=jh,l.conformsTo=Ah,l.deburr=hl,l.defaultTo=dg,l.divide=Tg,l.endsWith=D0,l.eq=Ht,l.escape=F0,l.escapeRegExp=R0,l.every=Hf,l.find=Vf,l.findIndex=Ra,l.findKey=o0,l.findLast=Kf,l.findLastIndex=za,l.findLastKey=a0,l.floor=Og,l.forEach=Ha,l.forEachRight=qa,l.forIn=l0,l.forInRight=c0,l.forOwn=d0,l.forOwnRight=u0,l.get=Pi,l.gt=Lh,l.gte=Mh,l.has=g0,l.hasIn=Di,l.head=Ba,l.identity=yt,l.includes=Zf,l.indexOf=Vu,l.inRange=T0,l.invoke=x0,l.isArguments=Mn,l.isArray=le,l.isArrayBuffer=Th,l.isArrayLike=xt,l.isArrayLikeObject=Ve,l.isBoolean=Oh,l.isBuffer=vn,l.isDate=Ph,l.isElement=Dh,l.isEmpty=Fh,l.isEqual=Rh,l.isEqualWith=zh,l.isError=Ti,l.isFinite=Wh,l.isFunction=an,l.isInteger=el,l.isLength=gs,l.isMap=tl,l.isMatch=Bh,l.isMatchWith=Uh,l.isNaN=Gh,l.isNative=$h,l.isNil=qh,l.isNull=Hh,l.isNumber=nl,l.isObject=Ge,l.isObjectLike=qe,l.isPlainObject=xr,l.isRegExp=Oi,l.isSafeInteger=Vh,l.isSet=rl,l.isString=ms,l.isSymbol=It,l.isTypedArray=Kn,l.isUndefined=Kh,l.isWeakMap=Jh,l.isWeakSet=Yh,l.join=Qu,l.kebabCase=z0,l.last=Ft,l.lastIndexOf=Zu,l.lowerCase=W0,l.lowerFirst=B0,l.lt=Xh,l.lte=Qh,l.max=Pg,l.maxBy=Dg,l.mean=Fg,l.meanBy=Rg,l.min=zg,l.minBy=Wg,l.stubArray=Ui,l.stubFalse=Gi,l.stubObject=Ig,l.stubString=Ng,l.stubTrue=jg,l.multiply=Bg,l.nth=ef,l.noConflict=xg,l.noop=Bi,l.now=us,l.pad=U0,l.padEnd=G0,l.padStart=$0,l.parseInt=H0,l.random=O0,l.reduce=sh,l.reduceRight=ih,l.repeat=q0,l.replace=V0,l.result=S0,l.round=Ug,l.runInContext=y,l.sample=ah,l.size=dh,l.snakeCase=K0,l.some=uh,l.sortedIndex=lf,l.sortedIndexBy=cf,l.sortedIndexOf=df,l.sortedLastIndex=uf,l.sortedLastIndexBy=ff,l.sortedLastIndexOf=hf,l.startCase=Y0,l.startsWith=X0,l.subtract=Gg,l.sum=$g,l.sumBy=Hg,l.template=Q0,l.times=Cg,l.toFinite=ln,l.toInteger=de,l.toLength=il,l.toLower=Z0,l.toNumber=Rt,l.toSafeInteger=Zh,l.toString=Ee,l.toUpper=eg,l.trim=tg,l.trimEnd=ng,l.trimStart=rg,l.truncate=sg,l.unescape=ig,l.uniqueId=Ag,l.upperCase=og,l.upperFirst=Fi,l.each=Ha,l.eachRight=qa,l.first=Ba,Wi(l,function(){var e={};return Jt(l,function(t,n){Le.call(l.prototype,n)||(e[n]=t)}),e}(),{chain:!1}),l.VERSION=u,Mt(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){l[e].placeholder=l}),Mt(["drop","take"],function(e,t){ve.prototype[e]=function(n){n=n===r?1:Qe(de(n),0);var i=this.__filtered__&&!t?new ve(this):this.clone();return i.__filtered__?i.__takeCount__=lt(n,i.__takeCount__):i.__views__.push({size:lt(n,W),type:e+(i.__dir__<0?"Right":"")}),i},ve.prototype[e+"Right"]=function(n){return this.reverse()[e](n).reverse()}}),Mt(["filter","map","takeWhile"],function(e,t){var n=t+1,i=n==ce||n==fe;ve.prototype[e]=function(o){var c=this.clone();return c.__iteratees__.push({iteratee:ne(o,3),type:n}),c.__filtered__=c.__filtered__||i,c}}),Mt(["head","last"],function(e,t){var n="take"+(t?"Right":"");ve.prototype[e]=function(){return this[n](1).value()[0]}}),Mt(["initial","tail"],function(e,t){var n="drop"+(t?"":"Right");ve.prototype[e]=function(){return this.__filtered__?new ve(this):this[n](1)}}),ve.prototype.compact=function(){return this.filter(yt)},ve.prototype.find=function(e){return this.filter(e).head()},ve.prototype.findLast=function(e){return this.reverse().find(e)},ve.prototype.invokeMap=ge(function(e,t){return typeof e=="function"?new ve(this):this.map(function(n){return ur(n,e,t)})}),ve.prototype.reject=function(e){return this.filter(hs(ne(e)))},ve.prototype.slice=function(e,t){e=de(e);var n=this;return n.__filtered__&&(e>0||t<0)?new ve(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),t!==r&&(t=de(t),n=t<0?n.dropRight(-t):n.take(t-e)),n)},ve.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},ve.prototype.toArray=function(){return this.take(W)},Jt(ve.prototype,function(e,t){var n=/^(?:filter|find|map|reject)|While$/.test(t),i=/^(?:head|last)$/.test(t),o=l[i?"take"+(t=="last"?"Right":""):t],c=i||/^find/.test(t);o&&(l.prototype[t]=function(){var m=this.__wrapped__,x=i?[1]:arguments,v=m instanceof ve,A=x[0],L=v||le(m),T=function(be){var we=o.apply(l,hn([be],x));return i&&$?we[0]:we};L&&n&&typeof A=="function"&&A.length!=1&&(v=L=!1);var $=this.__chain__,Y=!!this.__actions__.length,se=c&&!$,ue=v&&!Y;if(!c&&L){m=ue?m:new ve(this);var ie=e.apply(m,x);return ie.__actions__.push({func:cs,args:[T],thisArg:r}),new Ot(ie,$)}return se&&ue?e.apply(this,x):(ie=this.thru(T),se?i?ie.value()[0]:ie.value():ie)})}),Mt(["pop","push","shift","sort","splice","unshift"],function(e){var t=Pr[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",i=/^(?:pop|shift)$/.test(e);l.prototype[e]=function(){var o=arguments;if(i&&!this.__chain__){var c=this.value();return t.apply(le(c)?c:[],o)}return this[n](function(m){return t.apply(le(m)?m:[],o)})}}),Jt(ve.prototype,function(e,t){var n=l[t];if(n){var i=n.name+"";Le.call(Gn,i)||(Gn[i]=[]),Gn[i].push({name:t,func:n})}}),Gn[ns(r,z).name]=[{name:"wrapper",func:r}],ve.prototype.clone=sd,ve.prototype.reverse=id,ve.prototype.value=od,l.prototype.at=Df,l.prototype.chain=Ff,l.prototype.commit=Rf,l.prototype.next=zf,l.prototype.plant=Bf,l.prototype.reverse=Uf,l.prototype.toJSON=l.prototype.valueOf=l.prototype.value=Gf,l.prototype.first=l.prototype.head,sr&&(l.prototype[sr]=Wf),l},Wn=Fc();Sn?((Sn.exports=Wn)._=Wn,zs._=Wn):ot._=Wn}).call(br)})(ys,ys.exports);var vs=ys.exports;const Cm=(a,d=!1)=>{const r=_.useRef(a),u=_.useRef(null),[f,h]=_.useState(0),g=()=>{u.current||(h(r.current),u.current=setInterval(()=>{h(b=>b<=1?(p(),0):b-1)},1e3))},p=()=>{u.current&&(clearInterval(u.current),u.current=null)};return _.useEffect(()=>(r.current=a,d&&g(),p),[a,d]),{countDown:f,start:g,stop:p}},Em=()=>s.jsx("span",{children:s.jsxs("svg",{className:"animate-spin h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),Am=Yg.apiBaseUrl;function Lm({isOpen:a,onClose:d,onSave:r,initialApiKey:u=""}){const[f,h]=_.useState(u),[g,p]=_.useState(""),[b,k]=_.useState(!1),[w,S]=_.useState(!1),[N,E]=_.useState(""),{countDown:P,start:F}=Cm(60),[U,z]=_.useState(!1),[te,Q]=_.useState(""),[q,G]=_.useState("https://api.openai.com/v1"),[re,Z]=_.useState(!1),[j,D]=_.useState(!1),[J,xe]=_.useState(null),[B,ke]=_.useState(null);_.useEffect(()=>{h(u);const R=localStorage.getItem("openaiApiKey"),je=localStorage.getItem("openaiBaseUrl");R&&Q(R),je&&G(je),(async()=>{try{const W=localStorage.getItem("rsaPublicKey");if(W)ke(W);else{const ye=await Jg();ke(ye),localStorage.setItem("rsaPublicKey",ye)}}catch(W){console.error("Failed to fetch RSA public key:",W)}})()},[u]);const ce=async()=>{if(!te.trim()){xe({success:!1,message:"Please enter an OpenAI API key"});return}if(!B){xe({success:!1,message:"RSA public key not available. Please try again later."});return}D(!0),xe(null);try{const R=await Xg(te,q);xe({success:R,message:R?"API key is valid!":"Invalid API key. Please check and try again."})}catch(R){xe({success:!1,message:R instanceof Error?R.message:"Failed to verify API key"})}finally{D(!1)}},X=_.useMemo(()=>vs.debounce(R=>{console.log("checkEmailValid",R),k(/^[\w.-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(R))},500),[]),fe=async()=>{if(!g||g===""||!b)return;z(!0);const R=g?.split("@")?.[0]||"",H=await(await fetch(`${Am}/api/user/create`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:R,email:g})})).json();z(!1),S(!0),F(),H?.data?E("Send email successfully, please check your email"):E(H?.message||"Send email failed")},_e=()=>{r(f),te.trim()?(localStorage.setItem("openaiApiKey",te),localStorage.setItem("openaiBaseUrl",q)):(localStorage.removeItem("openaiApiKey"),localStorage.removeItem("openaiBaseUrl")),d()};return a?s.jsxs("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-10",children:[s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-8 w-[480px] shadow-2xl",children:[s.jsx("h2",{className:"text-xl text-gray-900 dark:text-white font-semibold mb-6",children:"Set API Key"}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Email"}),s.jsxs("div",{className:"relative mb-4 flex flex-row gap-2",children:[s.jsx(bl,{value:g,setValue:p,setIsValueValid:X,placeholder:"Enter your Email",className:"flex-1"}),s.jsx("button",{onClick:fe,disabled:U||!b||P>0,className:`w-28 py-2.5 ${!U&&b&&P===0?"bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white":"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed"} 
                            rounded-lg font-medium transition-colors flex justify-center items-center`,children:U?s.jsx(Em,{}):P>0?`Resend in ${P}s`:"Send"})]}),!!g&&g!==""&&!b&&s.jsx("div",{className:"text-sm text-red-600 dark:text-red-300",children:s.jsx("span",{children:"Please enter a valid email"})})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ComfyUI Copilot API Key"}),s.jsx("div",{className:"relative mb-4",children:s.jsx(bl,{isPassword:!0,value:f,setValue:h,placeholder:"Enter your API key",className:"mb-4"})}),s.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:[s.jsx("span",{children:"Don't have an API key? "}),s.jsx("a",{href:"https://form.typeform.com/to/tkg91K8D",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 font-medium",children:"Click here to request one"})]})]}),s.jsx(Nm,{title:s.jsx("h3",{className:"text-sm text-gray-900 dark:text-white font-medium",children:"OpenAI API Configuration (Optional)"}),className:"mb-4",children:s.jsxs("div",{children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-2",children:"OpenAI API Key"}),s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:re?"text":"password",value:te,onChange:R=>Q(R.target.value),placeholder:"Enter your OpenAI API key",className:`w-full px-4 py-3 border border-gray-200 dark:border-gray-600 rounded-lg pr-12 text-xs
                                    bg-gray-50 dark:bg-gray-700 
                                    text-gray-900 dark:text-white
                                    placeholder-gray-500 dark:placeholder-gray-400
                                    focus:border-blue-500 dark:focus:border-blue-400 
                                    focus:ring-2 focus:ring-blue-500/20 dark:focus:ring-blue-400/20
                                    focus:outline-none`}),s.jsx("button",{type:"button",className:`absolute inset-y-0 right-0 pr-4 flex items-center text-gray-500 dark:text-gray-400 
                                    hover:text-gray-700 dark:hover:text-gray-200 transition-colors bg-transparent border-none`,onClick:()=>Z(!re),children:re?s.jsxs("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}):s.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})})})]})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-2",children:"OpenAI Base URL"}),s.jsx("input",{type:"text",value:q,onChange:R=>G(R.target.value),placeholder:"https://api.openai.com/v1",className:`w-full px-4 py-3 border border-gray-200 dark:border-gray-600 rounded-lg text-xs
                                bg-gray-50 dark:bg-gray-700 
                                text-gray-900 dark:text-white
                                placeholder-gray-500 dark:placeholder-gray-400
                                focus:border-blue-500 dark:focus:border-blue-400 
                                focus:ring-2 focus:ring-blue-500/20 dark:focus:ring-blue-400/20
                                focus:outline-none`})]}),s.jsx("div",{className:"flex items-center mb-2",children:s.jsx("button",{onClick:ce,disabled:j||!te.trim(),className:`px-4 py-2 rounded-lg font-medium text-xs transition-colors ${j||!te.trim()?"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white"}`,children:j?s.jsxs("span",{className:"flex items-center",children:[s.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Verifying..."]}):"Verify"})}),J&&s.jsx("div",{className:`text-xs p-2 rounded-md ${J.success?"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-400":"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400"}`,children:J.message})]})}),s.jsxs("div",{className:"flex justify-end gap-3",children:[s.jsx("button",{onClick:d,className:`px-5 py-2.5 text-gray-700 bg-white dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 
                        rounded-lg font-medium transition-colors`,children:"Cancel"}),s.jsx("button",{onClick:_e,className:`px-5 py-2.5 bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 
                        text-white rounded-lg font-medium transition-colors`,children:"Save"})]})]}),s.jsx(jm,{open:w,onClose:()=>S(!1),children:s.jsx("p",{children:N})})]}):null}class Mm{dbName="ComfyUICopilotDB";version=1;storeName="chatSessions";db=null;async init(){return new Promise((d,r)=>{const u=indexedDB.open(this.dbName,this.version);u.onerror=()=>{r(new Error("Failed to open IndexedDB"))},u.onsuccess=()=>{this.db=u.result,d()},u.onupgradeneeded=f=>{const h=f.target.result;h.objectStoreNames.contains(this.storeName)||h.createObjectStore(this.storeName,{keyPath:"id"}).createIndex("lastUpdated","lastUpdated",{unique:!1})}})}async saveSession(d,r){if(this.db||await this.init(),!this.db)throw new Error("Database not initialized");const u=r.find(h=>h.role==="user")?.content||"",f={id:d,firstMessage:u.length>50?u.substring(0,50)+"...":u,lastUpdated:Date.now(),messages:r};return new Promise((h,g)=>{const k=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).put(f);k.onsuccess=()=>h(),k.onerror=()=>g(new Error("Failed to save session"))})}async getSession(d){if(this.db||await this.init(),!this.db)throw new Error("Database not initialized");return new Promise((r,u)=>{const g=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName).get(d);g.onsuccess=()=>{r(g.result||null)},g.onerror=()=>u(new Error("Failed to get session"))})}async getAllSessions(){if(this.db||await this.init(),!this.db)throw new Error("Database not initialized");return new Promise((d,r)=>{const g=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName).index("lastUpdated").openCursor(null,"prev"),p=[];g.onsuccess=()=>{const b=g.result;b?(p.push(b.value),b.continue()):d(p)},g.onerror=()=>r(new Error("Failed to get all sessions"))})}async deleteSession(d){if(this.db||await this.init(),!this.db)throw new Error("Database not initialized");return new Promise((r,u)=>{const g=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).delete(d);g.onsuccess=()=>r(),g.onerror=()=>u(new Error("Failed to delete session"))})}}const vr=new Mm;function Tm({isOpen:a,onClose:d,onSelectSession:r,currentSessionId:u}){const[f,h]=_.useState([]),[g,p]=_.useState(!1);_.useEffect(()=>{a&&b()},[a]);const b=async()=>{p(!0);try{const N=await vr.getAllSessions();h(N)}catch(N){console.error("Failed to load sessions:",N)}finally{p(!1)}},k=N=>{const E=new Date(N),F=new Date().getTime()-E.getTime(),U=Math.floor(F/(1e3*60*60*24));return U===0?E.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):U===1?"昨天":U<7?`${U}天前`:E.toLocaleDateString("zh-CN",{month:"short",day:"numeric"})},w=N=>{r(N.id,N.messages),d()},S=async(N,E)=>{if(N.stopPropagation(),confirm("确定要删除这个会话吗？"))try{await vr.deleteSession(E),b()}catch(P){console.error("Failed to delete session:",P)}};return a?s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-96 max-h-[80vh] flex flex-col",children:[s.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100",children:"Session History"}),s.jsx("button",{onClick:d,className:"text-gray-400 hover:text-gray-600 dark:hover:text-white transition-colors",children:s.jsx(yr,{className:"h-5 w-5"})})]}),s.jsx("div",{className:"flex-1 overflow-y-auto",children:g?s.jsx("div",{className:"flex items-center justify-center py-8",children:s.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"Loading..."})}):f.length===0?s.jsx("div",{className:"flex items-center justify-center py-8",children:s.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"No session history"})}):s.jsx("div",{className:"space-y-1 p-2",children:f.map(N=>s.jsxs("div",{onClick:()=>w(N),className:`flex items-center justify-between p-3 rounded-lg cursor-pointer group ${N.id===u?"dark:bg-gray-700 border border-blue-200 dark:border-gray-600":"hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center justify-between mb-1",children:[s.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:k(N.lastUpdated)}),N.id===u&&s.jsx("span",{className:"text-xs text-blue-600 dark:text-blue-400 font-medium",children:"Current"})]}),s.jsx("div",{className:"text-sm text-gray-900 dark:text-gray-100 truncate",children:N.firstMessage||"Empty session"})]}),s.jsx("button",{onClick:E=>S(E,N.id),className:"ml-2 p-1 text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-all",title:"Delete session",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]},N.id))})}),s.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 text-xs text-gray-500 dark:text-gray-400",children:["Click session to switch, total ",f.length," sessions"]})]})}):null}const Om="/copilot_web/assets/logo-BTZhX0BN.png";function Pm({onClose:a,onClear:d,hasMessages:r,onHeightResize:u,title:f="ComfyUI-Copilot",onSelectSession:h,currentSessionId:g}){const[p,b]=_.useState(!1),[k,w]=_.useState(!1),[S,N]=_.useState(!1),E=()=>{b(!0)},P=()=>{w(!0)},F=te=>{localStorage.setItem("chatApiKey",te)},U=(te,Q)=>{h?.(te,Q)},z=()=>{window.open("https://docs.google.com/forms/d/e/1FAIpQLSf_SeUpgrZh8sPGwVFXAlsviVXKpsQnyaevcB2VrIqUBYUMKg/viewform?usp=dialog","_blank")};return _.useEffect(()=>{const te=q=>{if(!S)return;const G=q.movementY;u?.(G)},Q=()=>{N(!1)};return S&&(document.addEventListener("mousemove",te),document.addEventListener("mouseup",Q)),()=>{document.removeEventListener("mousemove",te),document.removeEventListener("mouseup",Q)}},[S,u]),s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:`flex items-center justify-between border-b px-3 py-2 
                        bg-white border-gray-200 sticky top-2 z-10`,children:[s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx("img",{src:`.${Om}`,alt:"ComfyUI-Copilot Logo",className:"h-7 w-7 -ml-1"}),s.jsx("h3",{className:"text-[14px] font-medium text-gray-800",children:f}),s.jsx("button",{onClick:E,className:"p-1 bg-white border-none hover:!bg-gray-100 rounded text-gray-500",children:s.jsx(_m,{className:"h-4 w-4"})})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("button",{onClick:P,className:"p-1.5 bg-white border-none hover:bg-gray-100 rounded text-gray-500",title:"Session History",children:s.jsx(fm,{className:"h-4 w-4"})}),s.jsx("button",{className:"inline-flex bg-white border-none items-center justify-center rounded-md p-1.5 text-gray-500 hover:!bg-gray-100",onClick:z,children:s.jsx(pm,{className:"h-4 w-4"})}),s.jsx("button",{className:`inline-flex bg-white border-none items-center justify-center rounded-md p-1.5 
                                 ${r?"text-gray-500 hover:!bg-gray-100":"text-gray-300 cursor-not-allowed"}`,disabled:!r,onClick:d,children:s.jsx(Sm,{className:"h-4 w-4"})})]})]}),s.jsx(Lm,{isOpen:p,onClose:()=>b(!1),onSave:F,initialApiKey:localStorage.getItem("chatApiKey")||""}),s.jsx(Tm,{isOpen:k,onClose:()=>w(!1),onSelectSession:U,currentSessionId:g||null})]})}const Dm=({className:a})=>s.jsx("svg",{className:a,viewBox:"0 0 24 24",fill:"currentColor",children:s.jsx("path",{d:"M20 8h-2.81c-.45-.78-1.07-1.45-1.82-1.96L17 4.41 15.59 3l-2.17 2.17C12.96 5.06 12.49 5 12 5s-.96.06-1.42.17L8.41 3 7 4.41l1.63 1.63C7.88 6.55 7.26 7.22 6.81 8H4v2h2.09c-.05.33-.09.66-.09 1v1H4v2h2v1c0 .34.04.67.09 1H4v2h2.81c1.04 1.79 2.97 3 5.19 3s4.15-1.21 5.19-3H20v-2h-2.09c.05-.33.09-.66.09-1v-1h2v-2h-2v-1c0-.34-.04-.67-.09-1H20V8zm-6 8h-4v-2h4v2zm0-4h-4v-2h4v2z"})}),Fm=5*1024*1024,yl=["image/jpeg","image/png","image/gif","image/webp"];function Rm({input:a,loading:d,onChange:r,onSend:u,onKeyPress:f,onUploadImages:h,uploadedImages:g,onRemoveImage:p,selectedModel:b,onModelChange:k,onStop:w,onAddDebugMessage:S}){const[N,E]=_.useState(!1),[P,F]=_.useState([]),U=bs.useRef(null),z=_.useRef(null);_.useEffect(()=>{z.current&&(z.current.style.height="auto",z.current.style.height=`${Math.min(z.current.scrollHeight,400)}px`)},[a]),_.useEffect(()=>{(async()=>{try{const G=await Vt.listModels();F(G.models)}catch(G){console.error("Failed to load models:",G),F([{label:"gemini-2.5-flash",name:"gemini-2.5-flash",image_enable:!0},{label:"gpt-4.1",name:"gpt-4.1-2025-04-14-GlobalStandard",image_enable:!0},{label:"qwen-plus",name:"qwen-plus",image_enable:!1}])}})()},[]);const te=q=>{if(q.target.files){const G=[],re=[];if(Array.from(q.target.files).forEach(Z=>{yl.includes(Z.type)?Z.size>Fm?G.push(`${Z.name} (exceeds 5MB)`):re.push(Z):G.push(`${Z.name} (unsupported format)`)}),G.length>0&&alert(`The following files couldn't be uploaded:
${G.join(`
`)}`),re.length>0){const Z=new DataTransfer;re.forEach(j=>Z.items.add(j)),h(Z.files)}}},Q=()=>{if(S){const q={id:Ze(),role:"ai",content:JSON.stringify({text:"Would you like me to help you debug the current workflow on the canvas?",ext:[]}),format:"debug_guide",name:"Assistant"};S(q)}};return s.jsxs("div",{className:`relative ${g.length>0?"mt-12":""}`,children:[g.length>0&&s.jsx("div",{className:"absolute -top-10 left-0 flex gap-2",children:g.map(q=>s.jsxs("div",{className:"relative group",children:[s.jsx("img",{src:q.preview,alt:"uploaded",className:"w-8 h-8 rounded object-cover"}),s.jsx("button",{onClick:()=>p(q.id),className:`absolute -top-1 -right-1 bg-white border-none text-gray-500 rounded-full p-0.5
                                         opacity-0 group-hover:opacity-100 transition-opacity`,children:s.jsx(yr,{className:"w-3 h-3"})})]},q.id))}),s.jsx("textarea",{ref:z,onChange:r,onKeyDown:q=>{if(q.key==="Enter"&&!q.shiftKey){if(q.nativeEvent.isComposing)return;q.preventDefault(),a.trim()!==""&&u()}f(q)},value:a,placeholder:"Type your message...",className:`w-full min-h-[80px] max-h-[400px] resize-none rounded-md border 
                         border-gray-200 px-3 py-2 pr-12 pb-10 text-[14px] shadow-sm 
                         focus:outline-none focus:ring-2 focus:ring-blue-500 
                         focus:border-transparent bg-white transition-all 
                         duration-200 text-gray-700 overflow-y-auto`,style:{height:"80px"}}),s.jsxs("div",{className:`absolute bottom-2 left-3 right-12 flex items-center gap-2 
                          bg-white border-t border-gray-100 pt-1`,children:[s.jsx("select",{value:b,onChange:q=>k(q.target.value),className:`px-1.5 py-0.5 text-xs rounded-md 
                             border border-gray-200 bg-white text-gray-700
                             focus:outline-none focus:ring-2 focus:ring-blue-500
                             focus:border-transparent hover:bg-gray-50
                             transition-colors border-0`,children:P.map(q=>s.jsx("option",{value:q.name,children:q.label},q.name))}),s.jsx("button",{type:"button",onClick:()=>E(!0),disabled:!P.find(q=>q.name===b)?.image_enable,className:`p-1.5 text-gray-500 bg-white border-none
                             hover:bg-gray-100 hover:text-gray-600 
                             transition-all duration-200 outline-none
                             ${P.find(q=>q.name===b)?.image_enable?"":"opacity-50 cursor-not-allowed"}`,children:s.jsx(gm,{className:"h-4 w-4"})})]}),s.jsx("button",{type:"submit",onClick:d?w:u,disabled:d?!1:a.trim()==="",className:`absolute bottom-3 right-3 p-2 rounded-md text-gray-500 bg-white border-none 
                         hover:bg-gray-100 hover:text-gray-600 disabled:opacity-50 
                         transition-all duration-200 active:scale-95`,children:d?s.jsx(dm,{className:"h-5 w-5 text-red-500 hover:text-red-600"}):s.jsx(vm,{className:"h-5 w-5 group-hover:translate-x-1"})}),s.jsx("button",{type:"button",onClick:Q,className:`absolute bottom-3 right-14 p-2 rounded-md text-gray-500 bg-white border-none 
                         hover:bg-gray-100 hover:text-gray-600 
                         transition-all duration-200 active:scale-95`,title:"Debug workflow",children:s.jsx(Dm,{className:"h-5 w-5"})}),N&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 w-96 relative",children:[s.jsx("button",{onClick:()=>E(!1),className:"absolute top-2 right-2 bg-white border-none text-gray-500 hover:text-gray-700",children:s.jsx(yr,{className:"w-5 h-5"})}),s.jsx("h3",{className:"text-lg text-gray-800 font-medium mb-4",children:"Upload Images"}),s.jsxs("div",{className:`border-2 border-dashed border-gray-300 rounded-lg p-8
                                      flex flex-col items-center justify-center gap-4
                                      hover:border-blue-500 transition-colors cursor-pointer`,onClick:()=>U.current?.click(),children:[s.jsx(bm,{className:"w-8 h-8 text-gray-400"}),s.jsxs("div",{className:"text-center",children:[s.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"Click to upload images or drag and drop"}),s.jsx("p",{className:"text-xs text-gray-400",children:"Supported formats: JPG, PNG, GIF, WebP"}),s.jsx("p",{className:"text-xs text-gray-400",children:"Max file size: 5MB"})]})]}),s.jsx("input",{ref:U,type:"file",multiple:!0,accept:yl.join(","),onChange:te,className:"hidden"}),g.length>0&&s.jsx("div",{className:"mt-4 grid grid-cols-3 gap-2",children:g.map(q=>s.jsxs("div",{className:"relative group",children:[s.jsx("img",{src:q.preview,alt:"preview",className:"w-full h-20 object-cover rounded"}),s.jsx("button",{onClick:()=>p(q.id),className:`absolute -top-1 -right-1 bg-white border-none text-gray-500 
                                                     rounded-full p-0.5 opacity-0 group-hover:opacity-100 
                                                     transition-opacity`,children:s.jsx(yr,{className:"w-3 h-3"})})]},q.id))}),s.jsx("div",{className:"mt-4 flex justify-end gap-2",children:s.jsx("button",{onClick:()=>E(!1),className:`px-4 py-2 text-sm font-medium text-gray-700 
                                         bg-white border border-gray-300 rounded-md 
                                         hover:bg-gray-50`,children:"Close"})})]})})]})}function zm(a){const d=a[0],r=new Set;function u(f,h){if(!(!f||h>=1)&&f.inputs)for(const g of Object.values(f.inputs)){const p=g.link;if(p&&Me.graph.links[p]){const b=Me.graph.links[p].origin_id,k=Me.graph._nodes_by_id[b];k&&(r.add(k.type),u(k,h+1))}}}return d?(u(d,0),[{type:"upstream_node_types",data:Array.from(r)}]):null}function Wm({nodeInfo:a,onSendWithIntent:d,loading:r,onSendWithContent:u}){return console.log("SelectedNodeInfo nodeInfo:",a[0]),s.jsx("div",{className:"mb-3 p-3 rounded-md bg-gray-50 border border-gray-200",children:s.jsxs("div",{className:"text-sm text-gray-700",children:[s.jsxs("p",{children:["Selected node: ",a[0].type]}),s.jsxs("div",{className:"flex gap-2 mt-2",children:[s.jsx("button",{className:`px-3 py-1 text-xs rounded-md bg-blue-50 
                                 text-blue-700 hover:bg-blue-100`,onClick:()=>u(`Reply in ${navigator.language} language: How does the ${a[0].type} node work? I need its official usage guide.`),disabled:r,children:"Usage"}),s.jsx("button",{className:`px-3 py-1 text-xs rounded-md bg-green-100 
                                 text-green-700 hover:bg-green-200`,onClick:()=>u(`Reply in ${navigator.language} language: Show me the technical specifications for the ${a[0].type} node's inputs and outputs.`),disabled:r,children:"Parameters"}),s.jsx("button",{className:`px-3 py-1 text-xs rounded-md bg-purple-100 
                                 text-purple-700 hover:bg-purple-200`,onClick:()=>d("downstream_subgraph_search",zm(a)),disabled:r,children:"Downstream Nodes"})]})]})})}function Bm(){return s.jsx(Ll,{name:"Assistant",children:s.jsxs("div",{className:"flex items-center space-x-2 p-4 bg-gray-50 rounded-lg",children:[s.jsxs("div",{className:"flex space-x-1",children:[s.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),s.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),s.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]}),s.jsx("span",{className:"text-sm text-gray-500",children:"AI is thinking..."})]})})}const Um=[{type:"chat",tool:"workflow_generate",name:"给我一个工作流，基于ltx创建一个短视频",messages:[{id:"showcase1-3",role:"user",content:"给我一个工作流，基于ltx创建一个短视频",trace_id:"showcase1"},{id:"showcase1-4",role:"ai",content:`{"session_id":"611f8fda-e441-4e87-9fe3-59f51c29e910","text":"\\n\\n🔄 **Switching to ComfyUI-Copilot**\\n\\n### Workflow Recommendations for Creating Short Video Clips from LTX\\n\\nHere are some workflow options to help you create short video clips based on \\"ltx\\":\\n\\n#### 1. Recalled Workflows\\n\\nBased on your request, I found these existing workflows that might be helpful:\\n\\n*   **api-t2i2v-txt\\\\_to\\\\_image\\\\_to\\\\_video**\\n    *   **Description:** Creates a short animated video clip from a text description of a nature scene.\\n    *   **Use Case:** Ideal if your \\"ltx\\" content can be translated into a text description of a scene you want to animate.\\n    *   **Image:** ![api-t2i2v-txt\\\\_to\\\\_image\\\\_to\\\\_video](https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-06-26%2F648f8d5e2e924162852e98f2a249e3b0.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2066264036&Signature=ZcP5qLm%2B4W23KXaNhJlQnPJljDw%3D)\\n\\n*   **sdxl-t2i2v-api**\\n    *   **Description:** Creates a short animated video clip based on your text description.\\n    *   **Use Case:** Similar to the above, this workflow is good for generating smooth, high-quality animations from text prompts.\\n    *   **Image:** ![sdxl-t2i2v-api](https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-06-26%2Fbb9685f63da3498f8e743172a8083f9d.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2066264381&Signature=BiWhDeYVswBNpH23UtP9WqDNUEk%3D)\\n\\n*   **api-t2v\\\\_ltxv\\\\_text\\\\_to\\\\_video**\\n    *   **Description:** Creates a short animated video clip (about 4 seconds) from text, with a focus on natural and fluid movement. This workflow specifically mentions \\"ltxv\\".\\n    *   **Use Case:** This workflow seems highly relevant as it explicitly includes \\"ltxv\\" in its description, suggesting it might be directly applicable to your \\"ltx\\" content.\\n    *   **Image:** ![api-t2v\\\\_ltxv\\\\_text\\\\_to\\\\_video](https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-06-26%2F2f5343c2b19c4afba48b8f9079ed736d.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2066264124&Signature=w1X1XSG3Pxay02KBI3twT%2B3xEpQ%3D)\\n\\n#### 2. AI Generated Workflow\\n\\nI have also generated a new personalized workflow solution for you:\\n\\n*   **AI Generated Workflow**\\n    *   **Description:** Build a workflow that creates a short video clip based on 'ltx' content.\\n    *   **Use Case:** This is a custom-generated workflow tailored to your specific request.\\n    *   **Image:** ![AI Generated Workflow](https://ppc-img.oss-ap-southeast-1.aliyuncs.com/AI_workflow_default.jpg)\\n\\nPlease let me know if you have any questions about these workflows or would like further adjustments!","finished":true,"type":"message","format":"markdown","ext":[{"type":"workflow","data":[{"id":31809,"name":"AI Generated Workflow","description":"Build a workflow that creates a short video clip based on 'ltx' content.","image":"https://ppc-img.oss-ap-southeast-1.aliyuncs.com/AI_workflow_default.jpg","unique_id":"4d7e074f326a544bfcba0daf615ae220","score":null,"source":"AI Generated"},{"id":26740,"name":"api-t2i2v-txt_to_image_to_video","description":"Create a short animated video clip from a text description of a nature scene. I want to describe a beautiful landscape and have it turned into a flowing video with natural movement, like clouds drifting or water flowing, without needing to provide any reference video or images.","image":"https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-06-26%2F648f8d5e2e924162852e98f2a249e3b0.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2066264036&Signature=ZcP5qLm%2B4W23KXaNhJlQnPJljDw%3D","unique_id":"554fd2c996083c5b9525051d49a6b2f5","score":[0.5690833843847055,0.5]},{"id":26745,"name":"sdxl-t2i2v-api","description":"Create a short animated video clip based on my text description. I want to be able to type in what I want to see (like \\"a cute dog running on the beach\\"), and get back a smooth, high-quality animation that brings my description to life. The video should be a few seconds long and loop seamlessly.","image":"https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-06-26%2Fbb9685f63da3498f8e743172a8083f9d.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2066264381&Signature=BiWhDeYVswBNpH23UtP9WqDNUEk%3D","unique_id":"ef568bd54974e83122c8ac59ba02c8c2","score":[0.616972625255589,0.5]},{"id":26831,"name":"api-t2v_ltxv_text_to_video","description":"Create a short animated video clip (about 4 seconds) showing two women having a conversation, where one has brown hair wearing a black jacket and the other has blonde hair. Make sure the video looks natural and fluid, focusing on the brown-haired woman's face with warm sunset lighting.","image":"https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-06-26%2F2f5343c2b19c4afba48b8f9079ed736d.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2066264124&Signature=w1X1XSG3Pxay02KBI3twT%2B3xEpQ%3D","unique_id":"6fc80d5671a79696ddff0db0bd39ee02","score":[0.589295913064967,1]}]}],"message_id":"3cd1418e-e57c-4c01-9005-93365b0acc70"}`,format:"markdown",finished:!0,name:"Assistant"}]},{type:"chat",tool:"workflow_generate",name:"给我一个工作流，把图片变成动漫风格",messages:[{id:"showcase1-5",role:"user",content:"给我一个工作流，把图片变成动漫风格",trace_id:"showcase1"},{id:"showcase1-6",role:"ai",content:`{"session_id":"fd931296-4337-4f1a-bd23-27b3a17caf07","text":"\\n\\n🔄 **Switching to ComfyUI-Copilot**\\n\\n### Image to Anime Style Workflows\\n\\nHere are some workflow options to transform your images into an anime style:\\n\\n#### Recalled Workflows\\n\\n1.  **api-i2i_image2image**\\n    *   **Description:** This workflow is designed to modify portrait photos to add anime-style features like furry ears while preserving most of the original facial features. It aims for a clean final image without watermarks or text overlays.\\n    *   **Image:** ![api-i2i_image2image](https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-06-26%2Ff3a37b904b6d4ad4ae7db5039c8fffe9.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2066263152&Signature=DsEDthKG%2BEHXHWO3S0dSD7rRURY%3D)\\n\\n2.  **api-i2i_flux_canny_model_example**\\n    *   **Description:** This workflow focuses on transforming portrait photos into anime-style characters while maintaining the basic pose and composition of the original photo. It can incorporate specific anime features such as fennec ears, a fluffy tail, blonde hair, and blue eyes, with characters wearing casual clothes. The goal is a high-quality anime illustration.\\n    *   **Image:** ![api-i2i_flux_canny_model_example](https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-06-26%2Fa36288a992704596b74556539fefbd25.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2066263038&Signature=oTHt155s64%2FHAzETosaTYesTUc%3D)\\n\\n3.  **api-i2v_image_to_video_wan**\\n    *   **Description:** While primarily for animation, this workflow involves an initial image of an anime character and can be used to create movement from a still anime image. This might be relevant if you later want to animate the anime-styled output.\\n    *   **Image:** ![api-i2v_image_to_video_wan](https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-06-26%2Fbb12a2decb0c4f55a66caefa98eaf1d8.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2066263536&Signature=c9MxE0hqAMEb4%2FNGG7UnwRylz6Y%3D)\\n\\n#### AI Generated Workflow\\n\\n*   **Name:** AI Generated Workflow\\n*   **Description:** This custom workflow is designed to transform an input image into an anime art style, effectively preserving key features from the original image while applying characteristic anime aesthetics.\\n*   **Image:** ![AI Generated Workflow](https://ppc-img.oss-ap-southeast-1.aliyuncs.com/AI_workflow_default.jpg)\\n\\nYou can choose one of the recommended workflows above, or explore the AI-generated solution. If you have any further questions about these workflows, feel free to ask!","finished":true,"type":"message","format":"markdown","ext":[{"type":"workflow","data":[{"id":31813,"name":"AI Generated Workflow","description":"Build a workflow that transforms an input image into an anime art style, preserving key features while applying anime aesthetics.","image":"https://ppc-img.oss-ap-southeast-1.aliyuncs.com/AI_workflow_default.jpg","unique_id":"578e2c1ebc888b09319bfc7310dd3b02","score":null,"source":"AI Generated"},{"id":26711,"name":"api-i2i_image2image","description":"I want to modify my portrait photo to add anime-style features like furry ears while keeping most of my original facial features intact. The final image should look clean without any watermarks or text overlays.","image":"https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-06-26%2Ff3a37b904b6d4ad4ae7db5039c8fffe9.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2066263152&Signature=DsEDthKG%2BEHXHWO3S0dSD7rRURY%3D","unique_id":"7326dc2eb7014aea9bb8853293f1261b","score":[0.5843760618939373,0.5]},{"id":26819,"name":"api-i2i_flux_canny_model_example","description":"I want to transform my portrait photos into anime-style characters while keeping the basic pose and composition of the original photo. The anime character should have specific features like fennec ears and a fluffy tail, with blonde hair and blue eyes, wearing casual clothes. The final result should look like a high-quality anime illustration.","image":"https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-06-26%2Fa36288a992704596b74556539fefbd25.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2066263038&Signature=oTHt155s64%2FLHAzETosaTYesTUc%3D","unique_id":"8e456b0c483b5eb64b4aac78bd5cd4be","score":[0.6201659297745311,0.5]},{"id":26822,"name":"api-i2v_image_to_video_wan","description":"I have a still image of an anime character and I want to create a short animation where the character smoothly turns around. The animation should maintain the character's original style and details while adding natural movement. Can you create a workflow that can do this automatically?","image":"https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-06-26%2Fbb12a2decb0c4f55a66caefa98eaf1d8.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2066263536&Signature=c9MxE0hqAMEb4%2FNGG7UnwRylz6Y%3D","unique_id":"0ed3d66aea19873488df2b6821dcf7f0","score":[0.632876618757651,0.5]}]}],"message_id":"8895ed9c-f188-4bdb-9646-13b0ec909aa2"}`,format:"markdown",finished:!0,name:"Assistant"}]},{type:"chat",tool:"workflow_generate",name:"给我一个编辑图片的工作流",messages:[{id:"showcase1-7",role:"user",content:"给我一个编辑图片的工作流",trace_id:"showcase1"},{id:"showcase1-8",role:"ai",content:`{"session_id":"bb570efe-14c4-4bde-b595-593026375d5f","text":"\\n\\n🔄 **Switching to ComfyUI-Copilot**\\n\\n### Image Editing Workflows\\n\\nHere are some workflow options for image editing, including both recalled and newly generated solutions:\\n\\n#### **Recalled Workflows**\\n\\nBased on your request, I've found a few relevant workflows that handle various image editing tasks:\\n\\n1.  **image-edit-api (1)**\\n    *   **Description:** This workflow allows you to modify photos using text descriptions. For example, you can change hair color or add specific features while preserving the natural look and original composition of the image. It takes your photo and a text description of the desired changes as input.\\n\\n2.  **image-edit-api**\\n    *   **Description:** This workflow is designed for modifying photos of people. You can add specific objects or change expressions while maintaining the person's identity and overall appearance. For instance, you could make someone smile more or add a coffee cup they're holding, with the changes blending in seamlessly.\\n\\n3.  **i2i-editing**\\n    *   **Description:** If you have a landscape image and want to extend its canvas size in any direction, this workflow can help. It maintains the original artistic style and atmosphere, ensuring the new areas blend seamlessly with the existing image.\\n\\n#### **AI Generated Workflow**\\n\\nI've also generated a new, personalized workflow solution for general image editing:\\n\\n1.  **AI Generated Workflow**\\n    *   **Description:** This workflow is designed to perform general image editing operations, including resizing, cropping, and color correction. It provides a versatile solution for common image manipulation needs.\\n\\nYou can choose one of the recommended workflows above, or let AI generate a personalized solution based on your input. If you have any specific questions about any of these workflows, feel free to ask!","finished":true,"type":"message","format":"markdown","ext":[{"type":"workflow","data":[{"id":31815,"name":"AI Generated Workflow","description":"Build a workflow that allows for general image editing, including operations like resizing, cropping, and color correction.","image":"https://ppc-img.oss-ap-southeast-1.aliyuncs.com/AI_workflow_default.jpg","unique_id":"6f7faac37e32285a935b8699ecc70c15","score":null,"source":"AI Generated"},{"id":26728,"name":"image-edit-api (1)","description":"I want to modify my photos by describing the changes I want in plain text. For example, I want to be able to change hair color or add specific features while keeping the rest of the image looking natural and maintaining the original composition. The workflow should take my photo and a text description of the desired changes as input, and produce a modified version of my photo that incorporates these changes.","image":"","unique_id":"7c9029b78952b52475f5a77d3b5dd781","score":[0.6382076740264893,0]},{"id":26733,"name":"image-edit-api","description":"I have a photo of a person, and I'd like to modify it to add specific objects or change their expression while keeping their identity and overall appearance intact. For example, I want to make them smile more and add objects they're holding, like a coffee cup. The changes should look natural and seamless.","image":"","unique_id":"4080a7a9b33783892cf3cf4fed1755de","score":[0.5695966821668564,0]},{"id":26776,"name":"i2i-editing","description":"I have a beautiful landscape image and I want to extend its canvas size in all directions while maintaining the same artistic style and atmosphere. The new areas should blend seamlessly with the original image and follow the same artistic pattern. Can you create a workflow that achieves this?","image":"","unique_id":"2e7970867f24319161de9a09504350d3","score":[0.5364670477191844,0.25]}]}],"message_id":"225cc1d8-10d9-44ae-bccd-007d4f3e88b2"}`,format:"markdown",finished:!0,name:"Assistant"}]},{type:"chat",tool:"node_recommend",name:"给我一个把多张图合并的节点",messages:[{id:"showcase2-1",role:"user",content:"给我一个把多张图合并的节点",trace_id:"showcase2"},{id:"showcase2-2",role:"ai",content:'{"session_id":"bbe71936-8402-4fd0-8bb4-69eecac5ee01","text":"以下是可以合并多张图片的节点：\\n\\n1. **MonoMerge**  \\n   [GitHub链接](https://github.com/bmad4ever/comfyui_bmad_nodes): 将两张图片合并为单色图片，可选择在白色或黑色方向合并。\\n\\n2. **Concat Images (mtb)**  \\n   [GitHub链接](https://github.com/melMass/comfy_mtb): 可将多张图片合并成一个批次，适用于处理和操控图片集。\\n\\n3. **JoinImageBatch**  \\n   [GitHub链接](https://github.com/yolain/ComfyUI-Easy-Use): 合并批量图片成一张大图，支持水平或垂直拼接。\\n\\n4. **MergeLayers**  \\n   [GitHub链接](https://github.com/shadowcz007/comfyui-mixlab-nodes): 将多层图像合并为单张图片，支持指定的遮罩和混合选项。\\n\\n5. **Composite Images 🧅**  \\n   [GitHub链接](https://github.com/natto-maki/ComfyUI-NegiTools): 结合两张图片，支持多种复合方法，如乘法、划分、叠加等。\\n\\n6. **ImageContainerInheritanceSum**  \\n   [GitHub链接](https://github.com/Nourepide/ComfyUI-Allor): 通过总结图像维度以创建复合图像，适用于需要考虑输入图像总宽和高的情况。\\n\\n7. **Join Image Lists**  \\n   [GitHub链接](https://github.com/M1kep/Comfy_KepListStuff): 合并多张图片列表成为一个列表，同时提供原列表大小。\\n\\n8. **Merge Image List**  \\n   [GitHub链接](https://github.com/AInseven/ComfyUI-fastblend): 合并图像张量列表为一个单一张量，便于图像相关任务的批处理。\\n\\n根据你的具体需求选择合适的节点使用。","finished":true,"format":"markdown","ext":[{"type":"node","data":[{"id":28311,"unique_id":"7cca1314298b9a9d4b785e009099ea28","name":"MonoMerge","name_oral":"MonoMerge","description":"The MonoMerge node is designed to merge two images into a monochromatic image based on a target color scheme (either towards white or black). This process involves comparing the luminance (L component) of corresponding pixels from both images and selecting the higher or lower value depending on the target, resulting in an image that emphasizes either the lighter or darker aspects of the combined images.","github_url":"https://github.com/bmad4ever/comfyui_bmad_nodes","github_stars":50,"from_index":0,"to_index":0,"is_existed":true},{"id":29658,"unique_id":"e3a2782874d3bf8f99bb2b70c7090f74","name":"Concat Images (mtb)","name_oral":"Concat Images (mtb)","description":"The Concat Images node is designed to merge multiple images into a single batch, allowing for efficient processing and manipulation of image collections. It provides flexibility in handling size mismatches through customizable strategies.","github_url":"https://github.com/melMass/comfy_mtb","github_stars":350,"from_index":0,"to_index":0,"is_existed":true},{"id":29719,"unique_id":"458e445b2f21e81111dc9a7d3fb8cb7b","name":"easy joinImageBatch","name_oral":"JoinImageBatch","description":"This node is designed to merge a batch of images into a single large image, either by stacking them horizontally or vertically based on the specified mode. It abstracts the complexity of image manipulation and resizing, providing a straightforward way to create composite images from multiple inputs.","github_url":"https://github.com/yolain/ComfyUI-Easy-Use","github_stars":510,"from_index":0,"to_index":0,"is_existed":true},{"id":32325,"unique_id":"0ea3707eaaf8052e37630f95f4e5b72b","name":"MergeLayers","name_oral":"Merge Layers ♾️Mixlab","description":"The MergeLayers node is designed to combine multiple image layers into a single image while applying specified masks and blending options. It facilitates the creation of complex images by layering and compositing various elements based on their defined properties.","github_url":"https://github.com/shadowcz007/comfyui-mixlab-nodes","github_stars":null,"from_index":0,"to_index":0,"is_existed":true},{"id":32571,"unique_id":"0bd39afd25f012f877c9676b3c9837a1","name":"NegiTools_CompositeImages","name_oral":"Composite Images 🧅","description":"NegiTools_CompositeImages is a versatile node designed to combine two images using various compositing methods. This node allows you to blend images in multiple ways, such as multiplying, dividing, overlaying, and more, to achieve different visual effects.","github_url":"https://github.com/natto-maki/ComfyUI-NegiTools","github_stars":30,"from_index":0,"to_index":0,"is_existed":true},{"id":32865,"unique_id":"4e6b0fa27366545e19695c4e8931e270","name":"ImageContainerInheritanceSum","name_oral":"ImageContainerInheritanceSum","description":"Efficiently combine and sum image dimensions for creating composite images with integrity and visual quality. This node is designed to facilitate the combination of multiple images by summing their dimensions. This node is particularly useful when you need to create a composite image that encompasses the total width and height of the input images.","github_url":"https://github.com/Nourepide/ComfyUI-Allor","github_stars":200,"from_index":0,"to_index":0,"is_existed":true},{"id":72827,"unique_id":"1c76ce5bcc2c5097bdf515bddd32fb0b","name":"Join Image Lists","name_oral":"Join Image Lists","description":"This node is designed to combine multiple lists of images into a single list while also providing the sizes of the original lists. It facilitates the management of image data by allowing users to easily merge and track the number of images from various sources.","github_url":"https://github.com/M1kep/Comfy_KepListStuff","github_stars":null,"from_index":0,"to_index":0,"is_existed":true},{"id":81206,"unique_id":"1cc97ed3bc709de3f23c378eef1ce74e","name":"Merge_Image_List","name_oral":"Merge Image List","description":"This node is designed to merge a list of image tensors into a single tensor, facilitating batch processing in image-related tasks. It efficiently concatenates the input images along a specified dimension, enabling seamless integration of multiple images for further processing.","github_url":"https://github.com/AInseven/ComfyUI-fastblend","github_stars":null,"from_index":0,"to_index":0,"is_existed":true}]}],"message_id":"f60c3cf2-0b54-47a3-97e3-f536fc992c81"}',format:"markdown",finished:!0,name:"Assistant"}]},{type:"chat",tool:"model_recommend",name:"给我一个宫崎骏风格的lora",messages:[{id:"showcase3-1",role:"user",content:"给我一个宫崎骏风格的lora",trace_id:"showcase3"},{id:"showcase3-2",role:"ai",content:'{"session_id":"0b26efaf-e417-4344-9942-658fedbbc12c","text":"请问您需要基于哪种基座模型的宫崎骏风格LORA？可选择以下基座模型：\\n\\n1. Stable Diffusion v1.5\\n2. Illustrious\\n3. Pony\\n4. Flux.1\\n5. Flux.1 D\\n6. Stable Diffusion XL 1.0","finished":true,"format":"markdown","ext":[{"type":"guides","data":["Stable Diffusion v1.5","Illustrious","Pony","Flux.1","Flux.1 D","Stable Diffusion XL 1.0"]}],"message_id":"cfecdc29-5131-4afa-9807-9fe911e6b670"}',format:"markdown",finished:!0,name:"Assistant"},{id:"showcase3-3",role:"user",content:"Flux.1",trace_id:"showcase3"},{id:"showcase3-4",role:"ai",content:`{"session_id":"0b26efaf-e417-4344-9942-658fedbbc12c","text":"以下是几个基于Flux.1的宫崎骏风格LORA模型：\\n\\n1. **宫崎骏风格插画**  \\n   - 描述：此模型擅长创作灵感来自宫崎骏风格的插图，展示奇幻、细致的风景和幻想元素。它强调丰富的质感、鲜艳的色彩和复杂的自然环境，擅长营造充满生机和暖意的场景，以讲述具有特色的宫崎骏风格的故事。  \\n   - [获取链接](https://www.liblib.art/modelinfo/51b6a44f87b543a6b21dfbadc2952313)  \\n\\n2. **宫崎骏的现实主义**  \\n   - 描述：模型擅长生成吉卜力风格的梦幻景观，展现葱郁的绿地、鲜亮的蓝色以及自然与建筑之间的和谐融合。它捕捉梦幻般的场景，具有柔和的幻想氛围，体现出在宁静森林和空中城堡间的魔幻现实主义。  \\n   - ![示例图片1](https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||20d56a93ad9fd5daeaf043453766b60d.jpg)  \\n   - ![示例图片2](https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||4fca763050d3e8941193b4230e8e7410.jpg)  \\n   - [获取链接](https://www.liblib.art/modelinfo/c2ea3eebba764e388a3f08c2ca6eed3a)  \\n\\n3. **F.1-宫崎骏风格**  \\n   - 描述：模型擅长生成宫崎骏影响下的动漫风格图像，呈现鲜艳的色彩、富有想象力的构图和生动的表现。专注于生成年轻女孩在各种迷人环境中的场景，擅长渲染云的细节纹理和复杂的光影。 \\n   - [获取链接](https://www.liblib.art/modelinfo/5638cc813c264f899b43536e02abfc82)  \\n\\n您可以选择一个适合您需求的模型进行使用。","finished":true,"format":"markdown","ext":[{"type":"model","data":[{"id":375989,"name":"宫崎骏风格插画","description":"This model excels in creating illustrations inspired by Miyazaki's style, featuring whimsical, detailed landscapes and fantastical elements. It consistently captures scenes brimming with life and warmth, emphasizing lush textures, vibrant colors, and intricate natural settings. This model is adept at generating compositions that convey a sense of wonder and storytelling in a distinctively Miyazaki fashion.","model_type":"LORA","model_algorithm":"Flux.1","model_pics":[],"source_url":"https://www.liblib.art/modelinfo/51b6a44f87b543a6b21dfbadc2952313","unique_id":"c3123b5ab427eebeaae884a3f1fe10cc"},{"id":378349,"name":"宫崎骏的现实主义","description":"The model excels in generating whimsical, serene landscapes with a Ghibli-inspired aesthetic, featuring lush greenery, vibrant blues, and harmonious nature-architecture integration. It captures dreamy sceneries with a soft, fantasy-like ambiance, demonstrating strengths in depicting tranquil forests, ethereal sky castles, and interactions between natural and man-made elements with a magical realism touch.","model_type":"LORA","model_algorithm":"Flux.1","model_pics":["https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||20d56a93ad9fd5daeaf043453766b60d.jpg","https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||4fca763050d3e8941193b4230e8e7410.jpg","https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||b782cc39b8d159cb2c52fbb31b0c51b8.jpg","https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||cddb9c4648639e78805dd2c088f3f039.jpg","https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||ef8b418d2ad9c6092c14c17e4aa1b051.jpg"],"source_url":"https://www.liblib.art/modelinfo/c2ea3eebba764e388a3f08c2ca6eed3a","unique_id":"256ec6894dd15b42eb60c91fde22b61b"},{"id":385880,"name":"F.1-宫崎骏风格","description":"The model excels in generating whimsical anime-style images influenced by Miyazaki's distinct aesthetic, characterized by vibrant colors, playful compositions, and lively expressions. It specializes in scenes featuring young girls in varied enchanting settings, demonstrating strong skills in rendering detailed textures like clouds and intricate lighting. Notably adept at creating charming and imaginative animated environments.","model_type":"LORA","model_algorithm":"Flux.1","model_pics":[],"source_url":"https://www.liblib.art/modelinfo/5638cc813c264f899b43536e02abfc82","unique_id":"cbcbc993133822bccd46f16d49f5a4db"}]}],"message_id":"6903403f-cd32-447e-a9a6-a9247ab77c15"}`,format:"markdown",finished:!0,name:"Assistant"}]},{type:"chat",tool:"prompt",name:"基于我的描述生成prompt",messages:[{id:"showcase4-1",role:"user",content:'请为我生成英文prompt: "一个红衣女子在海边跳舞，笑容很灿烂"',trace_id:"showcase4"},{id:"showcase4-2",role:"ai",content:'{"session_id":"6272c460-04da-4b30-9090-1c05406f46e3","text":"woman in a red dress dancing by the seaside, bright smile, high quality, cinematic lighting, detailed, realistic, wide shot","finished":true,"format":"markdown","ext":null,"message_id":"13f0a58e-8670-4457-97da-cbad7a7d7530"}',format:"markdown",finished:!0,name:"Assistant"}]},{type:"genlab",tool:"genlab_prompt",name:"根据我的诉求生成3个prompt，各自生图查看效果",messages:[{id:"showcase5-1",role:"user",content:"根据我的诉求生成3个prompt，各自生图查看效果",trace_id:"showcase5"},{id:"showcase5-2",role:"ai",content:'{"text":"请根据下面的演示，使用Genlab来实现您的调试prompt的诉求。\\n ![](https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-07-16%2Fab89513606fd4966b0362f95f3f1ab86.gif?OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2068018398&Signature=3XUgadQjjsGRu46S1fRxA7iDWJU%3D)"}',format:"markdown",finished:!0,name:"Assistant"}]}],vl=[{type:"chat",tool:"workflow_generate",name:"Give me a workflow to create a short video clip based on ltx",messages:[{id:"showcase1-3",role:"user",content:"Give me a workflow to create a short video clip based on ltx",trace_id:"showcase1"},{id:"showcase1-4",role:"ai",content:`{"session_id":"611f8fda-e441-4e87-9fe3-59f51c29e910","text":"\\n\\n🔄 **Switching to ComfyUI-Copilot**\\n\\n### Workflow Recommendations for Creating Short Video Clips from LTX\\n\\nHere are some workflow options to help you create short video clips based on \\"ltx\\":\\n\\n#### 1. Recalled Workflows\\n\\nBased on your request, I found these existing workflows that might be helpful:\\n\\n*   **api-t2i2v-txt\\\\_to\\\\_image\\\\_to\\\\_video**\\n    *   **Description:** Creates a short animated video clip from a text description of a nature scene.\\n    *   **Use Case:** Ideal if your \\"ltx\\" content can be translated into a text description of a scene you want to animate.\\n    *   **Image:** ![api-t2i2v-txt\\\\_to\\\\_image\\\\_to\\\\_video](https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-06-26%2F648f8d5e2e924162852e98f2a249e3b0.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2066264036&Signature=ZcP5qLm%2B4W23KXaNhJlQnPJljDw%3D)\\n\\n*   **sdxl-t2i2v-api**\\n    *   **Description:** Creates a short animated video clip based on your text description.\\n    *   **Use Case:** Similar to the above, this workflow is good for generating smooth, high-quality animations from text prompts.\\n    *   **Image:** ![sdxl-t2i2v-api](https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-06-26%2Fbb9685f63da3498f8e743172a8083f9d.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2066264381&Signature=BiWhDeYVswBNpH23UtP9WqDNUEk%3D)\\n\\n*   **api-t2v\\\\_ltxv\\\\_text\\\\_to\\\\_video**\\n    *   **Description:** Creates a short animated video clip (about 4 seconds) from text, with a focus on natural and fluid movement. This workflow specifically mentions \\"ltxv\\".\\n    *   **Use Case:** This workflow seems highly relevant as it explicitly includes \\"ltxv\\" in its description, suggesting it might be directly applicable to your \\"ltx\\" content.\\n    *   **Image:** ![api-t2v\\\\_ltxv\\\\_text\\\\_to\\\\_video](https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-06-26%2F2f5343c2b19c4afba48b8f9079ed736d.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2066264124&Signature=w1X1XSG3Pxay02KBI3twT%2B3xEpQ%3D)\\n\\n#### 2. AI Generated Workflow\\n\\nI have also generated a new personalized workflow solution for you:\\n\\n*   **AI Generated Workflow**\\n    *   **Description:** Build a workflow that creates a short video clip based on 'ltx' content.\\n    *   **Use Case:** This is a custom-generated workflow tailored to your specific request.\\n    *   **Image:** ![AI Generated Workflow](https://ppc-img.oss-ap-southeast-1.aliyuncs.com/AI_workflow_default.jpg)\\n\\nPlease let me know if you have any questions about these workflows or would like further adjustments!","finished":true,"type":"message","format":"markdown","ext":[{"type":"workflow","data":[{"id":31809,"name":"AI Generated Workflow","description":"Build a workflow that creates a short video clip based on 'ltx' content.","image":"https://ppc-img.oss-ap-southeast-1.aliyuncs.com/AI_workflow_default.jpg","unique_id":"4d7e074f326a544bfcba0daf615ae220","score":null,"source":"AI Generated"},{"id":26740,"name":"api-t2i2v-txt_to_image_to_video","description":"Create a short animated video clip from a text description of a nature scene. I want to describe a beautiful landscape and have it turned into a flowing video with natural movement, like clouds drifting or water flowing, without needing to provide any reference video or images.","image":"https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-06-26%2F648f8d5e2e924162852e98f2a249e3b0.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2066264036&Signature=ZcP5qLm%2B4W23KXaNhJlQnPJljDw%3D","unique_id":"554fd2c996083c5b9525051d49a6b2f5","score":[0.5690833843847055,0.5]},{"id":26745,"name":"sdxl-t2i2v-api","description":"Create a short animated video clip based on my text description. I want to be able to type in what I want to see (like \\"a cute dog running on the beach\\"), and get back a smooth, high-quality animation that brings my description to life. The video should be a few seconds long and loop seamlessly.","image":"https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-06-26%2Fbb9685f63da3498f8e743172a8083f9d.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2066264381&Signature=BiWhDeYVswBNpH23UtP9WqDNUEk%3D","unique_id":"ef568bd54974e83122c8ac59ba02c8c2","score":[0.616972625255589,0.5]},{"id":26831,"name":"api-t2v_ltxv_text_to_video","description":"Create a short animated video clip (about 4 seconds) showing two women having a conversation, where one has brown hair wearing a black jacket and the other has blonde hair. Make sure the video looks natural and fluid, focusing on the brown-haired woman's face with warm sunset lighting.","image":"https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-06-26%2F2f5343c2b19c4afba48b8f9079ed736d.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2066264124&Signature=w1X1XSG3Pxay02KBI3twT%2B3xEpQ%3D","unique_id":"6fc80d5671a79696ddff0db0bd39ee02","score":[0.589295913064967,1]}]}],"message_id":"3cd1418e-e57c-4c01-9005-93365b0acc70"}`,format:"markdown",finished:!0,name:"Assistant"}]},{type:"chat",tool:"workflow_generate",name:"Give me a workflow that can turn the image into anime style",messages:[{id:"showcase1-5",role:"user",content:"give me a workflow that can turn the image into anime style",trace_id:"showcase1"},{id:"showcase1-6",role:"ai",content:`{"session_id":"fd931296-4337-4f1a-bd23-27b3a17caf07","text":"\\n\\n🔄 **Switching to ComfyUI-Copilot**\\n\\n### Image to Anime Style Workflows\\n\\nHere are some workflow options to transform your images into an anime style:\\n\\n#### Recalled Workflows\\n\\n1.  **api-i2i_image2image**\\n    *   **Description:** This workflow is designed to modify portrait photos to add anime-style features like furry ears while preserving most of the original facial features. It aims for a clean final image without watermarks or text overlays.\\n    *   **Image:** ![api-i2i_image2image](https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-06-26%2Ff3a37b904b6d4ad4ae7db5039c8fffe9.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2066263152&Signature=DsEDthKG%2BEHXHWO3S0dSD7rRURY%3D)\\n\\n2.  **api-i2i_flux_canny_model_example**\\n    *   **Description:** This workflow focuses on transforming portrait photos into anime-style characters while maintaining the basic pose and composition of the original photo. It can incorporate specific anime features such as fennec ears, a fluffy tail, blonde hair, and blue eyes, with characters wearing casual clothes. The goal is a high-quality anime illustration.\\n    *   **Image:** ![api-i2i_flux_canny_model_example](https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-06-26%2Fa36288a992704596b74556539fefbd25.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2066263038&Signature=oTHt155s64%2FLHAzETosaTYesTUc%3D)\\n\\n3.  **api-i2v_image_to_video_wan**\\n    *   **Description:** While primarily for animation, this workflow involves an initial image of an anime character and can be used to create movement from a still anime image. This might be relevant if you later want to animate the anime-styled output.\\n    *   **Image:** ![api-i2v_image_to_video_wan](https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-06-26%2Fbb12a2decb0c4f55a66caefa98eaf1d8.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2066263536&Signature=c9MxE0hqAMEb4%2FNGG7UnwRylz6Y%3D)\\n\\n#### AI Generated Workflow\\n\\n*   **Name:** AI Generated Workflow\\n*   **Description:** This custom workflow is designed to transform an input image into an anime art style, effectively preserving key features from the original image while applying characteristic anime aesthetics.\\n*   **Image:** ![AI Generated Workflow](https://ppc-img.oss-ap-southeast-1.aliyuncs.com/AI_workflow_default.jpg)\\n\\nYou can choose one of the recommended workflows above, or explore the AI-generated solution. If you have any further questions about these workflows, feel free to ask!","finished":true,"type":"message","format":"markdown","ext":[{"type":"workflow","data":[{"id":31813,"name":"AI Generated Workflow","description":"Build a workflow that transforms an input image into an anime art style, preserving key features while applying anime aesthetics.","image":"https://ppc-img.oss-ap-southeast-1.aliyuncs.com/AI_workflow_default.jpg","unique_id":"578e2c1ebc888b09319bfc7310dd3b02","score":null,"source":"AI Generated"},{"id":26711,"name":"api-i2i_image2image","description":"I want to modify my portrait photo to add anime-style features like furry ears while keeping most of my original facial features intact. The final image should look clean without any watermarks or text overlays.","image":"https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-06-26%2Ff3a37b904b6d4ad4ae7db5039c8fffe9.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2066263152&Signature=DsEDthKG%2BEHXHWO3S0dSD7rRURY%3D","unique_id":"7326dc2eb7014aea9bb8853293f1261b","score":[0.5843760618939373,0.5]},{"id":26819,"name":"api-i2i_flux_canny_model_example","description":"I want to transform my portrait photos into anime-style characters while keeping the basic pose and composition of the original photo. The anime character should have specific features like fennec ears and a fluffy tail, with blonde hair and blue eyes, wearing casual clothes. The final result should look like a high-quality anime illustration.","image":"https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-06-26%2Fa36288a992704596b74556539fefbd25.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2066263038&Signature=oTHt155s64%2FLHAzETosaTYesTUc%3D","unique_id":"8e456b0c483b5eb64b4aac78bd5cd4be","score":[0.6201659297745311,0.5]},{"id":26822,"name":"api-i2v_image_to_video_wan","description":"I have a still image of an anime character and I want to create a short animation where the character smoothly turns around. The animation should maintain the character's original style and details while adding natural movement. Can you create a workflow that can do this automatically?","image":"https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-06-26%2Fbb12a2decb0c4f55a66caefa98eaf1d8.png?x-oss-process=style%2Fresize&OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2066263536&Signature=c9MxE0hqAMEb4%2FNGG7UnwRylz6Y%3D","unique_id":"0ed3d66aea19873488df2b6821dcf7f0","score":[0.632876618757651,0.5]}]}],"message_id":"8895ed9c-f188-4bdb-9646-13b0ec909aa2"}`,format:"markdown",finished:!0,name:"Assistant"}]},{type:"chat",tool:"workflow_generate",name:"Give me a workflow for image editing",messages:[{id:"showcase1-7",role:"user",content:"give me a workflow for image editing",trace_id:"showcase1"},{id:"showcase1-8",role:"ai",content:`{"session_id":"bb570efe-14c4-4bde-b595-593026375d5f","text":"\\n\\n🔄 **Switching to ComfyUI-Copilot**\\n\\n### Image Editing Workflows\\n\\nHere are some workflow options for image editing, including both recalled and newly generated solutions:\\n\\n#### **Recalled Workflows**\\n\\nBased on your request, I've found a few relevant workflows that handle various image editing tasks:\\n\\n1.  **image-edit-api (1)**\\n    *   **Description:** This workflow allows you to modify photos using text descriptions. For example, you can change hair color or add specific features while preserving the natural look and original composition of the image. It takes your photo and a text description of the desired changes as input.\\n\\n2.  **image-edit-api**\\n    *   **Description:** This workflow is designed for modifying photos of people. You can add specific objects or change expressions while maintaining the person's identity and overall appearance. For instance, you could make someone smile more or add a coffee cup they're holding, with the changes blending in seamlessly.\\n\\n3.  **i2i-editing**\\n    *   **Description:** If you have a landscape image and want to extend its canvas size in any direction, this workflow can help. It maintains the original artistic style and atmosphere, ensuring the new areas blend seamlessly with the existing image.\\n\\n#### **AI Generated Workflow**\\n\\nI've also generated a new, personalized workflow solution for general image editing:\\n\\n1.  **AI Generated Workflow**\\n    *   **Description:** This workflow is designed to perform general image editing operations, including resizing, cropping, and color correction. It provides a versatile solution for common image manipulation needs.\\n\\nYou can choose one of the recommended workflows above, or let AI generate a personalized solution based on your input. If you have any specific questions about any of these workflows, feel free to ask!","finished":true,"type":"message","format":"markdown","ext":[{"type":"workflow","data":[{"id":31815,"name":"AI Generated Workflow","description":"Build a workflow that allows for general image editing, including operations like resizing, cropping, and color correction.","image":"https://ppc-img.oss-ap-southeast-1.aliyuncs.com/AI_workflow_default.jpg","unique_id":"6f7faac37e32285a935b8699ecc70c15","score":null,"source":"AI Generated"},{"id":26728,"name":"image-edit-api (1)","description":"I want to modify my photos by describing the changes I want in plain text. For example, I want to be able to change hair color or add specific features while keeping the rest of the image looking natural and maintaining the original composition. The workflow should take my photo and a text description of the desired changes as input, and produce a modified version of my photo that incorporates these changes.","image":"","unique_id":"7c9029b78952b52475f5a77d3b5dd781","score":[0.6382076740264893,0]},{"id":26733,"name":"image-edit-api","description":"I have a photo of a person, and I'd like to modify it to add specific objects or change their expression while keeping their identity and overall appearance intact. For example, I want to make them smile more and add objects they're holding, like a coffee cup. The changes should look natural and seamless.","image":"","unique_id":"4080a7a9b33783892cf3cf4fed1755de","score":[0.5695966821668564,0]},{"id":26776,"name":"i2i-editing","description":"I have a beautiful landscape image and I want to extend its canvas size in all directions while maintaining the same artistic style and atmosphere. The new areas should blend seamlessly with the original image and follow the same artistic pattern. Can you create a workflow that achieves this?","image":"","unique_id":"2e7970867f24319161de9a09504350d3","score":[0.5364670477191844,0.25]}]}],"message_id":"225cc1d8-10d9-44ae-bccd-007d4f3e88b2"}`,format:"markdown",finished:!0,name:"Assistant"}]},{type:"chat",tool:"node_recommend",name:"Give me a node to merge multiple images",messages:[{id:"showcase2-1",role:"user",content:"Give me a node to merge multiple images",trace_id:"showcase2"},{id:"showcase2-2",role:"ai",content:'{"session_id":"bbe71936-8402-4fd0-8bb4-69eecac5ee01","text":"Here are nodes that can merge multiple images:\\n\\n1. **MonoMerge**  \\n   [GitHub Link](https://github.com/bmad4ever/comfyui_bmad_nodes): Merges two images into a monochromatic image, with options to merge towards white or black direction.\\n\\n2. **Concat Images (mtb)**  \\n   [GitHub Link](https://github.com/melMass/comfy_mtb): Can merge multiple images into a single batch, suitable for processing and manipulating image collections.\\n\\n3. **JoinImageBatch**  \\n   [GitHub Link](https://github.com/yolain/ComfyUI-Easy-Use): Merges batch images into one large image, supports horizontal or vertical stitching.\\n\\n4. **MergeLayers**  \\n   [GitHub Link](https://github.com/shadowcz007/comfyui-mixlab-nodes): Merges multi-layer images into a single image, supports specified masks and blending options.\\n\\n5. **Composite Images 🧅**  \\n   [GitHub Link](https://github.com/natto-maki/ComfyUI-NegiTools): Combines two images, supports multiple composite methods such as multiply, divide, overlay, etc.\\n\\n6. **ImageContainerInheritanceSum**  \\n   [GitHub Link](https://github.com/Nourepide/ComfyUI-Allor): Creates composite images by summarizing image dimensions, suitable for cases that need to consider the total width and height of input images.\\n\\n7. **Join Image Lists**  \\n   [GitHub Link](https://github.com/M1kep/Comfy_KepListStuff): Merges multiple image lists into one list while providing original list sizes.\\n\\n8. **Merge Image List**  \\n   [GitHub Link](https://github.com/AInseven/ComfyUI-fastblend): Merges image tensor lists into a single tensor, convenient for batch processing of image-related tasks.\\n\\nChoose the appropriate node based on your specific needs.","finished":true,"format":"markdown","ext":[{"type":"node","data":[{"id":28311,"unique_id":"7cca1314298b9a9d4b785e009099ea28","name":"MonoMerge","name_oral":"MonoMerge","description":"The MonoMerge node is designed to merge two images into a monochromatic image based on a target color scheme (either towards white or black). This process involves comparing the luminance (L component) of corresponding pixels from both images and selecting the higher or lower value depending on the target, resulting in an image that emphasizes either the lighter or darker aspects of the combined images.","github_url":"https://github.com/bmad4ever/comfyui_bmad_nodes","github_stars":50,"from_index":0,"to_index":0,"is_existed":true},{"id":29658,"unique_id":"e3a2782874d3bf8f99bb2b70c7090f74","name":"Concat Images (mtb)","name_oral":"Concat Images (mtb)","description":"The Concat Images node is designed to merge multiple images into a single batch, allowing for efficient processing and manipulation of image collections. It provides flexibility in handling size mismatches through customizable strategies.","github_url":"https://github.com/melMass/comfy_mtb","github_stars":350,"from_index":0,"to_index":0,"is_existed":true},{"id":29719,"unique_id":"458e445b2f21e81111dc9a7d3fb8cb7b","name":"easy joinImageBatch","name_oral":"JoinImageBatch","description":"This node is designed to merge a batch of images into a single large image, either by stacking them horizontally or vertically based on the specified mode. It abstracts the complexity of image manipulation and resizing, providing a straightforward way to create composite images from multiple inputs.","github_url":"https://github.com/yolain/ComfyUI-Easy-Use","github_stars":510,"from_index":0,"to_index":0,"is_existed":true},{"id":32325,"unique_id":"0ea3707eaaf8052e37630f95f4e5b72b","name":"MergeLayers","name_oral":"Merge Layers ♾️Mixlab","description":"The MergeLayers node is designed to combine multiple image layers into a single image while applying specified masks and blending options. It facilitates the creation of complex images by layering and compositing various elements based on their defined properties.","github_url":"https://github.com/shadowcz007/comfyui-mixlab-nodes","github_stars":null,"from_index":0,"to_index":0,"is_existed":true},{"id":32571,"unique_id":"0bd39afd25f012f877c9676b3c9837a1","name":"NegiTools_CompositeImages","name_oral":"Composite Images 🧅","description":"NegiTools_CompositeImages is a versatile node designed to combine two images using various compositing methods. This node allows you to blend images in multiple ways, such as multiplying, dividing, overlaying, and more, to achieve different visual effects.","github_url":"https://github.com/natto-maki/ComfyUI-NegiTools","github_stars":30,"from_index":0,"to_index":0,"is_existed":true},{"id":32865,"unique_id":"4e6b0fa27366545e19695c4e8931e270","name":"ImageContainerInheritanceSum","name_oral":"ImageContainerInheritanceSum","description":"Efficiently combine and sum image dimensions for creating composite images with integrity and visual quality. This node is designed to facilitate the combination of multiple images by summing their dimensions. This node is particularly useful when you need to create a composite image that encompasses the total width and height of the input images.","github_url":"https://github.com/Nourepide/ComfyUI-Allor","github_stars":200,"from_index":0,"to_index":0,"is_existed":true},{"id":72827,"unique_id":"1c76ce5bcc2c5097bdf515bddd32fb0b","name":"Join Image Lists","name_oral":"Join Image Lists","description":"This node is designed to combine multiple lists of images into a single list while also providing the sizes of the original lists. It facilitates the management of image data by allowing users to easily merge and track the number of images from various sources.","github_url":"https://github.com/M1kep/Comfy_KepListStuff","github_stars":null,"from_index":0,"to_index":0,"is_existed":true},{"id":81206,"unique_id":"1cc97ed3bc709de3f23c378eef1ce74e","name":"Merge_Image_List","name_oral":"Merge Image List","description":"This node is designed to merge a list of image tensors into a single tensor, facilitating batch processing in image-related tasks. It efficiently concatenates the input images along a specified dimension, enabling seamless integration of multiple images for further processing.","github_url":"https://github.com/AInseven/ComfyUI-fastblend","github_stars":null,"from_index":0,"to_index":0,"is_existed":true}]}],"message_id":"f60c3cf2-0b54-47a3-97e3-f536fc992c81"}',format:"markdown",finished:!0,name:"Assistant"}]},{type:"chat",tool:"model_recommend",name:"Give me a Studio Ghibli style LoRA",messages:[{id:"showcase3-1",role:"user",content:"Give me a Studio Ghibli style LoRA",trace_id:"showcase3"},{id:"showcase3-2",role:"ai",content:'{"session_id":"0b26efaf-e417-4344-9942-658fedbbc12c","text":"Which base model would you like for the Studio Ghibli style LoRA? You can choose from the following base models:\\n\\n1. Stable Diffusion v1.5\\n2. Illustrious\\n3. Pony\\n4. Flux.1\\n5. Flux.1 D\\n6. Stable Diffusion XL 1.0","finished":true,"format":"markdown","ext":[{"type":"guides","data":["Stable Diffusion v1.5","Illustrious","Pony","Flux.1","Flux.1 D","Stable Diffusion XL 1.0"]}],"message_id":"cfecdc29-5131-4afa-9807-9fe911e6b670"}',format:"markdown",finished:!0,name:"Assistant"},{id:"showcase3-3",role:"user",content:"Flux.1",trace_id:"showcase3"},{id:"showcase3-4",role:"ai",content:`{"session_id":"0b26efaf-e417-4344-9942-658fedbbc12c","text":"Here are several Studio Ghibli style LoRA models based on Flux.1:\\n\\n1. **Studio Ghibli Style Illustration**  \\n   - Description: This model excels at creating illustrations inspired by Studio Ghibli's style, showcasing whimsical, detailed landscapes and fantasy elements. It emphasizes rich textures, vibrant colors, and intricate natural environments, excelling at creating scenes full of life and warmth to tell stories with distinctive Studio Ghibli characteristics.  \\n   - [Get Link](https://www.liblib.art/modelinfo/51b6a44f87b543a6b21dfbadc2952313)  \\n\\n2. **Studio Ghibli Realism**  \\n   - Description: The model excels at generating Ghibli-style dreamlike landscapes, showcasing lush greenery, bright blues, and harmonious integration between nature and architecture. It captures dreamy scenes with soft fantasy atmosphere, embodying magical realism between tranquil forests and sky castles.  \\n   - ![Example Image 1](https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||20d56a93ad9fd5daeaf043453766b60d.jpg)  \\n   - ![Example Image 2](https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||4fca763050d3e8941193b4230e8e7410.jpg)  \\n   - [Get Link](https://www.liblib.art/modelinfo/c2ea3eebba764e388a3f08c2ca6eed3a)  \\n\\n3. **F.1-Studio Ghibli Style**  \\n   - Description: The model excels at generating anime-style images influenced by Studio Ghibli, presenting vibrant colors, imaginative compositions, and lively expressions. It focuses on generating scenes of young girls in various charming environments, excelling at rendering detailed cloud textures and complex lighting and shadows. \\n   - [Get Link](https://www.liblib.art/modelinfo/5638cc813c264f899b43536e02abfc82)  \\n\\nYou can choose a model that suits your needs.","finished":true,"format":"markdown","ext":[{"type":"model","data":[{"id":375989,"name":"Studio Ghibli Style Illustration","description":"This model excels in creating illustrations inspired by Miyazaki's style, featuring whimsical, detailed landscapes and fantastical elements. It consistently captures scenes brimming with life and warmth, emphasizing lush textures, vibrant colors, and intricate natural settings. This model is adept at generating compositions that convey a sense of wonder and storytelling in a distinctively Miyazaki fashion.","model_type":"LORA","model_algorithm":"Flux.1","model_pics":[],"source_url":"https://www.liblib.art/modelinfo/51b6a44f87b543a6b21dfbadc2952313","unique_id":"c3123b5ab427eebeaae884a3f1fe10cc"},{"id":378349,"name":"Studio Ghibli Realism","description":"The model excels in generating whimsical, serene landscapes with a Ghibli-inspired aesthetic, featuring lush greenery, vibrant blues, and harmonious nature-architecture integration. It captures dreamy sceneries with a soft, fantasy-like ambiance, demonstrating strengths in depicting tranquil forests, ethereal sky castles, and interactions between natural and man-made elements with a magical realism touch.","model_type":"LORA","model_algorithm":"Flux.1","model_pics":["https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||20d56a93ad9fd5daeaf043453766b60d.jpg","https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||4fca763050d3e8941193b4230e8e7410.jpg","https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||b782cc39b8d159cb2c52fbb31b0c51b8.jpg","https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||cddb9c4648639e78805dd2c088f3f039.jpg","https://aib-data-sg.oss-ap-southeast-1.aliyuncs.com/ext-img/comuify/liblib||505b51e94736455c9d78ebe38afc3148||ef8b418d2ad9c6092c14c17e4aa1b051.jpg"],"source_url":"https://www.liblib.art/modelinfo/c2ea3eebba764e388a3f08c2ca6eed3a","unique_id":"256ec6894dd15b42eb60c91fde22b61b"},{"id":385880,"name":"F.1-Studio Ghibli Style","description":"The model excels in generating whimsical anime-style images influenced by Miyazaki's distinct aesthetic, characterized by vibrant colors, playful compositions, and lively expressions. It specializes in scenes featuring young girls in varied enchanting settings, demonstrating strong skills in rendering detailed textures like clouds and intricate lighting. Notably adept at creating charming and imaginative animated environments.","model_type":"LORA","model_algorithm":"Flux.1","model_pics":[],"source_url":"https://www.liblib.art/modelinfo/5638cc813c264f899b43536e02abfc82","unique_id":"cbcbc993133822bccd46f16d49f5a4db"}]}],"message_id":"6903403f-cd32-447e-a9a6-a9247ab77c15"}`,format:"markdown",finished:!0,name:"Assistant"}]},{type:"chat",tool:"prompt",name:"Generate prompt based on my description",messages:[{id:"showcase4-1",role:"user",content:'Please generate an English prompt for me: "A woman in red dancing by the seaside with a bright smile"',trace_id:"showcase4"},{id:"showcase4-2",role:"ai",content:'{"session_id":"6272c460-04da-4b30-9090-1c05406f46e3","text":"woman in a red dress dancing by the seaside, bright smile, high quality, cinematic lighting, detailed, realistic, wide shot","finished":true,"format":"markdown","ext":null,"message_id":"13f0a58e-8670-4457-97da-cbad7a7d7530"}',format:"markdown",finished:!0,name:"Assistant"}]},{type:"genlab",tool:"genlab_prompt",name:"Generate 3 prompts based on my requirements and test each with image generation",messages:[{id:"showcase5-1",role:"user",content:"Generate 3 prompts based on my requirements and test each with image generation",trace_id:"showcase5"},{id:"showcase5-2",role:"ai",content:'{"text":"Please follow the demonstration below to use Genlab to fulfill your prompt debugging requirements.\\n ![](https://aib-vision-hz.oss-accelerate.aliyuncs.com/mood_board%2Finput%2F2025-07-16%2Fab89513606fd4966b0362f95f3f1ab86.gif?OSSAccessKeyId=LTAI5tQyhnsJhtiinV3B1gfV&Expires=2068018398&Signature=3XUgadQjjsGRu46S1fRxA7iDWJU%3D)"}',format:"markdown",finished:!0,name:"Assistant"}]}],Gm=2,$m=[s.jsxs("svg",{t:"1752732936328",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"27395",width:"16",height:"16",children:[s.jsx("path",{d:"M149.333333 661.333333h213.333334v213.333334H149.333333zM753.066667 411.733333l-119.466667-119.466666c-8.533333-8.533333-8.533333-21.333333 0-29.866667l119.466667-119.466667c8.533333-8.533333 21.333333-8.533333 29.866666 0l119.466667 119.466667c8.533333 8.533333 8.533333 21.333333 0 29.866667l-119.466667 119.466666c-8.533333 8.533333-21.333333 8.533333-29.866666 0z",fill:"#1296db","p-id":"27396"}),s.jsx("path",{d:"M256 277.333333m-128 0a128 128 0 1 0 256 0 128 128 0 1 0-256 0Z",fill:"#1296db","p-id":"27397"}),s.jsx("path",{d:"M768 768m-128 0a128 128 0 1 0 256 0 128 128 0 1 0-256 0Z",fill:"#1296db","p-id":"27398"}),s.jsx("path",{d:"M234.666667 512h42.666666v106.666667h-42.666666z",fill:"#1296db","p-id":"27399"}),s.jsx("path",{d:"M256 448l-64 85.333333h128z",fill:"#1296db","p-id":"27400"}),s.jsx("path",{d:"M426.666667 256h106.666666v42.666667h-106.666666z",fill:"#1296db","p-id":"27401"}),s.jsx("path",{d:"M597.333333 277.333333l-85.333333-64v128z",fill:"#1296db","p-id":"27402"}),s.jsx("path",{d:"M746.666667 448h42.666666v106.666667h-42.666666z",fill:"#1296db","p-id":"27403"}),s.jsx("path",{d:"M768 618.666667l64-85.333334h-128z",fill:"#1296db","p-id":"27404"})]}),s.jsxs("svg",{t:"1752729194808",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"11650",width:"16",height:"16",children:[s.jsx("path",{d:"M512 1024C229.2224 1024 0 794.7776 0 512S229.2224 0 512 0s512 229.2224 512 512-229.2224 512-512 512z m0-53.9136a458.0864 458.0864 0 1 0 0-916.1728 458.0864 458.0864 0 0 0 0 916.1728z",fill:"#1296db","p-id":"11651"}),s.jsx("path",{d:"M363.5712 657.9712a8.8576 8.8576 0 0 1 8.8576 8.8576v143.5136A8.8576 8.8576 0 0 1 363.52 819.2H220.5184a8.8576 8.8576 0 0 1-8.8064-9.3184v-143.0528c0-4.864 3.9424-8.8576 8.8064-8.8576h143.0528z m222.6688 0c4.9152 0 8.96 3.9424 9.0624 8.8576v143.0528a9.1136 9.1136 0 0 1-9.0624 8.8064H443.392a9.1136 9.1136 0 0 1-9.1136-8.8064v-143.0528a9.1136 9.1136 0 0 1 9.1136-8.8576h142.7968z m216.5248 0c4.9152 0 8.96 3.9424 9.0624 8.8576v143.0528a9.1136 9.1136 0 0 1-9.0624 8.8064h-142.848a9.1136 9.1136 0 0 1-9.0624-8.8064v-143.0528a9.1136 9.1136 0 0 1 9.1136-8.8576h142.7968z m-25.1904 33.2288h-90.8288a5.7856 5.7856 0 0 0-5.7856 5.632v91.136c0.1024 3.1232 2.6624 5.632 5.7856 5.632h90.8288a5.7856 5.7856 0 0 0 5.7856-5.632v-91.136a5.7856 5.7856 0 0 0-5.7856-5.632z m-215.04 0H471.7056a5.7856 5.7856 0 0 0-5.7856 5.632v91.136c0.1024 3.1232 2.6624 5.632 5.7856 5.632h90.8288a5.7856 5.7856 0 0 0 5.7856-5.632v-91.136a5.7856 5.7856 0 0 0-5.7856-5.632z m-225.28 0H246.4256a5.7856 5.7856 0 0 0-5.7856 5.632v91.136c0.1024 3.1232 2.6624 5.632 5.7856 5.632h90.8288a5.7856 5.7856 0 0 0 5.7856-5.632v-91.136a5.7856 5.7856 0 0 0-5.7856-5.632zM608.8192 204.8H414.72c-6.3488 0-12.032 3.9424-12.032 8.8576v143.0016c0 4.9152 5.4272 8.8576 12.032 8.8576h194.1504c6.656 0 12.0832-3.9424 12.0832-8.8576V213.6576c0-4.9152-5.4272-8.8576-12.0832-8.8576z m53.3504 419.0208v-107.4176h-136.3968v107.1616h-27.2896v-107.1616H361.3696v107.4176h-27.2896V489.3696h163.6864V394.752h27.7504v94.6176h163.9424v134.4512h-27.2896zM584.6528 235.52c5.0176 0 9.1136 2.5088 9.2672 5.632v91.136c-0.1536 3.1232-4.2496 5.632-9.216 5.632H439.296c-4.9664 0-9.0624-2.5088-9.216-5.632V241.152c0.1536-3.1232 4.2496-5.632 9.216-5.632h145.408z",fill:"#1296db","p-id":"11652"})]}),s.jsxs("svg",{t:"1752729509637",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"22212",width:"16",height:"16",children:[s.jsx("path",{d:"M114.0736 307.2l-1.4336 0.73728v418.33472L512 942.08V511.20128z",fill:"#FFFFFF","p-id":"22213"}),s.jsx("path",{d:"M930.73408 302.72512L521.3184 92.16 128.50176 294.07232l-15.86176 8.2944L521.3184 501.76l4.79232-2.16064L931.84 303.45216v-0.3584l-1.10592-0.36864zM526.11072 499.6096L521.3184 501.76l4.79232-2.16064z",fill:"#91D5FF","p-id":"22214"}),s.jsx("path",{d:"M1006.40768 264.31488a68.21888 68.21888 0 0 0-29.04064-30.39232L548.00384 7.68a67.51232 67.51232 0 0 0-62.49472 0L56.50432 232.448a66.44736 66.44736 0 0 0-17.64352 15.74912 73.25696 73.25696 0 0 0-11.02848 14.27456A67.87072 67.87072 0 0 0 20.48 291.76832v439.33696a67.33824 67.33824 0 0 0 36.7616 59.31008l428.99456 224.79872c9.32864 5.29408 19.79392 8.31488 30.5152 8.78592h5.15072a64.53248 64.53248 0 0 0 26.10176-6.9632L976.9984 792.25856A67.33824 67.33824 0 0 0 1013.76 732.93824V291.76832a64.23552 64.23552 0 0 0-7.35232-27.45344z m-80.50688 39.90528l-404.3776 199.168-4.77184 2.56v427.25376L107.60192 719.02208V303.85152l15.81056-8.41728L516.75136 89.67168l408.04352 213.8112 1.10592 0.73728z",fill:"#40A9FF","p-id":"22215"})]}),s.jsx("svg",{t:"1752729587088",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"24973",width:"16",height:"16",children:s.jsx("path",{d:"M153.6 204.8a128 128 0 0 1 128-128h386.9696c21.6576 0 41.984 9.1136 56.6272 24.4736 14.7968 15.5648 37.888 39.168 59.904 58.88 18.688 16.6912 47.36 46.08 64.0512 63.3856 13.824 14.2336 21.248 33.28 21.248 52.8384V819.2a128 128 0 0 1-128 128h-460.8A128 128 0 0 1 153.6 819.2V204.8z m665.6 76.8v-5.2224a24.8832 24.8832 0 0 0-6.912-17.3056c-16.896-17.5616-44.288-45.568-61.3376-60.7744-23.552-21.0944-47.7696-45.8752-62.8736-61.7472a27.0336 27.0336 0 0 0-19.456-8.5504H665.6V256a25.6 25.6 0 0 0 25.6 25.6H819.2z m-204.8-153.6H281.6A76.8 76.8 0 0 0 204.8 204.8v614.4a76.8 76.8 0 0 0 76.8 76.8h460.8A76.8 76.8 0 0 0 819.2 819.2V332.8h-128A76.8 76.8 0 0 1 614.4 256V128zM332.8 307.2a25.6 25.6 0 0 1 25.6-25.6h102.4a25.6 25.6 0 1 1 0 51.2H358.4a25.6 25.6 0 0 1-25.6-25.6z m0 153.6a25.6 25.6 0 0 1 25.6-25.6h307.2a25.6 25.6 0 1 1 0 51.2H358.4a25.6 25.6 0 0 1-25.6-25.6z m0 153.6a25.6 25.6 0 0 1 25.6-25.6h307.2a25.6 25.6 0 1 1 0 51.2H358.4a25.6 25.6 0 0 1-25.6-25.6z",fill:"#1296db","p-id":"24974"})}),s.jsx("svg",{t:"1752729687983",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"26244",width:"16",height:"16",children:s.jsx("path",{d:"M960.547341 839.611479l0-656.56349c0-119.372761-102.850459-119.372761-119.385041-119.372761L184.573227 63.675228c-16.471137 0-119.346155 0-119.346155 119.372761l0 656.56349c0 119.378901 119.346155 119.378901 119.346155 119.378901l656.589073 0c34.458813 0 58.69582-10.053983 76.130911-24.249287 1.105171-0.816598 2.211365-1.633197 3.316535-2.533706 3.960195-3.497661 7.637957-7.231705 10.839883-11.109012 0.938372-1.105171 1.696642-2.301416 2.571568-3.496637C960.367239 883.154181 960.547341 839.611479 960.547341 839.611479L960.547341 839.611479zM187.453834 128.375809l645.788076 0c16.265452 0 58.69582 0 58.69582 58.721403l0 645.725654c0 0-0.115634 33.892925-25.998117 50.125631-43.075051-45.201481-161.341618-169.178097-191.248765-199.054545-22.205745-22.237467-45.170782-27.27725-59.160401-26.51898-30.048363 0.405229-49.489134 19.260669-50.891064 20.893866l-61.872163 53.919027c-12.562107 11.919471-22.964014 1.511423-28.004821-3.554966-37.827537-37.8347-111.092168-103.230106-120.311133-111.394043-6.055926-6.088672-27.502377-25.118074-58.426691-25.851784-16.175401-0.784876-40.720424 4.314259-65.343217 28.943193-22.938432 22.964014-66.950831 63.530942-101.925391 95.418186L128.755967 187.097212C128.756991 128.375809 171.252851 128.375809 187.453834 128.375809L187.453834 128.375809zM128.756991 830.636061l0-28.505217c26.873044-24.218588 110.809735-100.137675 147.1852-136.571469 4.718465-4.685719 11.186783-10.986215 18.361183-10.254551 7.522324 0.058328 14.400988 6.583952 14.452153 6.583952l0 0 2.391467 2.359744c0.822738 0.700965 80.207763 71.380724 118.408807 109.61349 23.298636 23.318078 47.188742 26.784016 62.052265 27.774577 32.92897-0.437975 54.736649-22.438035 54.91675-22.817682l61.782112-53.803393c6.351662-5.998621 12.292977-4.776793 21.215184 4.081968 23.080671 23.136953 102.991676 106.637716 156.185178 162.363901-139.251507-0.058328-540.893051-0.264013-594.22777-0.264013C126.776893 891.287419 128.756991 830.636061 128.756991 830.636061L128.756991 830.636061zM662.076552 549.130665c83.550904 0 151.582347-68.108191 151.582347-151.755286 0-83.672678-68.030419-151.755286-151.582347-151.755286-83.563184 0-151.581324 68.082608-151.581324 151.755286C510.495228 481.022475 578.513368 549.130665 662.076552 549.130665L662.076552 549.130665zM662.076552 309.59515c48.293913 0 87.575568 39.370683 87.575568 87.781252s-39.281655 87.754646-87.575568 87.754646-87.574544-39.3451-87.574544-87.754646S613.782639 309.59515 662.076552 309.59515L662.076552 309.59515zM662.076552 309.59515",fill:"#1296db","p-id":"26245"})})],Hm=()=>{const{dispatch:a,isAutoScroll:d,showcasIng:r}=_n(),u=(p,b=!1,k=()=>{})=>{let w=0;const S=Ze(),N=(E=!1)=>{if(!r.current)return;w+=Gm;const F=typeof p=="string"?p:p?.text||"",U=b?{id:S,role:"user",content:F.slice(0,w)}:{id:S,role:"ai",content:w>F.length&&p?.ext?JSON.stringify({text:F.slice(0,w),ext:p?.ext}):JSON.stringify({text:F.slice(0,w)}),finished:w>F.length,format:"markdown",name:"Assistant"};a({type:E?"ADD_MESSAGE":"UPDATE_MESSAGE",payload:U}),w<=F.length?setTimeout(()=>{N()},10):setTimeout(()=>{k()},500)};N(!0)},f=(p,b)=>{a({type:"SET_LOADING",payload:!0}),u(p,!0,b)},h=(p,b)=>{a({type:"SET_LOADING",payload:!1}),u(p,!1,b)},g=()=>{const p=Me.extensionManager.setting.get("Comfy.Locale");let b=vl,k="welcome to ComfyUI Copilot!";switch(p){case"zh":k="欢迎使用ComfyUI Copilot!",b=Um;break;case"en":default:k="welcome to ComfyUI Copilot!",b=vl;break}return{title:k,list:b}};return s.jsx(Ll,{name:"showcase",children:s.jsxs("div",{className:"bg-gray-100 p-4 rounded-lg",children:[s.jsx("div",{className:"text-xl text-gray-900 font-extrabold text-center mb-4",children:g()?.title}),g()?.list?.map((p,b)=>s.jsxs("div",{className:"min-h-[50px] flex flex-row items-center mt-4 bg-showcase-bg shadow-[0_4px_24px_rgba(0,0,0,0.12)] hover:!shadow-[0_0_12px_2px_#3b82f6] hover:!shadow-[0_0_0_4px_rgba(59,130,246,0.15)] px-4 py-2 rounded-full",onClick:()=>{d.current=!0,r.current=!0;const k=p.messages||[];let w=0;const S=()=>{if(w<k.length){const N=k[w];N.role==="user"?f(N.content,S):h(JSON.parse(N.content||"{}")||"",S),w++}};S()},children:[$m[b],s.jsx("div",{className:"flex-1 text-sm text-gray-900 font-normal ml-4",children:p.name})]},b.toString()))]})})},qm=a=>`https://ui-avatars.com/api/?name=${a||"User"}&background=random`,Vm=_.lazy(()=>wn(()=>import(getImportPath("WorkflowOption-CggLwCTe.js")),__vite__mapDeps([0,1,2,3])).then(a=>({default:a.WorkflowOption}))),Km=_.lazy(()=>wn(()=>import(getImportPath("message-components-wGrDwG40.js")).then(a=>a.N),__vite__mapDeps([3,2,1])).then(a=>({default:a.NodeSearch}))),Jm=_.lazy(()=>wn(()=>import(getImportPath("message-components-wGrDwG40.js")).then(a=>a.D),__vite__mapDeps([3,2,1])).then(a=>({default:a.DownstreamSubgraphs}))),Ym=_.lazy(()=>wn(()=>import(getImportPath("message-components-wGrDwG40.js")).then(a=>a.i),__vite__mapDeps([3,2,1])).then(a=>({default:a.NodeInstallGuide}))),Xm=_.lazy(()=>wn(()=>import(getImportPath("DebugGuide-DLGkTPB4.js")),__vite__mapDeps([4,1,2,3])).then(a=>({default:a.DebugGuide}))),wl=_.lazy(()=>wn(()=>import(getImportPath("DebugResult-PnLX_FEt.js")),__vite__mapDeps([5,1,2,3])).then(a=>({default:a.DebugResult}))),Qm=3;function Zm({messages:a,latestInput:d,onOptionClick:r,installedNodes:u,onAddMessage:f,onUpdateMessage:h,loading:g,isActive:p}){const{isAutoScroll:b}=_n(),[k,w]=_.useState(0),[S,N]=_.useState([]),E=_.useRef(null),P=_.useRef(0),F=_.useRef(0),U=_.useRef(!1),z=_.useRef(new Set);_.useEffect(()=>{a.length<z.current.size/2&&z.current.clear()},[a]);const te=j=>{const D=[...j];for(let J=0;J<D.length;J++){const xe=D[J];if((xe.role==="ai"||xe.role==="tool")&&xe.content)try{const B=JSON.parse(xe.content);if(B.ext){const ke=B.ext.find(X=>X.type==="workflow_rewrite_checkpoint"||X.type==="debug_checkpoint"&&X.data?.checkpoint_type==="workflow_rewrite_start"),ce=B.ext.find(X=>X.type==="workflow_rewrite_complete");if(ke&&J>0){const X=D[J-1];X.role==="user"&&(D[J-1]={...X,ext:[ke]})}if(ce){const X={...B};X.ext=B.ext.filter(fe=>fe.type!=="workflow_rewrite_checkpoint"&&!(fe.type==="debug_checkpoint"&&fe.data?.checkpoint_type==="workflow_rewrite_start")),D[J]={...xe,content:JSON.stringify(X)}}}}catch{}}return D};_.useEffect(()=>{const j=E.current;if(!j)return;const D=()=>{E.current&&(b.current=j.scrollHeight-j.scrollTop-j.clientHeight<=10),F.current=j.scrollHeight};return j.addEventListener("scroll",D),()=>j.removeEventListener("scroll",D)},[]);const Q=()=>{E?.current&&b.current&&(E.current.scrollTop=E.current.scrollHeight)},q=j=>{if(j.role==="user")return s.jsx(Qg,{content:j.content,trace_id:j.trace_id,ext:j.ext},j.id);if(j.role==="showcase")return s.jsx(Hm,{});if(j.role==="ai"||j.role==="tool"){const D=qm(j.role);try{const J=JSON.parse(j.content),xe=J.ext?.find(W=>W.type==="workflow"),B=J.ext?.find(W=>W.type==="node"),ke=J.ext?.find(W=>W.type==="downstream_subgraph_search"),ce=J.ext?.find(W=>W.type==="node_install_guide"),X=J.ext?.find(W=>W.type==="param_update"),fe=J.ext?.find(W=>W.type==="workflow_update"),_e=J.ext?.find(W=>W.type==="debug_checkpoint"),R=J.ext?.find(W=>W.type==="workflow_update_complete"),je=J.text==="The workflow has been successfully loaded to the canvas";if(fe&&fe.data){const W=`workflow_update_${j.id}`;if(!z.current.has(W)){const{workflow_data:ye}=fe.data;if(typeof window<"u"&&window.app&&ye)try{wn(async()=>{const{applyNewWorkflow:he}=await import(getImportPath("message-components-wGrDwG40.js")).then(pe=>pe.h);return{applyNewWorkflow:he}},__vite__mapDeps([3,2,1])).then(({applyNewWorkflow:he})=>{const pe=he(ye)}).catch(he=>{})}catch{}z.current.add(W)}}if(X&&X.data){const W=`param_update_${j.id}`;if(!z.current.has(W)){const{changes:ye}=X.data;if(typeof window<"u"&&window.app&&ye)try{wn(async()=>{const{applyParameterChanges:he}=await import(getImportPath("message-components-wGrDwG40.js")).then(pe=>pe.h);return{applyParameterChanges:he}},__vite__mapDeps([3,2,1])).then(({applyParameterChanges:he})=>{const pe=Array.isArray(ye)?ye:[ye],Ie=he(pe)}).catch(he=>{})}catch{}z.current.add(W)}}let H=null;if(xe)H=s.jsx(_.Suspense,{fallback:s.jsx("div",{children:"Loading..."}),children:s.jsx(Vm,{content:j.content,name:j.name,avatar:D,latestInput:d,installedNodes:u,onAddMessage:f,onFinishLoad:Q})});else if(B)H=s.jsx(_.Suspense,{fallback:s.jsx("div",{children:"Loading..."}),children:s.jsx(Km,{content:j.content,name:j.name,avatar:D,installedNodes:u,onFinishLoad:Q})});else if(ke){const W=s.jsx(_.Suspense,{fallback:s.jsx("div",{children:"Loading..."}),children:s.jsx(Jm,{content:j.content,name:j.name,avatar:D,onAddMessage:f,onFinishLoad:Q})});if(j.metadata?.intent==="downstream_subgraph_search")return s.jsx(xs,{content:j.content,name:j.name,avatar:D,format:j.format,onOptionClick:r,extComponent:W,metadata:j.metadata,finished:j.finished,debugGuide:j.debugGuide},j.id);H=W}else ce?H=s.jsx(_.Suspense,{fallback:s.jsx("div",{children:"Loading..."}),children:s.jsx(Ym,{content:j.content,onLoadSubgraph:()=>{if(j.metadata?.pendingSubgraph){const W=Object.values(Me.canvas.selected_nodes)[0];if(W){const ye=j.metadata.pendingSubgraph,he=ye.json.nodes,pe=ye.json.links,Ie=he.find(Ae=>Ae.id===0),Pe=Ie?.id,rt={};Pe&&(rt[Pe]=W),Me.canvas.emitBeforeChange();try{for(const Ae of he)if(Ae.id!==Pe){const We=Ie?.pos||[0,0],et=W._pos||[0,0],ht=[Ae.pos[0]+et[0]-We[0],Ae.pos[1]+et[1]-We[1]];rt[Ae.id]=Zg(Ae.type,{pos:ht})}}finally{Me.canvas.emitAfterChange()}for(const Ae of pe){const We=rt[Ae.origin_id],et=rt[Ae.target_id];We&&et&&We.connect(Ae.origin_slot,et,Ae.target_slot)}}else alert("Please select a upstream node first before adding a subgraph.")}else if(j.metadata?.pendingWorkflow){const W=j.metadata.pendingWorkflow,ye=j.metadata.optimizedParams;if(W.nodes)Me.loadGraphData(W);else{Me.loadApiJson(W);const pe=Object.keys(W),Ie=Object.keys(Me.graph._nodes_by_id)[0],Pe=Me.graph._nodes_by_id[Ie],rt=Pe?Pe.pos[0]:0,Ae=Pe?Pe.pos[1]:0,We=250,et=60,ht=20,vt=60,zt=50,st=1e3;let gt=rt,Qt=Ae,Be=0;for(const Zt of pe){const tt=Me.graph._nodes_by_id[Zt];if(tt){Be>st&&(gt+=We+vt,Be=0,Qt=Ae);const Wt=tt.inputs?tt.inputs.length:0,Je=tt.outputs?tt.outputs.length:0,Ct=tt.widgets?tt.widgets.length:0,wt=Math.max(Wt,Je)+Ct,Bt=ht*wt+et;tt.size[0]=We,tt.size[1]=Bt,tt.pos[0]=gt,tt.pos[1]=Qt,Be+=Bt+zt,Qt+=Bt+zt}}}for(const[pe,Ie,Pe,rt,Ae]of ye){const We=Me.graph._nodes_by_id[pe].widgets;for(const et of We)et.name===rt&&(et.value=Ae)}Me.graph.setDirtyCanvas(!1,!0);const he={id:Ze(),role:"tool",content:JSON.stringify({text:"The workflow has been successfully loaded to the canvas",ext:[]}),format:"markdown",name:"Assistant"};f?.(he)}},onFinishLoad:Q})}):je||j.format==="debug_guide"?H=s.jsx(_.Suspense,{fallback:s.jsx("div",{children:"Loading..."}),children:s.jsx(Xm,{content:j.content,name:j.name,avatar:D,onAddMessage:f,onUpdateMessage:h,onFinishLoad:Q,messageId:j.id})}):_e?H=s.jsx(_.Suspense,{fallback:s.jsx("div",{children:"Loading..."}),children:s.jsx(wl,{content:j.content,name:j.name,avatar:D,format:j.format,onFinishLoad:Q})}):fe&&(H=s.jsx(_.Suspense,{fallback:s.jsx("div",{children:"Loading..."}),children:s.jsx(wl,{content:j.content,name:j.name,avatar:D,format:j.format,onFinishLoad:Q})}));return(je||j.format==="debug_guide")&&H||_e&&H||fe&&H?H:J.text||H?s.jsx(xs,{content:j.content,name:j.name,avatar:D,format:j.format,onOptionClick:r,extComponent:H,metadata:j.metadata,finished:j.finished,debugGuide:j.debugGuide},j.id):H||s.jsx(xs,{content:j.content,name:j.name,avatar:D,format:j.format,onOptionClick:r,metadata:j.metadata,finished:j.finished,debugGuide:j.debugGuide},j.id)}catch{return s.jsx(xs,{content:j.content,name:j.name,avatar:D,format:j.format,onOptionClick:r,metadata:j.metadata,finished:j.finished,debugGuide:j.debugGuide},j.id)}}return null},G=j=>{const D=j?.buttonStatus==="not_used";return s.jsx("div",{className:"flex justify-center items-center",children:D?s.jsx("button",{className:"w-full h-[24px] text-gray-700 text-xs bg-transparent hover:!bg-gray-100 px-2 py-1 rounded-md",onClick:Z,children:"Load more"}):s.jsx("div",{className:"w-full h-[24px] bg-transparent"})},j.id)};function re(j){return j&&typeof j=="object"&&j.buttonType==="loadmore"}const Z=()=>{U.current=!0,w(j=>j+1)};return _.useEffect(()=>{const j=te(a);let D=[];if(P.current>0&&P.current<j.length)D=j.slice(P.current),j[P.current].role==="user"&&D.unshift({id:`${j[P.current].id}_loadmore`,buttonType:"loadmore",buttonStatus:"used"}),N(J=>[...J,...D]);else{let J=0,xe=j?.length;for(let B=j?.length-1;B>=0;B--)if(j[B].role==="ai"||B===0)if(J>Qm+k){D.unshift({id:`${j[B].id}_loadmore`,buttonType:"loadmore",buttonStatus:"not_used"});break}else J++,D?.length>0&&D.unshift({id:`${j[B].id}_loadmore`,buttonType:"loadmore",buttonStatus:"used"}),D=[...j?.slice(Math.min(xe,B===0?B:B+1),xe+1),...D],xe=B;N(D)}P.current=j.length},[a,k]),_.useLayoutEffect(()=>{E?.current&&(U.current?(E.current.scrollTop=E.current.scrollHeight-F.current,U.current=!1):b.current&&(E.current.scrollTop=E.current.scrollHeight),F.current=E.current.scrollHeight)},[S]),s.jsxs("div",{className:"flex-1 flex-col overflow-y-auto p-4 h-0",ref:E,style:{display:p?"block":"none"},children:[S?.map(j=>!!j&&(re(j)?G(j):q(j))),g&&s.jsx(Bm,{})]})}async function ep(){try{return await(await kr.fetchApi("/object_info",{method:"GET"})).json()}catch(a){throw console.error("Error fetching object info:",a),a}}async function tp(){const a=await ep();return Object.keys(a)}async function np(a){return await(await kr.fetchApi("/prompt",{method:"POST",body:JSON.stringify(a)})).json()}async function rp(a){try{const d=await kr.fetchApi("/queue",{method:"POST",body:JSON.stringify(a)});if(!d.ok)throw new Error(`Failed to manage queue: ${d.status} ${d.statusText}`);return d}catch(d){throw console.error("Error managing queue:",d),d}}async function sp(){try{const a=await kr.fetchApi("/interrupt",{method:"POST"});if(!a.ok)throw new Error(`Failed to interrupt processing: ${a.status} ${a.statusText}`);return a}catch(a){throw console.error("Error interrupting processing:",a),a}}async function ip(a){try{const d=await kr.fetchApi(`/history/${a}`,{method:"GET"});if(!d.ok)throw new Error(`Failed to fetch history: ${d.status} ${d.statusText}`);return await d.json()}catch(d){throw console.error("Error fetching history:",d),d}}function op(a=!0){_.useEffect(()=>{if(!a)return;const d=vs.debounce(r=>{document.documentElement.style.setProperty("--mouse-x",`${r.clientX}px`),document.documentElement.style.setProperty("--mouse-y",`${r.clientY}px`)},16);return document.addEventListener("mousemove",d),()=>{d.cancel(),document.removeEventListener("mousemove",d)}},[a])}function ap(a=!0){const{state:d,dispatch:r}=_n(),{activeTab:u,screenState:f}=d;_.useEffect(()=>{if(!a)return;const h=g=>{const p=u==="parameter-debug",b=u==="chat";//!screenState || screenState.currentScreen === 0;
if(b||p){const k=Me.canvas.selected_nodes;Object.keys(k??{}).length?r({type:"SET_SELECTED_NODE",payload:Object.values(k)}):r({type:"SET_SELECTED_NODE",payload:null})}};return document.addEventListener("click",h),()=>{document.removeEventListener("click",h)}},[r,a,u,f])}const lp=({selectedNodes:a,handleParamSelect:d,selectedParams:r,handleNext:u,handleClose:f})=>{const g=a.flatMap(p=>(p.widgets||[]).map(b=>b.name)).some(p=>r[p]===!0);return s.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[s.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Select parameters"}),s.jsx("p",{className:"text-xs text-gray-500",children:"multiple selections supported"})]}),s.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:f,children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),a.map((p,b)=>{const k=p.title||"Unknown Node",w=p.widgets||[];return s.jsxs("div",{className:"border rounded-md mb-4 overflow-hidden",children:[s.jsx("div",{className:"bg-gray-50 px-3 py-2 text-sm font-medium text-gray-700 border-b",children:k}),s.jsx("div",{className:"p-4 space-y-3",children:s.jsx("div",{className:"flex items-center gap-3 flex-wrap",children:w.map((S,N)=>{const E=S.name;return s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:`w-5 h-5 rounded-full border flex items-center justify-center ${r[E]?"border-red-500 bg-red-100":"border-gray-300"}`,onClick:P=>d(E,P),children:r[E]&&s.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"})}),s.jsx("span",{className:"ml-2 text-gray-700 text-xs",children:E})]},`widget-${N}`)})})})]},`node-${b}`)}),s.jsx("div",{className:"mt-6 flex justify-center",children:s.jsx("button",{onClick:p=>u(p),disabled:!g,className:`px-3 py-1.5 text-xs ${g?"bg-pink-200 text-pink-700 hover:bg-pink-300":"bg-gray-200 text-gray-500 cursor-not-allowed"} rounded-md transition-colors`,children:"Next"})})]})},cp=({selectedNodes:a,paramTestValues:d,selectedParams:r,updateParamTestValues:u,toggleDropdown:f,openDropdowns:h,handleTestValueSelect:g,searchTerms:p,handleSearch:b,handleSelectAll:k,handleNext:w,handlePrevious:S,handleClose:N,inputValues:E,updateState:P,textInputs:F,handleTextInputChange:U,handleAddTextInput:z,handleRemoveTextInput:te,openAiWritingModal:Q})=>{const q=(G,re,Z,j=0)=>{if(G=isNaN(G)?0:G,re=isNaN(re)?100:re,Z=isNaN(Z)||Z<=0?1:Z,re<G&&(re=G),Math.floor((re-G)/Z)+1<=1)return[G];const J=[];let xe=G;for(;xe<=re;){const B=Math.pow(10,j),ke=Math.round(xe*B)/B;J.push(ke),xe+=Z}return J};return _.useEffect(()=>{!a||a.length===0||a.forEach(G=>{const re=G.id.toString(),Z=G.widgets||{};Object.values(Z).forEach(D=>{const J=D.name;if(!r[J])return;if(!(d[re]?.[J]?.length>0)&&D.type==="number"){const B=D.options?.min||0,ke=D.options?.max||100;let ce=(D.options?.step||10)/10;ce<.1&&(ce=.1);const X=D.options?.precision||0,fe=q(B,ke,ce,X);if(fe.length>0){u(re,J,fe);const _e=`${re}_${J}`;P(me.InputValues,{...E,[_e]:{min:B.toString(),max:ke.toString(),step:ce.toString()}})}}if(D.type==="customtext"||D.type.toLowerCase().includes("text")){const B=`${re}_${J}`,ke=F[B]||[""];JSON.stringify(ke)!==JSON.stringify(d[re]?.[J]||[""])&&u(re,J,ke)}})})},[a,r,d,F,u,q]),s.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[s.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Set test values"}),s.jsx("p",{className:"text-xs text-gray-500",children:"Configure the test values for each parameter"})]}),s.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:N,children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),a.length>0?a.map((G,re)=>{const Z=G.widgets||{},j=Object.values(Z),D=G.id;return s.jsxs("div",{className:"border rounded-md mb-4 overflow-hidden",children:[s.jsxs("div",{className:"bg-gray-50 px-3 py-2 text-xs font-medium text-gray-700 border-b flex justify-between items-center",children:[s.jsxs("span",{children:[G.type," (ID: ",D,")"]}),s.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:J=>N(J,re),children:s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),s.jsx("div",{className:"p-4 space-y-4",children:j.map((J,xe)=>{const B=J.name;if(!r[B])return null;const ke=`${D}_${B}`;if(J.type==="customtext"||J.type.toLowerCase().includes("text")){const ce=F[ke]||[""];return s.jsxs("div",{className:"border-b pb-3",children:[s.jsxs("div",{className:"flex justify-between items-center mb-2",children:[s.jsxs("label",{className:"text-xs font-medium text-gray-700",children:[B,":"]}),s.jsxs("button",{className:"px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs flex items-center hover:bg-blue-200 transition-colors",onClick:()=>Q(D,B),children:[s.jsx("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),"AI Writing"]})]}),s.jsx("div",{className:"space-y-2",children:ce.map((X,fe)=>s.jsxs("div",{className:"flex items-start",children:[s.jsx("textarea",{className:`flex-1 border ${X?"border-gray-300":"border-red-500"} rounded p-2 text-xs resize-y`,rows:2,placeholder:"Enter text...",value:X,onChange:_e=>U(D,B,fe,_e.target.value),required:!0}),s.jsx("button",{className:"ml-2 text-red-500 hover:text-red-700",onClick:()=>te(D,B,fe),title:"Remove",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},fe))}),s.jsxs("button",{className:"mt-2 px-2 py-1 border border-dashed border-gray-300 rounded text-xs text-gray-600 hover:bg-gray-50 flex items-center",onClick:()=>z(D,B),children:[s.jsx("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Add Text"]})]},xe)}if(J.type==="number"){const ce=J.options?.min||0,X=J.options?.max||100,fe=(J.options?.step||10)/10,_e=J.options?.precision||0,R=q(ce,X,fe,_e),je=E[ke]||{min:ce.toString(),max:X.toString(),step:fe.toString()};return s.jsxs("div",{className:"border-b pb-3",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("label",{className:"text-xs font-medium text-gray-700",children:[B,":"]}),s.jsx("div",{className:"w-4"})]}),s.jsxs("div",{className:"flex space-x-2 items-center",children:[s.jsx("label",{className:"text-xs text-gray-600",children:"Min"}),s.jsx("input",{type:"text",className:"w-12 h-6 border border-gray-300 rounded text-xs px-2",value:je.min,required:!0,onClick:H=>{H.preventDefault(),H.stopPropagation()},onChange:H=>{H.preventDefault(),H.stopPropagation();const W=H.target.value;if(P(me.InputValues,{...E,[ke]:{...E[ke],min:W}}),W===""||!isNaN(parseFloat(W))){const ye=W===""?0:parseFloat(W),he=parseFloat(je.max||X.toString()),pe=parseFloat(je.step||fe.toString()),Ie=q(ye,he,pe,_e);u(D,B,Ie)}}}),s.jsx("label",{className:"text-xs text-gray-600",children:"Max"}),s.jsx("input",{type:"text",className:"w-12 h-6 border border-gray-300 rounded text-xs px-2",value:je.max,onClick:H=>{H.preventDefault(),H.stopPropagation()},required:!0,onChange:H=>{H.preventDefault(),H.stopPropagation();const W=H.target.value;if(P(me.InputValues,{...E,[ke]:{...E[ke],max:W}}),W===""||!isNaN(parseFloat(W))){const ye=parseFloat(je.min||ce.toString()),he=W===""?ye:parseFloat(W),pe=parseFloat(je.step||fe.toString()),Ie=q(ye,he,pe,_e);u(D,B,Ie)}}}),s.jsx("label",{className:"text-xs text-gray-600",children:"Step"}),s.jsx("input",{type:"text",className:"w-12 h-6 border border-gray-300 rounded text-xs px-2",value:je.step,required:!0,onClick:H=>{H.preventDefault(),H.stopPropagation()},onChange:H=>{H.preventDefault(),H.stopPropagation();const W=H.target.value;if(P(me.InputValues,{...E,[ke]:{...E[ke],step:W}}),W===""||!isNaN(parseFloat(W))&&parseFloat(W)>0){const ye=parseFloat(je.min||ce.toString()),he=parseFloat(je.max||X.toString());let pe=W===""?1:parseFloat(W);pe<.1&&(pe=.1);const Ie=q(ye,he,pe,_e);u(D,B,Ie)}}})]}),s.jsxs("div",{className:"mt-1",children:[s.jsx("label",{className:"text-xs text-gray-600",children:"Test values"}),s.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:(()=>{const H=d[D]?.[B]||R;if(H.length<=10)return H.map((W,ye)=>s.jsxs("div",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-md flex items-center text-xs cursor-pointer hover:bg-blue-200",onClick:he=>{he.stopPropagation(),g(D,B,W,he)},children:[s.jsx("span",{children:W}),s.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},ye));{const W=H.slice(0,5),ye=H.slice(H.length-5);return s.jsxs(s.Fragment,{children:[W.map((he,pe)=>s.jsxs("div",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-md flex items-center text-xs cursor-pointer hover:bg-blue-200",onClick:Ie=>{Ie.stopPropagation(),g(D,B,he,Ie)},children:[s.jsx("span",{children:he}),s.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},`first-${pe}`)),s.jsx("div",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 rounded-md flex items-center text-xs",children:"..."}),ye.map((he,pe)=>s.jsxs("div",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-md flex items-center text-xs cursor-pointer hover:bg-blue-200",onClick:Ie=>{Ie.stopPropagation(),g(D,B,he,Ie)},children:[s.jsx("span",{children:he}),s.jsx("svg",{className:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},`last-${pe}`))]})}})()})]}),s.jsx("div",{className:"mt-1",children:s.jsx("p",{className:"text-xs text-gray-500",children:"Values are distributed evenly between Min and Max"})})]},xe)}else if(J.type==="combo"){const ce=J.options?.values||[],X=`${D}_${B}`,fe=R=>typeof R=="string"?R:R&&typeof R=="object"&&"name"in R?R.name:String(R),_e=R=>typeof R=="object"&&R!==null&&"name"in R?R.name:R;return s.jsxs("div",{className:"border-b pb-3",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("label",{className:"text-xs font-medium text-gray-700",children:B}),s.jsxs("div",{className:"relative dropdown-container",children:[s.jsxs("button",{className:`appearance-none border ${(d[D]?.[B]||[]).length===0?"border-red-500":"border-gray-300"} rounded px-2 py-0.5 pr-6 text-xs flex items-center bg-white text-gray-700`,onClick:R=>{R.preventDefault(),R.stopPropagation(),f(D,B,R)},"data-dropdown":X,children:[s.jsx("span",{children:(d[D]?.[B]||[]).length>0?`${B}: ${(d[D]?.[B]||[]).length} selected`:`Select ${B}`}),s.jsx("div",{className:"ml-2",children:s.jsx("svg",{className:"fill-current h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:s.jsx("path",{d:"M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"})})})]}),h[X]&&s.jsxs("div",{className:"absolute z-[9999] mt-1 w-64 bg-white border border-gray-300 rounded-md shadow-lg dropdown-menu",style:{position:"fixed",top:typeof h[X]=="object"?`${h[X].y}px`:"0px",left:typeof h[X]=="object"?`${h[X].x}px`:"0px",maxHeight:"300px",overflowY:"auto"},children:[s.jsx("div",{className:"p-2 border-b sticky top-0 bg-white",children:s.jsx("input",{type:"text",className:"w-full px-2 py-0.5 text-xs border border-gray-300 rounded",placeholder:"Search...",value:p[X]||"",onChange:R=>{R.preventDefault(),R.stopPropagation(),b(D,B,R.target.value)},onClick:R=>{R.preventDefault(),R.stopPropagation()},autoFocus:!0})}),s.jsxs("div",{className:"px-3 py-1.5 bg-gray-50 border-b cursor-pointer text-xs flex items-center text-gray-700 hover:bg-gray-100",onClick:R=>{R.preventDefault(),R.stopPropagation();const H=ce.filter(W=>!p[X]||fe(W).toLowerCase().includes((p[X]||"").toLowerCase())).map(_e);k(D,B,H)},children:[s.jsx("div",{className:`w-4 h-4 mr-2 border rounded-sm flex items-center justify-center ${ce.length>0&&(d[D]?.[B]||[]).length===ce.length?"bg-blue-500 border-blue-500":(d[D]?.[B]||[]).length>0?"bg-blue-500 border-blue-500 opacity-50":"border-gray-300"}`,children:(d[D]?.[B]||[]).length>0&&s.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),s.jsx("span",{className:"font-medium",children:ce.length>0&&(d[D]?.[B]||[]).length===ce.length?"Deselect All":"Select All"})]}),s.jsxs("div",{className:"max-h-60 overflow-y-auto",children:[ce.filter(R=>!p[X]||fe(R).toLowerCase().includes((p[X]||"").toLowerCase())).map((R,je)=>s.jsxs("div",{className:"px-3 py-1.5 hover:bg-gray-100 cursor-pointer text-xs flex items-center text-gray-700",onClick:H=>{H.preventDefault(),H.stopPropagation(),g(D,B,_e(R),H)},children:[s.jsx("div",{className:`w-4 h-4 mr-2 border rounded-sm flex items-center justify-center ${(d[D]?.[B]||[]).includes(_e(R))?"bg-blue-500 border-blue-500":"border-gray-300"}`,children:(d[D]?.[B]||[]).includes(_e(R))&&s.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),s.jsx("span",{className:"whitespace-normal overflow-hidden text-ellipsis",children:fe(R)})]},je)),ce.filter(R=>!p[X]||fe(R).toLowerCase().includes((p[X]||"").toLowerCase())).length===0&&s.jsx("div",{className:"px-3 py-4 text-sm text-gray-500 text-center",children:"No matching options"})]})]})]})]}),s.jsxs("div",{className:"mt-2",children:[s.jsx("label",{className:"text-xs text-gray-600",children:"Test values"}),(d[D]?.[B]||[]).length===0&&s.jsx("div",{className:"text-xs text-red-500 mt-1",children:"Please select at least one value"}),s.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:(d[D]?.[B]||[]).map((R,je)=>s.jsxs("div",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-md flex items-center text-xs",children:[s.jsx("span",{children:R}),s.jsx("svg",{className:"w-4 h-4 ml-1 cursor-pointer hover:text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",onClick:H=>{H.preventDefault(),H.stopPropagation(),g(D,B,R,H)},children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},je))})]})]},xe)}else return s.jsxs("div",{className:"border-b pb-3",children:[s.jsx("div",{className:"flex justify-between items-center",children:s.jsx("label",{className:"text-xs font-medium text-gray-700",children:B})}),s.jsxs("div",{className:"mt-2",children:[s.jsx("label",{className:"text-xs text-gray-600",children:"Test values"}),s.jsxs("div",{className:"mt-1 flex flex-wrap gap-1",children:[(d[D]?.[B]||[]).map((ce,X)=>s.jsxs("div",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-md flex items-center text-xs",children:[s.jsx("span",{children:ce}),s.jsx("svg",{className:"w-4 h-4 ml-1 cursor-pointer hover:text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",onClick:fe=>{fe.preventDefault(),fe.stopPropagation(),g(D,B,ce,fe)},children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]},X)),s.jsxs("button",{className:"px-2 py-0.5 border border-dashed border-blue-300 text-blue-600 rounded-md text-xs flex items-center hover:bg-blue-50",onClick:ce=>{ce.preventDefault(),ce.stopPropagation();const X=`${B}${(d[D]?.[B]||[]).length+1}`;u(D,B,[...d[D]?.[B]||[],X])},children:[s.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),s.jsx("span",{children:"Add"})]})]})]})]},xe)})})]},re)}):s.jsx("div",{className:"border rounded-md mb-4 p-4 text-center text-gray-500",children:"No nodes selected. Please select a node in the workflow to configure parameters."}),s.jsxs("div",{className:"mt-6 flex justify-between",children:[s.jsx("button",{onClick:G=>S(G),className:"px-3 py-1.5 text-xs bg-gray-100 text-gray-800 rounded-md hover:bg-gray-200 transition-colors",children:"Previous"}),s.jsx("button",{onClick:G=>w(G),className:"px-3 py-1.5 text-xs bg-pink-200 text-pink-700 rounded-md hover:bg-pink-300 transition-colors",children:"Next"})]})]})},dp=({selectedNodes:a,paramTestValues:d,selectedParams:r,totalCount:u,errorMessage:f,handlePrevious:h,handleStartGeneration:g,handleClose:p})=>{const[b,k]=_.useState([]),[w,S]=_.useState(null),[N,E]=_.useState(!1),{dispatch:P}=_n(),F=()=>{const z=Object.values(Me.graph._nodes_by_id),te=[],Q=[];for(const G of z)G.type==="SaveImage"?te.push(G.id):G.type==="PreviewImage"&&Q.push(G.id);const q=[...te,...Q];k(q),q.length===1?S(q[0]):q.length>1&&(E(!0),S(null))};_.useEffect(()=>{F()},[]),_.useEffect(()=>{const z=()=>{if(!Me.canvas.selected_nodes)return;const te=Object.values(Me.canvas.selected_nodes);if(te.length===0)return;const Q=te[0];Q&&(Q.type==="SaveImage"||Q.type==="PreviewImage")&&(console.log("Selected image node:",Q.id),S(Q.id))};return document.addEventListener("click",z),()=>{document.removeEventListener("click",z)}},[]);const U=z=>{if(z&&(z.preventDefault(),z.stopPropagation()),b.length>1&&!w){E(!0);return}g(z,w||void 0)};return s.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[s.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Conform combinations"}),s.jsxs("p",{className:"text-xs text-gray-500",children:["In the selected parameter combinations, there are ",u," total runs. Each run will generate a separate image."]})]}),s.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:p,children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),N&&b.length>1&&s.jsx("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-md text-amber-600 text-xs",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx("div",{className:"flex-shrink-0 mt-0.5",children:s.jsx("svg",{className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),s.jsx("div",{className:"ml-2",children:w===null?`Multiple SaveImage and PreviewImage nodes detected with IDs ${b.join(",")}. Please click the node on canvas.`:`Current node ID is ${w}, please click Start Generation again`})]})}),f&&s.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md text-red-600 text-xs",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx("div",{className:"flex-shrink-0 mt-0.5",children:s.jsx("svg",{className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),s.jsx("div",{className:"ml-2",children:f})]})}),a.length>0?a.map((z,te)=>{const Q=z.type||"Unknown Node",q=z.widgets||[],G=z.id;return s.jsxs("div",{className:"border rounded-md mb-4 overflow-hidden",children:[s.jsxs("div",{className:"bg-gray-50 px-3 py-2 text-xs font-medium text-gray-700 border-b",children:[Q," (ID: ",G,")"]}),s.jsx("div",{className:"p-4 space-y-3",children:q.map((re,Z)=>{const j=re.name;if(!r[j])return null;const D=d[G]?.[j]||[],J=Array.isArray(D)?`[${D.join(", ")}]`:JSON.stringify(D);return s.jsxs("div",{className:Z<q.length-1?"flex justify-between items-center border-b pb-2":"flex justify-between items-center",children:[s.jsx("label",{className:"font-medium text-gray-700 text-xs",children:j}),s.jsx("div",{className:"flex space-x-2 items-center",children:s.jsx("input",{type:"text",className:"w-64 h-7 border border-gray-300 rounded text-xs px-2 bg-gray-50 cursor-not-allowed text-gray-500",readOnly:!0,disabled:!0,value:J,onClick:xe=>xe.preventDefault()})})]},Z)})})]},te)}):s.jsx("div",{className:"border rounded-md mb-4 p-4 text-center text-gray-500 text-xs",children:"No nodes selected. Please select a node in the workflow to configure parameters."}),s.jsxs("div",{className:"mt-6 flex justify-between",children:[s.jsx("button",{onClick:z=>h(z),className:"px-3 py-1.5 text-xs bg-gray-100 text-gray-800 rounded-md hover:bg-gray-200 transition-colors",children:"Previous"}),s.jsx("button",{onClick:z=>U(z),className:`px-3 py-1.5 text-xs rounded-md transition-colors ${b.length>1&&!w?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-pink-200 text-pink-700 hover:bg-pink-300"}`,disabled:b.length>1&&!w,children:"Generate & Compare"})]})]})},up=({selectedNodes:a,paramTestValues:d,selectedParams:r,totalCount:u,completedCount:f,errorMessage:h,handleClose:g,updateState:p,cleanupPolling:b})=>{const k=w=>{w.preventDefault(),w.stopPropagation(),rp({clear:!0}),sp(),b&&b(),p(me.IsProcessing,!1),p(me.CurrentSceen,2)};return s.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 relative",children:[s.jsx("div",{className:"absolute inset-0 bg-gray-500 bg-opacity-30 flex flex-col items-center justify-center z-10",children:s.jsxs("div",{className:"text-center text-gray-800 bg-white p-4 rounded-lg shadow-lg",children:[s.jsx("div",{className:"mb-2 text-sm font-medium",children:"Processing..."}),s.jsxs("div",{className:"text-xs mb-3",children:["Completed ",f," of ",u," runs"]}),s.jsx("div",{className:"w-48 h-2 bg-gray-200 rounded-full overflow-hidden",children:s.jsx("div",{className:"h-full bg-pink-500 transition-all duration-200",style:{width:`${f/u*100}%`}})}),s.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:["Already generated ",f," images"]}),s.jsx("button",{onClick:k,className:"mt-4 px-3 py-1.5 text-xs bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"})]})}),s.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Confirm Test Configuration"}),s.jsxs("p",{className:"text-xs text-gray-500",children:["In the selected parameter combinations, there are ",u," total runs. Each run will generate a separate image."]})]}),s.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:g,children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),h&&s.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md text-red-600 text-xs",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx("div",{className:"flex-shrink-0 mt-0.5",children:s.jsx("svg",{className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),s.jsx("div",{className:"ml-2",children:h})]})}),a.length>0?a.map((w,S)=>{const N=w.type||"Unknown Node",E=w.widgets||[],P=w.id;return s.jsxs("div",{className:"border rounded-md mb-4 overflow-hidden",children:[s.jsxs("div",{className:"bg-gray-50 px-3 py-2 text-xs font-medium text-gray-700 border-b",children:[N," (ID: ",P,")"]}),s.jsx("div",{className:"p-4 space-y-3",children:E.map((F,U)=>{const z=F.name;if(!r[z])return null;const te=d[P]?.[z]||[],Q=Array.isArray(te)?`[${te.join(", ")}]`:JSON.stringify(te);return s.jsxs("div",{className:U<E.length-1?"flex justify-between items-center border-b pb-2":"flex justify-between items-center",children:[s.jsx("label",{className:"font-medium text-gray-700",children:z}),s.jsx("div",{className:"flex space-x-2 items-center",children:s.jsx("input",{type:"text",className:"w-64 h-7 border border-gray-300 rounded text-sm px-2 bg-gray-50 cursor-not-allowed text-gray-500",readOnly:!0,disabled:!0,value:Q,onClick:q=>q.preventDefault()})})]},U)})})]},S)}):s.jsx("div",{className:"border rounded-md mb-4 p-4 text-center text-gray-500",children:"No nodes selected. Please select a node in the workflow to configure parameters."})]})},wr=({visible:a,imageUrl:d,params:r,onClose:u})=>{if(!a)return null;const f=()=>{if(!r||!r.nodeParams)return null;const h=Object.entries(r.nodeParams).map(([g,p])=>{const b=r.nodeNames?.[g]||r.selectedNodeInfoMap&&r.selectedNodeInfoMap[g]||(g.includes("text")?"Text Node":`Node ${g}`),k=Object.entries(p).filter(([w,S])=>typeof S!="object"||S===null).map(([w,S])=>s.jsxs("div",{className:"pl-4 text-sm py-1 flex",children:[s.jsx("span",{className:"text-gray-600 dark:text-gray-400 mr-2",children:"-"}),s.jsxs("span",{className:"font-medium mr-1",children:[w,":"]}),s.jsx("span",{className:"text-gray-700 dark:text-gray-300 break-all",children:String(S)})]},w));return s.jsxs("div",{className:"mb-4",children:[s.jsx("div",{className:"font-semibold text-pink-600 dark:text-pink-400 text-base py-1 border-b border-gray-200 dark:border-gray-700 mb-2",children:b}),k.length>0?k:s.jsx("div",{className:"pl-4 text-sm text-gray-500 italic",children:"nodeParams is null"})]},g)});return s.jsx("div",{className:"overflow-y-auto max-h-full",children:h.length>0?h:s.jsx("div",{className:"text-sm text-gray-500 italic",children:"nodeParams is null"})})};return s.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50",onClick:u,children:s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl flex flex-row w-[90%] max-w-6xl max-h-[90vh] relative m-4 overflow-hidden",onClick:h=>h.stopPropagation(),style:{display:"flex",flexDirection:"row"},children:[s.jsx("button",{className:"absolute top-2 right-2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 p-1 z-10",onClick:u,children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),s.jsx("div",{className:"w-[65%] border-r border-gray-200 dark:border-gray-700",children:s.jsx("div",{className:"p-4 h-full flex items-center justify-center",children:s.jsx("img",{src:d,alt:"Enlarged image",className:"max-w-full max-h-[calc(90vh-2rem)] object-contain"})})}),s.jsx("div",{className:"w-[35%] h-full overflow-hidden flex flex-col",children:s.jsxs("div",{className:"p-4 flex-1 overflow-y-auto",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-800 dark:text-gray-200 mb-4",children:"Parameters"}),r&&!r.nodeParams&&Object.entries(r).filter(([h,g])=>h!=="nodeParams"&&typeof g!="object").map(([h,g])=>s.jsxs("div",{className:"py-1 text-sm text-gray-600 dark:text-gray-300",children:[s.jsxs("span",{className:"font-medium",children:[h,":"]})," ",String(g)]},h)),s.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:f()})]})})]})})};function Xn(a,d,r){let u=r.initialDeps??[],f;function h(){var g,p,b,k;let w;r.key&&((g=r.debug)!=null&&g.call(r))&&(w=Date.now());const S=a();if(!(S.length!==u.length||S.some((P,F)=>u[F]!==P)))return f;u=S;let E;if(r.key&&((p=r.debug)!=null&&p.call(r))&&(E=Date.now()),f=d(...S),r.key&&((b=r.debug)!=null&&b.call(r))){const P=Math.round((Date.now()-w)*100)/100,F=Math.round((Date.now()-E)*100)/100,U=F/16,z=(te,Q)=>{for(te=String(te);te.length<Q;)te=" "+te;return te};console.info(`%c⏱ ${z(F,5)} /${z(P,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*U,120))}deg 100% 31%);`,r?.key)}return(k=r?.onChange)==null||k.call(r,f),f}return h.updateDeps=g=>{u=g},h}function _l(a,d){if(a===void 0)throw new Error("Unexpected undefined");return a}const fp=(a,d)=>Math.abs(a-d)<1.01,hp=(a,d,r)=>{let u;return function(...f){a.clearTimeout(u),u=a.setTimeout(()=>d.apply(this,f),r)}},kl=a=>{const{offsetWidth:d,offsetHeight:r}=a;return{width:d,height:r}},gp=a=>a,mp=a=>{const d=Math.max(a.startIndex-a.overscan,0),r=Math.min(a.endIndex+a.overscan,a.count-1),u=[];for(let f=d;f<=r;f++)u.push(f);return u},pp=(a,d)=>{const r=a.scrollElement;if(!r)return;const u=a.targetWindow;if(!u)return;const f=g=>{const{width:p,height:b}=g;d({width:Math.round(p),height:Math.round(b)})};if(f(kl(r)),!u.ResizeObserver)return()=>{};const h=new u.ResizeObserver(g=>{const p=()=>{const b=g[0];if(b?.borderBoxSize){const k=b.borderBoxSize[0];if(k){f({width:k.inlineSize,height:k.blockSize});return}}f(kl(r))};a.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(p):p()});return h.observe(r,{box:"border-box"}),()=>{h.unobserve(r)}},Sl={passive:!0},Il=typeof window>"u"?!0:"onscrollend"in window,xp=(a,d)=>{const r=a.scrollElement;if(!r)return;const u=a.targetWindow;if(!u)return;let f=0;const h=a.options.useScrollendEvent&&Il?()=>{}:hp(u,()=>{d(f,!1)},a.options.isScrollingResetDelay),g=w=>()=>{const{horizontal:S,isRtl:N}=a.options;f=S?r.scrollLeft*(N&&-1||1):r.scrollTop,h(),d(f,w)},p=g(!0),b=g(!1);b(),r.addEventListener("scroll",p,Sl);const k=a.options.useScrollendEvent&&Il;return k&&r.addEventListener("scrollend",b,Sl),()=>{r.removeEventListener("scroll",p),k&&r.removeEventListener("scrollend",b)}},bp=(a,d,r)=>{if(d?.borderBoxSize){const u=d.borderBoxSize[0];if(u)return Math.round(u[r.options.horizontal?"inlineSize":"blockSize"])}return a[r.options.horizontal?"offsetWidth":"offsetHeight"]},yp=(a,{adjustments:d=0,behavior:r},u)=>{var f,h;const g=a+d;(h=(f=u.scrollElement)==null?void 0:f.scrollTo)==null||h.call(f,{[u.options.horizontal?"left":"top"]:g,behavior:r})};class vp{constructor(d){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let r=null;const u=()=>r||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:r=new this.targetWindow.ResizeObserver(f=>{f.forEach(h=>{const g=()=>{this._measureElement(h.target,h)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(g):g()})}));return{disconnect:()=>{var f;(f=u())==null||f.disconnect(),r=null},observe:f=>{var h;return(h=u())==null?void 0:h.observe(f,{box:"border-box"})},unobserve:f=>{var h;return(h=u())==null?void 0:h.unobserve(f)}}})(),this.range=null,this.setOptions=r=>{Object.entries(r).forEach(([u,f])=>{typeof f>"u"&&delete r[u]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:gp,rangeExtractor:mp,onChange:()=>{},measureElement:bp,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...r}},this.notify=r=>{var u,f;(f=(u=this.options).onChange)==null||f.call(u,this,r)},this.maybeNotify=Xn(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),r=>{this.notify(r)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(r=>r()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var r;const u=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==u){if(this.cleanup(),!u){this.maybeNotify();return}this.scrollElement=u,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((r=this.scrollElement)==null?void 0:r.window)??null,this.elementsCache.forEach(f=>{this.observer.observe(f)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,f=>{this.scrollRect=f,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(f,h)=>{this.scrollAdjustments=0,this.scrollDirection=h?this.getScrollOffset()<f?"forward":"backward":null,this.scrollOffset=f,this.isScrolling=h,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(r,u)=>{const f=new Map,h=new Map;for(let g=u-1;g>=0;g--){const p=r[g];if(f.has(p.lane))continue;const b=h.get(p.lane);if(b==null||p.end>b.end?h.set(p.lane,p):p.end<b.end&&f.set(p.lane,!0),f.size===this.options.lanes)break}return h.size===this.options.lanes?Array.from(h.values()).sort((g,p)=>g.end===p.end?g.index-p.index:g.end-p.end)[0]:void 0},this.getMeasurementOptions=Xn(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled],(r,u,f,h,g)=>(this.pendingMeasuredCacheIndexes=[],{count:r,paddingStart:u,scrollMargin:f,getItemKey:h,enabled:g}),{key:!1}),this.getMeasurements=Xn(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:r,paddingStart:u,scrollMargin:f,getItemKey:h,enabled:g},p)=>{if(!g)return this.measurementsCache=[],this.itemSizeCache.clear(),[];this.measurementsCache.length===0&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(w=>{this.itemSizeCache.set(w.key,w.size)}));const b=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const k=this.measurementsCache.slice(0,b);for(let w=b;w<r;w++){const S=h(w),N=this.options.lanes===1?k[w-1]:this.getFurthestMeasurement(k,w),E=N?N.end+this.options.gap:u+f,P=p.get(S),F=typeof P=="number"?P:this.options.estimateSize(w),U=E+F,z=N?N.lane:w%this.options.lanes;k[w]={index:w,start:E,size:F,end:U,key:S,lane:z}}return this.measurementsCache=k,k},{key:!1,debug:()=>this.options.debug}),this.calculateRange=Xn(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(r,u,f,h)=>this.range=r.length>0&&u>0?wp({measurements:r,outerSize:u,scrollOffset:f,lanes:h}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=Xn(()=>{let r=null,u=null;const f=this.calculateRange();return f&&(r=f.startIndex,u=f.endIndex),this.maybeNotify.updateDeps([this.isScrolling,r,u]),[this.options.rangeExtractor,this.options.overscan,this.options.count,r,u]},(r,u,f,h,g)=>h===null||g===null?[]:r({startIndex:h,endIndex:g,overscan:u,count:f}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=r=>{const u=this.options.indexAttribute,f=r.getAttribute(u);return f?parseInt(f,10):(console.warn(`Missing attribute name '${u}={index}' on measured element.`),-1)},this._measureElement=(r,u)=>{const f=this.indexFromElement(r),h=this.measurementsCache[f];if(!h)return;const g=h.key,p=this.elementsCache.get(g);p!==r&&(p&&this.observer.unobserve(p),this.observer.observe(r),this.elementsCache.set(g,r)),r.isConnected&&this.resizeItem(f,this.options.measureElement(r,u,this))},this.resizeItem=(r,u)=>{const f=this.measurementsCache[r];if(!f)return;const h=this.itemSizeCache.get(f.key)??f.size,g=u-h;g!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(f,g,this):f.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=g,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(f.index),this.itemSizeCache=new Map(this.itemSizeCache.set(f.key,u)),this.notify(!1))},this.measureElement=r=>{if(!r){this.elementsCache.forEach((u,f)=>{u.isConnected||(this.observer.unobserve(u),this.elementsCache.delete(f))});return}this._measureElement(r,void 0)},this.getVirtualItems=Xn(()=>[this.getVirtualIndexes(),this.getMeasurements()],(r,u)=>{const f=[];for(let h=0,g=r.length;h<g;h++){const p=r[h],b=u[p];f.push(b)}return f},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=r=>{const u=this.getMeasurements();if(u.length!==0)return _l(u[Tl(0,u.length-1,f=>_l(u[f]).start,r)])},this.getOffsetForAlignment=(r,u,f=0)=>{const h=this.getSize(),g=this.getScrollOffset();u==="auto"&&(u=r>=g+h?"end":"start"),u==="center"?r+=(f-h)/2:u==="end"&&(r-=h);const p=this.getTotalSize()+this.options.scrollMargin-h;return Math.max(Math.min(p,r),0)},this.getOffsetForIndex=(r,u="auto")=>{r=Math.max(0,Math.min(r,this.options.count-1));const f=this.measurementsCache[r];if(!f)return;const h=this.getSize(),g=this.getScrollOffset();if(u==="auto")if(f.end>=g+h-this.options.scrollPaddingEnd)u="end";else if(f.start<=g+this.options.scrollPaddingStart)u="start";else return[g,u];const p=u==="end"?f.end+this.options.scrollPaddingEnd:f.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(p,u,f.size),u]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(r,{align:u="start",behavior:f}={})=>{f==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(r,u),{adjustments:void 0,behavior:f})},this.scrollToIndex=(r,{align:u="auto",behavior:f}={})=>{f==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),r=Math.max(0,Math.min(r,this.options.count-1));let h=0;const g=10,p=k=>{if(!this.targetWindow)return;const w=this.getOffsetForIndex(r,k);if(!w){console.warn("Failed to get offset for index:",r);return}const[S,N]=w;this._scrollToOffset(S,{adjustments:void 0,behavior:f}),this.targetWindow.requestAnimationFrame(()=>{const E=this.getScrollOffset(),P=this.getOffsetForIndex(r,N);if(!P){console.warn("Failed to get offset for index:",r);return}fp(P[0],E)||b(N)})},b=k=>{this.targetWindow&&(h++,h<g?this.targetWindow.requestAnimationFrame(()=>p(k)):console.warn(`Failed to scroll to index ${r} after ${g} attempts.`))};p(u)},this.scrollBy=(r,{behavior:u}={})=>{u==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+r,{adjustments:void 0,behavior:u})},this.getTotalSize=()=>{var r;const u=this.getMeasurements();let f;if(u.length===0)f=this.options.paddingStart;else if(this.options.lanes===1)f=((r=u[u.length-1])==null?void 0:r.end)??0;else{const h=Array(this.options.lanes).fill(null);let g=u.length-1;for(;g>=0&&h.some(p=>p===null);){const p=u[g];h[p.lane]===null&&(h[p.lane]=p.end),g--}f=Math.max(...h.filter(p=>p!==null))}return Math.max(f-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(r,{adjustments:u,behavior:f})=>{this.options.scrollToFn(r,{behavior:f,adjustments:u},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(d)}}const Tl=(a,d,r,u)=>{for(;a<=d;){const f=(a+d)/2|0,h=r(f);if(h<u)a=f+1;else if(h>u)d=f-1;else return f}return a>0?a-1:0};function wp({measurements:a,outerSize:d,scrollOffset:r,lanes:u}){const f=a.length-1,h=b=>a[b].start;if(a.length<=u)return{startIndex:0,endIndex:f};let g=Tl(0,f,h,r),p=g;if(u===1)for(;p<f&&a[p].end<r+d;)p++;else if(u>1){const b=Array(u).fill(0);for(;p<f&&b.some(w=>w<r+d);){const w=a[p];b[w.lane]=w.end,p++}const k=Array(u).fill(r+d);for(;g>=0&&k.some(w=>w>=r);){const w=a[g];k[w.lane]=w.start,g--}g=Math.max(0,g-g%u),p=Math.min(f,p+(u-1-p%u))}return{startIndex:g,endIndex:p}}const Nl=typeof document<"u"?_.useLayoutEffect:_.useEffect;function _p(a){const d=_.useReducer(()=>({}),{})[1],r={...a,onChange:(f,h)=>{var g;h?Kg.flushSync(d):d(),(g=a.onChange)==null||g.call(a,f,h)}},[u]=_.useState(()=>new vp(r));return u.setOptions(r),Nl(()=>u._didMount(),[]),Nl(()=>u._willUpdate()),u}function kp(a){return _p({observeElementRect:pp,observeElementOffset:xp,scrollToFn:yp,...a})}const Ol=a=>{const{items:d,renderItem:r,minWidth:u=200,gap:f=16}=a,h=_.useRef(null),[g,p]=_.useState(1),[b,k]=_.useState(0);_.useLayoutEffect(()=>{if(!h.current)return;const S=()=>{if(h.current){const E=h.current.offsetWidth,P=Math.max(1,Math.floor(E/(u+f/2)));p(P),k(Math.ceil(d.length/P))}};S();const N=new window.ResizeObserver(vs.debounce(S,50));return N.observe(h.current),()=>N.disconnect()},[]);const w=kp({count:b,getScrollElement:()=>h.current,estimateSize:()=>u+40,overscan:3,gap:f});return s.jsx("div",{ref:h,className:"h-full relative overflow-auto hide-scrollbar",children:s.jsx("div",{style:{height:w.getTotalSize(),position:"relative"},children:w.getVirtualItems().map(S=>{const N=S.index,E=N*g,P=Math.min(E+g,d.length);return s.jsx("div",{"data-index":N,ref:w.measureElement,style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${S.start}px)`,display:"grid",gridTemplateColumns:`repeat(${g}, minmax(${u}px, 1fr))`,gap:`${f}px`},children:d.slice(E,P).map((F,U)=>r(F,E+U))},N)})})})},Sp=({generatedImages:a,selectedImageIndex:d,handleSelectImage:r,handleApplySelected:u,handleClose:f,notificationVisible:h,modalVisible:g,modalImageUrl:p,modalImageParams:b,openImageModal:k,closeImageModal:w})=>{const S=(N,E)=>s.jsxs("div",{className:`relative flex flex-col rounded-lg overflow-hidden border ${d===N.index?"border-pink-500 ring-2 ring-pink-300":"border-gray-200"}`,onClick:P=>r(E,P),children:[s.jsx("button",{className:"absolute top-2 right-2 bg-white bg-opacity-75 rounded-full p-0.5 text-gray-600 hover:text-gray-900 shadow-sm z-10",onClick:P=>k(N.url,N.params,P),children:s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5v-4m0 4h-4m4 0l-5-5"})})}),s.jsx("div",{className:"aspect-square",children:s.jsx("img",{src:N.url,alt:`Generated image ${E+1}`,className:"w-full h-full object-cover"})}),s.jsx("div",{className:"p-2 text-xs text-gray-600 bg-white max-h-16 overflow-y-auto",children:Object.entries(N.params).filter(([P,F])=>P!=="nodeParams"&&typeof F!="object").map(([P,F])=>s.jsxs("div",{children:[P,": ",String(F)]},P))})]},E.toString());return s.jsxs("div",{className:"h-full flex flex-col relative bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[s.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Generation Complete"}),s.jsxs("p",{className:"text-xs text-gray-500",children:["All ",a.length," images have been generated."]})]}),s.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:f,children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),h&&s.jsx("div",{className:"fixed top-4 right-4 bg-green-100 border-l-4 border-green-500 text-green-700 p-3 shadow-md rounded animate-fade-in-out z-50",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"py-1",children:s.jsx("svg",{className:"h-4 w-4 text-green-500 mr-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),s.jsx("p",{className:"text-xs",children:"Parameters has been applied."})]})}),s.jsx("div",{className:"flex-1 min-h-0",children:s.jsx(Ol,{items:a,renderItem:S})}),s.jsx("div",{className:"mt-6 flex justify-end",children:s.jsx("button",{onClick:N=>u(N),className:"px-3 py-1.5 text-xs bg-pink-200 text-pink-700 rounded-md hover:bg-pink-300 transition-colors",disabled:d===null,children:"Apply Selected"})}),s.jsx(wr,{visible:g,imageUrl:p,params:b||{},onClose:w})]})},Ip=({visible:a,aiWritingModalText:d,setAiWritingModalText:r,aiGeneratedTexts:u,aiSelectedTexts:f,aiWritingLoading:h,aiWritingError:g,handleAiWriting:p,toggleTextSelection:b,addSelectedTexts:k,onClose:w})=>a?s.jsx("div",{className:"fixed inset-0 bg-black flex items-center justify-center z-50",children:s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col",children:[s.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"AI Writing Assistant"}),s.jsx("button",{className:"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200",onClick:w,children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),s.jsxs("div",{className:"p-4 overflow-y-auto flex-1",children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 mb-2",children:"Enter text and AI will generate variations"}),s.jsx("textarea",{className:`w-full px-4 py-3 border border-gray-200 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white
                bg-gray-50 dark:bg-gray-700 
                placeholder-gray-500 dark:placeholder-gray-400
                focus:border-blue-500 dark:focus:border-blue-400 
                focus:ring-2 focus:ring-blue-500/20 dark:focus:ring-blue-400/20
                focus:outline-none`,rows:3,placeholder:"Enter some text here...",value:d,onChange:S=>r(S.target.value)}),s.jsx("button",{className:`mt-2 px-4 py-2 rounded-lg text-sm flex items-center transition-colors ${h?"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white"}`,onClick:p,disabled:h,children:h?s.jsxs(s.Fragment,{children:[s.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-gray-500 dark:text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Generating..."]}):s.jsx(s.Fragment,{children:"Generate"})})]}),g&&s.jsx("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800/20 rounded-md text-red-700 dark:text-red-400 text-sm",children:g}),u.length>0&&s.jsxs("div",{className:"mb-4",children:[s.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Generated variations (select items to add):"}),s.jsx("div",{className:"space-y-2 max-h-[40vh] overflow-y-auto p-2",children:u.map((S,N)=>s.jsxs("div",{className:"flex items-start border border-gray-200 dark:border-gray-600 rounded-md p-2",children:[s.jsx("div",{className:"mr-2 mt-1",children:s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:"checkbox",id:`text${N+1}`,checked:!!f[`text${N+1}`],onChange:()=>b(`text${N+1}`),className:"sr-only"}),s.jsx("div",{className:`h-4 w-4 rounded border ${f[`text${N+1}`]?"bg-blue-600 dark:bg-blue-500 border-blue-600 dark:border-blue-500":"border-gray-300 dark:border-gray-600"} flex items-center justify-center cursor-pointer`,onClick:()=>b(`text${N+1}`),children:f[`text${N+1}`]&&s.jsx("svg",{className:"h-3 w-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]})}),s.jsx("label",{htmlFor:`text${N+1}`,className:"text-sm text-gray-700 dark:text-gray-300 cursor-pointer flex-1",children:S})]},N))})]})]}),s.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex justify-end flex-shrink-0",children:[s.jsx("button",{className:`px-5 py-2.5 text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 
            rounded-lg font-medium transition-colors mr-3`,onClick:w,children:"Cancel"}),s.jsx("button",{className:`px-5 py-2.5 rounded-lg font-medium transition-colors ${Object.values(f).every(S=>!S)?"bg-gray-300 dark:bg-gray-600 text-gray-500 dark:text-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white"}`,onClick:k,disabled:Object.values(f).every(S=>!S),children:"Add Selected"})]})]})}):null,$i=a=>{const d=[],r={};if(Object.keys(a).forEach(h=>{const g=parseInt(h),p=a[h]||{},b=Object.keys(p).filter(w=>p[w]&&p[w].length>0);if(b.length===0)return;const k=[[]];b.forEach(w=>{const S=p[w],N=[];k.forEach(E=>{S.forEach(P=>{const F=[...E,{nodeId:g,paramName:w,paramValue:String(P)}];N.push(F)})}),k.length=0,k.push(...N)}),r[h]=k}),Object.keys(r).length===0)return d;if(Object.keys(r).length===1){const h=Object.keys(r)[0];return r[h]}const u=Object.keys(r);let f=r[u[0]];for(let h=1;h<u.length;h++){const g=r[u[h]],p=[];f.forEach(b=>{g.forEach(k=>{p.push([...b,...k])})}),f=p}return f},Np=(a,d)=>{const r={};r.nodeParams={};const u=$i(a);return d<u.length&&u[d].forEach(h=>{const g=h.nodeId.toString(),p=h.paramName,b=h.paramValue;r.nodeParams[g]||(r.nodeParams[g]={}),r.nodeParams[g][p]=b,r[p]=b}),r},Pl="parameter_debug_history",jl=30,Cl=async(a,d,r,u,f)=>{try{const h=Dl(),g={id:Ze(),timestamp:Date.now(),title:Hi(a,d),nodeName:a,params:{...d,nodeNames:{...d.nodeNames||{},[a.split("<")[0]]:a.split("<")[0]}},generatedImages:r,totalCount:u,workflow:f};return h.unshift(g),h.length>jl&&h.splice(jl),localStorage.setItem(Pl,JSON.stringify(h)),g}catch(h){return console.error("Error saving parameter debug history:",h),null}},Dl=()=>{try{const a=localStorage.getItem(Pl);if(a)return JSON.parse(a)}catch(a){console.error("Error loading parameter debug history:",a)}return[]},Fl=a=>{const d=new Date(a);return`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")} ${String(d.getHours()).padStart(2,"0")}:${String(d.getMinutes()).padStart(2,"0")}`},Hi=(a,d)=>{if(d.nodeParams)return Object.entries(d.nodeParams).map(([h,g])=>{let p=a;d.selectedNodeInfoMap&&d.selectedNodeInfoMap[h]&&(p=d.selectedNodeInfoMap[h]);const b=Object.keys(g).slice(0,3);return`${p}<${b.join(",")}>`}).join(";");const r=Object.keys(d).filter(u=>u!=="nodeParams"&&u!=="selectedNodeInfoMap").slice(0,3);return`${a}<${r.join(",")}>`},jp=({historyItems:a,onViewHistoryItem:d,onClose:r})=>s.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 flex flex-col h-full",children:[s.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-base font-medium text-gray-800",children:"Experiments History"}),s.jsxs("p",{className:"text-xs text-gray-500",children:["Last ",a.length," experiments"]})]}),s.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:r,children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),a.length===0?s.jsx("div",{className:"flex-1 flex items-center justify-center text-gray-500 text-sm",children:"No history items found"}):s.jsx("div",{className:"flex-1 overflow-y-auto",children:a.map(u=>s.jsxs("div",{className:"border border-gray-200 rounded-lg mb-3 overflow-hidden",children:[s.jsxs("div",{className:"bg-gray-50 py-2 px-3 flex items-center justify-between border-b",children:[s.jsx("div",{className:"text-[14px] text-gray-600",children:Fl(u.timestamp)}),s.jsx("button",{onClick:()=>d(u),className:"px-3 py-1 text-xs bg-pink-200 text-pink-700 rounded-md hover:bg-pink-300 transition-colors",children:"view"})]}),s.jsx("div",{className:"p-3",children:s.jsx("div",{className:"text-[10px] font-medium text-gray-700",children:Hi(u.nodeName,u.params)})})]},u.id))})]}),Cp=({historyItem:a,selectedImageIndex:d,handleSelectImage:r,handleClose:u,modalVisible:f,modalImageUrl:h,modalImageParams:g,openImageModal:p,closeImageModal:b})=>{const{timestamp:k,nodeName:w,generatedImages:S,params:N}=a,E=(P,F)=>s.jsxs("div",{className:`relative flex flex-col rounded-lg overflow-hidden border ${d===F?"border-pink-500 ring-2 ring-pink-300":"border-gray-200"}`,onClick:U=>r(F,U),children:[s.jsx("button",{className:"absolute top-2 right-2 bg-white bg-opacity-75 rounded-full p-0.5 text-gray-600 hover:text-gray-900 shadow-sm z-10",onClick:U=>p(P.url,P.params,U),children:s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5v-4m0 4h-4m4 0l-5-5"})})}),s.jsx("div",{className:"aspect-square",children:s.jsx("img",{src:P.url,alt:`Generated image ${F+1}`,className:"w-full h-full object-cover"})}),s.jsx("div",{className:"p-2 text-xs text-gray-600 bg-white max-h-16 overflow-y-auto",children:Object.entries(P.params).filter(([U,z])=>U!=="nodeParams"&&typeof z!="object").map(([U,z])=>s.jsxs("div",{children:[U,": ",String(z)]},U))})]},F.toString());return s.jsxs("div",{className:"h-full flex flex-col relative bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[s.jsxs("div",{className:"mb-4 border-b pb-2 flex justify-between items-start",children:[s.jsxs("div",{className:"min-w-0",children:[s.jsx("h3",{className:"text-base font-medium text-gray-800 truncate hover:!break-words hover:!whitespace-normal hover:!overflow-visible",children:Hi(w,N)}),s.jsxs("p",{className:"text-xs text-gray-500",children:[Fl(k)," • ",S.length," images"]})]}),s.jsx("button",{className:"text-gray-400 hover:text-gray-600 mt-0",onClick:u,children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),s.jsx("div",{className:"flex-1 min-h-0",children:s.jsx(Ol,{items:S,renderItem:E})}),s.jsx(wr,{visible:f,imageUrl:h,params:g?{...g,nodeNames:{[a.nodeName.split("<")[0]]:a.nodeName.split("<")[0]}}:void 0,onClose:b})]})},Ep=`
  @keyframes highlight-pulse {
    0% { 
      box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.5);
    }
    70% { 
      box-shadow: 0 0 0 15px rgba(59, 130, 246, 0);
    }
    100% { 
      box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
    }
  }
  
  .highlight-pulse {
    animation: highlight-pulse 1.5s infinite;
    border: 2px solid #3b82f6;
  }

  @keyframes fade-in-out {
    0% { opacity: 0; transform: translateY(-20px); }
    10% { opacity: 1; transform: translateY(0); }
    90% { opacity: 1; transform: translateY(0); }
    100% { opacity: 0; transform: translateY(-20px); }
  }
  
  .animate-fade-in-out {
    animation: fade-in-out 3s forwards;
  }
`,_r="parameter_debug_state",Ap=a=>{try{localStorage.setItem(_r,JSON.stringify(a))}catch(d){console.error("Error saving parameter debug state:",d)}},Lp=()=>{try{const a=localStorage.getItem(_r);if(a)return JSON.parse(a)}catch(a){console.error("Error loading parameter debug state:",a)}return null},Mp=()=>{try{localStorage.removeItem(_r)}catch(a){console.error("Error clearing parameter debug state:",a)}},Tp=(a,d,r,u,f,h)=>{const g=`${a}_${d}`,p=[...f[g]||[]];return p[r]=u,h(me.TextInputs,{...f,[g]:p.map((b,k)=>k===r?u:b)}),p},Op=(a,d,r,u)=>{const f=`${a}_${d}`,h=[...r[f]||[]];return h.push(""),u(me.TextInputs,{...r,[f]:h}),h},Pp=(a,d,r,u,f)=>{const h=`${a}_${d}`,g=[...u[h]||[]];return g.splice(r,1),f(me.TextInputs,{...u,[h]:g}),g},Dp=(a,d,r,u,f)=>{r.preventDefault(),r.stopPropagation();const h=`${a}_${d}`;f(g=>{if(g[h]&&typeof g[h]=="object"?g[h].isOpen:!!g[h])return{...g,[h]:!1};{let b=0,k=0;if(r.currentTarget){const N=r.currentTarget.getBoundingClientRect();b=N.left,k=N.bottom}else b=r.clientX,k=r.clientY+20;const w=window.innerWidth,S=250;return b+S>w&&(b=w-S-10),b<0&&(b=10),{...g,[h]:{isOpen:!0,x:b,y:k}}}})},Fp=(a,d,r,u,f)=>{const h={...u};h[a]||(h[a]={}),h[a][d]=r,f(me.ParamTestValues,h)},Rp=(a,d,r,u,f,h)=>{h&&(h.preventDefault(),h.stopPropagation());const g={...u};g[a]||(g[a]={}),g[a][d]||(g[a][d]=[]);const p=g[a][d];p.includes(r)?g[a][d]=p.filter(b=>b!==r):g[a][d]=[...p,r],f(me.ParamTestValues,g)},zp=(a,d,r,u,f)=>{const h=`${a}_${d}`;f(me.SearchTerms,{...u,[h]:r})},Wp=(a,d,r,u,f)=>{if(!u[a]){f(a,d,r);return}const h=u[a][d]||[];r.length===h.length?f(a,d,[]):f(a,d,[...r])},Bp=(a,d,r,u,f)=>{f&&(f.preventDefault(),f.stopPropagation());const h=d[a];if(u(me.SelectedParams,{...d,[a]:!h}),h){const g={...r};Object.keys(g).forEach(p=>{g[p][a]&&delete g[p][a]}),u(me.ParamTestValues,g)}},Up=(a,d,r,u,f,h,g)=>{g.preventDefault(),g.stopPropagation();const p={...d};if(d.nodeParams){const b={};Object.keys(d.nodeParams).forEach(k=>{const w=r.find(S=>S.id.toString()===k);b[k]=w?w.title||`Node ${k}`:`Node ${k}`}),p.nodeNames=b}else if(Object.keys(d).length>0){const b={};Object.entries(d).forEach(([k,w])=>{(typeof w!="object"||w===null)&&(b[k]=w)}),Object.keys(b).length>0&&(p.nodeParams={default:b},p.nodeNames={default:d.node_name||d.nodeName||"参数"})}u(a),f(p),h(!0)},Gp=(a,d)=>{d&&(d.preventDefault(),d.stopPropagation()),a(!1)},$p=(a,d,r,u,f,h,g,p,b)=>{if(b&&(b.preventDefault(),b.stopPropagation()),a===0){const k={...r};Object.keys(k).forEach(w=>{const S=k[w];Object.keys(S).forEach(N=>{d[N]||delete S[N]})}),p(me.ParamTestValues,k)}if(a===1){const k={...r};f.forEach(S=>{const N=S.id.toString(),E=S.widgets||{};Object.values(E).forEach(P=>{const F=P.name;if(d[F]&&(P.type==="customtext"||P.type.toLowerCase().includes("text"))){const U=`${N}_${F}`,z=u[U]||[""];k[N]=k[N]||{},k[N][F]=z}})}),p(me.ParamTestValues,k);const w=g(k);p(me.TotalCount,w.length)}h(null),p(me.CurrentSceen,Math.min(a+1,2))},Hp=(a,d,r,u,f,h,g,p)=>{if(p&&(p.preventDefault(),p.stopPropagation()),h(null),f&&g(me.IsCompleted,!1),a===1){const b=d.map(S=>S.id.toString()),k=Object.keys(r),w={...r};k.forEach(S=>{b.includes(S)||delete w[S]}),g(me.ParamTestValues,w)}if(a===2||f){const b={...r};Object.entries(u).forEach(([k,w])=>{if(!w||w.length===0)return;const[S,N]=k.split("_");d.some(E=>E.id.toString()===S)&&(b[S]=b[S]||{},JSON.stringify(b[S][N])!==JSON.stringify(w)&&(b[S][N]=w))}),g(me.ParamTestValues,b)}g(me.CurrentSceen,Math.max(a-1,0))},qp=(a,d,r,u,f)=>{f&&(f.preventDefault(),f.stopPropagation()),u(me.CurrentPage,Math.max(1,Math.min(a,Math.ceil(r.length/d))))};function Vp(a,d){try{if(!a)return console.error("Invalid prompt_output: ",a),a;for(const r of d){if(!a[r.nodeId]){console.error(`Node with ID ${r.nodeId} not found`);continue}if(!a[r.nodeId].inputs){console.error(`Inputs not found for node with ID ${r.nodeId}`);continue}a[r.nodeId].inputs[r.paramName]=r.paramValue}return a}catch(r){return console.error("Error updating prompt:",r),a}}async function Kp(a){const d=await Me.graphToPrompt(),r=Vp(d.output,a);console.log("queuePrompt updated_prompt:",r);const u={prompt:r,client_id:Me.api.clientId,extra_data:{extra_pageinfo:{workflow:d.workflow}}};console.debug("queuePrompt request_body.prompt:",r);const f=await np(u);return console.debug("queuePrompt response:",f),f}function El(a){const d=document.createElement("canvas"),r=d.getContext("2d");if(d.width=512,d.height=512,r){r.fillStyle="#f8d7da",r.fillRect(0,0,d.width,d.height),r.strokeStyle="#dc3545",r.lineWidth=4,r.strokeRect(10,10,d.width-20,d.height-20),r.fillStyle="#dc3545",r.beginPath(),r.arc(d.width/2,150,50,0,2*Math.PI),r.fill(),r.fillStyle="white",r.font="bold 80px Arial",r.textAlign="center",r.textBaseline="middle",r.fillText("!",d.width/2,150),r.fillStyle="#721c24",r.font="20px Arial",r.textAlign="center",r.textBaseline="middle";const u=d.width-60,f=30,h=a.split(" ");let g="",p=250;for(let b=0;b<h.length;b++){const k=g+h[b]+" ";r.measureText(k).width>u&&b>0?(r.fillText(g,d.width/2,p),g=h[b]+" ",p+=f):g=k}r.fillText(g,d.width/2,p)}return d.toDataURL("image/png")}async function Jp(a){try{if(!a||a==="")return console.log("No prompt ID provided"),{1:[El("Fail to generate prompt ID")]};const d=await ip(a);if(!d||!d[a])return console.log("Not finished for prompt ID:",a),{};const r=d[a];if(r.status&&r.status.status_str==="error"){console.error("Error for prompt ID:",a);const f=r.status.messages;if(f&&f.length>0){const h=f[f.length-1];if(h&&h.length>0){const g=h[0];return{1:[El(g)]}}}}const u={};if(r.outputs)for(const f in r.outputs){const h=r.outputs[f];if(h&&h.images){u[f]=[];for(const g of h.images)if(g&&g.filename&&g.type){const p=Me?.graph._nodes_by_id?.[f]?.imgs?.[0]?.currentSrc?.split("?")[0];u[f].push(p+"?filename="+encodeURIComponent(g.filename)+"&type="+encodeURIComponent(g.type)+(g.subfolder?"&subfolder="+encodeURIComponent(g.subfolder):""))}console.log("outputImages for nodeId:",f,u[f])}}return u}catch(d){throw console.error("Error getting output images from prompt:",d),d}}function Yp(){const a=Object.values(Me.graph._nodes_by_id),d=[],r=[];for(const u of a)u.type==="SaveImage"?d.push(u.id):u.type==="PreviewImage"&&r.push(u.id);if(console.log("saveNodeIds:",d),console.log("previewNodeIds:",r),d.length===0&&r.length===0)throw new Error("No SaveImage or PreviewImage node found, please add one to the graph");return d.length===1?d[0]:d.length==0&&r.length===1?r[0]:null}async function Xp(a,d){const r=await Jp(a);return Object.keys(r).length===0?null:r[d.toString()]&&r[d.toString()].length>0?r[d.toString()][0]:null}const Qp=async(a,d,r,u,f,h,g,p,b,k)=>{b&&(b.preventDefault(),b.stopPropagation()),zl(f,u);const w=h(a),S=w.length;if(S>100){r(`Cannot generate more than 100 images at once (currently: ${S} images)`);return}r(null),p(me.IsProcessing,!0),p(me.CompletedCount,0),console.log("Generated parameter combinations:",w);let N=null;try{N=(await g.graphToPrompt()).output}catch(U){console.error("Error capturing workflow data:",U)}if(Vt.trackEvent({event_type:"start_generation",message_type:"parameter_debug",message_id:d,data:{workflow:N,all_params:a,count:S}}),w.length===0){r("No valid parameter combinations found. Please check your parameter selections."),p(me.IsProcessing,!1);return}let E=k||null;if(E===null){const U=Yp();U!==null&&(E=U)}if(E===null){r("Please select a SaveImage or PreviewImage node first."),p(me.IsProcessing,!1);return}const P={};Object.keys(a).forEach(U=>{const z=g.graph._nodes_by_id[U];z&&(P[U]=z.type||z.comfyClass||"Unknown Node")});const F=[];try{const U=Date.now().toString();u.current=U;for(const re of w){const Z=await Kp(re);Z.prompt_id?F.push(Z.prompt_id):(console.error("Failed to get prompt_id from response:",Z),F.push(""))}const z=Array(w.length).fill(null).map((re,Z)=>({url:`https://source.unsplash.com/random/300x300?sig=${Math.random()}`,params:Np(a,Z)}));p(me.GeneratedImages,z);const te=Date.now(),Q=5*60*1e3,q=Object.keys(a)[0],G=P[q]||"Unknown Node";Rl(F,E,z,U,te,Q,u,f,p,G,a,S,N,P)}catch(U){console.error("Error generating images:",U),p(me.IsProcessing,!1)}},Rl=async(a,d,r,u,f,h,g,p,b,k,w,S,N,E)=>{if(g.current!==u){console.log("Another polling session has started, stopping this one");return}if(Date.now()-f>h){if(console.log("Timeout reached while waiting for images"),g.current===u&&(b(me.IsProcessing,!1),b(me.IsCompleted,!0),b(me.CurrentPage,1),r.length>0&&k&&w)){const F=r[0].params;E&&(F.selectedNodeInfoMap=E),Cl(k,F,r,S||r.length,N)}return}let P=0;for(let F=0;F<a.length;F++){const U=a[F];if(U)try{const z=await Xp(U,Number(d));z&&(r[F]={...r[F],url:z},P++)}catch(z){console.error(`Error fetching image for prompt ID ${U}:`,z)}}if(b(me.GeneratedImages,[...r]),b(me.CompletedCount,P),P===a.length){if(console.log("All images have been generated!"),g.current===u&&(b(me.IsProcessing,!1),b(me.IsCompleted,!0),b(me.CurrentPage,1),r.length>0&&k&&w)){const F=r[0].params;E&&(F.selectedNodeInfoMap=E),Cl(k,F,r,S||r.length,N)}return}g.current===u&&(p.current=setTimeout(()=>{Rl(a,d,r,u,f,h,g,p,b,k,w,S,N,E)},2e3))},zl=(a,d)=>{a.current&&(clearTimeout(a.current),a.current=null),d.current=null},Zp=async(a,d,r,u,f,h)=>{if(!a.trim()){u("Please enter some text to generate variations");return}r(!0),u(null),f([]),h({});try{const g=await Vt.generateSDPrompts(a);f(g),Vt.trackEvent({event_type:"prompt_generate",message_type:"parameter_debug",message_id:d,data:{input_text:a,generated_texts:g}});const p={};g.forEach((b,k)=>{p[`text${k+1}`]=!1}),h(p)}catch(g){console.error("Error generating text:",g),u("Failed to generate text variations. Please try again.")}finally{r(!1)}},e1=(a,d)=>{d(r=>({...r,[a]:!r[a]}))},t1=(a,d,r,u,f,h,g,p,b,k)=>{const w=`${a}_${d}`,S=Object.entries(r).filter(([P,F])=>F).map(([P])=>{const F=parseInt(P.replace("text",""))-1;return u[F]});if(S.length===0)return;const N=[...g[w]||[]];p(me.TextInputs,{...g,[w]:[...N,...S]}),Vt.trackEvent({event_type:"prompt_apply",message_type:"parameter_debug",message_id:h,data:{input_text:f,generated_texts:u,selected_texts:S}});const E=[...g[w]||[],...S];b(a,d,E),k(!1)},n1=(a,d,r,u,f,h,g,p,b,k)=>{r(!0),u(a),f(d),h(""),g([]),p({}),b(!1),k(null)},r1=(a,d,r,u,f,h,g,p,b,k,w,S,N,E,P,F,U,z,te,Q,q,G,re,Z,j,D,J,xe,B,ke=!1)=>{a(0),d({Steps:!0,CFG:!0,sampler_name:!0,threshold:!1,prompt:!1}),r(Ze()),u(),f(!1),h(!1),g(0),p(12),b(null),k(Array(12).fill(null).map((ce,X)=>({url:`https://source.unsplash.com/random/300x300?sig=${Math.random()}`,params:{step:X%3===0?5:X%3===1?10:15,sampler_name:"euler",cfg:1}}))),w({}),S({}),N({}),E({}),P(1),F(null),U(!1),z(!1),te(""),Q(null),q({}),G(!1),re(""),Z([]),j(!1),D(""),J(""),xe(null),B({}),ke&&Mp()},s1=async(a,d,r,u,f,h,g)=>{if(g&&(g.preventDefault(),g.stopPropagation()),a!==null){console.log(`Applied image ${a+1} with parameters:`,d[a].params);let p=1;if(f){for(const k in f)if(f[k])for(const w in f[k]){const S=f[k][w];if(S){let N=1;Array.isArray(S)?N=S.length>0?S.length:1:typeof S=="object"&&S!==null&&(N=Object.keys(S).length>0?Object.keys(S).length:1),p=p*N}}}Vt.trackEvent({event_type:"parameter_debug_apply",message_type:"parameter_debug",message_id:u,data:{workflow:(await r.graphToPrompt()).output,selected_params:d[a].params,all_params:f,count:p}});const b=d[a].params;b.nodeParams&&(em(b.nodeParams)?(console.log("[stateManagementUtils] Successfully applied selected parameters to canvas"),h(!0),setTimeout(()=>{h(!1)},3e3)):console.warn("[stateManagementUtils] Failed to apply selected parameters to canvas"))}},i1=(a,d,r,u,f,h,g)=>{if(g&&(g.preventDefault(),g.stopPropagation()),a===1&&r!==void 0){const p=[...d];p[r],p.splice(r,1),p.length===0?f&&(u({type:"SET_SCREEN_STATE",payload:null}),h(!0),f()):u({type:"SET_SELECTED_NODE",payload:p});return}f&&(u({type:"SET_SCREEN_STATE",payload:null}),h(!0),f())};var me=(a=>(a.CurrentSceen="currentSceen",a.SelectedParams="selectedParams",a.TaskId="taskId",a.IsProcessing="isProcessing",a.IsCompleted="isCompleted",a.CompletedCount="completedCount",a.TotalCount="totalCount",a.SelectedImageIndex="selectedImageIndex",a.GeneratedImages="generatedImages",a.ParamTestValues="paramTestValues",a.SearchTerms="searchTerms",a.InputValues="inputValues",a.CurrentPage="currentPage",a.TextInputs="textInputs",a))(me||{});const o1=({selectedNodes:a,visible:d,onClose:r})=>{const[u,f]=_.useState(0),[h,g]=_.useState({Steps:!0,CFG:!0,sampler_name:!0,threshold:!1,prompt:!1}),[p,b]=_.useState(Ze()),[k,w]=_.useState(!1),[S,N]=_.useState(!1),[E,P]=_.useState(0),[F,U]=_.useState(12),[z,te]=_.useState(null),[Q,q]=_.useState(()=>Array(12).fill(null).map((M,O)=>({url:`https://source.unsplash.com/random/300x300?sig=${Math.random()}`,params:{step:O%3===0?5:O%3===1?10:15,sampler_name:"euler",cfg:1}}))),[G,re]=_.useState({}),[Z,j]=_.useState({}),[D,J]=_.useState({}),[xe,B]=_.useState({}),[ke,ce]=_.useState(1),X=6,[fe,_e]=_.useState(null),[R,je]=_.useState(!1),[H,W]=_.useState(!1),[ye,he]=_.useState(""),[pe,Ie]=_.useState(null),[Pe,rt]=_.useState({}),[Ae,We]=_.useState(!1),[et,ht]=_.useState(""),[vt,zt]=_.useState([]),[st,gt]=_.useState(!1),[Qt,Be]=_.useState(""),[Zt,tt]=_.useState(""),[Wt,Je]=_.useState(null),[Ct,wt]=_.useState({}),[Bt,Et]=_.useState(!1),[V,ee]=_.useState([]),[ae,Ce]=_.useState(null),{dispatch:Ye}=_n(),Fe=_.useRef(null),Ue=_.useRef(null),Re=_.useRef(!0),[it,mt]=_.useState(()=>d),[Ut,Qn]=_.useState(!1);_.useEffect(()=>{if(Bt){const M=Dl();ee(M)}},[Bt]);const ws=async()=>{Zp(et,p,gt,Je,zt,wt)},_s=(M,O,Se,He)=>{const At=Tp(M,O,Se,He,Pe,$e);dn(M,O,At)},ks=(M,O)=>{const Se=Op(M,O,Pe,$e);dn(M,O,Se)},Sr=(M,O,Se)=>{const He=Pp(M,O,Se,Pe,$e);dn(M,O,He)},Ir=M=>{e1(M,wt)},Ss=()=>{t1(Qt,Zt,Ct,vt,et,p,Pe,$e,dn,We)},Is=(M,O)=>{n1(M,O,We,Be,tt,ht,zt,wt,gt,Je)},Nr=M=>{M&&(M.preventDefault(),M.stopPropagation()),Et(O=>!O)},Ns=M=>{Ce(M),Et(!1),$e("generatedImages",M.generatedImages||[]),$e("selectedImageIndex",null),$e("currentPage",1)},jr=M=>{M&&(M.preventDefault(),M.stopPropagation()),Ce(null)},js=(M,O)=>{console.log("key--->",M,O);const Se={currentScreen:u,selectedParams:h,task_id:p,isProcessing:k,isCompleted:S,completedCount:E,totalCount:F,selectedImageIndex:z,generatedImages:Q,paramTestValues:G,searchTerms:D,inputValues:xe,currentPage:ke,textInputs:Pe};console.log("doSaveState-->",Se),Ap({...Se,[M]:O})},$e=(M,O)=>{switch(M){case"currentSceen":f(O);break;case"selectedParams":g(O);break;case"taskId":b(O);break;case"isProcessing":w(O);break;case"isCompleted":N(O);break;case"completedCount":P(O);break;case"totalCount":U(O);break;case"selectedImageIndex":te(O);break;case"generatedImages":q(O);break;case"paramTestValues":re(O);break;case"searchTerms":J(O);break;case"inputValues":B(O);break;case"currentPage":ce(O);break;case"textInputs":rt(O);break}js(M,O)};_.useEffect(()=>{if(!Ut||!a||a.length===0)return;const M={...G},O=a.map(He=>He.id.toString());Object.keys(M).forEach(He=>{O.includes(He)||delete M[He]}),a.forEach(He=>{const At=He.id.toString();M[At]||(M[At]={})}),JSON.stringify(M)!==JSON.stringify(G)&&$e("paramTestValues",M)},[a,G,Ut]),_.useEffect(()=>{Ye({type:"SET_SCREEN_STATE",payload:{currentScreen:u,isProcessing:k,isCompleted:S}})},[u,k,S,Ye]),_.useEffect(()=>{const M=document.createElement("style");return M.textContent=Ep,document.head.appendChild(M),()=>{document.head.removeChild(M)}},[]),_.useEffect(()=>{const M=O=>{if(Object.values(Z).some(Se=>Se)){const Se=O.target,He=!!Se.closest(".dropdown-menu"),At=!!Se.closest("[data-dropdown]");!He&&!At&&j({})}};return document.addEventListener("mousedown",M),()=>{document.removeEventListener("mousedown",M)}},[Z]),_.useEffect(()=>{d&&(JSON.parse(localStorage.getItem(_r)||"{}").task_id||$e("taskId",Ze()))},[d]),_.useEffect(()=>{if(k&&Re.current){Re.current=!1;let M=0;const O=Object.values(Me.graph._nodes_by_id),Se=[],He=[];for(const Pn of O)Pn.type==="SaveImage"?Se.push(Pn.id):Pn.type==="PreviewImage"&&He.push(Pn.id);const At=[...Se,...He];At.length===1?M=At[0]:At.length>1&&(M=void 0),Er(void 0,M)}},[k]),_.useEffect(()=>{if(d){mt(!0);try{const M=localStorage.getItem(_r);if(M){const O=JSON.parse(M);if(!a||a.length===0){console.log("Not restoring parameter debug state: no nodes selected"),mt(!1);return}O.currentScreen!==void 0&&f(O.currentScreen),O.selectedParams&&g(O.selectedParams),O.task_id&&b(O.task_id),w(O?.isProcessing);const Se=O.generatedImages&&O.generatedImages.length>0;O.isCompleted!==void 0&&Se&&N(O.isCompleted),O.completedCount!==void 0&&P(O.completedCount),O.totalCount!==void 0&&U(O.totalCount),O.selectedImageIndex!==void 0&&te(O.selectedImageIndex),O.generatedImages&&q(O.generatedImages),O.paramTestValues&&re(O.paramTestValues),O.searchTerms&&J(O.searchTerms),O.inputValues&&B(O.inputValues),O.currentPage!==void 0&&ce(O.currentPage),O.textInputs&&rt(O.textInputs),Ut||Qn(!0)}}catch(M){console.error("Error loading parameter debug state:",M)}finally{setTimeout(()=>{mt(!1)},50)}}else mt(!0)},[d,a]);const Cs=(M=!1)=>{r1(f,g,b,tr,w,N,P,U,te,q,re,j,J,B,ce,_e,je,W,he,Ie,rt,We,ht,zt,gt,Be,tt,Je,wt,M),Et(!1),Ce(null)},Tn=M=>{$p(u,h,G,Pe,a,_e,$i,$e,M)},Zn=M=>{Hp(u,a,G,Pe,S,_e,$e,M)},er=(M,O)=>{Bp(M,h,G,$e,O)},Es=(M,O,Se)=>{Dp(M,O,Se,Z,j)},dn=(M,O,Se)=>{Fp(M,O,Se,G,$e)},As=(M,O,Se,He)=>{Rp(M,O,Se,G,$e,He)},Ls=(M,O,Se)=>{zp(M,O,Se,D,$e)},Ms=(M,O,Se)=>{Wp(M,O,Se,G,dn)},Cr=(M,O)=>{qp(M,X,Q,$e,O)},tr=()=>{zl(Fe,Ue)};_.useEffect(()=>()=>{tr()},[]);const Er=async(M,O)=>{Qp(G,p,_e,Ue,Fe,$i,Me,$e,M,O)},nr=(M,O)=>{O&&(O.preventDefault(),O.stopPropagation()),$e("selectedImageIndex",M)},Ar=(M,O,Se)=>{Up(M,O,a,he,Ie,W,Se)},kn=M=>{Gp(W,M)},Ts=async M=>{s1(z,Q,Me,p,G,je,M)},un=(M,O)=>{i1(u,a,O,Ye,r,Cs,M)},On=()=>s.jsx(s.Fragment,{children:s.jsx(wr,{visible:H,imageUrl:ye,params:pe||{},onClose:kn})});return ae?s.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4",onClick:M=>M.stopPropagation(),children:s.jsx(Cp,{historyItem:ae,selectedImageIndex:z,handleSelectImage:nr,handleClose:jr,currentPage:ke,handlePageChange:Cr,imagesPerPage:X,modalVisible:H,modalImageUrl:ye,modalImageParams:pe,openImageModal:Ar,closeImageModal:kn})}):Bt?s.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4 flex flex-col h-full max-h-[80vh]",onClick:M=>M.stopPropagation(),children:s.jsx(jp,{historyItems:V,onViewHistoryItem:Ns,onClose:Nr})}):it&&d&&a.length>0?s.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 bg-gray-50 overflow-y-auto",onClick:M=>M.stopPropagation(),children:[s.jsxs("div",{className:"p-8 rounded-lg shadow-sm relative flex flex-col items-center",children:[s.jsx("div",{className:"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),s.jsx("div",{className:"mt-4 text-gray-600 text-sm",children:"Loading interface..."})]}),s.jsx(wr,{visible:H,imageUrl:ye,params:pe||{},onClose:kn})]}):!d||a.length===0?s.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 bg-gray-50 overflow-y-auto",onClick:M=>M.stopPropagation(),children:[s.jsxs("div",{className:"max-w-lg p-8 rounded-lg shadow-sm border border-blue-100 relative",children:[s.jsxs("div",{className:"absolute top-3 right-3 flex",children:[s.jsx("button",{className:"text-blue-500 hover:text-blue-700 mr-2",onClick:Nr,title:"Show History",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z",clipRule:"evenodd"})})}),s.jsx("button",{className:"text-gray-400 hover:text-gray-600",onClick:un,children:s.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),s.jsxs("div",{className:"mb-6 text-center",children:[s.jsx("h3",{className:"text-base font-bold text-blue-600 mb-2",children:"GenLab"}),s.jsx("div",{className:"h-1 w-16 bg-blue-500 mx-auto rounded-full mb-4"})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"text-left mb-4",children:[s.jsx("h3",{className:"text-sm font-medium text-gray-800 mb-3",children:"Batch-test parameters & find the best combo in one click."}),s.jsx("div",{className:"h-px w-full bg-gray-200 my-4"})]}),s.jsxs("div",{className:"text-left",children:[s.jsx("h4",{className:"text-base font-medium text-gray-800 mb-4",children:"How to use"}),s.jsxs("div",{className:"space-y-2 mb-4",children:[s.jsxs("p",{className:"text-sm text-gray-700",children:[s.jsx("span",{className:"font-bold",children:"1 - "}),"Click any node(hold Shift to select multiple nodes)"]}),s.jsxs("p",{className:"text-sm text-gray-700",children:[s.jsx("span",{className:"font-bold",children:"2 - "}),"Set parameter ranges and start batch generation."]})]}),s.jsx("div",{className:"h-px w-full bg-gray-200 my-4"}),s.jsx("p",{className:"text-sm text-blue-600 mt-6",children:"Let's select a node to begin!"})]})]})]}),s.jsx(wr,{visible:H,imageUrl:ye,params:pe||{},onClose:kn})]}):S?s.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4",onClick:M=>M.stopPropagation(),children:s.jsx(Sp,{generatedImages:Q,selectedImageIndex:z,handleSelectImage:nr,handleApplySelected:Ts,handlePrevious:Zn,handleClose:un,currentPage:ke,handlePageChange:Cr,imagesPerPage:X,notificationVisible:R,modalVisible:H,modalImageUrl:ye,modalImageParams:pe,openImageModal:Ar,closeImageModal:kn})}):k?s.jsxs("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4",onClick:M=>M.stopPropagation(),children:[s.jsx(up,{selectedNodes:a,paramTestValues:G,selectedParams:h,totalCount:F,completedCount:E,errorMessage:fe,handleClose:un,updateState:$e,cleanupPolling:tr}),s.jsx(On,{})]}):u===0?s.jsxs("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4 flex flex-col h-full max-h-[80vh]",onClick:M=>M.stopPropagation(),children:[s.jsx(lp,{selectedNodes:a,handleParamSelect:er,selectedParams:h,handleNext:Tn,handleClose:un}),s.jsx(On,{})]}):u===1?s.jsxs("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4 flex flex-col h-full max-h-[80vh]",onClick:M=>M.stopPropagation(),children:[s.jsx(cp,{selectedNodes:a,paramTestValues:G,selectedParams:h,updateParamTestValues:dn,toggleDropdown:Es,openDropdowns:Z,handleTestValueSelect:As,searchTerms:D,handleSearch:Ls,handleSelectAll:Ms,handleNext:Tn,handlePrevious:Zn,handleClose:un,inputValues:xe,updateState:$e,textInputs:Pe,handleTextInputChange:_s,handleAddTextInput:ks,handleRemoveTextInput:Sr,openAiWritingModal:Is}),s.jsx(Ip,{visible:Ae,aiWritingModalText:et,setAiWritingModalText:ht,aiGeneratedTexts:vt,aiSelectedTexts:Ct,aiWritingLoading:st,aiWritingError:Wt,handleAiWriting:ws,toggleTextSelection:Ir,addSelectedTexts:Ss,onClose:()=>We(!1)}),s.jsx(On,{})]}):s.jsxs("div",{className:"flex-1 overflow-y-auto bg-gray-50 p-4 flex flex-col h-full max-h-[80vh]",onClick:M=>M.stopPropagation(),children:[s.jsx(dp,{selectedNodes:a,paramTestValues:G,selectedParams:h,totalCount:F,errorMessage:fe,handlePrevious:Zn,handleStartGeneration:Er,handleClose:un}),s.jsx(On,{})]})},a1=a=>{const{dispatch:d}=_n(),[r,u]=_.useState(!1);return _.useEffect(()=>{if(a.visible&&!r){const f=Lp();f&&f.screenState&&d({type:"SET_SCREEN_STATE",payload:{currentScreen:f.currentScreen,isProcessing:f.isProcessing,isCompleted:f.isCompleted}}),u(!0)}},[a.visible,r,d]),_.useEffect(()=>()=>{a.visible||d({type:"SET_SCREEN_STATE",payload:null})},[a.visible,d]),s.jsx(o1,{...a})},l1=({message:a,onClose:d})=>a?s.jsxs("div",{className:`bg-gradient-to-r from-gray-50 to-gray-100 
            border border-gray-300 px-2 py-1 mt-2 ml-2 mr-2 relative shadow-sm rounded-sm`,children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"flex-shrink-0 mr-1",children:s.jsx("svg",{className:"w-3.5 h-3.5 text-gray-700",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),s.jsx("div",{className:"text-gray-700 font-medium leading-relaxed pr-6 markdown-content",style:{fontSize:"11px"},children:s.jsx(tm,{rehypePlugins:[[Vg,{target:"_blank",rel:["noopener","noreferrer"]}]],remarkPlugins:[qg],className:"prose !text-[11px] prose-a:text-gray-700 prose-a:underline prose-a:font-medium hover:prose-a:text-gray-800",components:{a:({node:r,...u})=>s.jsx("a",{...u,className:"text-gray-700 underline hover:text-gray-800 transition-colors",style:{fontSize:"11px"}}),p:({children:r})=>s.jsx("span",{className:"inline",style:{fontSize:"11px"},children:r}),span:({children:r})=>s.jsx("span",{style:{fontSize:"11px"},children:r}),li:({children:r})=>s.jsx("li",{style:{fontSize:"11px"},children:r}),ul:({children:r})=>s.jsx("ul",{style:{fontSize:"11px"},children:r}),ol:({children:r})=>s.jsx("ol",{style:{fontSize:"11px"},children:r})},children:a})})]}),s.jsx("button",{onClick:d,className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-700 hover:text-gray-800 transition-colors p-1 rounded-full hover:bg-gray-800","aria-label":"Close announcement",children:s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}):null,c1=()=>{const{state:a,dispatch:d}=_n(),{selectedNode:r,screenState:u}=a,f=r||[],h=()=>{d({type:"SET_SELECTED_NODE",payload:null}),d({type:"SET_SCREEN_STATE",payload:null}),localStorage.removeItem("screenState")};return s.jsx("div",{className:"flex-1 flex flex-col overflow-y-auto",children:s.jsx(a1,{selectedNodes:f,visible:!0,onClose:h})})},Al=({active:a,onClick:d,children:r})=>s.jsx("button",{onClick:d,className:`px-4 py-2 font-medium text-xs transition-colors duration-200 border-b-2 ${a?"text-[#71A3F2] border-[#71A3F2]":"text-gray-600 border-transparent hover:!text-[#71A3F2] hover:!border-[#71A3F2]"}`,children:r});function p1({onClose:a,visible:d=!0,triggerUsage:r=!1,onUsageTriggered:u}){const{state:f,dispatch:h,isAutoScroll:g,showcasIng:p}=_n(),{messages:b,installedNodes:k,loading:w,sessionId:S,selectedNode:N,activeTab:E}=f;_.useRef(null);const[P,F]=_.useState(""),[U,z]=_.useState(""),[te,Q]=_.useState(window.innerWidth/3),[q,G]=_.useState(!1),[re,Z]=_.useState([]),[j,D]=_.useState("gemini-2.5-flash"),[J,xe]=_.useState(window.innerHeight),[B,ke]=_.useState(0),[ce,X]=_.useState(""),[fe,_e]=_.useState(!1),R=_.useRef(null);_.useRef(N);const[je,H]=_.useState("None");op(d&&E==="chat"),ap(d),_.useEffect(()=>{vr.init().catch(console.error)},[]),_.useEffect(()=>{b.length>0&&S&&Be(b)},[b,S]),_.useEffect(()=>{switch(je){case"Usage":zt();break;case"Parameters":st();break;case"DownstreamNodes":Qt();break}H("None")},[je]),_.useEffect(()=>{if(E!=="chat")return;(async()=>{const ee=await tp();console.log("[WorkflowChat] Received installed nodes:",ee.length),h({type:"SET_INSTALLED_NODES",payload:ee})})()},[E]);const W=()=>{h({type:"SET_MESSAGES",payload:[{id:Ze(),role:"showcase",content:""}]})},ye=async V=>{try{const ee=await vr.getSession(V);if(ee&&ee.messages.length>0){h({type:"SET_MESSAGES",payload:ee.messages});return}const ae=await Vt.fetchMessages(V);ae?.length>0?h({type:"SET_MESSAGES",payload:ae}):W()}catch(ee){console.error("Error fetching messages:",ee)}};_.useEffect(()=>{if(E!=="chat")return;let V=localStorage.getItem("sessionId");V?(h({type:"SET_SESSION_ID",payload:V}),ye(V)):(V=Ze(),h({type:"SET_SESSION_ID",payload:V}),localStorage.setItem("sessionId",V))},[E]),_.useEffect(()=>{const V=localStorage.getItem("activeTab");V&&h({type:"SET_ACTIVE_TAB",payload:V});const ee=localStorage.getItem("screenState");ee&&h({type:"SET_SCREEN_STATE",payload:JSON.parse(ee)});const ae=()=>{H("Usage")},Ce=()=>{H("Parameters")},Ye=()=>{H("DownstreamNodes")};return window.addEventListener(Yn.TOOLBOX_USAGE,ae),window.addEventListener(Yn.TOOLBOX_PARAMETERS,Ce),window.addEventListener(Yn.TOOLBOX_DOWNSTREAMNODES,Ye),()=>{window.removeEventListener(Yn.TOOLBOX_USAGE,ae),window.removeEventListener(Yn.TOOLBOX_PARAMETERS,Ce),window.removeEventListener(Yn.TOOLBOX_DOWNSTREAMNODES,Ye)}},[]),_.useEffect(()=>{localStorage.setItem("activeTab",E)},[E]),_.useEffect(()=>{f.screenState&&localStorage.setItem("screenState",JSON.stringify(f.screenState))},[f.screenState]);const he=bs.useCallback(V=>{if(!q)return;const ee=window.innerWidth-V.clientX,ae=Math.min(Math.max(300,ee),window.innerWidth*.8);Q(ae)},[q]),pe=bs.useMemo(()=>vs.debounce(he,16),[he]);_.useEffect(()=>(q&&(document.addEventListener("mousemove",pe),document.addEventListener("mouseup",Je)),()=>{document.removeEventListener("mousemove",pe),document.removeEventListener("mouseup",Je),pe.cancel()}),[q,pe]);const Ie=V=>{F(V.target.value)},Pe=()=>{R.current&&(R.current.abort(),R.current=null,h({type:"SET_LOADING",payload:!1}))},rt=async()=>{if(b?.[0]?.role==="showcase"&&h({type:"CLEAR_MESSAGES"}),g.current=!0,p.current=!1,h({type:"SET_LOADING",payload:!0}),P.trim()===""&&!N||!S)return;z(P);const V=Ze(),ee={id:Ze(),role:"user",content:P,trace_id:V};h({type:"ADD_MESSAGE",payload:ee}),F(""),R.current=new AbortController;try{const ae={type:"model_select",data:[j]};let Ce=Ze(),Ye=!0;for await(const Fe of Vt.streamInvokeServer(S,P,re.map(Ue=>Ue.file),null,ae,V,R.current.signal,f.messages)){const Ue={id:Ce,role:"ai",content:JSON.stringify(Fe),format:Fe.format,finished:Fe.finished,name:"Assistant"};if(Ye)h({type:"ADD_MESSAGE",payload:Ue}),Ye=!1;else{h({type:"UPDATE_MESSAGE",payload:Ue});const Re=f.messages.map(it=>it.id===Ue.id&&!it.finished?Ue:it);Be(Re)}Fe.finished&&(h({type:"SET_LOADING",payload:!1}),R.current=null)}}catch(ae){ae instanceof Error&&ae.name==="AbortError"?console.log("User aborted the request"):console.error("Error sending message:",ae),h({type:"SET_LOADING",payload:!1}),R.current=null}finally{Z([])}},Ae=async V=>{if(!S)return;h({type:"SET_LOADING",payload:!0}),z(V);const ee=Ze(),ae={id:Ze(),role:"user",content:V,trace_id:ee};h({type:"ADD_MESSAGE",payload:ae}),R.current=new AbortController;try{const Ce={type:"model_select",data:[j]};let Ye=Ze(),Fe=!0;for await(const Ue of Vt.streamInvokeServer(S,V,re.map(Re=>Re.file),null,Ce,ee,R.current.signal,f.messages)){const Re={id:Ye,role:"ai",content:JSON.stringify(Ue),format:Ue.format,finished:Ue.finished,name:"Assistant"};if(Fe)h({type:"ADD_MESSAGE",payload:Re}),Fe=!1;else{h({type:"UPDATE_MESSAGE",payload:Re});const it=f.messages.map(mt=>mt.id===Re.id&&!mt.finished?Re:mt);Be(it)}Ue.finished&&(h({type:"SET_LOADING",payload:!1}),R.current=null)}}catch(Ce){Ce instanceof Error&&Ce.name==="AbortError"?console.log("User aborted the request"):console.error("Error sending message:",Ce),h({type:"SET_LOADING",payload:!1}),R.current=null}finally{Z([])}},We=V=>{V.metaKey&&V.key==="Enter"&&rt()},et=()=>{p.current=!1,h({type:"CLEAR_MESSAGES"});const V=f.sessionId;V&&localStorage.removeItem(`messages_${V}`),localStorage.removeItem("sessionId");const ee=Ze();h({type:"SET_SESSION_ID",payload:ee}),localStorage.setItem("sessionId",ee),setTimeout(()=>{W()},500)},ht=V=>{F(V)},vt=async(V,ee)=>{if(!S||!N)return;h({type:"SET_LOADING",payload:!0});const ae=N[0].comfyClass||N[0].type,Ce=Ze(),Ye={id:Ze(),role:"user",content:ae,trace_id:Ce};h({type:"ADD_MESSAGE",payload:Ye}),R.current=new AbortController;try{let Fe=Ze(),Ue=!0;for await(const Re of Vt.streamInvokeServer(S,ae,[],V,ee,Ce,R.current.signal,f.messages)){const it={id:Fe,role:"ai",content:JSON.stringify(Re),format:Re.format,finished:Re.finished,name:"Assistant"};if(V&&V!==""&&(it.metadata={intent:V}),Ue)h({type:"ADD_MESSAGE",payload:it}),Ue=!1;else{h({type:"UPDATE_MESSAGE",payload:it});const mt=f.messages.map(Ut=>Ut.id===it.id&&!Ut.finished?it:Ut);Be(mt)}Re.finished&&(h({type:"SET_LOADING",payload:!1}),R.current=null)}}catch(Fe){Fe instanceof Error&&Fe.name==="AbortError"?console.log("User aborted the request"):console.error("Error sending message:",Fe),h({type:"SET_LOADING",payload:!1}),R.current=null}},zt=()=>{Ae(`Reply in ${navigator.language} language: How does the ${N?.[0]?.type} node work? I need its official usage guide.`)},st=()=>{Ae(`Reply in ${navigator.language} language: Show me the technical specifications for the ${N?.[0].type} node's inputs and outputs.`)},gt=()=>{const V=new Set;function ee(ae,Ce){if(!(!ae||Ce>=1)&&ae.inputs)for(const Ye of Object.values(ae.inputs)){const Fe=Ye.link;if(Fe&&Me.graph.links[Fe]){const Ue=Me.graph.links[Fe].origin_id,Re=Me.graph._nodes_by_id[Ue];Re&&(V.add(Re.type),ee(Re,Ce+1))}}}return N[0]?(ee(N[0],0),[{type:"upstream_node_types",data:Array.from(V)}]):null},Qt=()=>{vt("downstream_subgraph_search",gt())},Be=async V=>{if(f.sessionId){localStorage.setItem(`messages_${f.sessionId}`,JSON.stringify(V));try{await vr.saveSession(f.sessionId,V)}catch(ee){console.error("Failed to save session to IndexedDB:",ee)}}},Zt=V=>{console.log("[WorkflowChat] Adding new message:",V);const ee=[...f.messages,V];h({type:"ADD_MESSAGE",payload:V}),Be(ee)},tt=V=>{const ee=f.messages.map(ae=>ae.id===V.id&&!ae.finished?V:ae);h({type:"UPDATE_MESSAGE",payload:V}),Be(ee)},Wt=(V,ee)=>{h({type:"SET_SESSION_ID",payload:V}),h({type:"SET_MESSAGES",payload:ee}),localStorage.setItem("sessionId",V),localStorage.setItem(`messages_${V}`,JSON.stringify(ee))},Je=()=>{G(!1)},Ct=V=>{const ee=Array.from(V).map(ae=>({id:Math.random().toString(36).substr(2,9),file:ae,preview:URL.createObjectURL(ae)}));Z(ae=>[...ae,...ee])},wt=V=>{Z(ee=>ee.filter(Ce=>Ce.id!==V))};bs.useEffect(()=>()=>{re.forEach(V=>URL.revokeObjectURL(V.preview))},[re]),_.useEffect(()=>{r&&u&&E==="chat"&&(vt("node_explain"),u())},[r,E]),_.useEffect(()=>{if(!d||E!=="chat")return;(async()=>{try{const ee=new Date().toDateString();if(localStorage.getItem("announcementLastShownDate")!==ee){const Ce=await Vt.fetchAnnouncement();Ce&&Ce.trim()!==""&&(X(Ce),_e(!0),localStorage.setItem("announcementLastShownDate",ee))}}catch(ee){console.error("Error fetching announcement:",ee)}})()},[d,E]);const Bt=()=>{_e(!1)},Et=V=>{h({type:"SET_ACTIVE_TAB",payload:V})};return d?s.jsxs("div",{className:"flex flex-col h-full w-full bg-white relative",style:{display:d?"flex":"none"},children:[s.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1 cursor-ew-resize hover:bg-gray-300"}),s.jsxs("div",{className:"flex h-full flex-col",children:[s.jsx(Pm,{onClose:a,onClear:et,hasMessages:b.length>0,title:"ComfyUI-Copilot",onSelectSession:Wt,currentSessionId:S}),s.jsxs("div",{className:"flex border-b border-gray-200 mt-2",children:[s.jsx(Al,{active:E==="chat",onClick:()=>Et("chat"),children:"Chat"}),s.jsx(Al,{active:E==="parameter-debug",onClick:()=>Et("parameter-debug"),children:"GenLab"})]}),fe&&ce&&E==="chat"&&s.jsx(l1,{message:ce,onClose:Bt}),s.jsx(Zm,{messages:b,latestInput:U,onOptionClick:ht,installedNodes:k,onAddMessage:Zt,onUpdateMessage:tt,loading:w,isActive:E==="chat"}),s.jsxs("div",{className:"border-t px-4 py-3 border-gray-200 bg-white sticky bottom-0",style:{display:E==="chat"?"block":"none"},children:[N&&s.jsx(Wm,{nodeInfo:N,onSendWithIntent:vt,loading:w,onSendWithContent:Ae}),s.jsx(Rm,{input:P,loading:w,onChange:Ie,onSend:rt,onKeyPress:We,onUploadImages:Ct,uploadedImages:re,onRemoveImage:wt,selectedModel:j,onModelChange:D,onStop:Pe,onAddDebugMessage:Zt})]}),s.jsx("div",{className:"flex-1 flex flex-col h-0",style:{display:E==="parameter-debug"?"flex":"none"},children:s.jsx(c1,{})})]})]}):null}export{p1 as default};
